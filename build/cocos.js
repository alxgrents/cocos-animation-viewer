var cc=cc||{};window.cc=cc,cc._tmp=cc._tmp||{},cc._LogInfos={};var _p=window,_p=Object.prototype,_p=null;cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,window.ENABLE_IMAEG_POOL=!0,cc.each=function(t,e,i){if(t)if(t instanceof Array)for(var n=0,r=t.length;n<r&&!1!==e.call(i,t[n],n);n++);else for(n in t)if(!1===e.call(i,t[n],n))break},cc.extend=function(t){var e=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return cc.each(e,(function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})),t},cc.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},cc.isFunction=function(t){return"function"==typeof t},cc.isNumber=function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},cc.isString=function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},cc.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},cc.isUndefined=function(t){return void 0===t},cc.isObject=function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},cc.isCrossOrigin=function(t){if(!t)return cc.log("invalid URL"),!1;var e=t.indexOf("://");return-1!==e&&(-1===(e=t.indexOf("/",e+3))?t:t.substring(0,e))!==location.origin},cc.AsyncPool=function(t,e,i,n,r){var o=this;o._finished=!1,o._srcObj=t,o._limit=e,o._pool=[],o._iterator=i,o._iteratorTarget=r,o._onEnd=n,o._onEndTarget=r,o._results=t instanceof Array?[]:{},o._errors=t instanceof Array?[]:{},cc.each(t,(function(t,e){o._pool.push({index:e,value:t})})),o.size=o._pool.length,o.finishedSize=0,o._workingSize=0,o._limit=o._limit||o.size,o.onIterator=function(t,e){o._iterator=t,o._iteratorTarget=e},o.onEnd=function(t,e){o._onEnd=t,o._onEndTarget=e},o._handleItem=function(){var t=this;if(!(0===t._pool.length||t._workingSize>=t._limit)){var e=t._pool.shift(),i=e.value,n=e.index;t._workingSize++,t._iterator.call(t._iteratorTarget,i,n,function(e,i){t._finished||(e?t._errors[this.index]=e:t._results[this.index]=i,t.finishedSize++,t._workingSize--,t.finishedSize===t.size?t.onEnd(0===t._errors.length?null:t._errors,t._results):t._handleItem())}.bind(e),t)}},o.flow=function(){if(0===this._pool.length)this._onEnd&&this._onEnd.call(this._onEndTarget,null,[]);else for(var t=0;t<this._limit;t++)this._handleItem()},o.onEnd=function(t,e){if(o._finished=!0,o._onEnd){var i=o._onEnd,n=o._onEndTarget;o._onEnd=null,o._onEndTarget=null,i.call(n,t,e)}}},cc.async={series:function(t,e,i){return(t=new cc.AsyncPool(t,1,(function(t,e,n){t.call(i,n)}),e,i)).flow(),t},parallel:function(t,e,i){return(t=new cc.AsyncPool(t,0,(function(t,e,n){t.call(i,n)}),e,i)).flow(),t},waterfall:function(t,e,i){var n=[],r=[null],o=new cc.AsyncPool(t,1,(function(e,o,c){n.push((function(e){n=Array.prototype.slice.call(arguments,1),t.length-1===o&&(r=r.concat(n)),c.apply(null,arguments)})),e.apply(i,n)}),(function(t){if(e){if(t)return e.call(i,t);e.apply(i,r)}}));return o.flow(),o},map:function(t,e,i,n){var r=e;return"object"==typeof e&&(i=e.cb,n=e.iteratorTarget,r=e.iterator),(t=new cc.AsyncPool(t,0,r,i,n)).flow(),t},mapLimit:function(t,e,i,n,r){return(t=new cc.AsyncPool(t,e,i,n,r)).flow(),t}},cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){return(t=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t))?t[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");return 0<i&&(t=t.substring(0,i)),(i=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,"")))?(i=i[2],e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i):null},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return 0<i&&(n=t.substring(i),t=t.substring(0,i)),0>(i=t.lastIndexOf("."))?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="";return i=i?this.extname(t):"",0<n&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),t.substring(0,0>=n?0:n+1)+e+i+r},_normalize:function(t){var e;t=String(t);do{e=t,t=t.replace(this.normalizeRE,"")}while(e.length!==t.length);return t}};var imagePool={_pool:Array(10),_MAX:10,_smallImg:"data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",count:0,get:function(){if(0<this.count){this.count--;var t=this._pool[this.count];return this._pool[this.count]=null,t}return new Image},put:function(t){var e=this._pool;t instanceof HTMLImageElement&&this.count<this._MAX&&(t.src=this._smallImg,e[this.count]=t,this.count++)}};if(cc.loader=function(){var t={},e={},i={},n={},r={},o=/^(?:https?|ftp):\/\/\S*$/i;return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){var t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");return void 0===t.ontimeout&&(t._timeoutId=-1,t.timeout=cc.game.config[cc.game.CONFIG_KEY.requestDefaultTimeout]),t},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(1===t.length)r[1]=e instanceof Array?e:[e];else if(2===t.length)"function"==typeof i?(r[1]=e instanceof Array?e:[e],r[2]=i):(r[0]=e||"",r[1]=i instanceof Array?i:[i]);else{if(3!==t.length)throw Error("arguments error to load js!");r[0]=e||"",r[1]=i instanceof Array?i:[i],r[2]=n}return r},isLoading:function(t){return void 0!==r[t]},loadJs:function(e,i,n){var r=this,o=(s=r._getArgs4Js(arguments))[0],c=s[1],s=s[2];-1<navigator.userAgent.indexOf("Trident/5")?r._loadJs4Dependency(o,c,0,s):cc.async.map(c,(function(e,i,n){if(e=cc.path.join(o,e),t[e])return n(null);r._createScript(e,!1,n)}),s)},loadJsWithImg:function(t,e,i){var n=this._loadJsImg(),r=this._getArgs4Js(arguments);this.loadJs(r[0],r[1],(function(t){if(t)throw Error(t);n.parentNode.removeChild(n),r[2]&&r[2]()}))},_createScript:function(e,i,n){var r=document,o=document.createElement("script");o.async=i,t[e]=!0,cc.game.config.noCache&&"string"==typeof e?this._noCacheRex.test(e)?o.src=e+"&_t="+(new Date-0):o.src=e+"?_t="+(new Date-0):o.src=e,o.addEventListener("load",(function(){o.parentNode.removeChild(o),this.removeEventListener("load",arguments.callee,!1),n()}),!1),o.addEventListener("error",(function(){o.parentNode.removeChild(o),n("Load "+e+" failed!")}),!1),r.body.appendChild(o)},_loadJs4Dependency:function(t,e,i,n){if(i>=e.length)n&&n();else{var r=this;r._createScript(cc.path.join(t,e[i]),!1,(function(o){if(o)return n(o);r._loadJs4Dependency(t,e,i+1,n)}))}},_loadJsImg:function(){var t=document,e=t.getElementById("cocos2d_loadJsImg");if(!e){e=document.createElement("img"),cc._loadingImage&&(e.src=cc._loadingImage),(t=t.getElementById(cc.game.config.id)).style.backgroundColor="transparent",t.parentNode.appendChild(e);var i=getComputedStyle?getComputedStyle(t):t.currentStyle;i||(i={width:t.width,height:t.height}),e.style.left=t.offsetLeft+(parseFloat(i.width)-e.width)/2+"px",e.style.top=t.offsetTop+(parseFloat(i.height)-e.height)/2+"px",e.style.position="absolute"}return e},loadTxt:function(t,e){if(cc._isNodeJs)require("fs").readFile(t,(function(t,i){t?e(t):e(null,i.toString())}));else{var i=this.getXMLHttpRequest(),n="load "+t+" failed!";if(i.open("GET",t,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent))i.setRequestHeader("Accept-Charset","utf-8"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n},null))};else{i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8");var r=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c),4===i.readyState&&(200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n},null))},o=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c),e({status:i.status,errorMessage:n},null)},c=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c),e({status:i.status,errorMessage:"Request timeout: "+n},null)};i.addEventListener("load",r),i.addEventListener("error",o),void 0===i.ontimeout?i._timeoutId=setTimeout((function(){c()}),i.timeout):i.addEventListener("timeout",c)}i.send(null)}},loadCsb:function(t,e){var i=cc.loader.getXMLHttpRequest(),n="load "+t+" failed!";i.open("GET",t,!0),i.responseType="arraybuffer";var r=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c);var t=i.response;t&&(window.msg=t),4===i.readyState&&(200===i.status||0===i.status?e(null,i.response):e({status:i.status,errorMessage:n},null))},o=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c),e({status:i.status,errorMessage:n},null)},c=function(){i.removeEventListener("load",r),i.removeEventListener("error",o),0<=i._timeoutId?clearTimeout(i._timeoutId):i.removeEventListener("timeout",c),e({status:i.status,errorMessage:"Request timeout: "+n},null)};i.addEventListener("load",r),i.addEventListener("error",o),void 0===i.ontimeout?i._timeoutId=setTimeout((function(){c()}),i.timeout):i.addEventListener("timeout",c),i.send(null)},loadJson:function(t,e){this.loadTxt(t,(function(i,n){if(i)e(i);else{try{var r=JSON.parse(n)}catch(i){return void e("parse json ["+t+"] failed : "+i)}e(null,r)}}))},_checkIsImageURL:function(t){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t)},loadImg:function(t,e,i,n){var o={isCrossOrigin:!0};if(void 0!==i?o.isCrossOrigin=void 0===e.isCrossOrigin?o.isCrossOrigin:e.isCrossOrigin:void 0!==e&&(i=e),e=this.getRes(t))return i&&i(null,e),null;if(e=r[t])return e.callbacks.push(i),e.img;(n=n||imagePool.get()).crossOrigin=o.isCrossOrigin&&"file://"!==location.origin?"Anonymous":null;var c=function(){this.removeEventListener("load",c,!1),this.removeEventListener("error",a,!1);var e=r[t];if(e){for(var i=e.callbacks,o=0;o<i.length;++o){var s=i[o];s&&s(null,n)}e.img=null,delete r[t]}window.ENABLE_IMAEG_POOL&&cc._renderType===cc.game.RENDER_TYPE_WEBGL&&imagePool.put(n)},s=this,a=function(){if(this.removeEventListener("load",c,!1),this.removeEventListener("error",a,!1),"https:"!==window.location.protocol&&n.crossOrigin&&"anonymous"===n.crossOrigin.toLowerCase())o.isCrossOrigin=!1,s.release(t),cc.loader.loadImg(t,o,i,n);else{var e=r[t];if(e){for(var h=e.callbacks,l=0;l<h.length;++l){var d=h[l];d&&d("load image failed: "+t)}e.img=null,delete r[t]}cc._renderType===cc.game.RENDER_TYPE_WEBGL&&imagePool.put(n)}};if(r[t]={img:n,callbacks:i?[i]:[]},n.addEventListener("load",c),n.addEventListener("error",a),e=0<(e=window.navigator.userAgent).indexOf("MSIE ")||!!e.match(/Trident.*rv\:11\./),-1!==t.indexOf(".svg")&&e){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==XMLHttpRequest.DONE){var t=h.responseXML&&h.responseXML.querySelector("svg");if(t){var e=new Blob([h.responseText],{type:"image/svg+xml"}),i=URL.createObjectURL(e);n.addEventListener("load",(function(){URL.revokeObjectURL(i)}),{once:!0}),n.src=i,t=t.attributes,n.width=t.width.value,n.height=t.height.value}else a()}},h.open("GET",t,!0),h.send(null)}else n.src=t;return n},_loadResIterator:function(t,i,n){var r=this,c=null,s=t.type;return s?(s="."+s.toLowerCase(),c=t.src?t.src:t.name+s):(c=t,s=cc.path.extname(c)),(i=r.getRes(c))?n(null,i):(i=null,s&&(i=e[s.toLowerCase()]),i?(s=c,o.test(c)||(s=i.getBasePath?i.getBasePath():r.resPath,s=r.getUrl(s,c)),cc.game.config.noCache&&"string"==typeof s&&(s=r._noCacheRex.test(s)?s+"&_t="+(new Date-0):s+"?_t="+(new Date-0)),void i.load(s,c,t,(function(t,e){t?(cc.log(t),r.cache[c]=null,delete r.cache[c],n({status:520,errorMessage:t},null)):(r.cache[c]=e,n(null,e))}))):(cc.error("loader for ["+s+"] doesn't exist!"),n()))},_noCacheRex:/\?/,getUrl:function(t,n){var r=cc.path;if(void 0!==t&&void 0===n&&(n=t,t=(t=r.extname(n))?t.toLowerCase():"",t=(t=e[t])&&t.getBasePath?t.getBasePath():this.resPath),(n=cc.path.join(t||"",n)).match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(i[n])return i[n];r=r.extname(n)||"",n=i[n]=n.substring(0,n.length-r.length)+"_"+cc.sys.language+r}return n},load:function(t,e,i){var n=this,r=arguments.length;if(0===r)throw Error("arguments error!");return 3===r?"function"==typeof e&&(e="function"==typeof i?{trigger:e,cb:i}:{cb:e,cbTarget:i}):2===r?"function"==typeof e&&(e={cb:e}):1===r&&(e={}),t instanceof Array||(t=[t]),r=new cc.AsyncPool(t,cc.CONCURRENCY_HTTP_REQUEST_COUNT,(function(t,i,r,o){n._loadResIterator(t,i,(function(t){var i=Array.prototype.slice.call(arguments,1);e.trigger&&e.trigger.call(e.triggerTarget,i[0],o.size,o.finishedSize),r(t,i[0])}))}),e.cb,e.cbTarget),r.flow(),r},_handleAliases:function(t,e){var i,r=[];for(i in t){var o=t[i];n[i]=o,r.push(o)}this.load(r,e)},loadAliases:function(t,e){var i=this,n=i.getRes(t);n?i._handleAliases(n.filenames,e):i.load(t,(function(t,n){i._handleAliases(n[0].filenames,e)}))},register:function(t,i){if(t&&i){if("string"==typeof t)return e[t.trim().toLowerCase()]=i;for(var n=0,r=t.length;n<r;n++)e["."+t[n].trim().toLowerCase()]=i}},getRes:function(t){return this.cache[t]||this.cache[n[t]]},_getAliase:function(t){return n[t]},release:function(t){var e=this.cache,i=r[t];i&&(i.img=null,delete r[t]),delete e[t],delete e[n[t]],delete n[t]},releaseAll:function(){var t,e=this.cache;for(t in e)delete e[t];for(t in n)delete n[t]}}}(),cc.formatStr=function(){var t=arguments,e=t.length;if(1>e)return"";var i=t[0],n=!0;"object"==typeof i&&(n=!1);for(var r=1;r<e;++r){var o=t[r];if(n)for(;;){if("number"==typeof o&&i.match(/(%d)|(%s)/)){i=i.replace(/(%d)|(%s)/,o);break}i=i.match(/%s/)?i.replace(/%s/,o):i+"    "+o;break}else i+="    "+o}return i},function(){function t(e,i,n){if(c[i])return null;n=n||"";var r=[],o=e[i];if(!o)throw Error("can not find module ["+i+"]");i=cc.path;for(var s=0,a=o.length;s<a;s++){var h=o[s];if(!c[h]){var l=i.extname(h);l?".js"===l.toLowerCase()&&r.push(i.join(n,h)):(l=t(e,h,n))&&(r=r.concat(l)),c[h]=1}}return r}function e(t){cc._initDebugSetting&&cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]),cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),a&&a()}function i(i){var n=i[cc.game.CONFIG_KEY.engineDir],r=cc.loader;if(cc.Class)e(i);else{var o=cc.path.join(n,"moduleConfig.json");r.loadJson(o,(function(r,o){if(r)throw Error(r);r=i.modules||[],o=o.module;var c=[];cc.sys.capabilities.opengl&&0>r.indexOf("base4webgl")?r.splice(0,0,"base4webgl"):0>r.indexOf("core")&&r.splice(0,0,"core");for(var s=0,a=r.length;s<a;s++){var h=t(o,r[s],n);h&&(c=c.concat(h))}cc.loader.loadJsWithImg(c,(function(t){if(t)throw t;e(i)}))}))}}function n(){this.removeEventListener("load",n,!1),i(cc.game.config)}var r=document.createElement("canvas"),o=document.createElement("canvas");cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(t){}if(n)break}return n},function(){cc.sys={};var t=cc.sys;t.LANGUAGE_ENGLISH="en",t.LANGUAGE_CHINESE="zh",t.LANGUAGE_FRENCH="fr",t.LANGUAGE_ITALIAN="it",t.LANGUAGE_GERMAN="de",t.LANGUAGE_SPANISH="es",t.LANGUAGE_DUTCH="du",t.LANGUAGE_RUSSIAN="ru",t.LANGUAGE_KOREAN="ko",t.LANGUAGE_JAPANESE="ja",t.LANGUAGE_HUNGARIAN="hu",t.LANGUAGE_PORTUGUESE="pt",t.LANGUAGE_ARABIC="ar",t.LANGUAGE_NORWEGIAN="no",t.LANGUAGE_POLISH="pl",t.LANGUAGE_UNKNOWN="unkonwn",t.OS_IOS="iOS",t.OS_ANDROID="Android",t.OS_WINDOWS="Windows",t.OS_MARMALADE="Marmalade",t.OS_LINUX="Linux",t.OS_BADA="Bada",t.OS_BLACKBERRY="Blackberry",t.OS_OSX="OS X",t.OS_WP8="WP8",t.OS_WINRT="WINRT",t.OS_UNKNOWN="Unknown",t.UNKNOWN=-1,t.WIN32=0,t.LINUX=1,t.MACOS=2,t.ANDROID=3,t.IPHONE=4,t.IPAD=5,t.BLACKBERRY=6,t.NACL=7,t.EMSCRIPTEN=8,t.TIZEN=9,t.WINRT=10,t.WP8=11,t.MOBILE_BROWSER=100,t.DESKTOP_BROWSER=101,t.BROWSER_TYPE_WECHAT="wechat",t.BROWSER_TYPE_ANDROID="androidbrowser",t.BROWSER_TYPE_IE="ie",t.BROWSER_TYPE_QQ_APP="qq",t.BROWSER_TYPE_QQ="qqbrowser",t.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",t.BROWSER_TYPE_UC="ucbrowser",t.BROWSER_TYPE_360="360browser",t.BROWSER_TYPE_BAIDU_APP="baiduboxapp",t.BROWSER_TYPE_BAIDU="baidubrowser",t.BROWSER_TYPE_MAXTHON="maxthon",t.BROWSER_TYPE_OPERA="opera",t.BROWSER_TYPE_OUPENG="oupeng",t.BROWSER_TYPE_MIUI="miuibrowser",t.BROWSER_TYPE_FIREFOX="firefox",t.BROWSER_TYPE_SAFARI="safari",t.BROWSER_TYPE_CHROME="chrome",t.BROWSER_TYPE_LIEBAO="liebao",t.BROWSER_TYPE_QZONE="qzone",t.BROWSER_TYPE_SOUGOU="sogou",t.BROWSER_TYPE_UNKNOWN="unknown",t.isNative=!1;var e=window,i=e.navigator,n=document,c=n.documentElement,s=i.userAgent.toLowerCase();t.isMobile=/mobile|android|iphone|ipad/.test(s),t.platform=t.isMobile?t.MOBILE_BROWSER:t.DESKTOP_BROWSER;var a=(a=(a=i.language)||i.browserLanguage)?a.split("-")[0]:t.LANGUAGE_ENGLISH;t.language=a;var h=!1,l=(a=!1,""),d=0,u=/android (\d+(?:\.\d+)+)/i.exec(s)||/android (\d+(?:\.\d+)+)/i.exec(i.platform);u&&(h=!0,l=u[1]||"",d=parseInt(l)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(s))?(a=!0,l=u[2]||"",d=parseInt(l)||0):/(iPhone|iPad|iPod)/.exec(i.platform)&&(a=!0,l="",d=0),u=t.OS_UNKNOWN,-1!==i.appVersion.indexOf("Win")?u=t.OS_WINDOWS:a?u=t.OS_IOS:-1!==i.appVersion.indexOf("Mac")?u=t.OS_OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?u=t.OS_UNIX:h?u=t.OS_ANDROID:-1!==i.appVersion.indexOf("Linux")&&(u=t.OS_LINUX),t.os=u,t.osVersion=l,t.osMainVersion=d,t.browserType=t.BROWSER_TYPE_UNKNOWN,function(){var e=/qqbrowser|qq|chrome|safari|firefox|opr|oupeng|opera/i,i=/micromessenger|mqqbrowser|sogou|qzone|liebao|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i.exec(s);i||(i=e.exec(s)),"micromessenger"===(e=i?i[0]:t.BROWSER_TYPE_UNKNOWN)?e=t.BROWSER_TYPE_WECHAT:"safari"===e&&h?e=t.BROWSER_TYPE_ANDROID:"trident"===e?e=t.BROWSER_TYPE_IE:"360 aphone"===e?e=t.BROWSER_TYPE_360:"mxbrowser"===e?e=t.BROWSER_TYPE_MAXTHON:"opr"===e&&(e=t.BROWSER_TYPE_OPERA),t.browserType=e}(),t.browserVersion="",function(){var e=s.match(/(mqqbrowser|micromessenger|sogou|qzone|liebao|maxthon|mxbrowser|baidu)(mobile)?(browser)?\/?([\d.]+)/i);e||(e=s.match(/(msie |rv:|firefox|chrome|ucbrowser|qq|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i)),t.browserVersion=e?e[4]:""}(),a=window.devicePixelRatio||1,t.windowPixelResolution={width:a*(window.innerWidth||document.documentElement.clientWidth),height:a*(window.innerHeight||document.documentElement.clientHeight)},t._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw Error("This feature supports WebGL render mode only.")},t._supportCanvasNewBlendModes=function(){var t=r;t.width=1,t.height=1,(t=t.getContext("2d")).fillStyle="#000",t.fillRect(0,0,1,1),t.globalCompositeOperation="multiply";var e=o;e.width=1,e.height=1;var i=e.getContext("2d");return i.fillStyle="#fff",i.fillRect(0,0,1,1),t.drawImage(e,0,0,1,1),0===t.getImageData(0,0,1,1).data[0]}(),cc.sys.isMobile&&((a=document.createElement("style")).type="text/css",document.body.appendChild(a),a.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");try{var _=t.localStorage=e.localStorage;_.setItem("storage",""),_.removeItem("storage"),_=null}catch(e){_=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")},t.localStorage={getItem:_,setItem:_,removeItem:_,clear:_}}if(_=!!r.getContext("2d"),a=!1,e.WebGLRenderingContext){l=document.createElement("CANVAS");try{if(cc.create3DContext(l)&&(a=!0),a&&t.os===t.OS_IOS&&9===t.osMainVersion&&(window.indexedDB||(a=!1)),a&&t.os===t.OS_ANDROID){var p=parseFloat(t.browserVersion);switch(t.browserType){case t.BROWSER_TYPE_MOBILE_QQ:case t.BROWSER_TYPE_BAIDU:case t.BROWSER_TYPE_BAIDU_APP:a=6.2<=p;break;case t.BROWSER_TYPE_CHROME:a=30<=p;break;case t.BROWSER_TYPE_ANDROID:t.osMainVersion&&5<=t.osMainVersion&&(a=!0);break;case t.BROWSER_TYPE_UNKNOWN:case t.BROWSER_TYPE_360:case t.BROWSER_TYPE_MIUI:case t.BROWSER_TYPE_UC:a=!1}}}catch(t){}l=null}p=t.capabilities={canvas:_,opengl:a},(void 0!==c.ontouchstart||void 0!==n.ontouchstart||i.msPointerEnabled)&&(p.touches=!0),void 0!==c.onmouseup&&(p.mouse=!0),void 0!==c.onkeyup&&(p.keyboard=!0),(e.DeviceMotionEvent||e.DeviceOrientationEvent)&&(p.accelerometer=!0),t.garbageCollect=function(){},t.dumpRoot=function(){},t.restartVM=function(){},t.cleanScript=function(t){},t.isObjectValid=function(t){return!!t},t.dump=function(){var t;t="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t)},t.openURL=function(t){window.open(t)},t.now=function(){return Date.now?Date.now():+new Date}}(),o=r=null,cc.log=cc.warn=cc.error=cc.assert=function(){};var c={},s=!1,a=null;cc._engineLoaded=!1,cc.initEngine=function(t,e){if(s){var r=a;a=function(){r&&r(),e&&e()}}else a=e,!cc.game.config&&t?cc.game.config=t:cc.game.config||cc.game._loadConfig(),function(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;(isNaN(i)||2<i||0>i)&&(t[e.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===i&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===i&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}(t=cc.game.config),document.body?i(t):cc._addEventListener(window,"load",n,!1),s=!0}}(),cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",exposeClassName:"exposeClassName",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList",requestDefaultTimeout:"requestDefaultTimeout"},_paused:!0,_configLoaded:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){this.config[this.CONFIG_KEY.frameRate]=t,this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._pausePlaying(),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._resumePlaying(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),cc.game.onStart()},end:function(){close()},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;this._configLoaded?this._prepared?t&&t():this._prepareCalled||(cc._engineLoaded?(this._prepareCalled=!0,this._initRenderer(i[n.width],i[n.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop(),(i=i[n.jsList])?cc.loader.loadJsWithImg(i,(function(i){if(i)throw Error(i);e._prepared=!0,t&&t()})):t&&t()):cc.initEngine(this.config,(function(){e.prepare(t)}))):this._loadConfig((function(){e.prepare(t)}))},run:function(t,e){"function"==typeof t?cc.game.onStart=t:(t&&("string"==typeof t?(cc.game.config||this._loadConfig(),cc.game.config[cc.game.CONFIG_KEY.id]=t):cc.game.config=t),"function"==typeof e&&(cc.game.onStart=e)),this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date;var t=cc.game.config[cc.game.CONFIG_KEY.frameRate];this._frameTime=1e3/t,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,cc.game._frameTime-(e-cc.game._lastTime)),n=window.setTimeout((function(){t()}),i);return cc.game._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director,o=!0,c=i[n.frameRate];r.setDisplayStats(i[n.showFPS]),t=function(){e._paused||(30===c&&(o=!o)||r.mainLoop(),e._intervalId=window.requestAnimFrame(t))},e._intervalId=window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(t){if(r=this.config||document.ccConfig)this._initConfig(r),t&&t();else{for(var e=document.getElementsByTagName("script"),i=0;i<e.length&&""!==(r=e[i].getAttribute("cocos"))&&!r;i++);var n=this,r=function(e,i){e=JSON.parse(i),n._initConfig(e),t&&t()};i<e.length&&((e=e[i].src)&&(e=/(.*)\//.exec(e)[0],cc.loader.resPath=e,e=cc.path.join(e,"project.json")),cc.loader.loadTxt(e,r)),cc.loader.loadTxt("project.json",r)}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];t[e.showFPS]=void 0===t[e.showFPS]||t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",null==t[e.debugMode]&&(t[e.debugMode]=0),t[e.exposeClassName]=!!t[e.exposeClassName],t[e.frameRate]=t[e.frameRate]||60,null==t[e.renderMode]&&(t[e.renderMode]=0),null==t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),i&&0>i.indexOf("core")&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this.config=t,this._configLoaded=!0},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r=this.config[cc.game.CONFIG_KEY.id],o=window;"CANVAS"===(r=cc.$(r)||cc.$("#"+r)).tagName?(t=t||r.width,e=e||r.height,this.canvas=cc._canvas=i=r,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==r.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||r.clientWidth,e=e||r.clientHeight,this.canvas=cc._canvas=i=cc.$(document.createElement("CANVAS")),this.container=cc.container=n=document.createElement("DIV"),r.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,alpha:!1})),this._renderContext?(cc.renderer=cc.rendererWebGL,o.gl=this._renderContext,cc.renderer.init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=o.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=o.gl.getExtension("OES_element_index_uint")):(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=n,cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.dispatchEvent(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e=window;this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(t="webkitHidden"):t="msHidden":t="mozHidden":t="hidden";var i=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],n=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},r=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow)};if(t)for(var o=0;o<i.length;o++)document.addEventListener(i[o],(function(e){var i=document[t];(i=i||e.hidden)?n():r()}),!1);else e.addEventListener("blur",n,!1),e.addEventListener("focus",r,!1);-1<navigator.userAgent.indexOf("MicroMessenger")&&(e.onfocus=function(){r()}),"onpageshow"in window&&"onpagehide"in window&&(e.addEventListener("pagehide",n,!1),e.addEventListener("pageshow",r,!1)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,(function(){cc.game.pause()})),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,(function(){cc.game.resume()}))}},Function.prototype.bind=Function.prototype.bind||function(t){if(!cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r},cc.EventHelper=function(){},cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(t){t.addEventListener=cc.EventHelper.prototype.addEventListener,t.hasEventListener=cc.EventHelper.prototype.hasEventListener,t.removeEventListener=cc.EventHelper.prototype.removeEventListener,t.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,i){if("load"===t&&this._textureLoaded)setTimeout((function(){e.call(i)}),0);else{void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),this.hasEventListener(t,e,i)||n[t].push({callback:e,eventTarget:i})}},hasEventListener:function(t,e,i){if(void 0===this._listeners)return!1;var n=this._listeners;if(void 0!==n[t]){t=0;for(var r=n.length;t<r;t++){var o=n[t];if(o.callback===e&&o.eventTarget===i)return!0}}return!1},removeEventListener:function(t,e,i){if(void 0!==this._listeners&&void 0!==(t=this._listeners[t]))for(var n=0;n<t.length;){var r=t[n];r.eventTarget===i&&r.callback===e?t.splice(n,1):n++}},removeEventTarget:function(t,e,i){if(void 0!==this._listeners&&void 0!==(t=this._listeners[t]))for(e=0;e<t.length;)t[e].eventTarget===i?t.splice(e,1):e++},dispatchEvent:function(t,e){if(void 0!==this._listeners&&(null==e&&(e=!0),void 0!==(t=this._listeners[t]))){for(var i=[],n=t.length,r=0;r<n;r++)i[r]=t[r];for(r=0;r<n;r++)i[r].callback.call(i[r].eventTarget,this);e&&(t.length=0)}}},cc.EventHelper.prototype.apply(cc.game),cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX != RotationY. Don't know which one to return",Node_getScale:"ScaleX != ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"cc.Node.reorderChild(): child must be non-null",Node_reorderChild_2:"cc.Node.reorderChild(): this child is not in children list",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."},cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;if(!e){var n=i.createElement("Div");e=n.style,n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),e.zIndex="99999",e.position="absolute",e.top="0",e.left="0",e=cc._logList=i.createElement("textarea"),i=e.style,e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderRightWidth="0px",i.borderLeftWidth="0px",i.borderTopWidth="0px",i.borderTopStyle="none",i.borderRightStyle="none",i.borderLeftStyle="none",i.padding="0px",i.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}},cc._formatString=function(t){if(!cc.isObject(t))return t;try{return JSON.stringify(t)}catch(t){return""}},cc._initDebugSetting=function(t){var e,i=cc.game;t!==i.DEBUG_MODE_NONE&&(t>i.DEBUG_MODE_ERROR?(e=cc._logToWebPage.bind(cc),cc.error=function(){e("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(t,i){if(!t&&i){for(var n=2;n<arguments.length;n++)i=i.replace(/(%s)|(%d)/,cc._formatString(arguments[n]));e("Assert: "+i)}},t!==i.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.formatStr.apply(cc,arguments))}),t===i.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(cc.log=function(){e(cc.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(cc.error=Function.prototype.bind.call(console.error,console),cc.assert=console.assert?Function.prototype.bind.call(console.assert,console):function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));throw Error(e)}},t!==i.DEBUG_MODE_ERROR&&(cc.warn=Function.prototype.bind.call(console.warn,console)),t===i.DEBUG_MODE_INFO&&(cc.log=Function.prototype.bind.call(console.log,console))))},cc.loader.loadBinary=function(t,e){var i=this,n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,!0),n.responseType="arraybuffer",cc.loader.loadBinary._IEFilter?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=cc._convertResponseBodyToText(n.responseBody);e(null,i._str2Uint8Array(t))}else e(r)}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){4===n.readyState&&200===n.status?e(null,new Uint8Array(n.response)):e(r)}),n.send(null)},cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last,cc.loader._str2Uint8Array=function(t){if(!t)return null;for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=255&t.charCodeAt(i);return e},cc.loader.loadBinarySync=function(t){var e=this.getXMLHttpRequest();e.timeout=0;var i="load "+t+" failed!";if(e.open("GET",t,!1),t=null,cc.loader.loadBinary._IEFilter){if(e.setRequestHeader("Accept-Charset","x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;(e=cc._convertResponseBodyToText(e.responseBody))&&(t=this._str2Uint8Array(e))}else{if(e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),200!==e.status)return cc.log(i),null;t=this._str2Uint8Array(e.responseText)}return t},window.Uint8Array=window.Uint8Array||Array,cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script='\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = ""\r\n   End If\r\nEnd Function\r\n',myVBScript=document.createElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),cc._convertResponseBodyToText=function(t){for(var e={},i=0;256>i;i++)for(var n=0;256>n;n++)e[String.fromCharCode(i+256*n)]=String.fromCharCode(i)+String.fromCharCode(n);return i=IEBinaryToArray_ByteStr(t),t=IEBinaryToArray_ByteStr_Last(t),i.replace(/[\s\S]/g,(function(t){return e[t]}))+t}}cc=cc||{},cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7",cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=",cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=",cc=cc||{},cc.defineGetterSetter=function(t,e,i,n,r,o){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw Error("browser does not support getters");var c={enumerable:!1,configurable:!0};i&&(c.get=i),n&&(c.set=n),Object.defineProperty(t,e,c)}if(!r&&!o){c=null!=i;for(var s=null!=n,a=Object.getOwnPropertyNames(t),h=0;h<a.length;h++){var l=a[h];if((t.__lookupGetter__?!t.__lookupGetter__(l):!Object.getOwnPropertyDescriptor(t,l))&&"function"==typeof t[l]){var d=t[l];if(c&&d===i&&(r=l,!s||o))break;if(s&&d===n&&(o=l,!c||r))break}}}t=t.constructor,r&&(t.__getters__||(t.__getters__={}),t.__getters__[r]=e),o&&(t.__setters__||(t.__setters__={}),t.__setters__[o]=e)},cc.clone=function(t){var e,i=t.constructor?new t.constructor:{};for(e in t){var n=t[e];i[e]="object"!=typeof n||!n||n instanceof cc.Node||n instanceof HTMLElement?n:cc.clone(n)}return i},cc.inject=function(t,e){for(var i in t)e[i]=t[i]};var ClassManager=function(){var t=0|998*Math.random(),e=0|998*Math.random();this.getNewID=function(){return t++},this.getNewInstanceId=function(){return e++}},classManager=new ClassManager;switch(function(){var a=/\b_super\b/;cc.Class=function(){},cc.Class.extend=function(b){var c=this.prototype,d=Object.create(c),e={writable:!0,enumerable:!1,configurable:!0},f;f=cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]?eval("(function "+(b._className||"Class")+" (arg0, arg1, arg2, arg3, arg4, arg5) {\n    this.__instanceId = classManager.getNewInstanceId();\n    if (this.ctor) {\n        switch (arguments.length) {\n        case 0: this.ctor(); break;\n        case 1: this.ctor(arg0); break;\n        case 3: this.ctor(arg0, arg1, arg2); break;\n        case 4: this.ctor(arg0, arg1, arg2, arg3); break;\n        case 5: this.ctor(arg0, arg1, arg2, arg3, arg4); break;\n        default: this.ctor.apply(this, arguments);\n        }\n    }\n})"):function(t,e,i,n,r){if(this.__instanceId=classManager.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(t);break;case 2:this.ctor(t,e);break;case 3:this.ctor(t,e,i);break;case 4:this.ctor(t,e,i,n);break;case 5:this.ctor(t,e,i,n,r);break;default:this.ctor.apply(this,arguments)}},e.value=classManager.getNewID(),Object.defineProperty(d,"__pid",e),f.prototype=d,e.value=f,Object.defineProperty(d,"constructor",e),this.__getters__&&(f.__getters__=cc.clone(this.__getters__)),this.__setters__&&(f.__setters__=cc.clone(this.__setters__));for(var g=0,h=arguments.length;g<h;++g){var k=arguments[g],m;for(m in k){var n="function"==typeof k[m],p="function"==typeof c[m],t=a.test(k[m]);if(n&&p&&t?(e.value=function(t,e){return function(){var i=this._super;this._super=c[t];var n=e.apply(this,arguments);return this._super=i,n}}(m,k[m]),Object.defineProperty(d,m,e)):n?(e.value=k[m],Object.defineProperty(d,m,e)):d[m]=k[m],n){var u,w;if(this.__getters__&&this.__getters__[m]){var n=this.__getters__[m],v;for(v in this.__setters__)if(this.__setters__[v]===n){w=v;break}cc.defineGetterSetter(d,n,k[m],k[w]?k[w]:d[w],m,w)}if(this.__setters__&&this.__setters__[m]){for(v in n=this.__setters__[m],this.__getters__)if(this.__getters__[v]===n){u=v;break}cc.defineGetterSetter(d,n,k[u]?k[u]:d[u],k[m],u,m)}}}}return f.extend=cc.Class.extend,f.implement=function(t){for(var e in t)d[e]=t[e]},f}}(),cc=cc||{},cc._tmp=cc._tmp||{},cc.associateWithNative=function(t,e){},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.getImageFormatByData=function(t){return 8<t.length&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.FMT_PNG:2<t.length&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN},cc.Point=function(t,e){this.x=t||0,this.y=e||0},cc.p=function(t,e){return void 0===t?{x:0,y:0}:void 0===e?{x:t.x,y:t.y}:{x:t,y:e}},cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},cc.Size=function(t,e){this.width=t||0,this.height=e||0},cc.size=function(t,e){return void 0===t?{width:0,height:0}:void 0===e?{width:t.width,height:t.height}:{width:t,height:e}},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Rect=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},cc.rect=function(t,e,i,n){return void 0===t?{x:0,y:0,width:0,height:0}:void 0===e?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:t,y:e,width:i,height:n}},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e||t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.y+t.height,n=e.x+e.width,r=e.y+e.height;return!(t.x+t.width<e.x||n<t.x||i<e.y||r<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){if("plist"!==(t=this._parseXML(t).documentElement).tagName)return cc.warn("Not a plist file!"),{};for(var e=null,i=0,n=t.childNodes.length;i<n&&1!==(e=t.childNodes[i]).nodeType;i++);return this._parseNode(e)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else for(e="",i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue;else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];1===o.nodeType&&("key"===o.tagName?i=o.firstChild.nodeValue:e[i]=this._parseNode(o))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,cc._txtLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,n)}},cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader),cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,n)}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),cc._jsLoader={load:function(t,e,i,n){cc.loader.loadJs(t,n)}},cc.loader.register(["js"],cc._jsLoader),cc._imgLoader={load:function(t,e,i,n){i=cc.loader.isLoading(t)?function(t,i){if(t)return n(t);t=cc.textureCache.getTextureForKey(e)||cc.textureCache.handleLoadedTexture(e,i),n(null,t)}:function(t,i){if(t)return n(t);t=cc.textureCache.handleLoadedTexture(e,i),n(null,t)},cc.loader.loadImg(t,i)}},cc.loader.register("png jpg bmp jpeg gif ico tiff webp".split(" "),cc._imgLoader),cc._serverImgLoader={load:function(t,e,i,n){cc._imgLoader.load(i.src,e,i,n)}},cc.loader.register(["serverImg"],cc._serverImgLoader),cc._plistLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,(function(t,e){if(t)return n(t);n(null,cc.plistParser.parse(e))}))}},cc.loader.register(["plist"],cc._plistLoader),cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,i){var n=document,r=cc.path,o=this.TYPE,c=document.createElement("style");c.type="text/css",n.body.appendChild(c);var s="";if(s=isNaN(t-0)?s+"@font-face { font-family:"+t+"; src:":s+"@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var a=0,h=e.length;a<h;a++)i=r.extname(e[a]).toLowerCase(),s+="url('"+e[a]+"') format('"+o[i]+"')",s+=a===h-1?";":",";else s+="url('"+e+"') format('"+o[i=i.toLowerCase()]+"');";c.textContent+=s+"}",(i=(e=document.createElement("div")).style).fontFamily=t,e.innerHTML=".",i.position="absolute",i.left="-100px",i.top="-100px",n.body.appendChild(e)},load:function(t,e,i,n){e=i.type,t=i.name,e=i.srcs,cc.isString(i)?(e=cc.path.extname(i),t=cc.path.basename(i,e),this._loadFont(t,i,e)):this._loadFont(t,e),document.fonts?document.fonts.load("1em "+t).then((function(){n(null,!0)}),(function(t){n(t)})):n(null,!0)}},cc.loader.register("font eot ttf woff svg ttc".split(" "),cc._fontLoader),cc._binaryLoader={load:function(t,e,i,n){cc.loader.loadBinary(t,n)}},cc._csbLoader={load:function(t,e,i,n){cc.loader.loadCsb(t,n)}},cc.loader.register(["csb"],cc._csbLoader),window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.17",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.DRAWNODE_TOTAL_VERTICES=2e4,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.$=function(t){var e=this===cc?document:this;return(t=t instanceof HTMLElement?t:e.querySelector(t))&&(t.find=t.find||cc.$,t.hasClass=t.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},t.addClass=t.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},t.removeClass=t.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},t.remove=t.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},t.appendTo=t.appendTo||function(t){return t.appendChild(this),this},t.prependTo=t.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},t.transforms=t.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},t.position=t.position||{x:0,y:0},t.rotation=t.rotation||0,t.scale=t.scale||{x:1,y:1},t.skew=t.skew||{x:0,y:0},t.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},t.rotate=function(t){return this.rotation=t,this.transforms(),this},t.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},t.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),t},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do{e+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{x:e,y:i}},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(t,e,i){if(!cc.isObject(i)||cc.isUndefined(i.x)||cc.isUndefined(i.y))cc.log(cc._LogInfos.swap);else{var n=i[t];i[t]=i[e],i[e]=n}},cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.RAD},cc.radiansToDegrees=function(t){return t*cc.DEG},cc.radiansToDegress=function(t){return cc.log(cc._LogInfos.radiansToDegress),t*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._glProgramState.apply(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=function(){return cc.director._contentScaleFactor},cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)},cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)},cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i,e.y=t.y/i},cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)},cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)},cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i,e.height=t.height/i},cc.rectPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)},cc.rectPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.REPEAT=10497,cc.CLAMP_TO_EDGE=33071,cc.MIRRORED_REPEAT=33648,cc.BLEND_SRC=cc.SRC_ALPHA,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)})),cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA,cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}},cc.ORIENTATION_PORTRAIT=1,cc.ORIENTATION_LANDSCAPE=2,cc.ORIENTATION_AUTO=3,cc.CONCURRENCY_HTTP_REQUEST_COUNT=cc.sys.isMobile?20:0,cc.BATCH_VERTEX_COUNT=2e3,cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=7,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY="ShaderSpritePositionTextureColorGray",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTextureUColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPositionUColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.arrayVerifyType=function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log("element type is wrong!"),!1;return!0},cc.arrayRemoveObject=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e){t.splice(i,1);break}},cc.arrayRemoveArray=function(t,e){for(var i=0,n=e.length;i<n;i++)cc.arrayRemoveObject(t,e[i])},cc.arrayAppendObjectsToIndex=function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},cc.copyArray=function(t){var e,i=t.length,n=Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n},cc.Color=function(t,e,i,n){this._val=((t||0)<<24>>>0)+((e||0)<<16)+((i||0)<<8)+("number"==typeof n?n:255)},_p=cc.Color.prototype,_p._getR=function(){return(4278190080&this._val)>>>24},_p._setR=function(t){this._val=16777215&this._val|t<<24>>>0},_p._getG=function(){return(16711680&this._val)>>16},_p._setG=function(t){this._val=4278255615&this._val|t<<16},_p._getB=function(){return(65280&this._val)>>8},_p._setB=function(t){this._val=4294902015&this._val|t<<8},_p._getA=function(){return 255&this._val},_p._setA=function(t){this._val=4294967040&this._val|t},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),cc.color=function(t,e,i,n){return void 0===t?new cc.Color(0,0,0,255):"object"==typeof t?new cc.Color(t.r,t.g,t.b,null==t.a?255:t.a):"string"==typeof t?cc.hexToColor(t):new cc.Color(t,e,i,null==n?255:n)},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,_p=cc.Vertex2F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0,this._view=new Float32Array(this._arrayBuffer,this._offset,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,_p=cc.Vertex3F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},_p._getZ=function(){return this._view[2]},_p._setZ=function(t){this._view[2]=t},cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,_p=cc.Tex2F.prototype,_p._getU=function(){return this._view[0]},_p._setU=function(t){this._view[0]=t},_p._getV=function(){return this._view[1]},_p._setV=function(t){this._view[1]=t},cc.defineGetterSetter(_p,"u",_p._getU,_p._setU),cc.defineGetterSetter(_p,"v",_p._getV,_p._setV),cc.Quad2=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=this._offset;var c=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,r,o):new cc.Vertex2F(0,0,r,o),o+=c,this._tr=e?new cc.Vertex2F(e.x,e.y,r,o):new cc.Vertex2F(0,0,r,o),o+=c,this._bl=i?new cc.Vertex2F(i.x,i.y,r,o):new cc.Vertex2F(0,0,r,o),o+=c,this._br=n?new cc.Vertex2F(n.x,n.y,r,o):new cc.Vertex2F(0,0,r,o)},cc.Quad2.BYTES_PER_ELEMENT=32,_p=cc.Quad2.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},_p._getTR=function(){return this._tr},_p._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},_p._getBL=function(){return this._bl},_p._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},_p._getBR=function(){return this._br},_p._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),cc.Quad3=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=this._offset;var c=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=t?new cc.Vertex3F(t.x,t.y,t.z,r,o):new cc.Vertex3F(0,0,0,r,o),o+=c,this.br=e?new cc.Vertex3F(e.x,e.y,e.z,r,o):new cc.Vertex3F(0,0,0,r,o),o+=c,this.tl=i?new cc.Vertex3F(i.x,i.y,i.z,r,o):new cc.Vertex3F(0,0,0,r,o),o+=c,this.tr=n?new cc.Vertex3F(n.x,n.y,n.z,r,o):new cc.Vertex3F(0,0,0,r,o)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset,this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,n,r):new cc.Vertex3F(0,0,0,n,r),r+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc._WebGLColor(e.r,e.g,e.b,e.a,n,r):new cc._WebGLColor(0,0,0,0,n,r),r+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r):new cc.Tex2F(0,0,n,r)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,_p=cc.V3F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=o||0,r=this._arrayBuffer,o=this._offset;var c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,r,o):new cc.V3F_C4B_T2F(null,null,null,r,o),o+=c,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,r,o):new cc.V3F_C4B_T2F(null,null,null,r,o),o+=c,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,r,o):new cc.V3F_C4B_T2F(null,null,null,r,o),o+=c,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,r,o):new cc.V3F_C4B_T2F(null,null,null,r,o)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,_p=cc.V3F_C4B_T2F_Quad.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBL=function(){return this._bl},_p._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getTR=function(){return this._tr},_p._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBR=function(){return this._br},_p._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getArrayBuffer=function(){return this._arrayBuffer},cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr;return t=t.br,{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:t.vertices.x,y:t.vertices.y,z:t.vertices.z},colors:{r:t.colors.r,g:t.colors.g,b:t.colors.b,a:t.colors.a},texCoords:{u:t.texCoords.u,v:t.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset,this._vertices=t?new cc.Vertex2F(t.x,t.y,n,r):new cc.Vertex2F(0,0,n,r),r+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc._WebGLColor(e.r,e.g,e.b,e.a,n,r):new cc._WebGLColor(0,0,0,0,n,r),r+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r):new cc.Tex2F(0,0,n,r)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,_p=cc.V2F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0,n=this._arrayBuffer,r=this._offset;var o=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r),r+=o,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r),r+=o,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,_p=cc.V2F_C4B_T2F_Triangle.prototype,_p._getA=function(){return this._a},_p._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getB=function(){return this._b},_p._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getC=function(){return this._c},_p._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"c",_p._getC,_p._setC),cc.vertex2=function(t,e){return new cc.Vertex2F(t,e)},cc.vertex3=function(t,e,i){return new cc.Vertex3F(t,e,i)},cc.tex2=function(t,e){return new cc.Tex2F(t,e)},cc.BlendFunc=function(t,e){this.src=t,this.dst=e},cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.hexToColor=function(t){return t=t.replace(/^#?/,"0x"),t=parseInt(t),new cc.Color(t>>16,(t>>8)%256,t%256)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(16>t.r?"0"+e:e)+(16>t.g?"0"+i:i)+(16>t.b?"0"+n:n)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e,i=this._keyMapTb;for(e in i)if(i[e]===t)return this._valueMapTb[e];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e,i=this._keyMapTb;for(e in i)if(i[e]===t){delete this._valueMapTb[e],delete i[e];break}}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t,e=[],i=this._keyMapTb;for(t in i)e.push(i[t]);return e},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}}),cc.FontDefinition=function(t){if(this.fontName="Arial",this.fontSize=12,this.textAlign=cc.TEXT_ALIGNMENT_CENTER,this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this.fillStyle=cc.color(255,255,255,255),this.boundingHeight=this.boundingWidth=0,this.strokeEnabled=!1,this.strokeStyle=cc.color(255,255,255,255),this.lineWidth=1,this.fontWeight=this.fontStyle=this.lineHeight="normal",this.shadowEnabled=!1,this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0,this.shadowOpacity=1,t&&t instanceof Object)for(var e in t)this[e]=t[e]},cc.FontDefinition.prototype._getCanvasFontStr=function(){return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+(this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px")+" '"+this.fontName+"'"},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc._WebGLColor=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc._WebGLColor.BYTES_PER_ELEMENT),this._offset=o||0,this._view=new Uint8Array(this._arrayBuffer,this._offset,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,this._view[3]=null==n?255:n,void 0===n&&(this.a_undefined=!0)},cc._WebGLColor.BYTES_PER_ELEMENT=4,(_p=cc._WebGLColor.prototype)._getR=function(){return this._view[0]},_p._setR=function(t){this._view[0]=0>t?0:t},_p._getG=function(){return this._view[1]},_p._setG=function(t){this._view[1]=0>t?0:t},_p._getB=function(){return this._view[2]},_p._setB=function(t){this._view[2]=0>t?0:t},_p._getA=function(){return this._view[3]},_p._setA=function(t){this._view[3]=0>t?0:t},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA))})),_p=cc.color,_p._getWhite=function(){return cc.color(255,255,255)},_p._getYellow=function(){return cc.color(255,255,0)},_p._getBlue=function(){return cc.color(0,0,255)},_p._getGreen=function(){return cc.color(0,255,0)},_p._getRed=function(){return cc.color(255,0,0)},_p._getMagenta=function(){return cc.color(255,0,255)},_p._getBlack=function(){return cc.color(0,0,0)},_p._getOrange=function(){return cc.color(255,127,0)},_p._getGray=function(){return cc.color(166,166,166)},cc.defineGetterSetter(_p,"WHITE",_p._getWhite),cc.defineGetterSetter(_p,"YELLOW",_p._getYellow),cc.defineGetterSetter(_p,"BLUE",_p._getBlue),cc.defineGetterSetter(_p,"GREEN",_p._getGreen),cc.defineGetterSetter(_p,"RED",_p._getRed),cc.defineGetterSetter(_p,"MAGENTA",_p._getMagenta),cc.defineGetterSetter(_p,"BLACK",_p._getBlack),cc.defineGetterSetter(_p,"ORANGE",_p._getOrange),cc.defineGetterSetter(_p,"GRAY",_p._getGray),cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.Touches=[],cc.TouchesIntergerDict={},cc.DENSITYDPI_DEVICE="device-dpi",cc.DENSITYDPI_HIGH="high-dpi",cc.DENSITYDPI_MEDIUM="medium-dpi",cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.documentElement},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true";break;case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",(function(){return cc.view._targetDensityDPI}));break;case cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var _scissorRect=null;cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_orientationChanging:!0,_resizing:!1,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=document,e=cc.ContainerStrategy,i=cc.ContentStrategy;__BrowserGetter.init(this),this._frame=cc.container.parentNode===t.body?t.documentElement:cc.container.parentNode,this._frameSize=cc.size(0,0),this._initFrameSize(),t=cc._canvas.width;var n=cc._canvas.height;this._designResolutionSize=cc.size(t,n),this._originalDesignResolutionSize=cc.size(t,n),this._viewPortRect=cc.rect(0,0,t,n),this._visibleRect=cc.rect(0,0,t,n),this._contentTranslateLeftTop={left:0,top:0},this._viewName="Cocos2dHTML5",t=cc.sys,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),this._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),this._targetDensityDPI=cc.DENSITYDPI_HIGH,t.isMobile?window.addEventListener("orientationchange",this._orientationChange):this._orientationChanging=!1},_resizeEvent:function(){var t;if(!(t=this.setDesignResolutionSize?this:cc.view)._orientationChanging){var e=t._frameSize.width,i=t._frameSize.height,n=t._isRotated;if(cc.sys.isMobile){var r=cc.game.container.style,o=r.margin;r.margin="0",r.display="none",t._initFrameSize(),r.margin=o,r.display="block"}else t._initFrameSize();t._isRotated===n&&t._frameSize.width===e&&t._frameSize.height===i||(e=t._originalDesignResolutionSize.width,i=t._originalDesignResolutionSize.height,t._resizing=!0,0<e&&t.setDesignResolutionSize(e,i,t._resolutionPolicy),t._resizing=!1,cc.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call())}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.sys.isMobile&&(cc.game.container.style.display="none"),setTimeout((function(){cc.view._orientationChanging=!1,cc.view._resizeEvent()}),300)},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){(t&=cc.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t,this._resolutionPolicy&&this.setDesignResolutionSize(this._originalDesignResolutionSize.width,this._originalDesignResolutionSize.height,this._resolutionPolicy))},setDocumentPixelWidth:function(t){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width="100%",this.setDesignResolutionSize(this._designResolutionSize.width,this._designResolutionSize.height,this._resolutionPolicy)},_initFrameSize:function(){var t=this._frameSize,e=__BrowserGetter.availWidth(this._frame),i=__BrowserGetter.availHeight(this._frame),n=e>=i;!cc.sys.isMobile||n&&this._orientation&cc.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;0<t&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,o,c=(c=document.getElementsByName("viewport"))?c[0]:null;for(r in n=c?c.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1==n.indexOf(r)?n+=","+r+"="+t[r]:e&&(o=new RegExp(r+"s*=s*[^,]+"),n.replace(o,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,c&&(c.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var t=cc.contentScaleFactor();this._scaleY=this._scaleX=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,this._frame.style.width=t+"px",this._frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){if(t instanceof cc.ResolutionPolicy)this._resolutionPolicy=t;else{var e=cc.ResolutionPolicy;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(0<t||0<e)if(this.setResolutionPolicy(i),(i=this._resolutionPolicy)&&i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var n=i.apply(this,this._designResolutionSize);n.scale&&2===n.scale.length&&(this._scaleX=n.scale[0],this._scaleY=n.scale[1]),n.viewport&&(t=this._viewPortRect,e=this._visibleRect,n=n.viewport,t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height,e.x=-t.x/this._scaleX,e.y=-t.y/this._scaleY,e.width=cc._canvas.width/this._scaleX,e.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(t.x,-t.y)),(t=cc.director)._winSizeInPoints.width=this._designResolutionSize.width,t._winSizeInPoints.height=this._designResolutionSize.height,i.postApply(this),cc.winSize.width=t._winSizeInPoints.width,cc.winSize.height=t._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?t.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,c=this._scaleY;cc._renderContext.viewport(t*o*r+this._viewPortRect.x*r,e*c*r+this._viewPortRect.y*r,i*o*r,n*c*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,c=this._scaleY;t=Math.ceil(t*o*r+this._viewPortRect.x*r),e=Math.ceil(e*c*r+this._viewPortRect.y*r),i=Math.ceil(i*o*r),n=Math.ceil(n*c*r),_scissorRect||(r=gl.getParameter(gl.SCISSOR_BOX),_scissorRect=cc.rect(r[0],r[1],r[2],r[3])),_scissorRect.x==t&&_scissorRect.y==e&&_scissorRect.width==i&&_scissorRect.height==n||(_scissorRect.x=t,_scissorRect.y=e,_scissorRect.width=i,_scissorRect.height=n,cc._renderContext.scissor(t,e,i,n))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!_scissorRect){var t=gl.getParameter(gl.SCISSOR_BOX);_scissorRect=cc.rect(t[0],t[1],t[2],t[3])}t=1/this._scaleX;var e=1/this._scaleY;return cc.rect((_scissorRect.x-this._viewPortRect.x)*t,(_scissorRect.y-this._viewPortRect.y)*e,_scissorRect.width*t,_scissorRect.height*e)},setViewName:function(t){null!=t&&0<t.length&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return t=this._devicePixelRatio*(t-i.left),e=this._devicePixelRatio*(i.top+i.height-e),this._isRotated?{x:this._viewPortRect.width-e,y:t}:{x:t,y:e}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n=this._viewPortRect,r=this._scaleX,o=this._scaleY,c=0;c<t.length;c++)i=(e=t[c])._point,e=e._prevPoint,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/o,e.x=(e.x-n.x)/r,e.y=(e.y-n.y)/o}}),cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px",r=t._devicePixelRatio=1,t.isRetinaEnabled()&&(r=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*r,n.height=i*r,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",(t=cc.container.style).position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,o){return 2>Math.abs(t-i)&&(i=t),2>Math.abs(e-n)&&(n=e),t=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n),this._result.scale=[r,o],this._result.viewport=t,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){var e=t._frameSize.height,i=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),i.margin=t._isRotated?"0 0 0 "+e+"px":"0px"}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,o=t._frameSize.height,c=cc.container.style,s=e.width,a=r/s,h=o/(e=e.height);a<h?(i=r,n=e*a):(i=s*h,n=o),s=Math.round((r-i)/2),n=Math.round((o-n)/2),this._setupContainer(t,r-2*s,o-2*n),c.margin=t._isRotated?"0 0 0 "+o+"px":"0px",c.paddingLeft=s+"px",c.paddingRight=s+"px",c.paddingTop=n+"px",c.paddingBottom=n+"px"}});t.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}});var i=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i,t=cc.ContentStrategy.extend({apply:function(t,e){t=cc._canvas.width;var i=cc._canvas.height;return this._buildResult(t,i,t,i,t/e.width,i/e.height)}}),e=cc.ContentStrategy.extend({apply:function(t,e){t=cc._canvas.width;var i,n,r=cc._canvas.height,o=e.width,c=t/o,s=r/(e=e.height),a=0;return c<s?(i=t,n=e*(a=c)):(i=o*(a=s),n=r),this._buildResult(t,r,i,n,a,a)}}),i=cc.ContentStrategy.extend({apply:function(t,e){t=cc._canvas.width;var i,n,r,o=cc._canvas.height,c=e.width,s=t/c,a=o/(e=e.height);return s<a?(n=c*(i=a),r=o):(n=t,r=e*(i=s)),this._buildResult(t,o,n,r,i,i)}});var n=cc.ContentStrategy.extend({apply:function(t,e){t=cc._canvas.width;var i=cc._canvas.height;return e=i/e.height,this._buildResult(t,i,t,i,e,e)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),r=cc.ContentStrategy.extend({apply:function(t,e){t=cc._canvas.width;var i=cc._canvas.height;return e=t/e.width,this._buildResult(t,i,t,i,e,e)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new t,cc.ContentStrategy.SHOW_ALL=new e,cc.ContentStrategy.NO_BORDER=new i,cc.ContentStrategy.FIXED_HEIGHT=new n,cc.ContentStrategy.FIXED_WIDTH=new r}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n=this._fnMap;for(t=0,l=n.length;t<l;t++)if((e=n[t])&&e[1]in document){for(t=0,i=e.length;t<i;t++)this._fn[n[0][t]]=e[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){t=t||document.body;var i=cc.game.canvas||t,n=this;this.requestFullScreen(t,e),i.addEventListener(this._touchEvent,(function r(){i.removeEventListener(n._touchEvent,r),n.requestFullScreen(t,e)}))}},cc.screen.init(),cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=(t=t.y)+i,o=n+e;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=o,this.topRight.y=r,this.top.x=n+e/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=t,this.bottomRight.x=o,this.bottomRight.y=t,this.bottom.x=n+e/2,this.bottom.y=t,this.center.x=n+e/2,this.center.y=t+i/2,this.left.x=n,this.left.y=t+i/2,this.right.x=o,this.right.y=t+i/2}},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.inputManager={TOUCH_TIMEOUT:5e3,_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>this.TOUCH_TIMEOUT)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){0>t||t>=this._maxTouches||(this._indexBitsUsed&=~(1<<t))},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r=[],o=this._touchesIntegerDict,c=cc.sys.now(),s=0,a=t.length;s<a;s++)if(null==(i=o[n=(e=t[s]).getID()])){var h=this._getUnUsedIndex();-1===h?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,h):((i=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=c,i._setPrevPoint(e._prevPoint),o[n]=h,r.push(i))}0<r.length&&(this._glView._convertTouchesWithScale(r),(t=new cc.EventTouch(r))._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(t))},handleTouchesMove:function(t){for(var e,i,n=[],r=this._touches,o=cc.sys.now(),c=0,s=t.length;c<s;c++)i=(e=t[c]).getID(),null!=(i=this._touchesIntegerDict[i])&&r[i]&&(r[i]._setPoint(e._point),r[i]._setPrevPoint(e._prevPoint),r[i]._lastModified=o,n.push(r[i]));0<n.length&&(this._glView._convertTouchesWithScale(n),(t=new cc.EventTouch(n))._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(t))},handleTouchesEnd:function(t){0<(t=this.getSetOfTouchesEndOrCancel(t)).length&&(this._glView._convertTouchesWithScale(t),(t=new cc.EventTouch(t))._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(t))},handleTouchesCancel:function(t){0<(t=this.getSetOfTouchesEndOrCancel(t)).length&&(this._glView._convertTouchesWithScale(t),(t=new cc.EventTouch(t))._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(t))},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],o=this._touches,c=this._touchesIntegerDict,s=0,a=t.length;s<a;s++)null!=(i=c[n=(e=t[s]).getID()])&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),r.push(o[i]),this._removeUsedIndexBit(i),delete c[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window;return{left:(t=cc.isFunction(t.getBoundingClientRect)?t.getBoundingClientRect():{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)}).left+i.pageXOffset-e.clientLeft,top:t.top+i.pageYOffset-e.clientTop,width:t.width,height:t.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(50>=i.length?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint;return t=this._glView.convertToLocationInView(t,e,i),(e=new cc.Touch(t.x,t.y))._setPrevPoint(n.x,n.y),n.x=t.x,n.y=t.y,e},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;return this._glView._convertMouseToLocationInView(t,e),(e=new cc.EventMouse(i)).setLocation(t.x,t.y),e._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,e},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r=[],o=this._glView,c=this._preTouchPoint,s=t.changedTouches.length,a=0;a<s;a++)if(i=t.changedTouches[a]){var h;h=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(i=new cc.Touch(h.x,h.y,i.identifier),n=this.getPreTouch(i).getLocation(),i._setPrevPoint(n.x,n.y),this.setPreTouch(i)):(i=new cc.Touch(h.x,h.y))._setPrevPoint(c.x,c.y),c.x=h.x,c.y=h.y,r.push(i)}return r},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=cc.view;var e,i=this,n="mouse"in cc.sys.capabilities,r="touches"in cc.sys.capabilities,o=!1;if(cc.sys.isMobile&&(o=!0),n&&(window.addEventListener("mousedown",(function(){i._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(e){if(!o){var n=i._mousePressed;if(i._mousePressed=!1,n){n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),r)||(i.handleTouchesEnd([i.getTouchByXY(r.x,r.y,n)]),(n=i.getMouseEvent(r,n,cc.EventMouse.UP)).setButton(e.button),cc.eventManager.dispatchEvent(n))}}}),!1),t.addEventListener("mousedown",(function(e){if(!o){i._mousePressed=!0;var n=i.getHTMLElementPosition(t),r=i.getPointByEvent(e,n);i.handleTouchesBegin([i.getTouchByXY(r.x,r.y,n)]),(n=i.getMouseEvent(r,n,cc.EventMouse.DOWN)).setButton(e.button),cc.eventManager.dispatchEvent(n),e.stopPropagation(),e.preventDefault(),t.focus()}}),!1),t.addEventListener("mouseup",(function(e){if(!o){i._mousePressed=!1;var n=i.getHTMLElementPosition(t),r=i.getPointByEvent(e,n);i.handleTouchesEnd([i.getTouchByXY(r.x,r.y,n)]),(n=i.getMouseEvent(r,n,cc.EventMouse.UP)).setButton(e.button),cc.eventManager.dispatchEvent(n),e.stopPropagation(),e.preventDefault()}}),!1),t.addEventListener("mousemove",(function(e){if(!o){var n=i.getHTMLElementPosition(t),r=i.getPointByEvent(e,n);i.handleTouchesMove([i.getTouchByXY(r.x,r.y,n)]),n=i.getMouseEvent(r,n,cc.EventMouse.MOVE),i._mousePressed?n.setButton(e.button):n.setButton(null),cc.eventManager.dispatchEvent(n),e.stopPropagation(),e.preventDefault()}}),!1),t.addEventListener("mousewheel",(function(e){var n=i.getHTMLElementPosition(t),r=i.getPointByEvent(e,n);(n=i.getMouseEvent(r,n,cc.EventMouse.SCROLL)).setButton(e.button),n.setScrollData(0,e.wheelDelta),cc.eventManager.dispatchEvent(n),e.stopPropagation(),e.preventDefault()}),!1),t.addEventListener("DOMMouseScroll",(function(e){var n=i.getHTMLElementPosition(t),r=i.getPointByEvent(e,n);(n=i.getMouseEvent(r,n,cc.EventMouse.SCROLL)).setButton(e.button),n.setScrollData(0,-120*e.detail),cc.eventManager.dispatchEvent(n),e.stopPropagation(),e.preventDefault()}),!1)),window.navigator.msPointerEnabled)for(e in n={MSPointerDown:i.handleTouchesBegin,MSPointerMove:i.handleTouchesMove,MSPointerUp:i.handleTouchesEnd,MSPointerCancel:i.handleTouchesCancel})!function(e,n){t.addEventListener(e,(function(e){var r=i.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(i,[i.getTouchByXY(e.clientX,e.clientY,r)]),e.stopPropagation()}),!1)}(e,n[e]);r&&(t.addEventListener("touchstart",(function(e){if(e.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesBegin(i.getTouchesByEvent(e,n)),e.stopPropagation(),e.preventDefault(),t.focus()}}),!1),t.addEventListener("touchmove",(function(e){if(e.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesMove(i.getTouchesByEvent(e,n)),e.stopPropagation(),e.preventDefault()}}),!1),t.addEventListener("touchend",(function(e){if(e.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesEnd(i.getTouchesByEvent(e,n)),e.stopPropagation(),e.preventDefault()}}),!1),t.addEventListener("touchcancel",(function(e){if(e.changedTouches){var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,i.handleTouchesCancel(i.getTouchesByEvent(e,n)),e.stopPropagation(),e.preventDefault()}}),!1)),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))),this._accelCurTime+=t}},_p=cc.inputManager,_p.setAccelerometerEnabled=function(t){this._accelEnabled!==t&&(this._accelEnabled=t,t=cc.director.getScheduler(),this._accelEnabled?(this._accelCurTime=0,this._registerAccelerometerEvent(),t.scheduleUpdate(this)):(this._accelCurTime=0,this._unregisterAccelerometerEvent(),t.unscheduleUpdate(this)))},_p.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},_p._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",(function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()}),!1),cc._canvas.addEventListener("keyup",(function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()}),!1)},_p._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),this.didAccelerateCallback=this.didAccelerate.bind(this),t.addEventListener(e,this.didAccelerateCallback,!1)},_p._unregisterAccelerometerEvent=function(){this._acceleration=null,window.removeEventListener(this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this.didAccelerateCallback,!1)},_p.didAccelerate=function(t){var e=window;if(this._accelEnabled){var i,n,r,o=this._acceleration;this._accelDeviceEvent===window.DeviceMotionEvent?(r=t.accelerationIncludingGravity,i=this._accelMinus*r.x*.1,n=this._accelMinus*r.y*.1,r=.1*r.z):(i=t.gamma/90*.981,n=-t.beta/90*.981,r=t.alpha/90*.981),o.x=i,o.y=n,o.z=r,o.timestamp=t.timeStamp||Date.now(),t=o.x,e.orientation===cc.UIInterfaceOrientationLandscapeRight?(o.x=-o.y,o.y=t):e.orientation===cc.UIInterfaceOrientationLandscapeLeft?(o.x=o.y,o.y=-t):e.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(o.x=-o.x,o.y=-o.y)}},delete _p,cc.AffineTransform=function(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o},cc.affineTransformMake=function(t,e,i,n,r,o){return{a:t,b:e,c:i,d:n,tx:r,ty:o}},cc.pointApplyAffineTransform=function(t,e,i){var n;return void 0===i?(i=e,n=t.x,t=t.y):(n=t,t=e),{x:i.a*n+i.c*t+i.tx,y:i.b*n+i.d*t+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),o=cc.rectGetMaxY(t);return t=cc.pointApplyAffineTransform(n,i,e),i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,o,e),e=cc.pointApplyAffineTransform(r,o,e),r=Math.min(t.x,i.x,n.x,e.x),o=Math.min(t.y,i.y,n.y,e.y),cc.rect(r,o,Math.max(t.x,i.x,n.x,e.x)-r,Math.max(t.y,i.y,n.y,e.y)-o)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),o=cc.rectGetMaxY(t),c=cc.pointApplyAffineTransform(n,i,e),s=(i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,o,e),cc.pointApplyAffineTransform(r,o,e));return e=Math.min(c.x,i.x,n.x,s.x),r=Math.max(c.x,i.x,n.x,s.x),o=Math.min(c.y,i.y,n.y,s.y),c=Math.max(c.y,i.y,n.y,s.y),t.x=e,t.y=o,t.width=r-e,t.height=c-o,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e);return e=Math.cos(e),{a:t.a*e+t.c*i,b:t.b*e+t.d*i,c:t.c*e-t.a*i,d:t.d*e-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,o=t.d,c=t.tx,s=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+o*e.c,t.d=r*e.b+o*e.d,t.tx=c*e.a+s*e.c+e.tx,t.ty=c*e.b+s*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.affineTransformInvertOut=function(t,e){var i=t.a,n=t.b,r=t.c,o=t.d,c=1/(i*o-n*r);e.a=c*o,e.b=-c*n,e.c=-c*r,e.d=c*i,e.tx=c*(r*t.ty-o*t.tx),e.ty=c*(n*t.tx-i*t.ty)},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t<i?t:i},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){return t=cc.pNormalize(t),e=cc.pNormalize(e),e=Math.atan2(t.x*e.y-t.y*e.x,cc.pDot(t,e)),Math.abs(e)<cc.POINT_EPSILON?0:e},cc.pAngle=function(t,e){return t=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e))),Math.abs(t)<cc.POINT_EPSILON?0:t},cc.pRotateByAngle=function(t,e,i){t=cc.pSub(t,e);var n=Math.cos(i);i=Math.sin(i);var r=t.x;return t.x=r*n-t.y*i+e.x,t.y=r*i+t.y*n+e.y,t},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var o=e.x-t.x;e=e.y-t.y;var c=n.x-i.x;n=n.y-i.y;var s=t.x-i.x;return t=t.y-i.y,i=n*o-c*e,r.x=c*t-n*s,r.y=o*t-e*s,0===i?0===r.x||0===r.y:(r.x/=i,r.y/=i,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&0<=r.x&&1>=r.x&&0<=r.y&&1>=r.y)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);return cc.pLineIntersect(t,e,i,n,r)?((i=cc.p(0,0)).x=t.x+r.x*(e.x-t.x),i.y=t.y+r.x*(e.y-t.y),i):cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&t.x===e.x&&t.y===e.y},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);0!==e&&cc.pMultIn(t,1/e)},cc.vertexLineToPolygon=function(t,e,i,n,r){if(!(1>=(r+=n))){e*=.5;for(var o,c=r-1,s=n;s<r;s++){o=2*s;var a,h=cc.p(t[2*s],t[2*s+1]);if(0===s)a=cc.pPerp(cc.pNormalize(cc.pSub(h,cc.p(t[2*(s+1)],t[2*(s+1)+1]))));else if(s===c)a=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[2*(s-1)],t[2*(s-1)+1]),h)));else{a=cc.p(t[2*(s-1)],t[2*(s-1)+1]);var l=cc.p(t[2*(s+1)],t[2*(s+1)+1]),d=cc.pNormalize(cc.pSub(l,h)),u=cc.pNormalize(cc.pSub(a,h)),_=Math.acos(cc.pDot(d,u));a=_<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(d,u))):_<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(d,u)):cc.pPerp(cc.pNormalize(cc.pSub(l,a)))}a=cc.pMult(a,e),i[2*o]=h.x+a.x,i[2*o+1]=h.y+a.y,i[2*(o+1)]=h.x-a.x,i[2*(o+1)+1]=h.y-a.y}for(s=0===n?0:n-1;s<c;s++)t=2+(o=2*s),e=cc.vertex2(i[2*o],i[2*o+1]),r=cc.vertex2(i[2*(o+1)],i[2*(o+1)+1]),o=cc.vertex2(i[2*t],i[2*t]),n=cc.vertex2(i[2*(t+1)],i[2*(t+1)+1]),!(e=!cc.vertexLineIntersect(e.x,e.y,n.x,n.y,r.x,r.y,o.x,o.y)).isSuccess&&(0>e.value||1<e.value)&&(e.isSuccess=!0),e.isSuccess&&(i[2*t]=n.x,i[2*t+1]=n.y,i[2*(t+1)]=o.x,i[2*(t+1)+1]=o.y)}},cc.vertexLineIntersect=function(t,e,i,n,r,o,c,s){return t===i&&e===n||r===c&&o===s?{isSuccess:!1,value:0}:(i-=t,n-=e,o-=e,c-=t,s-=e,e=(r-=t)*(i/=t=Math.sqrt(i*i+n*n))+o*(n/=t),o=o*i-r*n,r=e,e=c*i+s*n,s=s*i-c*n,c=e,o===s?{isSuccess:!1,value:0}:{isSuccess:!0,value:(c+(r-c)*s/(s-o))/t})},cc.vertexListIsClockwise=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[(e+1)%i],r=t[(e+2)%i];if(0<cc.pCross(cc.pSub(n,t[e]),cc.pSub(r,n)))return!1}return!0},cc.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty},cc.GLToCGAffine=function(t,e){e.a=t[0],e.c=t[4],e.tx=t[12],e.b=t[1],e.d=t[5],e.ty=t[13]},cc.Touch=cc.Class.extend({_lastModified:0,_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.p(t.x,t.y):cc.p(t||0,e||0)}}),cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}}),cc.Event.TOUCH=0,cc.Event.KEYBOARD=1,cc.Event.ACCELERATION=2,cc.Event.MOUSE=3,cc.Event.FOCUS=4,cc.Event.CUSTOM=6,cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM),this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}}),cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE),this._eventType=t},setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),cc.EventMouse.NONE=0,cc.EventMouse.DOWN=1,cc.EventMouse.UP=2,cc.EventMouse.MOVE=3,cc.EventMouse.SCROLL=4,cc.EventMouse.BUTTON_LEFT=0,cc.EventMouse.BUTTON_RIGHT=2,cc.EventMouse.BUTTON_MIDDLE=1,cc.EventMouse.BUTTON_4=3,cc.EventMouse.BUTTON_5=4,cc.EventMouse.BUTTON_6=5,cc.EventMouse.BUTTON_7=6,cc.EventMouse.BUTTON_8=7,cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH),this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}}),cc.EventTouch.MAX_TOUCHES=5,cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3},cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS),this._widgetGetFocus=e,this._widgetLoseFocus=t}}),cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e,i){this._onCustomEvent=e,this._target=i,cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,this._callback)},_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent.call(this._target,t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerCustom.create=function(t,e){return new cc._EventListenerCustom(t,e)},cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(t){var e=cc.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse},cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne},cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce},cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener_create);var e=t.event;delete t.event;var i=null;for(var n in e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION?(i=new cc._EventListenerAcceleration(t.callback),delete t.callback):e===cc.EventListener.FOCUS&&(i=new cc._EventListenerFocus),t)i[n]=t[n];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return!!this.onFocusChanged||(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,this._callback)},_callback:function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){null!=this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t);for(var e=0,i=(t=t.getChildren()).length;e<i;e++)this._setDirtyForNode(t[e])},pauseTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!0);if(!0===e)for(i=0,n=(t=t.getChildren()).length;i<n;i++)this.pauseTarget(t[i],!0)},resumeTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e)for(i=0,n=(t=t.getChildren()).length;i<n;i++)this.resumeTarget(t[i],!0)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];i||(i=new cc._EventListenerVector,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),null===(e=t._getSceneGraphPriority())&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(e,t),e.isRunning()&&this.resumeTarget(e)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,o=i.length;r<o;r++)if(t=n[i[r].__instanceId])for(var c=0,s=t.length;c<s;c++)(e=t[c])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,e):++i},_removeListenersForListenerID:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(n),this._removeAllListenersInVector(i),delete this._priorityDirtyFlagMap[t],this._inDispatch||e.clear(),delete this._listenersMap[t]}for(i=this._toAddedListeners,e=0;e<i.length;)(n=i[e])&&n._getListenerID()===t?cc.arrayRemoveObject(i,n):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&((e=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(t,e):i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(t,e){if(t=this._getListeners(t)){var i=t.getSceneGraphPriorityListeners();i&&0!==i.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){if(t=this._listenersMap[t]){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,n=e.length;i<n&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,n=t.getFixedPriorityListeners(),r=t.getSceneGraphPriorityListeners(),o=this._toRemovedListeners;if(r)for(e=0;e<r.length;)(i=r[e])._isRegistered()?++e:(cc.arrayRemoveObject(r,i),-1!==(i=o.indexOf(i))&&o.splice(i,1));if(n)for(e=0;e<n.length;)(i=n[e])._isRegistered()?++e:(cc.arrayRemoveObject(n,i),-1!==(i=o.indexOf(i))&&o.splice(i,1));r&&0===r.length&&t.clearSceneGraphListeners(),n&&0===n.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t,e=this._listenersMap,i=this._priorityDirtyFlagMap;for(t in e)e[t].empty()&&(delete i[t],delete e[t]);if(0!==(e=this._toAddedListeners).length){for(i=0,t=e.length;i<t;i++)this._forceAddEventListener(e[i]);e.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){if(t=this._inDispatch,cc.assert(0<t,cc._LogInfos.EventManager__updateListeners),!(1<t)){var e;if((e=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(e),(e=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(e),cc.assert(1===t,cc._LogInfos.EventManager__updateListeners_2),0!==(t=this._toAddedListeners).length){e=0;for(var i=t.length;e<i;e++)this._forceAddEventListener(t[e]);t.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();o&&-1!==(n=o.indexOf(i))&&o.splice(n,1),r&&-1!==(n=r.indexOf(i))&&r.splice(n,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=e.selTouch;i._setCurrentTarget(t._node);var r,o=!1,c=i.getEventCode(),s=cc.EventTouch.EventCode;return c===s.BEGAN?t.onTouchBegan&&(o=t.onTouchBegan(n,i))&&t._registered&&t._claimedTouches.push(n):0<t._claimedTouches.length&&-1!==(r=t._claimedTouches.indexOf(n))&&(o=!0,c===s.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):c===s.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):c===s.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(cc.eventManager._updateTouchListeners(i),!0):!!(o&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.copyArray(n),o={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var c=0;c<n.length;c++)if(o.selTouch=n[c],this._dispatchEventToListeners(e,this._onTouchEventCallback,o),t.isStopped())return;if(i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped()))return;this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.EventTouch.EventCode,n=e.event;e=e.touches;var r=n.getEventCode();return n._setCurrentTarget(t._node),r===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(e,n):r===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(e,n):r===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(e,n):r===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(e,n),!!n.isStopped()&&(cc.eventManager._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.arrayRemoveObject(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r=!1,o=t.getFixedPriorityListeners(),c=t.getSceneGraphPriorityListeners(),s=0;if(o&&0!==o.length)for(;s<t.gt0Index;++s)if((n=o[s]).isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){r=!0;break}if(c&&!r)for(t=0;t<c.length;t++)if((n=c[t]).isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){r=!0;break}if(o&&!r)for(;s<o.length&&(!(n=o[s]).isEnabled()||n._isPaused()||!n._isRegistered()||!e(n,i));++s);},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;i[t]=null==i[t]?e:e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0,r=i.length,o=this._globalZOrderNodeMap,c=this._nodeListenersMap;if(0<r){for(var s;n<r&&(s=i[n])&&0>s.getLocalZOrder();n++)this._visitTarget(s,!1);for(null!=c[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));n<r;n++)(s=i[n])&&this._visitTarget(s,!1)}else null!=c[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));if(e){for(var a in t=[],o)t.push(a);for(t.sort(this._sortNumberAsc),a=t.length,r=this._nodePriorityMap,n=0;n<a;n++)for(e=o[t[n]],i=0;i<e.length;i++)r[e[i]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.eventManager_addListener_2),t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.eventManager_addListener_4)}else cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.eventManager_addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0);return this._addListener(t),t}},addCustomListener:function(t,e,i){return t=new cc._EventListenerCustom(t,e,i),this.addListener(t,1),t},removeListener:function(t){if(null!=t){var e,i,n=this._listenersMap;for(i in n){var r=n[i],o=r.getFixedPriorityListeners();if(e=r.getSceneGraphPriorityListeners(),(e=this._removeListenerInVector(e,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(o,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete n[i]),e)break}if(!e)for(i=0,r=(n=this._toAddedListeners).length;i<r;i++)if((o=n[i])===t){cc.arrayRemoveObject(n,o),o._setRegistered(!1);break}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(t,r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,r):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){if(t instanceof cc.Node){if(delete this._nodePriorityMap[t.__instanceId],cc.arrayRemoveObject(this._dirtyNodes,t),n=this._nodeListenersMap[t.__instanceId]){for(var i=cc.copyArray(n),n=0;n<i.length;n++)this.removeListener(i[n]);i.length=0}for(i=this._toAddedListeners,n=0;n<i.length;){var r=i[n];r._getSceneGraphPriority()===t?(r._setSceneGraphPriority(null),r._setRegistered(!1),i.splice(n,1)):++n}if(!0===e)for(n=0,e=(t=t.getChildren()).length;n<e;n++)this.removeListeners(t[n],!0)}else t===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t,e=this._listenersMap,i=this._internalCustomListenerIDs;for(t in e)-1===i.indexOf(t)&&this._removeListenersForListenerID(t)},setPriority:function(t,e){if(null!=t){var i,n=this._listenersMap;for(i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t)){null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority),t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw Error("event is undefined");if(t._type===cc.Event.TOUCH)this._dispatchTouchEvent(t);else{var e=function(t){var e=cc.Event,i=t._type;return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.CUSTOM?t._eventName:i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i===e.MOUSE?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i===e.TOUCH&&cc.log(cc._LogInfos.__getListenerID),"")}(t);this._sortEventListeners(e),(e=this._listenersMap[e])&&(this._dispatchEventToListeners(e,this._onListenerCallback,t),this._onUpdateListeners(e))}this._inDispatch--}},_onListenerCallback:function(t,e){return e._setCurrentTarget(t._getSceneGraphPriority()),t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){(t=new cc.EventCustom(t)).setUserData(e),this.dispatchEvent(t)}},cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION),this._acc=t}}),cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD),this._keyCode=t,this._isPressed=e}}),cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,(function(t){e._onAccelerationEvent(t._acc,t)}))},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerAcceleration.create=function(t){return new cc._EventListenerAcceleration(t)},cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,(function(e){e._isPressed?t.onKeyPressed&&t.onKeyPressed(e._keyCode,e):t.onKeyReleased&&t.onKeyReleased(e._keyCode,e)}))},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};var GlobalVertexBuffer=function(){var t=function(t,e){this.gl=t,this.vertexBuffer=t.createBuffer(),this.size=888,this.byteLength=e||3552*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this.data=new ArrayBuffer(this.byteLength),this.dataArray=new Float32Array(this.data),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.dataArray,t.DYNAMIC_DRAW),this._dirty=!1,this._spaces={0:this.byteLength}};return t.prototype={constructor:t,allocBuffer:function(t,e){var i=this._spaces[t];return!!(i&&i>=e)&&(delete this._spaces[t],i>e&&(this._spaces[t+e]=i-e),!0)},requestBuffer:function(t){var e,i;for(e in this._spaces)if(i=parseInt(e),this._spaces[e]>=t&&this.allocBuffer(i,t))return i;return-1},freeBuffer:function(t,e){var i,n,r=this._spaces;for(n in r){if((i=parseInt(n))>t)break;if(i+r[n]>=t){e=e+t-i,t=i;break}}r=t+e,this._spaces[r]&&(e+=this._spaces[r],delete this._spaces[r]),this._spaces[t]=e},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},updateSubData:function(t,e){this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,t,e)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer),this.vertexBuffer=this.texCoords=this.colors=this.positions=this.data=null}},t}();cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_canUseDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,n=this._dirtyRegion,r=0,o=!0,c=cc.Node.CanvasRenderCmd.RegionStatus;for(t=0,e=i.length;t<e;t++){var s=i[t],a=s._oldRegion,h=s._currentRegion;s._regionFlag>c.NotDirty&&(++r>this._dirtyRegionCountThreshold&&(o=!1),o&&(!h.isEmpty()&&n.addRegion(h),s._regionFlag>c.Dirty&&!a.isEmpty()&&n.addRegion(a)),s._regionFlag=c.NotDirty)}return o},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save(),t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},t._scaleX,t._scaleY),e.beginPath(),t=0;for(var n=i.length;t<n;++t){var r=i[t];e.rect(r._minX,-r._maxY,r._width,r._height)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},t._scaleX,t._scaleY),e.beginPath(),t=0;for(var n=i.length;t<n;++t){var r=i[t];e.rect(r._minX,-r._maxY,r._width,r._height)}i=e.fillStyle,e.fillStyle="green",e.fill(),e.fillStyle=i}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,n=(t=t||cc._renderContext).getContext(),r=cc.view.getScaleX(),o=cc.view.getScaleY();t.setViewScale(r,o),t.computeRealOffsetY();var c,s=this._dirtyRegion.getDirtyRegions(),a=this._renderCmds,h=this._allNeedDraw||!this._enableDirtyRegion||!this._canUseDirtyRegion;for(c=!0,h||(c=this._collectDirtyRegion()),(h=h||!c)||this._beginDrawDirtyRegion(t),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,i.width,i.height),255===this._clearColor.r&&255===this._clearColor.g&&255===this._clearColor.b||(t.setFillStyle(this._clearFillStyle),t.setGlobalAlpha(this._clearColor.a),n.fillRect(0,0,i.width,i.height)),i=0,c=a.length;i<c;i++){var l=a[i],d=!1,u=l._currentRegion;if(!u||h)d=!0;else for(var _=0,p=s.length;_<p;++_)if(s[_].intersects(u)){d=!0;break}d&&l.rendering(t,r,o)}h||(this._debugDrawDirtyRegion(t),this._endDrawDirtyRegion(n)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,n){t||cc.log("The context of RenderTexture is invalid."),i=cc.isUndefined(i)?1:i,n=cc.isUndefined(n)?1:n,e=e||this._currentID;var r,o,c=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,o=c.length;r<o;r++)c[r].rendering(t,i,n);this._removeCache(e),0===(t=this._cacheInstanceIds).length?this._isCacheToCanvasOn=!1:this._currentID=t[t.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]),cc.arrayRemoveObject(this._cacheInstanceIds,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)0!==t[e]._dirtyFlag&&t[e].updateStatus();t.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._canUseDirtyRegion=this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.needDraw())if(t._canUseDirtyRegion||(this._canUseDirtyRegion=!1),this._isCacheToCanvasOn){var e=this._cacheToCanvasCmds[this._currentID];-1===e.indexOf(t)&&e.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetY=this._offsetX=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(t){0<this._saveCount?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){0<this._saveCount?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){0<this._saveCount?this._context.fillStyle=t:this._currentFillStyle!==t&&(this._currentFillStyle=t,this._context.fillStyle=t)},t.setStrokeStyle=function(t){0<this._saveCount?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(t.a*e,-t.b*i,-t.c*e,t.d*i,t.tx*e,-t.ty*i)):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}}(),cc.rendererWebGL=function(){var t={texture:null,blendSrc:null,blendDst:null,glProgramState:null},e=!1,i=null,n=null,r=0,o=0,c=0,s=null,a=null,h=null,l=null,d=0,u=!0,_={QUAD:0,TRIANGLE:1,CUSTOM:2};return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:_,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(0,0,0,255),init:function(){(t=cc._renderContext).disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity();var t=cc.BATCH_VERTEX_COUNT,e=cc._renderContext;if(null===i&&(n=e.createBuffer(),i=e.createBuffer()),e=cc._renderContext,i){var o=6*Math.ceil(t/4);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),l=new Uint16Array(o);for(var c=0,d=0;d<o;d+=6)l[d]=c+0,l[d+1]=c+1,l[d+2]=c+2,l[d+3]=c+1,l[d+4]=c+2,l[d+5]=c+3,c+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,l,e.DYNAMIC_DRAW)}n&&(s=new ArrayBuffer(6*t*4),a=new Float32Array(s),h=new Uint32Array(s),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,a,e.DYNAMIC_DRAW)),r=t-200},getVertexSize:function(){return r},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]),cc.arrayRemoveObject(this._cacheInstanceIds,t)},_renderingToBuffer:function(t){t=t||this._currentID,this.rendering(cc._renderContext,this._cacheToBufferCmds[t]),this._removeCache(t),0===(t=this._cacheInstanceIds).length?this._isCacheToBufferOn=!1:this._currentID=t[t.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t,e,i=this._transformNodePool;for(i.sort(this._sortNodeByLevelAsc),t=0,e=i.length;t<e;t++)i[t].updateStatus();i.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r/255,this._clearColor.g/255,this._clearColor.b/255,this._clearColor.a/255),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var e=this._cacheToBufferCmds[this._currentID];-1===e.indexOf(t)&&e.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)},_increaseBatchingSize:function(t,e,i){switch(e=e||_.QUAD){case _.QUAD:for(e=0;e<t;e+=4)i=o+e,l[c++]=i+0,l[c++]=i+1,l[c++]=i+2,l[c++]=i+1,l[c++]=i+2,l[c++]=i+3;break;case _.TRIANGLE:for(u=!1,e=0;e<t;e+=3)i=o+e,l[c++]=i+0,l[c++]=i+1,l[c++]=i+2;break;case _.CUSTOM:u=!1;var n=i.length;for(e=0;e<n;e++)l[c++]=o+i[e];break;default:return}o+=t},_updateBatchedInfo:function(e,i,n){return(e!==t.texture||i.src!==t.blendSrc||i.dst!==t.blendDst||n!==t.glProgramState)&&(this._batchRendering(),t.texture=e,t.blendSrc=i.src,t.blendDst=i.dst,t.glProgramState=n,!0)},_breakBatch:function(){e=!0},_uploadBufferData:function(i){o>=r&&this._batchRendering();var n=(s=i._node)._texture||s._spriteFrame&&s._spriteFrame._texture,c=s._blendFunc.src,s=s._blendFunc.dst,l=i._glProgramState;(e||t.texture!==n||t.blendSrc!==c||t.blendDst!==s||t.glProgramState!==l)&&(this._batchRendering(),t.texture=n,t.blendSrc=c,t.blendDst=s,t.glProgramState=l,e=!1),0<(n=i.uploadData(a,h,6*o))&&this._increaseBatchingSize(n,i.vertexType)},_batchRendering:function(){if(0!==o&&t.texture){var e=cc._renderContext,s=t.texture,h=t.glProgramState,_=o>.5*r;h&&(h.apply(),h.getGLProgram()._updateProjectionUniform()),cc.glBlendFunc(t.blendSrc,t.blendDst),cc.glBindTexture2DN(0,s),e.bindBuffer(e.ARRAY_BUFFER,n),_?e.bufferData(e.ARRAY_BUFFER,a,e.DYNAMIC_DRAW):(s=a.subarray(0,6*o),e.bufferData(e.ARRAY_BUFFER,s,e.DYNAMIC_DRAW)),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,24,12),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,24,16),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),(!d||!u||c>d)&&(_?e.bufferData(e.ELEMENT_ARRAY_BUFFER,l,e.DYNAMIC_DRAW):e.bufferData(e.ELEMENT_ARRAY_BUFFER,l.subarray(0,c),e.DYNAMIC_DRAW)),e.drawElements(e.TRIANGLES,c,e.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,u?d=c:(d=0,u=!0),c=o=0}},rendering:function(e,i){i=i||this._renderCmds;var n,r,c=e||cc._renderContext;for(c.bindBuffer(gl.ARRAY_BUFFER,null),e=0,n=i.length;e<n;++e)(r=i[e]).needDraw()&&(r.uploadData?this._uploadBufferData(r):(0<o&&this._batchRendering(),r.rendering(c)));this._batchRendering(),t.texture=null}}}();var Region=function(){this._area=this._height=this._width=this._maxY=this._maxX=this._minY=this._minX=0},regionProto=Region.prototype,regionPool=[];function regionCreate(){var t=regionPool.pop();return t||(t=new Region),t}function regionRelease(t){regionPool.push(t)}function unionArea(t,e){return((t._maxX>e._maxX?t._maxX:e._maxX)-(t._minX<e._minX?t._minX:e._minX))*((t._maxY>e._maxY?t._maxY:e._maxY)-(t._minY<e._minY?t._minY:e._minY))}regionProto.setTo=function(t,e,i,n){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=n,this.updateArea(),this},regionProto.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},regionProto.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},regionProto.union=function(t){0>=this._width||0>=this._height?this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),this.updateArea())},regionProto.setEmpty=function(){this._area=this._height=this._width=this._maxY=this._maxX=this._minY=this._minX=0},regionProto.isEmpty=function(){return 0>=this._width||0>=this._height},regionProto.intersects=function(t){if(0>=this._width||0>=this._height||0>=t._width||0>=t._height)return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(e>i)&&(e=this._minY>t._minY?this._minY:t._minY)<=(this._maxY<t._maxY?this._maxY:t._maxY)},regionProto.updateRegion=function(t,e){if(0==t.width||0==t.height)this.setEmpty();else{var i=e.a,n=e.b,r=e.c,o=e.d,c=e.tx;e=e.ty;var s=t.x,a=t.y,h=s+t.width,l=a+t.height;if(1==i&&0==n&&0==r&&1==o)n=s+c-1,t=a+e-1,c=h+c+1,e=l+e+1;else{var d=i*s+r*a+c;t=n*s+o*a+e;var u=i*h+r*a+c,_=(a=n*h+o*a+e,i*h+r*l+c);h=n*h+o*l+e,c=i*s+r*l+c,e=n*s+o*l+e,d>u&&(l=d,d=u,u=l),_>c&&(l=_,_=c,c=l),n=(d<_?d:_)-1,c=(u>c?u:c)+1,t>a&&(l=t,t=a,a=l),h>e&&(l=h,h=e,e=l),t=(t<h?t:h)-1,e=(a>e?a:e)+1}this._minX=n,this._minY=t,this._maxX=c,this._maxY=e,this._width=c-n,this._height=e-t,this._area=this._width*this._height}};var DirtyRegion=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipArea=this.clipHeight=this.clipWidth=0,this.clipRectChanged=!1},dirtyRegionProto=DirtyRegion.prototype;dirtyRegionProto.setClipRect=function(t,e){this.clipRectChanged=this.hasClipRect=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},dirtyRegionProto.addRegion=function(t){var e=t._minX,i=t._minY,n=t._maxX;if(t=t._maxY,this.hasClipRect&&(0>e&&(e=0),0>i&&(i=0),n>this.clipWidth&&(n=this.clipWidth),t>this.clipHeight&&(t=this.clipHeight)),e>=n||i>=t)return!1;if(this.clipRectChanged)return!0;var r=this.dirtyList,o=regionCreate();return r.push(o.setTo(e,i,n,t)),this.mergeDirtyList(r),!0},dirtyRegionProto.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)regionRelease(t[i]);t.length=0},dirtyRegionProto.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=regionCreate();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););if(0<(t=this.dirtyList.length))for(e=0;e<t;e++)this.dirtyList[e].intValues();return this.dirtyList},dirtyRegionProto.mergeDirtyList=function(t){var e=t.length;if(2>e)return!1;for(var i=this.hasClipRect,n=3<e?Number.POSITIVE_INFINITY:0,r=0,o=0,c=0,s=0;s<e-1;s++){var a=t[s];i&&(c+=a.area);for(var h=s+1;h<e;h++){var l;n>(l=unionArea(a,l=t[h])-a.area-l.area)&&(r=s,o=h,n=l)}}return i&&.95<c/this.clipArea&&(this.clipRectChanged=!0),r!=o&&(e=t[o],t[r].union(e),regionRelease(e),t.splice(o,1),!0)},cc.Region=Region,cc.DirtyRegion=DirtyRegion,cc._tmp.PrototypeCCNode=function(){var t=cc.Node.prototype;cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),cc.defineGetterSetter(t,"children",t.getChildren),cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount),cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),cc.defineGetterSetter(t,"running",t.isRunning),cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},cc.NODE_TAG_INVALID=-1,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,arrivalOrder:0,_actionManager:null,_scheduler:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){this._anchorPoint=cc.p(0,0),this._contentSize=cc.size(0,0),this._position=cc.p(0,0),this._normalizedPosition=cc.p(0,0),this._children=[],this._additionalTransform=cc.affineTransformMakeIdentity(),cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this)),this._realColor=cc.color(255,255,255,255),this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){t!==this._localZOrder&&(this._parent?this._parent.reorderChild(this,t):this._localZOrder=t,cc.eventManager._setDirtyForNode(this))},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.log(cc._LogInfos.Node_getZOrder),this.getLocalZOrder()},setZOrder:function(t){cc.log(cc._LogInfos.Node_setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var i=this._normalizedPosition;void 0===e?(i.x=t.x,i.y=t.y):(i.x=t,i.y=e),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){this.userObject!==t&&(this.userObject=t)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||cc.director.getActionManager()},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.log(cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?n=t._name:"string"==typeof i?(n=i,i=void 0):"number"==typeof i&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node_addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival++),this._running&&(t._performRecursive(cc.Node._stateCallbackType.onEnter),this._isTransitionFinished&&t._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)),t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),-1<this._children.indexOf(t)&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node_removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),n._performRecursive(cc.Node._stateCallbackType.onExit)),t&&n._performRecursive(cc.Node._stateCallbackType.cleanup),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),t._performRecursive(cc.Node._stateCallbackType.onExit)),e&&t._performRecursive(cc.Node._stateCallbackType.cleanup),t.parent=null,t._renderCmd.detachFromParent(),cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Node_reorderChild),-1===this._children.indexOf(t)?cc.log(cc._LogInfos.Node_reorderChild_2):(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty))},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;0<=e;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},_performRecursive:function(t){var e=cc.Node._stateCallbackType;if(!(t>=e.max)){var i,n,r,o,c,s=0,a=cc.Node._performStacks[cc.Node._performing];for(a||(a=[],cc.Node._performStacks.push(a)),a.length=0,cc.Node._performing++,r=a[0]=this;r;){if((i=r._children)&&0<i.length)for(o=0,c=i.length;o<c;++o)n=i[o],a.push(n);if((i=r._protectedChildren)&&0<i.length)for(o=0,c=i.length;o<c;++o)n=i[o],a.push(n);r=a[++s]}for(o=a.length-1;0<=o;--o)if(r=a[o],a[o]=null,r)switch(t){case e.onEnter:r.onEnter();break;case e.onExit:r.onExit();break;case e.onEnterTransitionDidFinish:r.onEnterTransitionDidFinish();break;case e.cleanup:r.cleanup();break;case e.onExitTransitionDidStart:r.onExitTransitionDidStart()}cc.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause(),this.removeAllComponents()},runAction:function(t){return cc.assert(t,cc._LogInfos.Node_runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){t===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var o=arguments.length;"function"==typeof t?1===o?(e=0,i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):2===o?"number"==typeof e?(i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,e=0,i=cc.REPEAT_FOREVER,n=0):3===o?("string"==typeof i?(r=i,i=cc.REPEAT_FOREVER):r=this.__instanceId,n=0):4===o&&(r=this.__instanceId):1===o?(e=0,i=cc.REPEAT_FOREVER,n=0):2===o&&(i=cc.REPEAT_FOREVER,n=0),cc.assert(t,cc._LogInfos.Node_schedule),cc.assert(0<=e,cc._LogInfos.Node_schedule_2),e=e||0,i=isNaN(i)?cc.REPEAT_FOREVER:i,this.scheduler.schedule(t,this,e,i,n||0,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){if(void 0===t)return this._additionalTransformDirty=!1;this._additionalTransform=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.p(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){return t=t||cc.p(0,0),t=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints()),this.convertToWorldSpace(t)},_convertToWindowSpace:function(t){return t=this.convertToWorldSpace(t),cc.director.convertToUI(t)},convertTouchToNodeSpace:function(t){return t=t.getLocation(),this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(t){return t=cc.director.convertToGL(t.getLocation()),this.convertToNodeSpaceAR(t)},update:function(t){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(t)},updateTransform:function(){for(var t,e=this._children,i=0;i<e.length;i++)(t=e[i])&&t.updateTransform()},retain:function(){},release:function(){},getComponent:function(t){return this._componentContainer?this._componentContainer.getComponent(t):null},addComponent:function(t){this._componentContainer&&this._componentContainer.add(t)},removeComponent:function(t){return!!this._componentContainer&&this._componentContainer.remove(t)},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){t=cc.renderer,e.visit(i);var n,r=this._children,o=r.length;if(0<o){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<o&&0>(n=r[i])._localZOrder;i++)n.visit(this);for(t.pushRenderCommand(e);i<o;i++)r[i].visit(this)}else t.pushRenderCommand(e);e._dirtyFlag=0}else e._propagateFlagsDown(i)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){e={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty};for(var i=this._parent;null!=i&&i!=t;i=i.getParent())cc.affineTransformConcatIn(e,i.getNodeToParentTransform())}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},setGLProgramState:function(t){this._renderCmd.setGLProgramState(t)},getGLProgramState:function(){return this._renderCmd.getGLProgramState()},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(t=cc.rectApplyAffineTransform(t,e),!this._children)return t;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(e))&&(t=cc.rectUnion(t,r))}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);if(t=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t),e=cc.rectApplyAffineTransform(e,t),!this._children)return e;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(t))&&(e=cc.rectUnion(e,r))}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(t,e){cc.assert(t&&0!=t.length,"Invalid name"),cc.assert(null!=e,"Invalid callback function");var i=t.length,n=0,r=i,o=!1;2<i&&"/"===t[0]&&"/"===t[1]&&(o=!0,n=2,r-=2);var c=!1;3<i&&"/"===t[i-3]&&"."===t[i-2]&&"."===t[i-1]&&(c=!0,r-=3),t=t.substr(n,r),c&&(t="[[:alnum:]]+/"+t),o?this.doEnumerateRecursive(this,t,e):this.doEnumerate(t,e)},doEnumerateRecursive:function(t,e,i){var n=!1;if(t.doEnumerate(e,i))n=!0;else for(var r=t.getChildren(),o=r.length,c=0;c<o;c++)if(t=r[c],this.doEnumerateRecursive(t,e,i)){n=!0;break}return n},doEnumerate:function(t,e){var i=t.indexOf("/"),n=t,r=!1;-1!==i&&(n=t.substr(0,i),r=!0),i=!1;for(var o,c=this._children,s=c.length,a=0;a<s;a++)if(-1!==(o=c[a])._name.indexOf(n))if(r){if(i=o.doEnumerate(t,e))break}else if(e(o)){i=!0;break}return i}}),cc.Node.create=function(){return new cc.Node},cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},cc.Node._performStacks=[[]],cc.Node._performing=0,cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),cc._tmp.PrototypeCCNode(),delete cc._tmp.PrototypeCCNode,cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e},cc.CustomRenderCmd.prototype.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)},cc.CustomRenderCmd.prototype.needDraw=function(){return this._needDraw};var dirtyFlags=cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1023},ONE_DEGREE=Math.PI/180;function transformChildTree(t){var e,i,n,r,o,c=1,s=cc.Node._performStacks[cc.Node._performing];for(s||(s=[],cc.Node._performStacks.push(s)),s.length=0,cc.Node._performing++,s[0]=t;c;)if(i=s[--c],s[c]=null,i){if((e=i._children)&&0<e.length)for(n=i._renderCmd,r=0,o=e.length;r<o;++r)t=e[r],s[c]=t,c++,t._renderCmd.transform(n);if((e=i._protectedChildren)&&0<e.length)for(n=i._renderCmd,r=0,o=e.length;r<o;++r)t=e[r],s[c]=t,c++,t._renderCmd.transform(n)}cc.Node._performing--}cc.Node.RenderCmd=function(t){this._node=t,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255)},cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,_needDraw:!1,_dirtyFlag:1,_curLevel:-1,_displayedOpacity:255,_cascadeColorEnabledDirty:!1,_cascadeOpacityEnabledDirty:!1,_transform:null,_worldTransform:null,_inverse:null,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._inverse||(this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0}),this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var i=this._node;t=t?t._worldTransform:null;var n=this._transform,r=this._worldTransform;if(i._usingNormalizedPosition&&i._parent){var o=i._parent._contentSize;i._position.x=i._normalizedPosition.x*o.width,i._position.y=i._normalizedPosition.y*o.height,i._normalizedPositionDirty=!1}var c=i._rotationX||i._rotationY,s=i._skewX||i._skewY,a=i._scaleX,h=i._scaleY,l=(o=this._anchorPointInPoints.x,this._anchorPointInPoints.y),d=1,u=0,_=0,p=1;c||s?(n.tx=i._position.x,n.ty=i._position.y,c&&(d=i._rotationX*ONE_DEGREE,_=Math.sin(d),p=Math.cos(d),i._rotationY===i._rotationX?(d=p,u=-_):(u=i._rotationY*ONE_DEGREE,d=Math.cos(u),u=-Math.sin(u))),n.a=d*=a,n.b=u*=a,n.c=_*=h,n.d=p*=h,s&&(1/0===(s=Math.tan(i._skewX*ONE_DEGREE))&&(s=99999999),1/0===(a=Math.tan(i._skewY*ONE_DEGREE))&&(a=99999999),n.a=d+_*a,n.b=u+p*a,n.c=_+d*s,n.d=p+u*s),(o||l)&&(n.tx-=n.a*o+n.c*l,n.ty-=n.b*o+n.d*l,i._ignoreAnchorPointForPosition&&(n.tx+=o,n.ty+=l)),i._additionalTransformDirty&&cc.affineTransformConcatIn(n,i._additionalTransform),t?(r.a=n.a*t.a+n.b*t.c,r.b=n.a*t.b+n.b*t.d,r.c=n.c*t.a+n.d*t.c,r.d=n.c*t.b+n.d*t.d,r.tx=t.a*n.tx+t.c*n.ty+t.tx,r.ty=t.d*n.ty+t.ty+t.b*n.tx):(r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty)):(n.a=a,n.b=0,n.c=0,n.d=h,n.tx=i._position.x,n.ty=i._position.y,(o||l)&&(n.tx-=n.a*o,n.ty-=n.d*l,i._ignoreAnchorPointForPosition&&(n.tx+=o,n.ty+=l)),i._additionalTransformDirty&&cc.affineTransformConcatIn(n,i._additionalTransform),t?(r.a=n.a*t.a+n.b*t.c,r.b=n.a*t.b+n.b*t.d,r.c=n.c*t.a+n.d*t.c,r.d=n.c*t.b+n.d*t.d,r.tx=n.tx*t.a+n.ty*t.c+t.tx,r.ty=n.tx*t.b+n.ty*t.d+t.ty):(r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty)),this._updateCurrentRegions&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),e&&transformChildTree(i),this._cacheDirty=!0},getNodeToParentTransform:function(){return(!this._transform||this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)&&this.transform(),this._transform},visit:function(t){var e=this._node,i=cc.renderer;(t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t)},_updateDisplayColor:function(t){var e,i=this._node,n=this._displayedColor,r=i._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!i._cascadeColorEnabled){for(n.r=r.r,n.g=r.g,n.b=r.b,n=new cc.Color(255,255,255,255),t=i._children,i=0,r=t.length;i<r;i++)(e=t[i])&&e._renderCmd&&e._renderCmd._updateDisplayColor(n);this._cascadeColorEnabledDirty=!1}else if(void 0===t&&(t=(t=i._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),n.r=0|r.r*t.r/255,n.g=0|r.g*t.g/255,n.b=0|r.b*t.b/255,i._cascadeColorEnabled)for(t=i._children,i=0,r=t.length;i<r;i++)(e=t[i])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(n),e._renderCmd._updateColor());this._dirtyFlag&=~dirtyFlags.colorDirty},_updateDisplayOpacity:function(t){var e,i,n=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!n._cascadeOpacityEnabled){for(this._displayedOpacity=n._realOpacity,t=0,n=(e=n._children).length;t<n;t++)(i=e[t])&&i._renderCmd&&i._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else if(void 0===t&&(t=255,(e=n._parent)&&e._cascadeOpacityEnabled&&(t=e.getDisplayedOpacity())),this._displayedOpacity=n._realOpacity*t/255,n._cascadeOpacityEnabled)for(t=0,n=(e=n._children).length;t<n;t++)(i=e[t])&&i._renderCmd&&(i._renderCmd._updateDisplayOpacity(this._displayedOpacity),i._renderCmd._updateColor());this._dirtyFlag&=~dirtyFlags.opacityDirty},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;void 0===t&&(t=(t=e._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},_propagateFlagsDown:function(t){var e=this._dirtyFlag,i=t?t._node:null;i&&i._cascadeColorEnabled&&t._dirtyFlag&dirtyFlags.colorDirty&&(e|=dirtyFlags.colorDirty),i&&i._cascadeOpacityEnabled&&t._dirtyFlag&dirtyFlags.opacityDirty&&(e|=dirtyFlags.opacityDirty),t&&t._dirtyFlag&dirtyFlags.transformDirty&&(e|=dirtyFlags.transformDirty),this._dirtyFlag=e},updateStatus:function(){var t=this._dirtyFlag,e=t&dirtyFlags.colorDirty,i=t&dirtyFlags.opacityDirty;t&dirtyFlags.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~dirtyFlags.contentDirty),e&&this._updateDisplayColor(),i&&this._updateDisplayOpacity(),(e||i)&&this._updateColor(),t&dirtyFlags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~dirtyFlags.transformDirty),t&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)},_syncStatus:function(t){var e=this._dirtyFlag;(i=t?t._node:null)&&i._cascadeColorEnabled&&t._dirtyFlag&dirtyFlags.colorDirty&&(e|=dirtyFlags.colorDirty),i&&i._cascadeOpacityEnabled&&t._dirtyFlag&dirtyFlags.opacityDirty&&(e|=dirtyFlags.opacityDirty),t&&t._dirtyFlag&dirtyFlags.transformDirty&&(e|=dirtyFlags.transformDirty),this._dirtyFlag=e;var i=e&dirtyFlags.colorDirty,n=e&dirtyFlags.opacityDirty;i&&this._syncDisplayColor(),n&&this._syncDisplayOpacity(),(i||n)&&this._updateColor(),e&dirtyFlags.transformDirty&&this.transform(t),e&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)},setShaderProgram:function(t){},getShaderProgram:function(){return null},getGLProgramState:function(){return null},setGLProgramState:function(t){}},cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform,cc.Node.RenderCmd.prototype.originUpdateStatus=cc.Node.RenderCmd.prototype.updateStatus,cc.Node.RenderCmd.prototype._originSyncStatus=cc.Node.RenderCmd.prototype._syncStatus,function(){cc.Node.CanvasRenderCmd=function(t){this._node=t,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0,this._canUseDirtyRegion=!1},cc.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var t=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.CanvasRenderCmd,t._rootCtor=cc.Node.CanvasRenderCmd,t._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var e=new cc.Rect;t.getLocalBB=function(){var t=this._node;return e.x=e.y=0,e.width=t._contentSize.width,e.height=t._contentSize.height,e},t._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},t.setDirtyFlag=function(t,e){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent&&this._cachedParent.setDirtyFlag(t,!0)},t._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},t._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;i<n;i++)e[i]._renderCmd._setCachedParent(t)}},t.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._renderCmd&&t._renderCmd.detachFromParent()},cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.SRC_ALPHA&&t.dst===cc.ONE||t.src===cc.ONE&&t.dst===cc.ONE?"lighter":t.src===cc.ZERO&&t.dst===cc.SRC_ALPHA?"destination-in":t.src===cc.ZERO&&t.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}(),function(){cc.Node.WebGLRenderCmd=function(t){this._node=t,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255),this._glProgramState=null};var t=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.WebGLRenderCmd,t._rootCtor=cc.Node.WebGLRenderCmd,t._updateColor=function(){},t.setShaderProgram=function(t){this._glProgramState=cc.GLProgramState.getOrCreateWithGLProgram(t)},t.getShaderProgram=function(){return this._glProgramState?this._glProgramState.getGLProgram():null},t.getGLProgramState=function(){return this._glProgramState},t.setGLProgramState=function(t){this._glProgramState=t},Object.defineProperty(t,"_shaderProgram",{set:function(t){this.setShaderProgram(t)},get:function(){return this.getShaderProgram()}})}(),cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._ignoreContentScaleFactor=!1,void 0!==n&&this.initWithTileFile(t,e,i,n)},_createRenderCmd:function(){this._renderCmd=cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.AtlasNode.CanvasRenderCmd(this):new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t,this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,i,n){if(!t)throw Error("cc.AtlasNode.initWithTileFile(): title should not be null");return t=cc.textureCache.addImage(t),this.initWithTexture(t,e,i,n)},initWithTexture:function(t,e,i,n){return this._renderCmd.initWithTexture(t,e,i,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)},getTexture:function(){return this._texture},setTexture:function(t){this._texture=t},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}}),_p=cc.AtlasNode.prototype,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.EventHelper.prototype.apply(_p),cc.AtlasNode.create=function(t,e,i,n){return new cc.AtlasNode(t,e,i,n)},function(){cc.AtlasNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._colorUnmodified=cc.color.WHITE,this._textureToRender=null};var t=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.AtlasNode.CanvasRenderCmd,t.initWithTexture=function(t,e,i,n){var r=this._node;return r._itemWidth=e,r._itemHeight=i,r._opacityModifyRGB=!0,r._texture=t,r._texture?(this._textureToRender=t,this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=this._node._realColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(this._colorUnmodified=t,this._changeTextureColor())},t._changeTextureColor=function(){var t=this._node._texture,e=this._colorUnmodified,i=t.getHtmlElementObj();i=cc.rect(0,0,i.width,i.height),t===this._textureToRender?this._textureToRender=t._generateColorTexture(e.r,e.g,e.b,i):t._generateColorTexture(e.r,e.g,e.b,i,this._textureToRender.getHtmlElementObj())},t.setOpacity=function(t){cc.Node.prototype.setOpacity.call(this._node,t)},t._calculateMaxItems=function(){var t=this._node,e=t._texture.getContentSize();t._itemsPerColumn=0|e.height/t._itemHeight,t._itemsPerRow=0|e.width/t._itemWidth}}(),function(){cc.AtlasNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=cc.color.WHITE,this._uniformColor=this._colorF32Array=null,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.AtlasNode.WebGLRenderCmd,t._updateBlendFunc=function(){var t=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(t._blendFunc.src=cc.SRC_ALPHA,t._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},t.rendering=function(t){t=t||cc._renderContext;var e=this._node,i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._glProgramState.apply(this._matrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(t.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(e.quadsToDraw,0))},t.initWithTexture=function(t,e,i,n){var r=this._node;return r._itemWidth=e,r._itemHeight=i,this._colorUnmodified=cc.color.WHITE,r._opacityModifyRGB=!0,r._blendFunc.src=cc.BLEND_SRC,r._blendFunc.dst=cc.BLEND_DST,e=r._realColor,this._colorF32Array=new Float32Array([e.r/255,e.g/255,e.b/255,r._realOpacity/255]),this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(t,n),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),r.quadsToDraw=n,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(t){var e=cc.color(t.r,t.g,t.b),i=this._node;this._colorUnmodified=t,t=this._displayedOpacity,i._opacityModifyRGB&&(e.r=e.r*t/255,e.g=e.g*t/255,e.b=e.b*t/255),cc.Node.prototype.setColor.call(i,e)},t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t),e._opacityModifyRGB&&(e.color=this._colorUnmodified)},t._updateColor=function(){if(this._colorF32Array){var t=this._displayedColor;this._colorF32Array[0]=t.r/255,this._colorF32Array[1]=t.g/255,this._colorF32Array[2]=t.b/255,this._colorF32Array[3]=this._displayedOpacity/255}},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.texture=t,this._updateBlendFunc(),this._updateOpacityModifyRGB()},t._calculateMaxItems=function(){var t=this._node,e=this._textureAtlas.texture,i=e.getContentSize();t._ignoreContentScaleFactor&&(i=e.getContentSizeInPixels()),t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),this._htmlElementObj=null,cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"<cc.Texture2D | Name = "+this._name+" | Dimensions = "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates = ("+this.maxS+", "+this.maxT+")>"},releaseData:function(t){},keepData:function(t,e){return t},initWithData:function(t,e,i,n,r){var o=cc.Texture2D,c=cc._renderContext,s=c.RGBA,a=c.UNSIGNED_BYTE,h=i*cc.Texture2D._B[e]/8;switch(0==h%8?c.pixelStorei(c.UNPACK_ALIGNMENT,8):0==h%4?c.pixelStorei(c.UNPACK_ALIGNMENT,4):0==h%2?c.pixelStorei(c.UNPACK_ALIGNMENT,2):c.pixelStorei(c.UNPACK_ALIGNMENT,1),this._webTextureObj=c.createTexture(),cc.glBindTexture2D(this),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:s=c.RGBA;break;case o.PIXEL_FORMAT_RGB888:s=c.RGB;break;case o.PIXEL_FORMAT_RGBA4444:a=c.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:a=c.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:a=c.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:s=c.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:s=c.ALPHA;break;case o.PIXEL_FORMAT_I8:s=c.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return c.texImage2D(c.TEXTURE_2D,0,s,i,n,0,s,a,t),this._contentSize.width=r.width,this._contentSize.height=r.height,this._pixelsWide=i,this._pixelsHigh=n,this._pixelFormat=e,this.maxS=r.width/i,this.maxT=r.height/n,this._hasMipmaps=this._hasPremultipliedAlpha=!1,this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),this._textureLoaded=!0},drawAtPoint:function(t){var e=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],i=cc._renderContext,n=this._pixelsWide*this.maxS,r=this._pixelsHigh*this.maxT;t=[t.x,t.y,0,n+t.x,t.y,0,t.x,r+t.y,0,n+t.x,r+t.y,0],this._glProgramState.apply(),this._glProgramState._glprogram.setUniformsForBuiltins(),cc.glBindTexture2D(this),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,t),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,0,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)},drawInRect:function(t){var e=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0];t=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height],this._glProgramState.apply(),this._glProgramState._glprogram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var i=cc._renderContext;i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,t),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,0,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();return e>n||i>n?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._hasPremultipliedAlpha=this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){if(t=void 0!==t?t:this._hasPremultipliedAlpha,cc.game._rendererInitialized&&this._htmlElementObj&&this._htmlElementObj.width&&this._htmlElementObj.height){var e=cc._renderContext;cc.glBindTexture2D(this),e.pixelStorei(e.UNPACK_ALIGNMENT,4),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e=this._htmlElementObj.height,this._pixelsWide=this._contentSize.width=this._htmlElementObj.width,this._pixelsHigh=this._contentSize.height=e,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.maxT=this.maxS=1,this._hasPremultipliedAlpha=t,this._hasMipmaps=!1,window.ENABLE_IMAEG_POOL&&(this._htmlElementObj=null),this.dispatchEvent("load")}},initWithString:function(t,e,i,n,r,o){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(t,e,i,n,r,o){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(t,e,i,n){var r=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh)||t.wrapS===r.CLAMP_TO_EDGE&&t.wrapT===r.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(this),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t.minFilter),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t.magFilter),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t.wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(this),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),this._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=cc.Texture2D._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n,r=cc.Texture2D,o=t.getData(),c=t.hasAlpha(),s=cc.size(t.getWidth(),t.getHeight()),a=r.defaultPixelFormat,h=t.getBitsPerComponent();c||(8<=h?a=r.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),a=r.PIXEL_FORMAT_RGB565));var l=e*i;if(a===r.PIXEL_FORMAT_RGB565)if(c)for(o=new Uint16Array(e*i),n=t.getData(),h=0;h<l;++h)o[h]=(n[h]>>0&255)>>3<<11|(n[h]>>8&255)>>2<<5|(n[h]>>16&255)>>3<<0;else for(o=new Uint16Array(e*i),n=t.getData(),h=0;h<l;++h)o[h]=(255&n[h])>>3<<11|(255&n[h])>>2<<5|(255&n[h])>>3<<0;else if(a===r.PIXEL_FORMAT_RGBA4444)for(o=new Uint16Array(e*i),n=t.getData(),h=0;h<l;++h)o[h]=(n[h]>>0&255)>>4<<12|(n[h]>>8&255)>>4<<8|(n[h]>>16&255)>>4<<4|(n[h]>>24&255)>>4<<0;else if(a===r.PIXEL_FORMAT_RGB5A1)for(o=new Uint16Array(e*i),n=t.getData(),h=0;h<l;++h)o[h]=(n[h]>>0&255)>>3<<11|(n[h]>>8&255)>>3<<6|(n[h]>>16&255)>>3<<1|(n[h]>>24&255)>>7<<0;else if(a===r.PIXEL_FORMAT_A8)for(o=new Uint8Array(e*i),n=t.getData(),h=0;h<l;++h)o[h]=n>>24&255;if(c&&a===r.PIXEL_FORMAT_RGB888)for(n=t.getData(),o=new Uint8Array(e*i*3),h=0;h<l;++h)o[3*h]=n>>0&255,o[3*h+1]=n>>8&255,o[3*h+2]=n>>16&255;return this.initWithData(o,a,e,i,s),t.getData(),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)}})},cc._tmp.WebGLTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},t._mapBuffers=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},t.drawNumberOfQuads=function(t,e){if(e=e||0,0!==t&&this.texture&&this.texture.isLoaded()){var i=cc._renderContext;cc.glBindTexture2D(this.texture),i.bindBuffer(i.ARRAY_BUFFER,this._quadsWebBuffer),this.dirty&&(i.bufferData(i.ARRAY_BUFFER,this._quadsArrayBuffer,i.DYNAMIC_DRAW),this.dirty=!1),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,24,0),i.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,24,12),i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,24,16),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?i.drawElements(i.TRIANGLE_STRIP,6*t,i.UNSIGNED_SHORT,6*e*this._indices.BYTES_PER_ELEMENT):i.drawElements(i.TRIANGLES,6*t,i.UNSIGNED_SHORT,6*e*this._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}},cc._tmp.WebGLTextureCache=function(){var t=cc.textureCache;t.handleLoadedTexture=function(t,e){var i,n=this._textures;return cc.game._rendererInitialized||(n=this._loadedTexturesBefore),(i=n[t])||((i=n[t]=new cc.Texture2D).url=t),i.initWithElement(e),".png"===cc.path.extname(t)?i.handleLoadedTexture(!0):i.handleLoadedTexture(),i},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage_2);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var r=n[t]||n[cc.loader._getAliase(t)];return r?(r.isLoaded()?e&&e.call(i,r):r.addEventListener("load",(function(){e&&e.call(i,r)}),i),r):((r=n[t]=new cc.Texture2D).url=t,n=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath,cc.loader.loadImg(cc.path.join(n||"",t),(function(n,r){if(n)return e&&e.call(i,n);n=cc.textureCache.handleLoadedTexture(t,r),e&&e.call(i,n)})),r)},t.addImageAsync=t.addImage,t=null},cc._tmp.PrototypeTexture2D=function(){var t=cc.Texture2D;t.PVRImagesHavePremultipliedAlpha=function(t){cc.PVRHaveAlphaPremultiplied_=t},t.PIXEL_FORMAT_RGBA8888=2,t.PIXEL_FORMAT_RGB888=3,t.PIXEL_FORMAT_RGB565=4,t.PIXEL_FORMAT_A8=5,t.PIXEL_FORMAT_I8=6,t.PIXEL_FORMAT_AI88=7,t.PIXEL_FORMAT_RGBA4444=8,t.PIXEL_FORMAT_RGB5A1=7,t.PIXEL_FORMAT_PVRTC4=9,t.PIXEL_FORMAT_PVRTC2=10,t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888,t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT;var e=cc.Texture2D._M={};e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888",e[t.PIXEL_FORMAT_RGB888]="RGB888",e[t.PIXEL_FORMAT_RGB565]="RGB565",e[t.PIXEL_FORMAT_A8]="A8",e[t.PIXEL_FORMAT_I8]="I8",e[t.PIXEL_FORMAT_AI88]="AI88",e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444",e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1",e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4",e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2",(e=cc.Texture2D._B={})[t.PIXEL_FORMAT_RGBA8888]=32,e[t.PIXEL_FORMAT_RGB888]=24,e[t.PIXEL_FORMAT_RGB565]=16,e[t.PIXEL_FORMAT_A8]=8,e[t.PIXEL_FORMAT_I8]=8,e[t.PIXEL_FORMAT_AI88]=16,e[t.PIXEL_FORMAT_RGBA4444]=16,e[t.PIXEL_FORMAT_RGB5A1]=16,e[t.PIXEL_FORMAT_PVRTC4]=4,e[t.PIXEL_FORMAT_PVRTC2]=3,t=cc.Texture2D.prototype,cc.defineGetterSetter(t,"name",t.getName),cc.defineGetterSetter(t,"pixelFormat",t.getPixelFormat),cc.defineGetterSetter(t,"pixelsWidth",t.getPixelsWide),cc.defineGetterSetter(t,"pixelsHeight",t.getPixelsHigh),cc.defineGetterSetter(t,"width",t._getWidth),cc.defineGetterSetter(t,"height",t._getHeight)},cc._tmp.PrototypeTextureAtlas=function(){var t=cc.TextureAtlas.prototype;cc.defineGetterSetter(t,"totalQuads",t.getTotalQuads),cc.defineGetterSetter(t,"capacity",t.getCapacity),cc.defineGetterSetter(t,"quads",t.getQuads,t.setQuads)},cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.PVRHaveAlphaPremultiplied_=!1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0),this._textureLoaded=!1,this._htmlElementObj=null,this._pattern="",this._pixelsHigh=this._pixelsWide=0},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getContentSize:function(){var t=cc.contentScaleFactor();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._pixelsWide=this._contentSize.width=t.width,this._pixelsHigh=this._contentSize.height=t.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(this._htmlElementObj){var t=this._htmlElementObj;this._pixelsWide=this._contentSize.width=t.width,this._pixelsHigh=this._contentSize.height=t.height,this.dispatchEvent("load")}},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},initWithString:function(t,e,i,n,r,o){return!1},releaseTexture:function(){this._htmlElementObj=null,cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(t){},getMaxT:function(){return 1},setMaxT:function(t){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(t){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(t){},keepData:function(t,e){return t},drawAtPoint:function(t){},drawInRect:function(t){},initWithETCFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithETCFile),!1},initWithPVRFile:function(t){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile),!1},initWithPVRTCData:function(t,e,i,n,r,o){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData),!1},setTexParameters:function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),this._pattern=t.wrapS===cc.REPEAT&&t.wrapT===cc.REPEAT?"repeat":t.wrapS===cc.REPEAT?"repeat-x":t.wrapT===cc.REPEAT?"repeat-y":""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")],e=this._htmlElementObj,i=e.width,n=e.height;t[0].width=i,t[0].height=n,t[1].width=i,t[1].height=n,t[2].width=i,t[2].height=n,t[3].width=i,t[3].height=n,(o=t[3].getContext("2d")).drawImage(e,0,0);for(var r,o=o.getImageData(0,0,i,n).data,c=0;4>c;c++){for(var s=(r=t[c].getContext("2d")).getImageData(0,0,i,n),a=s.data,h=0;h<o.length;h+=4)a[h]=0===c?o[h]:0,a[h+1]=1===c?o[h+1]:0,a[h+2]=2===c?o[h+2]:0,a[h+3]=o[h+3];r.putImageData(s,0,0)}return e.onload=null,this.channelCache=t},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&((this._isGray=t)?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var t=cc.Texture2D._generateGrayTexture(this._htmlElementObj),e=new cc.Texture2D;return e.initWithElement(t),e.handleLoadedTexture(),e}};t._generateColorTexture=cc.sys._supportCanvasNewBlendModes?function(t,e,i,n,r){var o=!1;r?o=!0:r=document.createElement("canvas");var c=this._htmlElementObj;n||(n=cc.rect(0,0,c.width,c.height)),r.width=n.width,r.height=n.height;var s=r.getContext("2d");return s.globalCompositeOperation="source-over",s.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",s.fillRect(0,0,n.width,n.height),s.globalCompositeOperation="multiply",s.drawImage(c,n.x,n.y,n.width,n.height,0,0,n.width,n.height),s.globalCompositeOperation="destination-atop",s.drawImage(c,n.x,n.y,n.width,n.height,0,0,n.width,n.height),o?r:((t=new cc.Texture2D).initWithElement(r),t.handleLoadedTexture(),t)}:function(t,e,i,n,r){var o=!1;r?o=!0:r=document.createElement("canvas");var c,s,a=this._htmlElementObj;if(n||(n=cc.rect(0,0,a.width,a.height)),a=n.x,c=n.y,s=n.width,n=n.height,s&&n){r.width=s,r.height=n;var h=r.getContext("2d"),l=cc.textureCache.getTextureColors(this);return h.globalCompositeOperation="lighter",h.drawImage(l[3],a,c,s,n,0,0,s,n),0<t&&(h.globalAlpha=t/255,h.drawImage(l[0],a,c,s,n,0,0,s,n)),0<e&&(h.globalAlpha=e/255,h.drawImage(l[1],a,c,s,n,0,0,s,n)),0<i&&(h.globalAlpha=i/255,h.drawImage(l[2],a,c,s,n,0,0,s,n)),o?r:((t=new cc.Texture2D).initWithElement(r),t.handleLoadedTexture(),t)}},cc.Texture2D=cc.Class.extend(t),cc.Texture2D._generateGrayTexture=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=0,o=(e=(t=n.getImageData(0,0,e.width,e.height)).data).length;r<o;r+=4)e[r]=e[r+1]=e[r+2]=.34*e[r]+.5*e[r+1]+.16*e[r+2];return n.putImageData(t,0,0),i}}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.EventHelper.prototype.apply(cc.Texture2D.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTexture2D(),delete cc._tmp.PrototypeTexture2D})),cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(t){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[cc.loader._getAliase(t)]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},addPVRImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var t,e=this._textures;for(t in e)e[t]&&e[t].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e,i=this._textures;for(e in i)i[e]===t&&(i[e].releaseTexture(),delete i[e])}},removeTextureForKey:function(t){if(null!=t){var e=this._textures[t];e&&(e.releaseTexture(),delete this._textures[t])}},cacheImage:function(t,e){if(e instanceof cc.Texture2D)this._textures[t]=e;else{var i=new cc.Texture2D;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i}},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache_addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new cc.Texture2D;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache_addUIImage),i},dumpCachedTextureInfo:function(){var t,e=0,i=0,n=this._textures;for(t in n)e++,(o=n[t]).getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,t,o.getHtmlElementObj().src,o.getPixelsWide(),o.getPixelsHigh()):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,t,o.getPixelsWide(),o.getPixelsHigh()),i+=o.getPixelsWide()*o.getPixelsHigh()*4;for(t in n=this._textureColorsCache){var r,o=n[t];for(r in o){var c=o[r];e++,cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,t,c.width,c.height),i+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,e,i/1024,(i/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.textureCache;t.handleLoadedTexture=function(t,e){var i=this._textures,n=i[t];return n||((n=i[t]=new cc.Texture2D).url=t),n.initWithElement(e),n.handleLoadedTexture(),n},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage);var n=this._textures,r=n[t]||n[cc.loader._getAliase(t)];return r?(r.isLoaded()?e&&e.call(i,r):r.addEventListener("load",(function(){e&&e.call(i,r)}),i),r):((r=n[t]=new cc.Texture2D).url=t,n=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath,cc.loader.loadImg(cc.path.join(n||"",t),(function(n,r){if(n)return e&&e.call(i,n);n=cc.textureCache.handleLoadedTexture(t,r),e&&e.call(i,n)})),r)},t.addImageAsync=t.addImage,t=null}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)})),cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,i[e].tr=t.tr):i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;i<e;i++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},_setupVBO:function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas_initWithFile,t),!1)},initWithTexture:function(t,e){if(cc.assert(t,cc._LogInfos.TextureAtlas_initWithTexture),this._capacity=e|=0,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e),t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this._quadsArrayBuffer=new ArrayBuffer(t*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&0<e)return!1;for(var i=this._quads,n=0;n<e;n++)i[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*t);return this._setupIndices(),this._setupVBO(),this.dirty=!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_updateQuad),cc.assert(0<=e&&e<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=e*i,r=(this._totalQuads-1-e)*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(n,n+r),n+i),this._setQuadToArray(t,e),this.dirty=!0}},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var r,o=e*n,c=(this._totalQuads-1-e-i)*n,s=this._totalQuads-1-i;for(r=0;r<i;r++)this._quads[s+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+c),o+n*i),r=0;r<i;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0}},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(0<=e||e<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex),cc.assert(0<=t||t<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var i,n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._quadsReader,o=r.subarray(t*n,n);t>e?(i=e*n,r.set(r.subarray(i,i+(t-e)*n),i+n),r.set(o,i)):(i=(t+1)*n,r.set(r.subarray(i,i+(e-t)*n),i-n),r.set(o,e*n)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+(this._totalQuads-t)*e),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;e=(t+e)*i;var n=t*i;this._quadsReader.set(this._quadsReader.subarray(e,e+(this._totalQuads-t)*i),n)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t);var n=this._capacity=0|t,r=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*n),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),t=0;t<n;t++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,t*e);else{var o,c,s=this._quads;if(n>i){for(o=[],c=new ArrayBuffer(e*n),t=0;t<r;t++)o[t]=new cc.V3F_C4B_T2F_Quad(s[t].tl,s[t].bl,s[t].tr,s[t].br,c,t*e);for(;t<n;t++)o[t]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,c,t*e)}else for(r=Math.max(r,n),o=[],c=new ArrayBuffer(e*n),t=0;t<r;t++)o[t]=new cc.V3F_C4B_T2F_Quad(s[t].tl,s[t].bl,s[t].tr,s[t].br,c,t*e);this._quadsReader=new Uint8Array(c),this._quads=o,this._quadsArrayBuffer=c}return null===this._indices?this._indices=new Uint16Array(6*n):n>i?((e=new Uint16Array(6*n)).set(this._indices,0),this._indices=e):this._indices=this._indices.subarray(0,6*n),this._setupIndices(),this._mapBuffers(),this.dirty=!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),t===i)return;var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=t*n,o=e*n,c=this._quadsReader,s=c.subarray(r,r+o),a=i*n;i<t?(e=i*n,c.set(c.subarray(e,e+(t-i)*n),e+o)):(e=(t+e)*n,c.set(c.subarray(e,e+(i-t)*n),r)),c.set(s,a),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){e*=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,t=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e);for(var i=0;i<e;i++)t[i]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),_p=cc.TextureAtlas.prototype,cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads),cc.defineGetterSetter(_p,"capacity",_p.getCapacity),cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads),cc.TextureAtlas.create=function(t,e){return new cc.TextureAtlas(t,e)},cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas)})),cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTextureAtlas(),delete cc._tmp.PrototypeTextureAtlas,cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_logo:null,_className:"LoaderScene",cb:null,target:null,init:function(){var t=this,e=200,i=t._bgLayer=new cc.LayerColor(cc.color(32,32,32,255));t.addChild(i,0);var n=24,r=-e/2+100;return cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},(function(i,n){e=n.height,t._initStage(n,cc.visibleRect.center)})),n=14,r=-e/2-10),(n=t._label=new cc.LabelTTF("Loading... 0%","Arial",n)).setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,r))),n.setColor(cc.color(180,180,180)),i.addChild(this._label,10),!0},_initStage:function(t,e){var i=this._texture2d=new cc.Texture2D;i.initWithElement(t),i.handleLoadedTexture(),(t=this._logo=new cc.Sprite(i)).setScale(cc.contentScaleFactor()),t.x=e.x,t.y=e.y,this._bgLayer.addChild(t,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.schedule(this._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this),this._label.setString("Loading... 0%")},initWithResources:function(t,e,i){cc.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading),cc.loader.load(t.resources,(function(e,i,n){t._label.setString("Loading... "+Math.min(n/i*100|0,100)+"%")}),(function(){t.cb&&t.cb.call(t.target)}))},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._logo&&this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}}),cc.LoaderScene.preload=function(t,e,i){var n=cc;return n.loaderScene||(n.loaderScene=new cc.LoaderScene,n.loaderScene.init(),cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,(function(){n.loaderScene._updateTransform()}))),n.loaderScene.initWithResources(t,e,i),cc.director.runScene(n.loaderScene),n.loaderScene},cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){if(t=cc.renderer,e.visit(i),e._isBaked)t.pushRenderCommand(e),e._bakeSprite.visit(this);else{var n,r=this._children,o=r.length;if(0<o){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<o&&0>(n=r[i])._localZOrder;i++)n.visit(this);for(t.pushRenderCommand(e);i<o;i++)r[i].visit(this)}else t.pushRenderCommand(e)}e._dirtyFlag=0}else e._propagateFlagsDown(i)},addChild:function(t,e,i){cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}}),cc.Layer.create=function(){return new cc.Layer},cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){cc.Layer.prototype.ctor.call(this),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),cc.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){var n=cc.director.getWinSize();return t=t||cc.color(0,0,0,255),e=void 0===e?n.width:e,i=void 0===i?n.height:i,(n=this._realColor).r=t.r,n.g=t.g,n.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty),cc.LayerColor.prototype.setContentSize.call(this,e,i),!0},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){if(t=cc.renderer,e.visit(i),e._isBaked)t.pushRenderCommand(e._bakeRenderCmd),e._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),e._bakeSprite.visit(this);else{var n=this._children,r=n.length;if(0<r){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<r&&(child=n[i],0>child._localZOrder);i++)child.visit(this);for(t.pushRenderCommand(e);i<r;i++)n[i].visit(this)}else t.pushRenderCommand(e)}e._dirtyFlag=0}else e._propagateFlagsDown(i)},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}}),cc.LayerColor.create=function(t,e,i){return new cc.LayerColor(t,e,i)},function(){var t=cc.LayerColor.prototype;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,n){cc.LayerColor.prototype.ctor.call(this),this._endColor=cc.color(0,0,0,255),this._alongVector=cc.p(0,-1),this._endOpacity=this._startOpacity=255,n&&n instanceof Array?(this._colorStops=n,n.splice(0,0,{p:0,color:t||cc.color.BLACK}),n.push({p:1,color:e||cc.color.BLACK})):this._colorStops=[{p:0,color:t||cc.color.BLACK},{p:1,color:e||cc.color.BLACK}],cc.LayerGradient.prototype.init.call(this,t,e,i,n)},init:function(t,e,i,n){return t=t||cc.color(0,0,0,255),e=e||cc.color(0,0,0,255),i=i||cc.p(0,-1),n=this._endColor,this._startOpacity=t.a,n.r=e.r,n.g=e.g,n.b=e.b,this._endOpacity=e.a,this._alongVector=i,this._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(this,cc.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){cc.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){cc.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){cc.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;e&&0<e.length&&((e=e[0].color).r=t.r,e.g=t.g,e.b=t.b)},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b,(e=this._colorStops)&&0<e.length&&((e=e[e.length-1].color).r=t.r,e.g=t.g,e.b=t.b),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&0<e.length&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&0<e.length&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}}),cc.LayerGradient.create=function(t,e,i,n){return new cc.LayerGradient(t,e,i,n)},function(){var t=cc.LayerGradient.prototype;cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),cc.defineGetterSetter(t,"vector",t.getVector,t.setVector),cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){cc.Layer.prototype.ctor.call(this),t instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,t):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return 0<t.length&&null==t[t.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){t>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){t>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,this.addChild(this._layers[t]))},addLayer:function(t){t?this._layers.push(t):cc.log(cc._LogInfos.LayerMultiplex_addLayer)}}),cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))},function(){cc.Layer.CanvasRenderCmd=function(t){this._rootCtor(t),this._isBaked=!1,this._bakeSprite=null,this._canUseDirtyRegion=!0,this._updateCache=2};var t=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Layer.CanvasRenderCmd,t._layerCmdCtor=cc.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){t&&0===this._updateCache&&(this._updateCache=2),!1===this._cacheDirty&&(this._cacheDirty=!0,(t=this._cachedParent)&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache())},t.updateStatus=function(){var t=cc.Node._dirtyFlags;this._dirtyFlag&t.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~t.orderDirty),this.originUpdateStatus()},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;(this._isBaked||i&e.orderDirty)&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~e.orderDirty),this._originSyncStatus(t)},t.transform=function(t,e){this._worldTransform||(this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var i=this._worldTransform,n=i.a,r=i.b,o=i.c,c=i.d;this.originTransform(t,e),i.a===n&&i.b===r&&i.c===o&&i.d===c||0!==this._updateCache||(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,this._isBaked=this._cacheDirty=cc.renderer.childrenOrderDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0,this._isBaked=this._needDraw=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var n=this._getBoundingBoxForBake();n.width=0|n.width+.5,n.height=0|n.height+.5;var r=i.getCacheContext(),o=r.getContext();if(i.setPosition(n.x,n.y),0<this._updateCache){for(i.resetCanvasSize(n.width,n.height),r.setOffset(0-n.x,o.canvas.height-n.height+n.y),t.sortAllChildren(),cc.renderer._turnToCacheMode(this.__instanceId),t=0,n=e.length;t<n;t++)e[t].visit(this);cc.renderer._renderingToCacheCanvas(r,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null;if(!(e=this._node)._children||0===e._children.length)return cc.rect(0,0,10,10);for(var e,i=e.getNodeToWorldTransform(),n=0,r=(e=e._children).length;n<r;n++){var o=e[n];o&&o._visible&&(t?(o=o._getBoundingBoxToCurrentNode(i))&&(t=cc.rectUnion(t,o)):t=o._getBoundingBoxToCurrentNode(i))}return t}}(),function(){cc.LayerColor.CanvasRenderCmd=function(t){this._layerCmdCtor(t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var t=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.LayerColor.CanvasRenderCmd,t.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,e,i){var n=(t=t||cc._renderContext).getContext(),r=this._node,o=this._displayedColor,c=this._displayedOpacity/255,s=r._contentSize.width;r=r._contentSize.height,0!==c&&(t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(c),t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+", 1)"),t.setTransform(this._worldTransform,e,i),n.fillRect(0,0,s,-r),cc.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,e=this._node,i=this._bakeSprite,n=e._children,r=n.length;this.transform(this.getParentRenderCmd(),!0),(t=this._getBoundingBoxForBake()).width=0|t.width+.5,t.height=0|t.height+.5;var o=i.getCacheContext(),c=o.getContext();if(i.setPosition(t.x,t.y),0<this._updateCache){if(c.fillStyle=o._currentFillStyle,i.resetCanvasSize(t.width,t.height),o.setOffset(0-t.x,c.canvas.height-t.height+t.y),cc.renderer._turnToCacheMode(this.__instanceId),0<r){for(e.sortAllChildren(),t=0;t<r&&0>(c=n[t])._localZOrder;t++)c.visit(e);for(cc.renderer.pushRenderCommand(this);t<r;t++)n[t].visit(e)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(o,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t._getBoundingBoxForBake=function(){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();if(e=cc.rectApplyAffineTransform(e,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return e;t=t._children;for(var n=0;n<t.length;n++){var r=t[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(i),e=cc.rectUnion(e,r))}return e}}(),function(){cc.LayerGradient.CanvasRenderCmd=function(t){cc.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=cc.p(0,0),this._endPoint=cc.p(0,0),this._endStopStr=this._startStopStr=null};var t=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);t.constructor=cc.LayerGradient.CanvasRenderCmd,t.rendering=function(t,e,i){var n=(t=t||cc._renderContext).getContext(),r=this._node,o=this._displayedOpacity/255;if(0!==o){var c=r._contentSize.width,s=r._contentSize.height;if(t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(o),o=n.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y),r._colorStops)for(var a=0;a<r._colorStops.length;a++)o.addColorStop(r._colorStops[a].p,this._colorStopsStr[a]);else o.addColorStop(0,this._startStopStr),o.addColorStop(1,this._endStopStr);t.setFillStyle(o),t.setTransform(this._worldTransform,e,i),n.fillRect(0,0,c,-s),cc.g_NumberOfDraws++}},t.updateStatus=function(){var t=cc.Node._dirtyFlags;this._dirtyFlag&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._dirtyFlag&=~t.gradientDirty),this.originUpdateStatus()},t._syncStatus=function(t){var e=cc.Node._dirtyFlags;this._dirtyFlag&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._dirtyFlag&=~e.gradientDirty),this._originSyncStatus(t)},t._updateColor=function(){var t=this._node,e=.5*(i=t._contentSize).width,i=.5*i.height,n=cc.pAngleSigned(cc.p(0,-1),t._alongVector),r=(n=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),n),Math.min(Math.abs(1/n.x),Math.abs(1/n.y)));if(this._startPoint.x=e*-n.x*r+e,this._startPoint.y=i*n.y*r-i,this._endPoint.x=e*n.x*r+e,this._endPoint.y=i*-n.y*r-i,e=this._displayedColor,i=t._endColor,n=t._endOpacity/255,this._startStopStr="rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+(t._startOpacity/255).toFixed(4)+")",this._endStopStr="rgba("+Math.round(i.r)+","+Math.round(i.g)+","+Math.round(i.b)+","+n.toFixed(4)+")",t._colorStops)for(this._endOpacity=this._startOpacity=0,this._colorStopsStr=[],e=0;e<t._colorStops.length;e++)i=t._colorStops[e].color,this._colorStopsStr.push("rgba("+Math.round(i.r)+","+Math.round(i.g)+","+Math.round(i.b)+","+(null==i.a?1:i.a/255).toFixed(4)+")")}}(),function(){cc.Layer.WebGLRenderCmd=function(t){this._rootCtor(t),this._isBaked=!1};var t=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Layer.WebGLRenderCmd,t._layerCmdCtor=cc.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(t){this._layerCmdCtor(t),this._needDraw=!0,this._matrix=null,this.initData(4),this._color=new Uint32Array(1),this._vertexBuffer=null,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var t=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.LayerColor.WebGLRenderCmd,t.initData=function(t){this._data=new ArrayBuffer(16*t),this._positionView=new Float32Array(this._data),this._colorView=new Uint32Array(this._data),this._dataDirty=!0},t.transform=function(t,e){this.originTransform(t,e),e=(t=this._node)._contentSize.width;var i=t._contentSize.height,n=this._positionView;n[4]=e,n[9]=i,n[12]=e,n[13]=i,n[2].z=n[6]=n[10]=n[14]=t._vertexZ,this._dataDirty=!0},t._updateColor=function(){var t=this._displayedColor;this._color[0]=this._displayedOpacity<<24|t.b<<16|t.g<<8|t.r,t=this._colorView;for(var e=0;4>e;e++)t[4*e+3]=this._color[0];this._dataDirty=!0},t.rendering=function(t){t=t||cc._renderContext;var e=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this._data,t.DYNAMIC_DRAW),this._dataDirty=!1),this._glProgramState.apply(this._matrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,16,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,16,12),t.drawArrays(t.TRIANGLE_STRIP,0,4)},t.updateBlendFunc=function(t){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(t){cc.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var t=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);t.constructor=cc.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var t=cc.Node._dirtyFlags;this._dirtyFlag&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._updateVertex(),this._dirtyFlag&=~t.gradientDirty),this.originUpdateStatus()},t._syncStatus=function(t){var e=cc.Node._dirtyFlags;this._dirtyFlag&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag&=~e.gradientDirty),this._originSyncStatus(t)},t.transform=function(t,e){this.originTransform(t,e),this._updateVertex()},t._updateVertex=function(){var t=this._node,e=t._colorStops;if(e&&!(2>e.length)){this._clippingRectDirty=!0;var i,n=e.length,r=2*n,o=t._contentSize;this._positionView.length/4<r&&this.initData(r),i=Math.PI+cc.pAngleSigned(cc.p(0,-1),t._alongVector),r=cc.p(o.width/2,o.height/2);var c,s=Math.round(cc.radiansToDegrees(i)),a=cc.affineTransformMake(1,0,0,1,r.x,r.y);a=cc.affineTransformRotate(a,i),90>s?(s=cc.p(-r.x,r.y),c=cc.p(r.x,r.y)):180>s?(s=cc.p(r.x,r.y),c=cc.p(r.x,-r.y)):270>s?(s=cc.p(r.x,-r.y),c=cc.p(-r.x,-r.y)):(s=cc.p(-r.x,-r.y),c=cc.p(-r.x,r.y));var h=Math.sin(i);for(i=Math.cos(i),a=cc.affineTransformScale(a,Math.abs((s.x*i-s.y*h)/r.x),Math.abs((c.x*h+c.y*i)/r.y)),s=this._positionView,i=0;i<n;i++){h=e[i].p*o.height;var l=cc.pointApplyAffineTransform(-r.x,h-r.y,a);s[c=8*i]=l.x,s[c+1]=l.y,s[c+2]=t._vertexZ,h=cc.pointApplyAffineTransform(o.width-r.x,h-r.y,a),s[c+=4]=h.x,s[c+1]=h.y,s[c+2]=t._vertexZ}this._dataDirty=!0}},t._updateColor=function(){var t=this._node._colorStops;if(t&&!(2>t.length)){var e,n=t.length,r=this._colorView,o=this._displayedOpacity/255;for(i=0;i<n;i++)e=t[i].color,this._color[0]=e.a*o<<24|e.b<<16|e.g<<8|e.r,r[3+(e=8*i)]=this._color[0],r[(e+=4)+3]=this._color[0];this._dataDirty=!0}},t.rendering=function(t){t=t||cc._renderContext;var e=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var i=this._getClippingRect();t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(i.x,i.y,i.width,i.height),i=this._worldTransform,this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._data,gl.DYNAMIC_DRAW),this._dataDirty=!1),this._glProgramState.apply(this._matrix),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,16,0),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,16,12),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),t.disable(t.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,e=cc.rect(0,0,t._contentSize.width,t._contentSize.height);t=t.getNodeToWorldTransform(),this._clipRect=cc._rectApplyAffineTransformIn(e,t)}return this._clipRect}}(),cc._tmp.PrototypeSprite=function(){var t=cc.Sprite.prototype;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),cc.defineGetterSetter(t,"offsetX",t._getOffsetX),cc.defineGetterSetter(t,"offsetY",t._getOffsetY),cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),cc.defineGetterSetter(t,"quad",t.getQuad)},cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){cc.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),this._loader=new cc.Sprite.LoadManager,this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){return cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrame),this.setSpriteFrame(t)},initWithSpriteFrameName:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrameName);var e=cc.spriteFrameCache.getSpriteFrame(t);return cc.assert(e,t+cc._LogInfos.Sprite_initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assert(t,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3),(t=cc.animationCache.getAnimation(t))?(e=t.getFrames()[e])?this.setSpriteFrame(e.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},getTexture:function(){return this._texture},_softInit:function(t,e,i){void 0===t?cc.Sprite.prototype.init.call(this):"string"==typeof t?"#"===t[0]?(e=t.substr(1,t.length-1),(e=cc.spriteFrameCache.getSpriteFrame(e))?this.initWithSpriteFrame(e):cc.log("%s does not exist",t)):cc.Sprite.prototype.init.call(this,t,e):"object"==typeof t&&(t instanceof cc.Texture2D?this.initWithTexture(t,e,i):t instanceof cc.SpriteFrame?this.initWithSpriteFrame(t):(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&((e=new cc.Texture2D).initWithElement(t),e.handleLoadedTexture(),this.initWithTexture(e)))},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){return 0<arguments.length?this.initWithFile(arguments[0],arguments[1]):(cc.Node.prototype.init.call(this),this.dirty=this._recursiveDirty=!1,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.texture=null,this._flippedX=this._flippedY=!1,this.anchorY=this.anchorX=.5,this._offsetPosition.x=0,this._offsetPosition.y=0,this._hasChildren=!1,this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assert(t,cc._LogInfos.Sprite_initWithFile);var i=cc.textureCache.getTextureForKey(t);if(i||(i=cc.textureCache.addImage(t)),!i.isLoaded())return this._loader.clear(),this._loader.once(i,(function(){this.initWithFile(t,e),this.dispatchEvent("load")}),this),!1;if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)},initWithTexture:function(t,e,i,n){return cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture),this._loader.clear(),this._textureLoaded=t.isLoaded(),this._textureLoaded?(i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),!!cc.Node.prototype.init.call(this)&&(this._batchNode=null,this.dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flippedX=this._flippedY=!1,this._offsetPosition.x=0,this._offsetPosition.y=0,this._hasChildren=!1,this._rectRotated=i,e&&(this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height),e||(e=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),this.setTexture(t),this.setTextureRect(e,i),this.setBatchNode(null),!0)):(this._loader.once(t,(function(){this.initWithTexture(t,e,i,n),this.dispatchEvent("load")}),this),!1)},setTextureRect:function(t,e,i,n){this._rectRotated=e||!1,this.setContentSize(i||t),this.setVertexRect(t),this._renderCmd._setTextureCoords(t,n),t=this._unflippedOffsetPositionFromCenter.x,e=this._unflippedOffsetPositionFromCenter.y,this._flippedX&&(t=-t),this._flippedY&&(e=-e),i=this._rect,this._offsetPosition.x=t+(this._contentSize.width-i.width)/2,this._offsetPosition.y=e+(this._contentSize.height-i.height)/2},addChild:function(t,e,i){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(cc.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){"string"==typeof t&&(t=cc.spriteFrameCache.getSpriteFrame(t),cc.assert(t,cc._LogInfos.Sprite_setSpriteFrame)),this._loader.clear(),this.setNodeDirty(!0);var e=t.getTexture();if(this._textureLoaded=t.textureLoaded(),this._loader.clear(),!this._textureLoaded)return this._loader.once(e,(function(){this.setSpriteFrame(t),this.dispatchEvent("load")}),this),!1;var i=t.getOffset();this._unflippedOffsetPositionFromCenter.x=i.x,this._unflippedOffsetPositionFromCenter.y=i.y,e!==this._texture&&(this._renderCmd._setTexture(e),this.setColor(this._realColor)),this.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())},setDisplayFrame:function(t){cc.log(cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e="string"==typeof t;if(e&&(t=cc.textureCache.addImage(t)),this._loader.clear(),!t._textureLoaded)return this._loader.once(t,(function(){this.setTexture(t),this.dispatchEvent("load")}),this),!1;this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t),this.setColor(this._realColor),this._textureLoaded=!0},_changeRectWithTexture:function(t){t=t._contentSize,t=cc.rect(0,0,t.width,t.height),this.setTextureRect(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}}),cc.Sprite.create=function(t,e,i){return new cc.Sprite(t,e,i)},cc.Sprite.createWithTexture=cc.Sprite.create,cc.Sprite.createWithSpriteFrameName=cc.Sprite.create,cc.Sprite.createWithSpriteFrame=cc.Sprite.create,cc.Sprite.INDEX_NOT_INITIALIZED=-1,cc.EventHelper.prototype.apply(cc.Sprite.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js"),cc._tmp.PrototypeSprite(),delete cc._tmp.PrototypeSprite,function(){var t=cc.Sprite.LoadManager=function(){this.list=[]};t.prototype.add=function(t,e,i){t&&t.addEventListener&&(t.addEventListener("load",e,i),this.list.push({source:t,listener:e,target:i}))},t.prototype.once=function(t,e,i){if(t&&t.addEventListener){var n=function(r){t.removeEventListener("load",n,i),e.call(i,r)};t.addEventListener("load",n,i),this.list.push({source:t,listener:n,target:i})}},t.prototype.clear=function(){for(;0<this.list.length;){var t=this.list.pop();t.source.removeEventListener("load",t.listener,t.target)}}}(),function(){cc.Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._canUseDirtyRegion=!0,this._textureToRender=null};var t=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Sprite.CanvasRenderCmd,t._spriteCmdCtor=cc.Sprite.CanvasRenderCmd,t.setDirtyRecursively=function(t){},t._setTexture=function(t){var e=this._node;e._texture!==t&&(e._textureLoaded=!!t&&t._textureLoaded,e._texture=t,t=t._contentSize,t=cc.rect(0,0,t.width,t.height),e.setTextureRect(t),this._updateColor())},t._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},t.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()===e._texture&&cc.rectEqualToRect(t.getRect(),e._rect)},t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._setBatchNodeForAddChild=function(t){return!0},t._handleTextureForRotatedTexture=function(t,e,i,n){return i&&t.isLoaded()&&(t=t.getHtmlElementObj(),t=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(t,e,n),(n=new cc.Texture2D).initWithElement(t),n.handleLoadedTexture(),t=n,e.x=e.y=0,this._node._rect=cc.rect(0,0,e.width,e.height)),t},t._checkTextureBoundary=function(t,e,i){t&&t.url&&(i=e.y+e.height,e.x+e.width>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),i>t.height&&cc.error(cc._LogInfos.RectHeight,t.url))},t.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,o=this._displayedOpacity/255,c=this._textureToRender||n._texture;if((!c||0!==r.width&&0!==r.height&&c._textureLoaded)&&0!==o){var s,a,h,l=(t=t||cc._renderContext).getContext(),d=n._offsetPosition.x,u=n._rect.height,_=n._rect.width,p=-n._offsetPosition.y-u;t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(o),(n._flippedX||n._flippedY)&&t.save(),n._flippedX&&(d=-d-_,l.scale(-1,1)),n._flippedY&&(p=n._offsetPosition.y,l.scale(1,-1)),this._colorized?s=o=0:(o=r.renderX,s=r.renderY),a=r.width,h=r.height,c&&c._htmlElementObj?(e=c._htmlElementObj,""!==c._pattern?(t.setFillStyle(l.createPattern(e,c._pattern)),l.fillRect(d,p,_,u)):l.drawImage(e,o,s,a,h,d,p,_,u)):(c=n._contentSize,r.validRect&&(r=this._displayedColor,t.setFillStyle("rgba("+r.r+","+r.g+","+r.b+",1)"),l.fillRect(d,p,c.width*e,c.height*i))),(n._flippedX||n._flippedY)&&t.restore(),cc.g_NumberOfDraws++}},t._updateColor=function(){var t=this._node._texture,e=this._textureCoord,i=this._displayedColor;t&&(255!==i.r||255!==i.g||255!==i.b?(this._textureToRender=t._generateColorTexture(i.r,i.g,i.b,e),this._colorized=!0):t&&(this._textureToRender=t,this._colorized=!1))},t._textureLoadedCallback=function(t){if(!this._textureLoaded){this._textureLoaded=!0;var e=this._rect,i=this._renderCmd;e?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),this.texture=t,this.setTextureRect(e,this._rectRotated),255===(t=i._displayedColor).r&&255===t.g&&255===t.b||i._updateColor(),this.setBatchNode(this._batchNode),this.dispatchEvent("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0);var i=this._textureCoord;e=e?cc.contentScaleFactor():1,i.renderX=i.x=0|t.x*e,i.renderY=i.y=0|t.y*e,i.width=0|t.width*e,i.height=0|t.height*e,i.validRect=!(0===i.width||0===i.height||0>i.x||0>i.y)},cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),i?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}}(),function(){cc.Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._recursiveDirty=this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var t=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Sprite.WebGLRenderCmd,t._spriteCmdCtor=cc.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(t){},t.setDirtyFlag=function(t){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},t.setDirtyRecursively=function(t){this._dirty=this._recursiveDirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)(e=i[r])instanceof cc.Sprite&&e._renderCmd.setDirtyRecursively(t)},t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(t){return t},t.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},t._textureLoadedCallback=function(t){if(!this._textureLoaded){this._textureLoaded=!0;var e=this._rect;e?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),this.texture=t,this.setTextureRect(e,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),cc.renderer.childrenOrderDirty=!0}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0),e&&(t=cc.rectPointsToPixels(t));var i=(e=this._node)._batchNode?e.textureAtlas.texture:e._texture,n=this._vertices;if(i){var r,o=i.pixelsWidth,c=i.pixelsHeight;e._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(i=(2*t.x+1)/(2*o))+(2*t.height-2)/(2*o),t=(r=(2*t.y+1)/(2*c))+(2*t.width-2)/(2*c)):(i=t.x/o,o=(t.x+t.height)/o,r=t.y/c,t=(t.y+t.width)/c),e._flippedX&&(c=r,r=t,t=c),e._flippedY&&(c=i,i=o,o=c),n[0].u=o,n[0].v=r,n[1].u=i,n[1].v=r,n[2].u=o,n[2].v=t,n[3].u=i):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(i=(2*t.x+1)/(2*o))+(2*t.width-2)/(2*o),t=(r=(2*t.y+1)/(2*c))+(2*t.height-2)/(2*c)):(i=t.x/o,o=(t.x+t.width)/o,r=t.y/c,t=(t.y+t.height)/c),e._flippedX&&(c=i,i=o,o=c),e._flippedY&&(c=r,r=t,t=c),n[0].u=i,n[0].v=r,n[1].u=i,n[1].v=t,n[2].u=o,n[2].v=r,n[3].u=o),n[3].v=t}},t._setColorDirty=function(){},t._updateBlendFunc=function(){if(this._batchNode)cc.log(cc._LogInfos.Sprite__updateBlendFunc);else{var t=this._node,e=t._blendFunc;t._texture&&t._texture.hasPremultipliedAlpha()?(e.src===cc.SRC_ALPHA&&e.dst===cc.BLEND_DST&&(e.src=cc.ONE),t.opacityModifyRGB=!0):(e.src===cc.ONE&&e.dst===cc.BLEND_DST&&(e.src=cc.SRC_ALPHA),t.opacityModifyRGB=!1)}},t._setTexture=function(t){var e=this._node;e._texture!==t&&(e._textureLoaded=!!t&&t._textureLoaded,(e._texture=t)&&(t=t._contentSize,t=cc.rect(0,0,t.width,t.height),e.setTextureRect(t),this._updateBlendFunc()),e._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},t._checkTextureBoundary=function(t,e,i){t&&t.url&&(i?(i=e.x+e.height,e=e.y+e.width):(i=e.x+e.width,e=e.y+e.height),i>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),e>t.height&&cc.error(cc._LogInfos.RectHeight,t.url))},t.transform=function(t,e){this.originTransform(t,e);var i=(c=(t=this._node)._offsetPosition.x)+t._rect.width,n=(l=t._offsetPosition.y)+t._rect.height;t=(r=this._worldTransform).tx,e=r.ty;var r,o=c*r.a,c=c*r.b,s=i*r.a,a=(i*=r.b,n*r.c),h=(n*=r.d,l*r.c),l=l*r.d;(r=this._vertices)[0].x=o+a+t,r[0].y=c+n+e,r[1].x=o+h+t,r[1].y=c+l+e,r[2].x=s+a+t,r[2].y=i+n+e,r[3].x=s+h+t,r[3].y=i+l+e},t.needDraw=function(){var t=this._node._texture;return this._needDraw&&t},t.uploadData=function(t,e,i){var n=this._node;if(!((r=n._texture)&&r._textureLoaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return 0;var r=this._displayedOpacity,o=this._displayedColor.r,c=this._displayedColor.g,s=this._displayedColor.b;if(n._opacityModifyRGB){var a=r/255;o*=a,c*=a,s*=a}for(this._color[0]=r<<24|s<<16|c<<8|o,n=n._vertexZ,o=(r=this._vertices).length,s=i,i=0;i<o;++i)c=r[i],t[s]=c.x,t[s+1]=c.y,t[s+2]=n,e[s+3]=this._color[0],t[s+4]=c.u,t[s+5]=c.v,s+=6;return o}}(),cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){var e;cc.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.isString(t)?(e=cc.textureCache.getTextureForKey(t))||(e=cc.textureCache.addImage(t)):t instanceof cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(t,e,i){return this.addChild(t,e,i),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},init:function(t,e){var i=cc.textureCache.getTextureForKey(t);return i||(i=cc.textureCache.addImage(t)),this.initWithTexture(i,e)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),t instanceof cc.Sprite?(t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren(),this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}else t.addEventListener("load",(function(){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}),this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setShaderProgram(t)},addChild:function(t,e,i){cc.assert(void 0!==t,cc._LogInfos.CCSpriteBatchNode_addChild_3),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof cc.Sprite?t.texture===this._texture||(cc.log(cc._LogInfos.Sprite_addChild_5),!1):(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}}),_p=cc.SpriteBatchNode.prototype,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram),cc.SpriteBatchNode.create=function(t){return new cc.SpriteBatchNode(t)},cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create,cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new cc.CanvasContextWrapper(t.getContext("2d"));var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,n=this._cacheContext,r=n._context.strokeStyle,o=n._context.fillStyle;void 0===e&&(e=t.height,t=t.width),i.width=t,i.height=e,r!==n._context.strokeStyle&&(n._context.strokeStyle=r),o!==n._context.fillStyle&&(n._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,t,e),!1,null,!1)}}),cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=i||null},clone:function(){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(t){return cc.clone(this)},copy:function(t){return(t=new cc.AnimationFrame).initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},initWithSpriteFrame:function(t,e,i){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=i,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}}),cc.AnimationFrame.create=function(t,e,i){return new cc.AnimationFrame(t,e,i)},cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){if(this._frames=[],void 0===t)this.initWithSpriteFrames(null,0);else{var n=t[0];n&&(n instanceof cc.SpriteFrame?this.initWithSpriteFrames(t,e,i):n instanceof cc.AnimationFrame&&this.initWithAnimationFrames(t,e,i))}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){t=cc.textureCache.addImage(t);var e=cc.rect(0,0,0,0);e.width=t.width,e.height=t.height,t=new cc.SpriteFrame(t,e),this.addSpriteFrame(t)},addSpriteFrameWithTexture:function(t,e){t=new cc.SpriteFrame(t,e),this.addSpriteFrame(t)},initWithAnimationFrames:function(t,e,i){for(cc.arrayVerifyType(t,cc.AnimationFrame),this._delayPerUnit=e,this._loops=void 0===i?1:i,this._totalDelayUnits=0,i=(e=this._frames).length=0;i<t.length;i++){var n=t[i];e.push(n),this._totalDelayUnits+=n.getDelayUnits()}return!0},clone:function(){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){return(t=new cc.Animation).initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){if(cc.arrayVerifyType(t,cc.SpriteFrame),this._loops=void 0===i?1:i,this._delayPerUnit=e||0,this._totalDelayUnits=0,(e=this._frames).length=0,t){for(i=0;i<t.length;i++){var n=t[i],r=new cc.AnimationFrame;r.initWithSpriteFrame(n,1,null),e.push(r)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(t,e,i){return new cc.Animation(t,e,i)},cc.Animation.createWithAnimationFrames=cc.Animation.create,cc.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){t&&this._animations[t]&&delete this._animations[t]},getAnimation:function(t){return this._animations[t]?this._animations[t]:null},_addAnimationsWithDictionary:function(t,e){var i=t.animations;if(i){var n=1;if(t=t.properties){n=null!=t.format?parseInt(t.format):n,t=t.spritesheets;for(var r=cc.spriteFrameCache,o=cc.path,c=0;c<t.length;c++)r.addSpriteFrames(o.changeBasename(e,t[c]))}switch(n){case 1:this._parseVersion1(i);break;case 2:this._parseVersion2(i);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(t){cc.assert(t,cc._LogInfos.animationCache_addAnimations_2);var e=cc.loader.getRes(t);e?this._addAnimationsWithDictionary(e,t):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(t){var e,i=cc.spriteFrameCache;for(e in t){var n=(r=t[e]).frames,r=parseFloat(r.delay)||0;if(n){for(var o=[],c=0;c<n.length;c++){var s=i.getSpriteFrame(n[c]);if(s){var a=new cc.AnimationFrame;a.initWithSpriteFrame(s,1,null),o.push(a)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,e,n[c])}0===o.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,e):(o.length!==n.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,e),n=new cc.Animation(o,r,1),cc.animationCache.addAnimation(n,e))}else cc.log(cc._LogInfos.animationCache__parseVersion1,e)}},_parseVersion2:function(t){var e,i=cc.spriteFrameCache;for(e in t){var n=t[e],r=n.loop,o=parseInt(n.loops),c=(r=r?cc.REPEAT_FOREVER:isNaN(o)?1:o,o=!(!n.restoreOriginalFrame||1!=n.restoreOriginalFrame),n.frames);if(c){for(var s=[],a=0;a<c.length;a++){var h=(d=c[a]).spriteframe,l=i.getSpriteFrame(h);if(l){h=parseFloat(d.delayUnits)||0;var d=d.notification,u=new cc.AnimationFrame;u.initWithSpriteFrame(l,h,d),s.push(u)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,e,h)}n=parseFloat(n.delayPerUnit)||0,(c=new cc.Animation).initWithAnimationFrames(s,n,r),c.setRestoreOriginalFrame(o),cc.animationCache.addAnimation(c,e)}else cc.log(cc._LogInfos.animationCache__parseVersion2,e)}},_clear:function(){this._animations={}}},cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(t,e,i,n,r){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,void 0!==t&&void 0!==e&&(void 0===i||void 0===n||void 0===r?this.initWithTexture(t,e):this.initWithTexture(t,e,i,n,r))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=t.x,this._rectInPixels.y=t.y,this._rectInPixels.width=t.width,this._rectInPixels.height=t.height,this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);return t&&(this._textureLoaded=t.isLoaded()),t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e,this._texture=t,e||t.addEventListener("load",(function(t){if(this._textureLoaded=!0,this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var e=t.getHtmlElementObj(),i=(e=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(e,this.getRect()),new cc.Texture2D);i.initWithElement(e),i.handleLoadedTexture(),this.setTexture(i),e=this.getRect(),this.setRect(cc.rect(0,0,e.width,e.height))}0===(e=this._rect).width&&0===e.height&&(e=t.width,t=t.height,this._rect.width=e,this._rect.height=t,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=e,this._originalSize.height=t),this.dispatchEvent("load")}),this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copyWithZone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,i,n,r){var o,c;return 2===arguments.length&&(e=cc.rectPointsToPixels(e)),n=n||cc.p(0,0),r=r||e,i=i||!1,"string"==typeof t?(this._texture=null,this._textureFilename=t):t instanceof cc.Texture2D&&this.setTexture(t),t=this.getTexture(),this._rectInPixels=e,this._rect=cc.rectPixelsToPoints(e),t&&t.url&&t.isLoaded()&&(i?(o=e.x+e.height,c=e.y+e.width):(o=e.x+e.width,c=e.y+e.height),o>t.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,t.url),c>t.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,t.url)),this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=r.width,this._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(r,this._originalSize),this._rotated=i,!0}}),cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype),cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,i,n,r){var o=new cc.SpriteFrame;return o._texture=t,o._rectInPixels=e,o._rect=cc.rectPixelsToPoints(e),o._offsetInPixels.x=n.x,o._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(o._offsetInPixels,o._offset),o._originalSizeInPixels.width=r.width,o._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(o._originalSizeInPixels,o._originalSize),o._rotated=i,o},cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){return(t=this._CCNS_REG2.exec(t))?cc.rect(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])):cc.rect(0,0,0,0)},_pointFromString:function(t){return(t=this._CCNS_REG1.exec(t))?cc.p(parseFloat(t[1]),parseFloat(t[2])):cc.p(0,0)},_sizeFromString:function(t){return(t=this._CCNS_REG1.exec(t))?cc.size(parseFloat(t[1]),parseFloat(t[2])):cc.size(0,0)},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),cc.loader.release(t),e._inited?this._frameConfigCache[t]=e:(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta;t={};var n={},r=0;for(var o in i&&(r=1>=(r=i.format).length?parseInt(r):r,n.image=i.textureFileName||i.textureFileName||i.image),e)if(s=e[o]){if(i={},0==r){i.rect=cc.rect(s.x,s.y,s.width,s.height),i.rotated=!1,i.offset=cc.p(s.offsetX,s.offsetY);var c=s.originalWidth,s=s.originalHeight;c&&s||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig),c=Math.abs(c),s=Math.abs(s),i.size=cc.size(c,s)}else if(1==r||2==r)i.rect=this._rectFromString(s.frame),i.rotated=s.rotated||!1,i.offset=this._pointFromString(s.offset),i.size=this._sizeFromString(s.sourceSize);else if(3==r){c=this._sizeFromString(s.spriteSize);var a=this._rectFromString(s.textureRect);c&&(a=cc.rect(a.x,a.y,c.width,c.height)),i.rect=a,i.rotated=s.textureRotated||!1,i.offset=this._pointFromString(s.spriteOffset),i.size=this._sizeFromString(s.spriteSourceSize),i.aliases=s.aliases}else c=s.frame,a=s.sourceSize,o=s.filename||o,i.rect=cc.rect(c.x,c.y,c.w,c.h),i.rotated=s.rotated||!1,i.offset=cc.p(0,0),i.size=cc.size(a.w,a.h);t[o]=i}return{_inited:!0,frames:t,meta:n}},_addSpriteFramesByObject:function(t,e,i){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2),e&&e.frames&&(e=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e),this._createSpriteFrames(t,e,i))},_createSpriteFrames:function(t,e,i){var n=e.frames;for(var r in e=e.meta,i?i instanceof cc.Texture2D||(cc.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(i=cc.path.changeBasename(t,e.image||".png"),i=cc.textureCache.addImage(i)),t=this._spriteFramesAliases,e=this._spriteFrames,n){var o=n[r],c=e[r];if(!c){if(c=new cc.SpriteFrame(i,cc.rect(o.rect),o.rotated,o.offset,o.size),o=o.aliases)for(var s=0,a=o.length;s<a;s++){var h=o[s];t[h]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,h),t[h]=r}cc._renderType===cc.game.RENDER_TYPE_CANVAS&&c.isRotated()&&c.getTexture().isLoaded()&&(o=c.getTexture().getHtmlElementObj(),o=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(o,c.getRectInPixels()),(s=new cc.Texture2D).initWithElement(o),s.handleLoadedTexture(),c.setTexture(s),c.setRotated(!1),o=c._rect,c.setRect(cc.rect(0,0,o.width,o.height))),e[r]=c}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);i&&i.frames&&(i=this._frameConfigCache[t]||this._getFrameConfig(t),this._createSpriteFrames(t,i,e))},_checkConflict:function(t){for(var e in t=t.frames)this._spriteFrames[e]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,e)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this._spriteFrames,i=this._spriteFramesAliases;if(t=this._frameConfigCache[t])for(var n in t=t.frames)if(e[n])for(var r in delete e[n],i)i[r]===n&&delete i[r]},removeSpriteFramesFromTexture:function(t){var e,i=this._spriteFrames,n=this._spriteFramesAliases;for(e in i){var r=i[e];if(r&&r.getTexture()===t)for(var o in delete i[e],n)n[o]===e&&delete n[o]}},getSpriteFrame:function(t){var e=this._spriteFrames[t];if(!e){var i=this._spriteFramesAliases[t];i&&((e=this._spriteFrames[i.toString()])||delete this._spriteFramesAliases[t])}return e},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return-1<this._GlExtensions.indexOf(t)},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw Error("Please load the resource first : "+t);if(cc.assert(e,cc._LogInfos.configuration_loadConfigFile_2,t),e=e.data)for(var i in e)this._valueDict[i]=e[i];else cc.log(cc._LogInfos.configuration_loadConfigFile,t)}},cc.g_NumberOfDraws=0,cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var t=this;t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,(function(){t._lastUpdate=Date.now()}))},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._purgeDirectorInNextLoop=this._paused=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&.2<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:function(t){var e=document.documentElement,i=cc.view,n=e.getBoundingClientRect();return n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop,e=i._devicePixelRatio*(t.x-n.left),t=i._devicePixelRatio*(n.top+n.height-t.y),i._isRotated?{x:i._viewPortRect.width-t,y:e}:{x:e,y:t}},convertToUI:function(t){var e=document.documentElement,i=cc.view,n=e.getBoundingClientRect();return n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop,e={x:0,y:0},i._isRotated?(e.x=n.left+t.y/i._devicePixelRatio,e.y=n.top+n.height-(i._viewPortRect.width-t.x)/i._devicePixelRatio):(e.x=n.left+t.x/i._devicePixelRatio,e.y=n.top+n.height-t.y/i._devicePixelRatio),e},drawScene:function(){var t=cc.renderer;this.calculateDeltaTime(),this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._nextScene&&this.setNextScene(),this._runningScene&&(t.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()),t.clear(),this._notificationNode&&this._notificationNode.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit),cc.g_NumberOfDraws=0,t.rendering(cc._renderContext),this._totalFrames++,cc.eventManager.dispatchEvent(this._eventAfterDraw),cc.eventManager.frameUpdateListeners(),this._calculateMPF()},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._runningScene._performRecursive(cc.Node._stateCallbackType.onExit),this._runningScene._performRecursive(cc.Node._stateCallbackType.cleanup)),this._nextScene=this._runningScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t){if(cc.assert(t,cc._LogInfos.Director_pushScene),this._runningScene){var e=this._scenesStack.length;0===e?(this._sendCleanupToScene=!0,this._scenesStack[e]=t):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=t),this._nextScene=t}else this.pushScene(t),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),e||((e=this._runningScene)&&(e._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),e._performRecursive(cc.Node._stateCallbackType.onExit)),this._sendCleanupToScene&&e&&e._performRecursive(cc.Node._stateCallbackType.cleanup)),this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnter),this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish))},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExit),this._notificationNode._performRecursive(cc.Node._stateCallbackType.cleanup)),(this._notificationNode=t)&&(this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnter),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===t)this.end();else if(!(t>=i)){for(;i>t;){var n=e.pop();n.running&&(n._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),n._performRecursive(cc.Node._stateCallbackType.onExit)),n._performRecursive(cc.Node._stateCallbackType.cleanup),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1e3}}),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,cc.eventManager.dispatchEvent(this._eventProjectionChanged)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}else cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",(function(){cc.Director._fpsImageLoaded=!0})),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)})),cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var i=t._children;for(t=0;t<i.length;t++)e(i[t])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,(function(){for(var t=cc.director._scenesStack,i=0;i<t.length;i++)e(t[i])})),t.setProjection=function(t){var e=this._winSizeInPoints;this.setViewport();var i=this._openGLView,n=i._viewPortRect.x/i._scaleX,r=i._viewPortRect.y/i._scaleY;switch(t){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),i=cc.math.Matrix4.createOrthographicProjection(0,e.width,0,e.height,-1024,1024),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var o,c=this.getZEye();new cc.math.Matrix4,i=new cc.math.Matrix4,cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),o=cc.math.Matrix4.createPerspectiveProjection(60,e.width/e.height,.1,2*c),cc.kmGLMultMatrix(o),c=new cc.math.Vec3(-n+e.width/2,-r+e.height/2,c),e=new cc.math.Vec3(-n+e.width/2,-r+e.height/2,0),n=new cc.math.Vec3(0,1,0),i.lookAt(c,e,n),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}this._projection=t,cc.eventManager.dispatchEvent(this._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){cc.renderer._clearColor=t},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,(t=cc.configuration).gatherGPUInfo(),t.dumpInfo(),this.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1546999375},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}})),function(){var t=function(t,e,i,n,r,o,c){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=o,this.markedForDeletion=c},e=[];t.get=function(i,n,r,o,c,s,a){var h=e.pop();return h?(h.prev=i,h.next=n,h.callback=r,h.target=o,h.priority=c,h.paused=s,h.markedForDeletion=a):h=new t(i,n,r,o,c,s,a),h},t.put=function(t){t.prev=null,t.next=null,t.callback=null,t.target=null,t.priority=0,t.paused=!1,t.markedForDeletion=!1,20>e.length&&e.push(t)};var i=function(t,e,i,n){this.list=t,this.entry=e,this.target=i,this.callback=n},n=[];i.get=function(t,e,r,o){var c=n.pop();return c?(c.list=t,c.entry=e,c.target=r,c.callback=o):c=new i(t,e,r,o),c},i.put=function(t){t.list=null,t.entry=null,t.target=null,t.callback=null,20>n.length&&n.push(t)};var r=function(t,e,i,n,r,o){this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=o},o=[];r.get=function(t,e,i,n,c,s){var a=o.pop();return a?(a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=c,a.paused=s):a=new r(t,e,i,n,c,s),a},r.put=function(t){t.timers=null,t.target=null,t.timerIndex=0,t.currentTimer=null,t.currentTimerSalvaged=!1,t.paused=!1,20>o.length&&o.push(t)};var c=function(){this._scheduler=null,this._elapsed=-1,this._useDelay=this._runForever=!1,this._interval=this._delay=this._repeat=this._timesExecuted=0,this._key=this._callback=this._target=null};cc.inject({initWithCallback:function(t,e,i,n,r,o,c){return this._scheduler=t,this._target=i,this._callback=e,c&&(this._key=c),this._elapsed=-1,this._interval=n,this._delay=o,this._useDelay=0<this._delay,this._repeat=r,this._runForever=this._repeat===cc.REPEAT_FOREVER,!0},getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},update:function(t){-1===this._elapsed?this._timesExecuted=this._elapsed=0:(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._target&&this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}},c.prototype);var s=[];c.get=function(){return s.pop()||new c},c.put=function(t){t._scheduler=null,t._elapsed=-1,t._runForever=!1,t._useDelay=!1,t._timesExecuted=0,t._repeat=0,t._delay=0,t._interval=0,t._target=null,t._callback=null,t._key=null,20>s.length&&s.push(t)},cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._updateHashLocked=this._currentTargetSalvaged=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[e.__instanceId];if(r&&r.entry){if(r.entry.priority===i)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,n):0>i?this._priorityIn(this._updatesNegList,t,e,i,n):this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId];for(var e=this._arrayForTimers,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1);break}r.put(t)},_removeUpdateFromHash:function(e){if(e=this._hashForUpdates[e.target.__instanceId]){for(var n=e.list,r=e.entry,o=0,c=n.length;o<c;o++)if(n[o]===r){n.splice(o,1);break}delete this._hashForUpdates[e.target.__instanceId],t.put(r),i.put(e)}},_priorityIn:function(e,n,r,o,c){if(n=t.get(null,null,n,r,o,c,!1),e){c=e.length-1;for(var s=0;s<=c&&!(o<e[s].priority);s++);e.splice(s,0,n)}else(e=[]).push(n);return this._hashForUpdates[r.__instanceId]=i.get(e,n,r,null),e},_appendIn:function(e,n,r,o){n=t.get(null,null,n,r,0,o,!1),e.push(n),this._hashForUpdates[r.__instanceId]=i.get(e,n,r,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,n,r;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,n=(i=this._updatesNegList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.callback(t);for(e=0,n=(i=this._updates0List).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.callback(t);for(e=0,n=(i=this._updatesPosList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.callback(t);for(n=this._arrayForTimers,e=0;e<n.length;e++){if(this._currentTarget=i=n[e],this._currentTargetSalvaged=!1,!i.paused)for(i.timerIndex=0;i.timerIndex<i.timers.length;++i.timerIndex)i.currentTimer=i.timers[i.timerIndex],i.currentTimerSalvaged=!1,i.currentTimer.update(t),i.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,o){this.schedule(e,t,i,n,r,o,t.__instanceId+"")},schedule:function(t,e,i,n,o,s,a){if("function"!=typeof t){var h=t;t=e,e=h}var l,d;if(4!==arguments.length&&5!==arguments.length||(a=o,s=n,n=cc.REPEAT_FOREVER,o=0),void 0===a&&(a=e.__instanceId+""),cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3),(h=this._hashForTimers[e.__instanceId])?cc.assert(h.paused===s,""):(h=r.get(null,e,0,null,null,s),this._arrayForTimers.push(h),this._hashForTimers[e.__instanceId]=h),null==h.timers)h.timers=[];else for(d=0;d<h.timers.length;d++)if(t===(l=h.timers[d])._callback)return cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,l.getInterval().toFixed(4),i.toFixed(4)),void(l._interval=i);(l=c.get()).initWithCallback(this,t,e,i,n,o,a),h.timers.push(l)},scheduleUpdate:function(t,e,i){this._schedulePerFrame((function(e){t.update(e)}),t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e._key;case"function":return t===e._callback}},unschedule:function(t,e){if(e&&t&&(e=this._hashForTimers[e.__instanceId]))for(var i=e.timers,n=0,r=i.length;n<r;n++){var o=i[n];if(this._getUnscheduleMark(t,o)){o!==e.currentTimer||e.currentTimerSalvaged||(e.currentTimerSalvaged=!0),i.splice(n,1),c.put(o),e.timerIndex>=n&&e.timerIndex--,0===i.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e));break}}},unscheduleUpdate:function(t){t&&(t=this._hashForUpdates[t.__instanceId])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllForTarget:function(t){if(t){var e=this._hashForTimers[t.__instanceId];if(e){var i=e.timers;-1<i.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0);for(var n=0,r=i.length;n<r;n++)c.put(i[n]);i.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;0<=e;e--)i=n[e],this.unscheduleAllForTarget(i.target);if(0>t)for(e=0;e<this._updatesNegList.length;)n=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),n==this._updatesNegList.length&&e++;if(0>=t)for(e=0;e<this._updates0List.length;)n=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),n==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)n=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),n==this._updatesPosList.length&&e++},isScheduled:function(t,e){if(cc.assert(t,"Argument callback must not be empty"),cc.assert(e,"Argument target must be non-nullptr"),!(e=this._hashForTimers[e.__instanceId]))return!1;if(null!=e.timers){e=e.timers;for(var i=0;i<e.length;++i)if(t===e[i]._callback)return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],o=this._arrayForTimers;for(i=0,n=o.length;i<n;i++)(e=o[i])&&(e.paused=!0,r.push(e.target));if(0>t)for(i=0;i<this._updatesNegList.length;i++)(e=this._updatesNegList[i])&&e.priority>=t&&(e.paused=!0,r.push(e.target));if(0>=t)for(i=0;i<this._updates0List.length;i++)(e=this._updates0List[i])&&(e.paused=!0,r.push(e.target));for(i=0;i<this._updatesPosList.length;i++)(e=this._updatesPosList[i])&&e.priority>=t&&(e.paused=!0,r.push(e.target));return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_pauseTarget);var e=this._hashForTimers[t.__instanceId];e&&(e.paused=!0),(t=this._hashForUpdates[t.__instanceId])&&(t.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_resumeTarget);var e=this._hashForTimers[t.__instanceId];e&&(e.paused=!1),(t=this._hashForUpdates[t.__instanceId])&&(t.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];return e?e.paused:!!(t=this._hashForUpdates[t.__instanceId])&&t.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1}(),cc.PI2=2*Math.PI,cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=this._renderContext.getContext();i.beginPath(),i.arc(t.x,-t.y,e,0,2*Math.PI,!1),i.closePath(),i.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1),(e=this._renderContext.getContext()).beginPath();for(var n=0,r=t.length;n<r;n++)e.arc(t[n].x,-t[n].y,i,0,2*Math.PI,!1);e.closePath(),e.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext();i.beginPath(),i.moveTo(t.x,-t.y),i.lineTo(e.x,-e.y),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],this.drawSolidPoly(t,4,i)},drawPoly:function(t,e,i,n){if(n=n||!1,null!=t){if(3>t.length)throw Error("Polygon's point must greater than 2");var r=t[0];(e=this._renderContext.getContext()).beginPath(),e.moveTo(r.x,-r.y),r=1;for(var o=t.length;r<o;r++)e.lineTo(t[r].x,-t[r].y);i&&e.closePath(),n?e.fill():e.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,n,r){r=r||!1,(n=this._renderContext.getContext()).beginPath(),n.arc(0|t.x,0|-t.y,e,-i,-(i-2*Math.PI),!1),r&&n.lineTo(0|t.x,0|-t.y),n.stroke()},drawQuadBezier:function(t,e,i,n){for(var r=this._cacheArray,o=r.length=0,c=0;c<n;c++)r.push(cc.p(Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y)),o+=1/n;r.push(cc.p(i.x,i.y)),this.drawPoly(r,n+1,!1,!1)},drawCubicBezier:function(t,e,i,n,r){for(var o=this._cacheArray,c=o.length=0,s=0;s<r;s++)o.push(cc.p(Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y)),c+=1/r;o.push(cc.p(n.x,n.y)),this.drawPoly(o,r+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var r,o,c=1/t.length,s=0;s<i+1;s++)1==(o=s/i)?(r=t.length-1,o=1):o=(o-c*(r=0|o/c))/c,r=cc.CardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,o),n.push(r);this.drawPoly(n,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var o=arguments.length,c=this._renderContext.getContext();switch(o){case 2:c.drawImage(t,e.x,-(e.y+t.height));break;case 3:c.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:c.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw Error("Argument must be non-nil")}},drawStar:function(t,e,i){var n=(t=t||this._renderContext).getContext();i="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),t.setFillStyle(i+",1)");var r=e/10;n.beginPath(),n.moveTo(-e,e),n.lineTo(0,r),n.lineTo(e,e),n.lineTo(r,0),n.lineTo(e,-e),n.lineTo(0,-r),n.lineTo(-e,-e),n.lineTo(-r,0),n.lineTo(-e,e),n.closePath(),n.fill();var o=n.createRadialGradient(0,0,r,0,0,e);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(1,i+", 0.0)"),t.setFillStyle(o),n.beginPath(),n.arc(0,0,e-r,0,cc.PI2,!1),n.closePath(),n.fill()},drawColorBall:function(t,e,i){var n=(t=t||this._renderContext).getContext();i="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);var r=n.createRadialGradient(0,0,e/10,0,0,e);r.addColorStop(0,i+", 1)"),r.addColorStop(.3,i+", 0.8)"),r.addColorStop(.6,i+", 0.4)"),r.addColorStop(1,i+", 0.0)"),t.setFillStyle(r),n.beginPath(),n.arc(0,0,e,0,cc.PI2,!1),n.closePath(),n.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t}}),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(null==t&&(t=cc._renderContext),!t instanceof WebGLRenderingContext)throw Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._glProgramState=cc.GLProgramState.getOrCreateWithGLProgram(this._shader),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init(),e=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,t.length),e.deleteBuffer(i),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(n),cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],this.drawSolidPoly(t,4,i)},drawPoly:function(t,e,i){this.lazy_init(),e=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),i?e.drawArrays(e.LINE_LOOP,0,t.length):e.drawArrays(e.LINE_STRIP,0,t.length),e.deleteBuffer(n),cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a),e=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,this._pointsToTypeArray(t),e.STATIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_FAN,0,t.length),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawCircle:function(t,e,i,n,r){this.lazy_init();var o=1;r&&o++;var c=2*Math.PI/n;r=new Float32Array(2*(n+2));for(var s=0;s<=n;s++){var a=s*c,h=e*Math.sin(a+i)+t.y;r[2*s]=e*Math.cos(a+i)+t.x,r[2*s+1]=h}r[2*(n+1)]=t.x,r[2*(n+1)+1]=t.y,t=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,n+o),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawQuadBezier:function(t,e,i,n){this.lazy_init();for(var r=new Float32Array(2*(n+1)),o=0,c=0;c<n;c++)r[2*c]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,r[2*c+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/n;r[2*n]=i.x,r[2*n+1]=i.y,t=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,n+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,n,r){this.lazy_init();for(var o=new Float32Array(2*(r+1)),c=0,s=0;s<r;s++)o[2*s]=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,o[2*s+1]=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y,c+=1/r;o[2*r]=n.x,o[2*r+1]=n.y,t=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,r+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var n,r,o=new Float32Array(2*(i+1)),c=1/t.length,s=0;s<i+1;s++)1==(r=s/i)?(n=t.length-1,r=1):r=(r-c*(n=0|r/c))/c,n=cc.cardinalSplineAt(cc.getControlPointAt(t,n-1),cc.getControlPointAt(t,n),cc.getControlPointAt(t,n+1),cc.getControlPointAt(t,n+2),e,r),o[2*s]=n.x,o[2*s+1]=n.y;t=this._renderContext,this._glProgramState.apply(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,i+1),t.deleteBuffer(e),cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*cc.contentScaleFactor()},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}}),cc._tmp.PrototypeLabelTTF=function(){var t=cc.LabelTTF.prototype;cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"string",t.getString,t.setString),cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),cc.defineGetterSetter(t,"font",t._getFont,t._setFont),cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,n,r,o){return t=t?t+"":"",i=i||16,n=n||cc.size(0,0),r=r||cc.TEXT_ALIGNMENT_LEFT,o=o||cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=cc.size(n.width,n.height),this._fontName=e||"Arial",this._hAlignment=r,this._vAlignment=o,this._fontSize=i,this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight),this.string=t,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,n,r,o){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.size(0,0),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=cc.p(0,0),this._shadowBlur=this._shadowOpacity=0,this._strokeEnabled=!1,this._strokeColor=cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=cc.color(255,255,255,255),this._strokeShadowOffsetY=this._strokeShadowOffsetX=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(t,e):cc.LabelTTF.prototype.initWithString.call(this,t,e,i,n,r,o)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(t,e,i,n){null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?this._enableShadow(t,e,i):this._enableShadowNoneColor(t,e,i,n)},_enableShadowNoneColor:function(t,e,i,n){i=i||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var r=this._shadowOffset;(r&&r.x!==t||r._y!==e)&&(r.x=t,r.y=e),this._shadowOpacity!==i&&(this._shadowOpacity=i),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b,this._enableShadowNoneColor(e.width||e.x||0,e.height||e.y||0,null!=t.a?t.a/255:.5,i)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x===t.x&&this._shadowOffset.y===t.y||(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var i=this._strokeColor;i.r===t.r&&i.g===t.g&&i.b===t.b||(i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var e=this._strokeColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,this._lineHeight=t.lineHeight?t.lineHeight:this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture(),t=cc.Node._dirtyFlags,this._renderCmd.setDirtyFlag(t.colorDirty|t.opacityDirty|t.textDirty)},_prepareTextDefinition:function(t){var e=new cc.FontDefinition;if(t?(e.fontSize=this._fontSize,e.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,e.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(e.fontSize=this._fontSize,e.boundingWidth=this._dimensions.width,e.boundingHeight=this._dimensions.height),e.fontName=this._fontName,e.textAlign=this._hAlignment,e.verticalAlign=this._vAlignment,this._strokeEnabled){e.strokeEnabled=!0;var i=this._strokeColor;e.strokeStyle=cc.color(i.r,i.g,i.b),e.lineWidth=this._strokeSize}else e.strokeEnabled=!1;return this._shadowEnabled?(e.shadowEnabled=!0,e.shadowBlur=this._shadowBlur,e.shadowOpacity=this._shadowOpacity,e.shadowOffsetX=(t?cc.contentScaleFactor():1)*this._shadowOffset.x,e.shadowOffsetY=(t?cc.contentScaleFactor():1)*this._shadowOffset.y):e._shadowEnabled=!1,t=this._textFillColor,e.fillStyle=cc.color(t.r,t.g,t.b),e},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX*cc.view.getDevicePixelRatio()},setScale:function(t,e){var i=cc.view.getDevicePixelRatio();this._scaleX=t/i,this._scaleY=(e||0===e?e:t)/i,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(t){this._scaleX=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(t){this._scaleY=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var i;void 0===e?(i=t.width,e=t.height):i=t,i===this._dimensions.width&&e===this._dimensions.height||(this._dimensions.width=i,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){(t=cc.LabelTTF._fontStyleRE.exec(t))&&(this._fontSize=parseInt(t[1]),this._fontName=t[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();var t=cc.view.getDevicePixelRatio();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.width/cc.view.getDevicePixelRatio()},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.height/cc.view.getDevicePixelRatio()},setTextureRect:function(t,e,i){this._rectRotated=e||!1,this.setContentSize(i||t),(e=this._rect).x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._renderCmd._setTextureCoords(t,!1),i=this._unflippedOffsetPositionFromCenter.x;var n=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(i=-i),this._flippedY&&(n=-n),this._offsetPosition.x=i+(t.width-e.width)/2,this._offsetPosition.y=n+(t.height-e.height)/2},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new cc.LabelTTF.CacheCanvasRenderCmd(this):new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),cc._tmp.PrototypeLabelTTF(),delete cc._tmp.PrototypeLabelTTF,cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,cc.LabelTTF.create=function(t,e,i,n,r,o){return new cc.LabelTTF(t,e,i,n,r,o)},cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create,cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",(function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(cc.LabelTTF.__labelHeightDiv)}),!1),cc.LabelTTF.__getFontHeightByDiv=function(t,e){var i,n=cc.LabelTTF.__labelHeightDiv;if(t instanceof cc.FontDefinition){if(0<(i=cc.LabelTTF.__fontHeightCache[t._getCanvasFontStr()]))return i;n.innerHTML="ajghl~!",n.style.fontFamily=t.fontName,n.style.fontSize=t.fontSize+"px",n.style.fontStyle=t.fontStyle,n.style.fontWeight=t.fontWeight,i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t._getCanvasFontStr()]=i}else{if(0<(i=cc.LabelTTF.__fontHeightCache[t+"."+e]))return i;n.innerHTML="ajghl~!",n.style.fontFamily=t,n.style.fontSize=e+"px",i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t+"."+e]=i}return n.innerHTML="",i},cc.LabelTTF.__fontHeightCache={},cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF.wrapInspection=!0,cc.LabelTTF._wordRex=/([a-zA-Z0-9\----\u0300-\u034e\u0350-\u036F-\u2011-]+|\S)/,cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>\u2010--]/,cc.LabelTTF._lastWordRex=/([a-zA-Z0-9\----\u0300-\u034e\u0350-\u036F-\u2011-]+|\S)$/,cc.LabelTTF._lastEnglish=/[a-zA-Z0-9\----\u0300-\u034e\u0350-\u036F-\u2011-]+$/,cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9\----\u0300-\u034e\u0350-\u036F-\u2011-]/,function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelContext=this._labelCanvas=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0,this._canUseDirtyRegion=!0};var t=cc.LabelTTF.RenderCmd.prototype;t.constructor=cc.LabelTTF.RenderCmd,t._labelCmdCtor=cc.LabelTTF.RenderCmd,t._setFontStyle=function(t,e,i,n){if(t instanceof cc.FontDefinition)this._fontStyleStr=t._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t);else{var r=e*cc.view.getDevicePixelRatio();this._fontStyleStr=i+" "+n+" "+r+"px '"+t+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,e)}},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateColor=function(){this._setColorsString(),this._updateTexture()},t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor,n=e._strokeColor,r=e._textFillColor,o=t.r/255,c=t.g/255;t=t.b/255,this._shadowColorStr="rgba("+(0|o*i.r)+","+(0|c*i.g)+","+(0|t*i.b)+","+e._shadowOpacity+")",this._fillColorStr="rgba("+(0|o*r.r)+","+(0|c*r.g)+","+(0|t*r.b)+", 1)",this._strokeColorStr="rgba("+(0|o*n.r)+","+(0|c*n.g)+","+(0|t*n.b)+", 1)"};var e=new cc.Rect;t.getLocalBB=function(){var t=this._node;e.x=e.y=0;var i=cc.view.getDevicePixelRatio();return e.width=t._getWidth()*i,e.height=t._getHeight()*i,e},t._updateTTF=function(){var t,e,i=this._node,n=cc.view.getDevicePixelRatio(),r=i._dimensions.width*n,o=this._lineWidths;o.length=0,this._isMultiLine=!1,this._measureConfig();var c={};if(0!==r)for(this._strings=i._string.split("\n"),t=0;t<this._strings.length;t++)this._checkWarp(this._strings,t,r);else for(this._strings=i._string.split("\n"),t=0,e=this._strings.length;t<e;t++)if(this._strings[t]){var s=this._measure(this._strings[t]);o.push(s),c[this._strings[t]]=s}else o.push(0);1<this._strings.length&&(this._isMultiLine=!0),e=t=0,i._strokeEnabled&&(t=e=2*i._strokeSize),i._shadowEnabled&&(s=i._shadowOffset,t+=2*Math.abs(s.x),e+=2*Math.abs(s.y)),0===r?this._isMultiLine?n=cc.size(Math.ceil(Math.max.apply(Math,o)+t),Math.ceil(this._fontClientHeight*n*this._strings.length+e)):(!(s=c[i._string])&&i._string&&(s=this._measure(i._string)),n=cc.size(Math.ceil((s||0)+t),Math.ceil(this._fontClientHeight*n+e))):n=0===i._dimensions.height?this._isMultiLine?cc.size(Math.ceil(r+t),Math.ceil(i.getLineHeight()*n*this._strings.length+e)):cc.size(Math.ceil(r+t),Math.ceil(i.getLineHeight()*n+e)):cc.size(Math.ceil(r+t),Math.ceil(i._dimensions.height*n+e)),"normal"!==i._getFontStyle()&&(n.width=Math.ceil(n.width+.3*i._fontSize)),i.setContentSize(n),i._strokeShadowOffsetX=t,i._strokeShadowOffsetY=e,i=i._anchorPoint,this._anchorPointInPoints.x=.5*t+(n.width-t)*i.x,this._anchorPointInPoints.y=.5*e+(n.height-e)*i.y},t._saveStatus=function(){var t=this._node,e=cc.view.getDevicePixelRatio(),i=t._strokeShadowOffsetX,n=t._strokeShadowOffsetY,r=t._contentSize.height-n,o=t._vAlignment,c=t._hAlignment,s=.5*i,a=(n=r+.5*n,0),h=0,l=[];if(i=t._contentSize.width-i,e=((t=t.getLineHeight()*e)-this._fontClientHeight*e)/2,a=c===cc.TEXT_ALIGNMENT_RIGHT?a+i:c===cc.TEXT_ALIGNMENT_CENTER?a+i/2:a+0,this._isMultiLine)for(c=this._strings.length,o===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?h=t-2*e+r-t*c:o===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(h=(t-2*e)/2+(r-t*c)/2),o=0;o<c;o++)l.push(-r+(t*o+e)+h);else o!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(h=o===cc.VERTICAL_TEXT_ALIGNMENT_TOP?h-r:h-.5*r),l.push(h);r={contextTransform:cc.p(s,n),xOffset:a,OffsetYArray:l},this._status.push(r)},t._drawTTFInCanvas=function(t){if(t){var e=this._status.pop();t.setTransform(1,0,0,1,e.contextTransform.x,e.contextTransform.y),this.drawLabels(t,e.xOffset,e.OffsetYArray)}},t._checkWarp=function(t,e,i){var n=t[e],r=this._measure(n);if(r>i&&1<n.length){for(var o,c=i/r*n.length|0,s=n.substr(c),a=r-this._measure(s),h=0,l=0;a>i&&100>l++;)c*=i/a,c|=0,s=n.substr(c),a=r-this._measure(s);for(l=0;a<i&&100>l++;)s&&(h=(o=cc.LabelTTF._wordRex.exec(s))?o[0].length:1,o=s),c+=h,s=n.substr(c),a=r-this._measure(s);0==(c-=h)&&(c=1,o=o.substr(1)),i=n.substr(0,c),cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(o||s)&&(0==(c-=(r=cc.LabelTTF._lastWordRex.exec(i))?r[0].length:0)&&(c=1),o=n.substr(c),i=n.substr(0,c)),cc.LabelTTF._firsrEnglish.test(o)&&(r=cc.LabelTTF._lastEnglish.exec(i))&&i!==r[0]&&(c-=r[0].length,o=n.substr(c),i=n.substr(0,c)),t[e]=o||s,t.splice(e,0,i)}},t.updateStatus=function(){this._dirtyFlag&cc.Node._dirtyFlags.textDirty&&this._updateTexture(),this.originUpdateStatus()},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.textDirty&&this._updateTexture(),this._originSyncStatus(t),(cc._renderType===cc.game.RENDER_TYPE_WEBGL||i&e.transformDirty)&&this.transform(t)},t.drawLabels=function(t,e,i){var n=this._node;if(n._shadowEnabled){var r=n._shadowOffset;t.shadowColor=this._shadowColorStr,t.shadowOffsetX=r.x,t.shadowOffsetY=-r.y,t.shadowBlur=n._shadowBlur}r=n._hAlignment;var o=n._vAlignment,c=n._strokeSize;for(t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr),t.fillStyle=this._fillColorStr,(n=n._strokeEnabled)&&(t.lineWidth=2*c,t.strokeStyle=this._strokeColorStr),t.textBaseline=cc.LabelTTF._textBaseline[o],t.textAlign=cc.LabelTTF._textAlign[r],r=this._strings.length,o=0;o<r;o++)c=this._strings[o],n&&(t.lineJoin="round",t.strokeText(c,e,i[o])),t.fillText(c,e,i[o]);cc.g_NumberOfDraws++}}(),function(){cc.LabelTTF.CacheRenderCmd=function(){this._labelCmdCtor();var t=this._labelCanvas=document.createElement("canvas");t.width=1,t.height=1,this._labelContext=t.getContext("2d")},cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var t=cc.LabelTTF.CacheRenderCmd.prototype;t.constructor=cc.LabelTTF.CacheRenderCmd,t._cacheCmdCtor=cc.LabelTTF.CacheRenderCmd,t._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var t=this._node;t._needUpdateTexture=!1;var e=t._contentSize;this._updateTTF();var i=e.width,n=e.height,r=this._labelContext,o=this._labelCanvas;if(!t._texture){var c=new cc.Texture2D;c.initWithElement(this._labelCanvas),t.setTexture(c)}return 0===t._string.length?(o.width=1,o.height=e.height||1,t._texture&&(t._texture._htmlElementObj=this._labelCanvas,t._texture.handleLoadedTexture()),t.setTextureRect(cc.rect(0,0,1,e.height)),!0):(r.font=this._fontStyleStr,e=o.width===i&&o.height===n,o.width=i,o.height=n,e&&r.clearRect(0,0,i,n),this._saveStatus(),this._drawTTFInCanvas(r),t._texture&&(t._texture._htmlElementObj=this._labelCanvas,t._texture.handleLoadedTexture()),t.setTextureRect(cc.rect(0,0,i,n)),!0)},t._measureConfig=function(){this._labelContext.font=this._fontStyleStr},t._measure=function(t){return t?this._labelContext.measureText(t).width:0}}(),function(){cc.LabelTTF.CacheCanvasRenderCmd=function(t){this._spriteCmdCtor(t),this._cacheCmdCtor()};var t=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=cc.LabelTTF.CacheCanvasRenderCmd}(),function(){cc.LabelTTF.CanvasRenderCmd=function(t){this._spriteCmdCtor(t),this._labelCmdCtor()},cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var t=cc.LabelTTF.CanvasRenderCmd.prototype;t.constructor=cc.LabelTTF.CanvasRenderCmd,t._measureConfig=function(){},t._measure=function(t){if(t){var e=cc._renderContext.getContext();return e.font=this._fontStyleStr,e.measureText(t).width}return 0},t._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var t=this._node,e=t._contentSize;this._updateTTF();var i=e.width,n=e.height;return 0===t._string.length?(t.setTextureRect(cc.rect(0,0,1,e.height)),!0):(this._saveStatus(),t.setTextureRect(cc.rect(0,0,i,n)),!0)},t.rendering=function(t){var e=cc.view.getScaleX(),i=cc.view.getScaleY(),n=(t=t||cc._renderContext).getContext();if(n){var r=this._node;if(t.computeRealOffsetY(),!(0>=this._status.length)){var o=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,c=this._status[o];this._renderingIndex=o+1;var s=r._offsetPosition.x,a=(o=-r._offsetPosition.y-r._rect.height,this._displayedOpacity/255);for(t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(this._blendFuncStr),t.setGlobalAlpha(a),t.save(),r._flippedX&&(s=-s-r._rect.width,n.scale(-1,1)),r._flippedY&&(o=r._offsetPosition.y,n.scale(1,-1)),e=c.xOffset+c.contextTransform.x+s*e,r=[],s=this._strings.length,a=0;a<s;a++)r.push(c.OffsetYArray[a]+c.contextTransform.y+o*i);this.drawLabels(n,e,r),t.restore()}}}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(t){this._spriteCmdCtor(t),this._cacheCmdCtor()};var t=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=cc.LabelTTF.WebGLRenderCmd,t._updateColor=function(){}}(),cc.HashElement=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.lock=this.paused=!1},cc.ActionManager=cc.Class.extend({_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null},_getElement:function(t,e){var i=this._elementPool.pop();return i||(i=new cc.HashElement),i.target=t,i.paused=!!e,i},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){if(!t)throw Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw Error("cc.ActionManager.addAction(): target must be non-null");var n=this._hashTargets[e.__instanceId];n?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){null!=t&&(t=this._hashTargets[t.__instanceId])&&(t.actions.length=0,this._deleteHashElement(t))},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget();if(e=this._hashTargets[e.__instanceId]){for(var i=0;i<e.actions.length;i++)if(e.actions[i]===t){e.actions.splice(i,1),e.actionIndex>=i&&e.actionIndex--;break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction),cc.assert(e,cc._LogInfos.ActionManager_addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;r<n;++r){var o=i.actions[r];if(o&&o.getTag()===t&&o.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){if(t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag),e=this._hashTargets[e.__instanceId]){if(null!=e.actions)for(var i=0;i<e.actions.length;++i){var n=e.actions[i];if(n&&n.getTag()===t)return n}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){return(t=this._hashTargets[t.__instanceId])&&t.actions?t.actions.length:0},pauseTarget:function(t){(t=this._hashTargets[t.__instanceId])&&(t.paused=!0)},resumeTarget:function(t){(t=this._hashTargets[t.__instanceId])&&(t.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target.__instanceId]){delete this._hashTargets[t.target.__instanceId];for(var i=0,n=(e=this._arrayTargets).length;i<n;i++)if(e[i]===t){e.splice(i,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(!(e=this._currentTarget=i[n]).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&n--}}}),cc.profiler=function(){var t=!1,e=!1,i=0,n=0,r=0,o=0,c=null,s=document.createElement("div"),a=document.createElement("div"),h=document.createElement("div"),l=document.createElement("div"),d=10,u=[0,10,20,30],_=[0,0,0,0],p=3,f=0,g=0;l.id="fps",l.style.position="absolute",l.style.padding="3px",l.style.textAlign="left",l.style.backgroundColor="rgb(0, 0, 34)",l.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px",l.style.left=cc.DIRECTOR_STATS_POSITION.x+"px",l.style.width="45px",l.style.height="80px";for(var m=[h,a,s],T=0;3>T;++T){var y=m[T].style;y.color="rgb(0, 255, 255)",y.font="bold 12px Helvetica, Arial",y.lineHeight="20px",y.width="100%",l.appendChild(m[T])}var E=function(){if(r=cc.director.getSecondsPerFrame(),i++,(o+=cc.director.getDeltaTime())>cc.DIRECTOR_FPS_INTERVAL){if(n=i/o,o=i=0,S.onFrameRateChange){var e,c=n,l=u.length-1,m=l;for(f++,g+=c;0<=m;m--)if(c>=u[m]){_[m]++;break}if(f>=d){for(e=g/d,m=l;0<m;m--)if(.6<=(c=_[m]/d)&&e>=u[m]){m!=p&&(p=m,S.onFrameRateChange&&S.onFrameRateChange(e.toFixed(2)));break}for(g=f=_changeCount=0,m=l;0<m;m--)_[m]=0}}t&&(l=cc._renderType===cc.game.RENDER_TYPE_CANVAS?"\n canvas":"\n webgl",a.innerHTML=r.toFixed(3),s.innerHTML=n.toFixed(1).toString()+l,h.innerHTML=(0|cc.g_NumberOfDraws).toString())}},S={onFrameRateChange:null,getSecondsPerFrame:function(){return r},getFrameRate:function(){return n},setProfileDuration:function(t){!isNaN(t)&&0<t&&(d=t/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(c,1)},stopProfiling:function(){cc.eventManager.removeListener(c)},isShowingStats:function(){return t},showStats:function(){e||this.init(),null===l.parentElement&&cc.container.appendChild(l),t=!0},hideStats:function(){t=!1,l.parentElement===cc.container&&cc.container.removeChild(l)},init:function(){e||(c=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,E),e=!0)}};return S}(),cc.math=cc.math||{},cc.math.EPSILON=.015625,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e},function(t){t.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var e=t.math.Vec2.prototype;e.fill=function(t,e){this.x=t,this.y=e},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},t.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},t.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},t.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scale=function(t){return this.x*=t,this.y*=t,this},e.equals=function(e){return this.x<e.x+t.math.EPSILON&&this.x>e.x-t.math.EPSILON&&this.y<e.y+t.math.EPSILON&&this.y>e.y-t.math.EPSILON}}(cc),function(t){t.math.Vec3=t.kmVec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},t.math.vec3=function(e,i,n){return new t.math.Vec3(e,i,n)};var e=t.math.Vec3.prototype;e.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},e.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.transform=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8]+t[12],this.y=e*t[1]+i*t[5]+n*t[9]+t[13],this.z=e*t[2]+i*t[6]+n*t[10]+t[14],this},e.transformNormal=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8],this.y=e*t[1]+i*t[5]+n*t[9],this.z=e*t[2]+i*t[6]+n*t[10],this},e.transformCoord=function(e){var i=new t.math.Vec4(this.x,this.y,this.z,1);return i.transform(e),this.x=i.x/i.w,this.y=i.y/i.w,this.z=i.z/i.w,this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i},e.inverseTransform=function(e){e=e.mat;var i=new t.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},e.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z;return t=t.mat,this.x=e*t[0]+i*t[1]+n*t[2],this.y=e*t[4]+i*t[5]+n*t[6],this.z=e*t[8]+i*t[9]+n*t[10],this},e.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},t.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},e.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}(cc),function(t){t.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},e.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)},e.lerp=function(t,e){return this},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return t=t.mat,this.x=e*t[0]+i*t[4]+n*t[8]+r*t[12],this.y=e*t[1]+i*t[5]+n*t[9]+r*t[13],this.z=e*t[2]+i*t[6]+n*t[10]+r*t[14],this.w=e*t[3]+i*t[7]+n*t[11]+r*t[15],this},t.math.Vec4.transformArray=function(e,i){for(var n=[],r=0;r<e.length;r++){var o=new t.math.Vec4(e[r]);o.transform(i),n.push(o)}return n},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i&&this.w<e.w+i&&this.w>e.w-i},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}(cc),function(t){function e(e,i,n){(i=new t.math.Vec2(i)).subtract(e),n.x=-i.y,n.y=i.x,n.normalize()}t.math.Ray2=function(e,i){this.start=e||new t.math.Vec2,this.dir=i||new t.math.Vec2},t.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},t.math.Ray2.prototype.intersectLineSegment=function(e,i,n){var r=this.start.x,o=this.start.y,c=this.start.x+this.dir.x,s=this.start.y+this.dir.y,a=e.x,h=e.y,l=i.x,d=i.y,u=(d-h)*(c-r)-(l-a)*(s-o);return!(u>-t.math.EPSILON&&u<t.math.EPSILON||(a=r+(h=((l-a)*(o-h)-(d-h)*(r-a))/u)*(c-r),h=o+h*(s-o),a<Math.min(e.x,i.x)-t.math.EPSILON||a>Math.max(e.x,i.x)+t.math.EPSILON||h<Math.min(e.y,i.y)-t.math.EPSILON||h>Math.max(e.y,i.y)+t.math.EPSILON||a<Math.min(r,c)-t.math.EPSILON||a>Math.max(r,c)+t.math.EPSILON||h<Math.min(o,s)-t.math.EPSILON||h>Math.max(o,s)+t.math.EPSILON||(n.x=a,n.y=h,0)))},t.math.Ray2.prototype.intersectTriangle=function(i,n,r,o,c){var s,a=new t.math.Vec2,h=new t.math.Vec2,l=new t.math.Vec2,d=1e4,u=!1;return this.intersectLineSegment(i,n,a)&&(u=!0,(s=a.subtract(this.start).length())<d&&(h.x=a.x,h.y=a.y,d=s,e(i,n,l))),this.intersectLineSegment(n,r,a)&&(u=!0,(s=a.subtract(this.start).length())<d&&(h.x=a.x,h.y=a.y,d=s,e(n,r,l))),this.intersectLineSegment(r,i,a)&&(u=!0,(s=a.subtract(this.start).length())<d&&(h.x=a.x,h.y=a.y,e(r,i,l))),u&&(o.x=h.x,o.y=h.y,c&&(c.x=l.x,c.y=l.y)),u}}(cc),window.Uint16Array=window.Uint16Array||Array,window.Float32Array=window.Float32Array||Array,function(t){t.math.Matrix3=function(t){this.mat=t&&t.mat?new Float32Array(t.mat):new Float32Array(9)},t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(t){var e=this.mat;return t=t.mat,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},e.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],c=t[5],s=t[6],a=t[7],h=t[8];return t[0]=o*h-c*a,t[1]=n*a-i*h,t[2]=i*c-n*o,t[3]=c*s-r*h,t[4]=e*h-n*s,t[5]=n*r-e*c,t[6]=r*a-o*s,t[8]=e*o-i*r,this},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var i=new t.math.Matrix3;e.inverse=function(t){return 0===t||(i.assignFrom(this),t=1/t,this.adjugate(),this.multiplyScalar(t)),this},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[5],r=t[6],o=t[7];return t[1]=t[3],t[2]=r,t[3]=e,t[5]=o,t[6]=i,t[7]=n,this},e.determinant=function(){var t=this.mat;return t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-(t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8])},e.multiply=function(t){var e=this.mat,i=t.mat;t=e[0];var n=e[1],r=e[2],o=e[3],c=e[4],s=e[5],a=e[6],h=e[7],l=e[8],d=i[0],u=i[1],_=i[2],p=i[3],f=i[4],g=i[5],m=i[6],T=i[7];return i=i[8],e[0]=t*d+o*u+a*_,e[1]=n*d+c*u+h*_,e[2]=r*d+s*u+l*_,e[3]=r*d+s*u+l*_,e[4]=n*p+c*f+h*g,e[5]=r*p+s*f+l*g,e[6]=t*m+o*T+a*i,e[7]=n*m+c*T+h*i,e[8]=r*m+s*T+l*i,this},e.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.math.Matrix3.rotationAxisAngle=function(e,i){var n=Math.cos(i);i=Math.sin(i);var r=new t.math.Matrix3,o=r.mat;return o[0]=n+e.x*e.x*(1-n),o[1]=e.z*i+e.y*e.x*(1-n),o[2]=-e.y*i+e.z*e.x*(1-n),o[3]=-e.z*i+e.x*e.y*(1-n),o[4]=n+e.y*e.y*(1-n),o[5]=e.x*i+e.z*e.y*(1-n),o[6]=e.y*i+e.x*e.z*(1-n),o[7]=-e.x*i+e.y*e.z*(1-n),o[8]=n+e.z*e.z*(1-n),r},e.assignFrom=function(e){if(this===e)return t.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var i=this.mat;return e=e.mat,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this},e.equals=function(e){if(this===e)return!0;var i=t.math.EPSILON,n=this.mat;e=e.mat;for(var r=0;9>r;++r)if(!(n[r]+i>e[r]&&n[r]-i<e[r]))return!1;return!0},t.math.Matrix3.createByRotationX=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=Math.cos(e),n[5]=Math.sin(e),n[6]=0,n[7]=-Math.sin(e),n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationY=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[4]=1,n[5]=0,n[6]=Math.sin(e),n[7]=0,n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationZ=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=-Math.sin(e),n[2]=0,n[3]=Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByRotation=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[2]=0,n[3]=-Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByScale=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[0]=e,n.mat[4]=i,n},t.math.Matrix3.createByTranslation=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[6]=e,n.mat[7]=i,n},t.math.Matrix3.createByQuaternion=function(e){if(!e)return null;var i=new t.math.Matrix3,n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y-e.w*e.z),n[2]=2*(e.x*e.z+e.w*e.y),n[3]=2*(e.x*e.y+e.w*e.z),n[4]=1-2*(e.x*e.x+e.z*e.z),n[5]=2*(e.y*e.z-e.w*e.x),n[6]=2*(e.x*e.z-e.w*e.y),n[7]=2*(e.y*e.z+e.w*e.x),n[8]=1-2*(e.x*e.x+e.y*e.y),i},e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}}(cc),function(t){t.math.Matrix4=function(t){this.mat=t&&t.mat?new Float32Array(t.mat):new Float32Array(16)},t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(t){for(var e=this.mat,i=0;16>i;i++)e[i]=t[i];return this},t.kmMat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},e.get=function(t,e){return this.mat[t+4*e]},e.set=function(t,e,i){this.mat[t+4*e]=i},e.swap=function(t,e,i,n){var r=this.mat,o=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=o},t.math.Matrix4._gaussj=function(t,e){var i,n,r,o,c,s=0,a=0,h=[0,0,0,0],l=[0,0,0,0],d=[0,0,0,0];for(i=0;4>i;i++){for(n=c=0;4>n;n++)if(1!==d[n])for(r=0;4>r;r++)0===d[r]&&(o=Math.abs(t.get(n,r)))>=c&&(c=o,a=n,s=r);if(++d[s],a!==s){for(n=0;4>n;n++)t.swap(a,n,s,n);for(n=0;4>n;n++)e.swap(a,n,s,n)}if(l[i]=a,h[i]=s,0===t.get(s,s))return!1;for(r=1/t.get(s,s),t.set(s,s,1),n=0;4>n;n++)t.set(s,n,t.get(s,n)*r);for(n=0;4>n;n++)e.set(s,n,e.get(s,n)*r);for(r=0;4>r;r++)if(r!==s){for(o=t.get(r,s),t.set(r,s,0),n=0;4>n;n++)t.set(r,n,t.get(r,n)-t.get(s,n)*o);for(n=0;4>n;n++)e.set(r,n,t.get(r,n)-e.get(s,n)*o)}}for(n=3;0<=n;n--)if(l[n]!==h[n])for(r=0;4>r;r++)t.swap(r,l[n],r,h[n]);return!0};var i=(new t.math.Matrix4).identity();t.kmMat4Inverse=function(e,n){n=new t.math.Matrix4(n);var r=new t.math.Matrix4(i);return!1===t.math.Matrix4._gaussj(n,r)?null:(e.assignFrom(n),e)},e.inverse=function(){var e=new t.math.Matrix4(this),n=new t.math.Matrix4(i);return!1===t.math.Matrix4._gaussj(e,n)?null:e},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[6],o=t[7],c=t[8],s=t[9],a=t[11],h=t[12],l=t[13],d=t[14];return t[1]=t[4],t[2]=c,t[3]=h,t[4]=e,t[6]=s,t[7]=l,t[8]=i,t[9]=r,t[11]=d,t[12]=n,t[13]=o,t[14]=a,this},t.kmMat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,o=i.mat;i=r[0],e=r[1];var c=r[2],s=r[3],a=r[4],h=r[5],l=r[6],d=r[7],u=r[8],_=r[9],p=r[10],f=r[11],g=r[12],m=r[13],T=r[14],y=(r=r[15],o[0]),E=o[1],S=o[2],C=o[3],v=o[4],x=o[5],R=o[6],A=o[7],I=o[8],b=o[9],P=o[10],L=o[11],w=o[12],O=o[13],N=o[14];return o=o[15],n[0]=y*i+E*a+S*u+C*g,n[1]=y*e+E*h+S*_+C*m,n[2]=y*c+E*l+S*p+C*T,n[3]=y*s+E*d+S*f+C*r,n[4]=v*i+x*a+R*u+A*g,n[5]=v*e+x*h+R*_+A*m,n[6]=v*c+x*l+R*p+A*T,n[7]=v*s+x*d+R*f+A*r,n[8]=I*i+b*a+P*u+L*g,n[9]=I*e+b*h+P*_+L*m,n[10]=I*c+b*l+P*p+L*T,n[11]=I*s+b*d+P*f+L*r,n[12]=w*i+O*a+N*u+o*g,n[13]=w*e+O*h+N*_+o*m,n[14]=w*c+O*l+N*p+o*T,n[15]=w*s+O*d+N*f+o*r,t},e.multiply=function(t){var e=this.mat,i=t.mat;t=e[0];var n=e[1],r=e[2],o=e[3],c=e[4],s=e[5],a=e[6],h=e[7],l=e[8],d=e[9],u=e[10],_=e[11],p=e[12],f=e[13],g=e[14],m=e[15],T=i[0],y=i[1],E=i[2],S=i[3],C=i[4],v=i[5],x=i[6],R=i[7],A=i[8],I=i[9],b=i[10],P=i[11],L=i[12],w=i[13],O=i[14];return i=i[15],e[0]=T*t+y*c+E*l+S*p,e[1]=T*n+y*s+E*d+S*f,e[2]=T*r+y*a+E*u+S*g,e[3]=T*o+y*h+E*_+S*m,e[4]=C*t+v*c+x*l+R*p,e[5]=C*n+v*s+x*d+R*f,e[6]=C*r+v*a+x*u+R*g,e[7]=C*o+v*h+x*_+R*m,e[8]=A*t+I*c+b*l+P*p,e[9]=A*n+I*s+b*d+P*f,e[10]=A*r+I*a+b*u+P*g,e[11]=A*o+I*h+b*_+P*m,e[12]=L*t+w*c+O*l+i*p,e[13]=L*n+w*s+O*d+i*f,e[14]=L*r+w*a+O*u+i*g,e[15]=L*o+w*h+O*_+i*m,this},t.getMat4MultiplyValue=function(t,e){t=t.mat,e=e.mat;var i=new Float32Array(16);return i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],i[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],i[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],i[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],i[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],i[7]=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],i[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],i[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],i[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],i[11]=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],i[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],i[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],i[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],i[15]=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15],i},t.kmMat4Assign=function(e,i){if(e===i)return t.log("cc.kmMat4Assign(): pOut equals pIn"),e;var n=e.mat;return i=i.mat,n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],e},e.assignFrom=function(e){if(this===e)return t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var i=this.mat;return e=e.mat,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this},e.equals=function(e){if(this===e)return t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;var i=this.mat;e=e.mat;for(var n=t.math.EPSILON,r=0;16>r;r++)if(!(i[r]+n>e[r]&&i[r]-n<e[r]))return!1;return!0},t.math.Matrix4.createByRotationX=function(e,i){var n=(i=i||new t.math.Matrix4).mat;return n[0]=1,n[3]=n[2]=n[1]=0,n[4]=0,n[5]=Math.cos(e),n[6]=Math.sin(e),n[7]=0,n[8]=0,n[9]=-Math.sin(e),n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationY=function(e,i){var n=(i=i||new t.math.Matrix4).mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[7]=n[6]=n[4]=0,n[5]=1,n[8]=Math.sin(e),n[9]=0,n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationZ=function(e,i){var n=(i=i||new t.math.Matrix4).mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[3]=n[2]=0,n[4]=-Math.sin(e),n[5]=Math.cos(e),n[7]=n[6]=0,n[11]=n[9]=n[8]=0,n[10]=1,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByPitchYawRoll=function(e,i,n,r){r=r||new t.math.Matrix4;var o=Math.cos(e);e=Math.sin(e);var c=Math.cos(i);i=Math.sin(i);var s=Math.cos(n);n=Math.sin(n);var a=e*i,h=o*i,l=r.mat;return l[0]=c*s,l[4]=c*n,l[8]=-i,l[1]=a*s-o*n,l[5]=a*n+o*s,l[9]=e*c,l[2]=h*s+e*n,l[6]=h*n-e*s,l[10]=o*c,l[3]=l[7]=l[11]=0,l[15]=1,r},t.math.Matrix4.createByQuaternion=function(e,i){var n=(i=i||new t.math.Matrix4).mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y+e.z*e.w),n[2]=2*(e.x*e.z-e.y*e.w),n[3]=0,n[4]=2*(e.x*e.y-e.z*e.w),n[5]=1-2*(e.x*e.x+e.z*e.z),n[6]=2*(e.z*e.y+e.x*e.w),n[7]=0,n[8]=2*(e.x*e.z+e.y*e.w),n[9]=2*(e.y*e.z-e.x*e.w),n[10]=1-2*(e.x*e.x+e.y*e.y),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationTranslation=function(e,i,n){var r=(n=n||new t.math.Matrix4).mat;return e=e.mat,r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[3],r[5]=e[4],r[6]=e[5],r[7]=0,r[8]=e[6],r[9]=e[7],r[10]=e[8],r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,n},t.math.Matrix4.createByScale=function(e,i,n,r){var o=(r=r||new t.math.Matrix4).mat;return o[0]=e,o[5]=i,o[10]=n,o[15]=1,o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=o[12]=o[13]=o[14]=0,r},t.kmMat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},t.math.Matrix4.createByTranslation=function(e,i,n,r){return(r=r||new t.math.Matrix4).identity(),r.mat[12]=e,r.mat[13]=i,r.mat[14]=n,r},e.getUpVec3=function(){var e=this.mat;return new t.math.Vec3(e[4],e[5],e[6]).normalize()},e.getRightVec3=function(){var e=this.mat;return new t.math.Vec3(e[0],e[1],e[2]).normalize()},e.getForwardVec3=function(){var e=this.mat;return new t.math.Vec3(e[8],e[9],e[10]).normalize()},t.kmMat4PerspectiveProjection=function(e,i,n,r,o){var c=t.degreesToRadians(i/2);i=o-r;var s=Math.sin(c);return 0===i||0===s||0===n?null:(c=Math.cos(c)/s,e.identity(),e.mat[0]=c/n,e.mat[5]=c,e.mat[10]=-(o+r)/i,e.mat[11]=-1,e.mat[14]=-2*r*o/i,e.mat[15]=0,e)},t.math.Matrix4.createPerspectiveProjection=function(e,i,n,r){var o=t.degreesToRadians(e/2);e=r-n;var c=Math.sin(o);if(0===e||0===c||0===i)return null;o=Math.cos(o)/c;var s=(c=new t.math.Matrix4).mat;return c.identity(),s[0]=o/i,s[5]=o,s[10]=-(r+n)/e,s[11]=-1,s[14]=-2*n*r/e,s[15]=0,c},t.kmMat4OrthographicProjection=function(t,e,i,n,r,o,c){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(c-o),t.mat[12]=-(i+e)/(i-e),t.mat[13]=-(r+n)/(r-n),t.mat[14]=-(c+o)/(c-o),t},t.math.Matrix4.createOrthographicProjection=function(e,i,n,r,o,c){var s=new t.math.Matrix4,a=s.mat;return s.identity(),a[0]=2/(i-e),a[5]=2/(r-n),a[10]=-2/(c-o),a[12]=-(i+e)/(i-e),a[13]=-(r+n)/(r-n),a[14]=-(c+o)/(c-o),s},t.kmMat4LookAt=function(e,i,n,r){n=new t.math.Vec3(n);var o=new t.math.Vec3(r);return n.subtract(i),n.normalize(),o.normalize(),(r=new t.math.Vec3(n)).cross(o),r.normalize(),(o=new t.math.Vec3(r)).cross(n),r.normalize(),e.identity(),e.mat[0]=r.x,e.mat[4]=r.y,e.mat[8]=r.z,e.mat[1]=o.x,e.mat[5]=o.y,e.mat[9]=o.z,e.mat[2]=-n.x,e.mat[6]=-n.y,e.mat[10]=-n.z,i=t.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z),e.multiply(i),e};var n=new t.math.Matrix4;e.lookAt=function(e,i,r){i=new t.math.Vec3(i);var o=new t.math.Vec3(r);r=this.mat,i.subtract(e),i.normalize(),o.normalize();var c=new t.math.Vec3(i);return c.cross(o),c.normalize(),(o=new t.math.Vec3(c)).cross(i),c.normalize(),this.identity(),r[0]=c.x,r[4]=c.y,r[8]=c.z,r[1]=o.x,r[5]=o.y,r[9]=o.z,r[2]=-i.x,r[6]=-i.y,r[10]=-i.z,n=t.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z,n),this.multiply(n),this},t.kmMat4RotationAxisAngle=function(e,i,n){var r=Math.cos(n);return n=Math.sin(n),(i=new t.math.Vec3(i)).normalize(),e.mat[0]=r+i.x*i.x*(1-r),e.mat[1]=i.z*n+i.y*i.x*(1-r),e.mat[2]=-i.y*n+i.z*i.x*(1-r),e.mat[3]=0,e.mat[4]=-i.z*n+i.x*i.y*(1-r),e.mat[5]=r+i.y*i.y*(1-r),e.mat[6]=i.x*n+i.z*i.y*(1-r),e.mat[7]=0,e.mat[8]=i.y*n+i.x*i.z*(1-r),e.mat[9]=-i.x*n+i.y*i.z*(1-r),e.mat[10]=r+i.z*i.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},t.math.Matrix4.createByAxisAndAngle=function(e,i,n){n=n||new t.math.Matrix4;var r=this.mat,o=Math.cos(i);return i=Math.sin(i),(e=new t.math.Vec3(e)).normalize(),r[0]=o+e.x*e.x*(1-o),r[1]=e.z*i+e.y*e.x*(1-o),r[2]=-e.y*i+e.z*e.x*(1-o),r[3]=0,r[4]=-e.z*i+e.x*e.y*(1-o),r[5]=o+e.y*e.y*(1-o),r[6]=e.x*i+e.z*e.y*(1-o),r[7]=0,r[8]=e.y*i+e.x*e.z*(1-o),r[9]=-e.x*i+e.y*e.z*(1-o),r[10]=o+e.z*e.z*(1-o),r[11]=0,r[12]=r[13]=r[14]=0,r[15]=1,n},e.extractRotation=function(){var e=new t.math.Matrix3,i=this.mat,n=e.mat;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],e},e.extractPlane=function(e){var i=new t.math.Plane,n=this.mat;switch(e){case t.math.Plane.RIGHT:i.a=n[3]-n[0],i.b=n[7]-n[4],i.c=n[11]-n[8],i.d=n[15]-n[12];break;case t.math.Plane.LEFT:i.a=n[3]+n[0],i.b=n[7]+n[4],i.c=n[11]+n[8],i.d=n[15]+n[12];break;case t.math.Plane.BOTTOM:i.a=n[3]+n[1],i.b=n[7]+n[5],i.c=n[11]+n[9],i.d=n[15]+n[13];break;case t.math.Plane.TOP:i.a=n[3]-n[1],i.b=n[7]-n[5],i.c=n[11]-n[9],i.d=n[15]-n[13];break;case t.math.Plane.FAR:i.a=n[3]-n[2],i.b=n[7]-n[6],i.c=n[11]-n[10],i.d=n[15]-n[14];break;case t.math.Plane.NEAR:i.a=n[3]+n[2],i.b=n[7]+n[6],i.c=n[11]+n[10],i.d=n[15]+n[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index")}return e=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c),i.a/=e,i.b/=e,i.c/=e,i.d/=e,i},e.toAxisAndAngle=function(){var e=this.extractRotation();return t.math.Quaternion.rotationMatrix(e).toAxisAndAngle()}}(cc),function(t){t.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)},t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0,t.math.Plane.RIGHT=1,t.math.Plane.BOTTOM=2,t.math.Plane.TOP=3,t.math.Plane.NEAR=4,t.math.Plane.FAR=5,t.math.Plane.POINT_INFRONT_OF_PLANE=0,t.math.Plane.POINT_BEHIND_PLANE=1,t.math.Plane.POINT_ON_PLANE=2,e.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},e.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},t.math.Plane.fromPointNormal=function(e,i){return new t.math.Plane(i.x,i.y,i.z,-i.dot(e))},t.math.Plane.fromPoints=function(e,i,n){i=new t.math.Vec3(i),n=new t.math.Vec3(n);var r=new t.math.Plane;return i.subtract(e),n.subtract(e),i.cross(n),i.normalize(),r.a=i.x,r.b=i.y,r.c=i.z,r.d=i.scale(-1).dot(e),r},e.normalize=function(){var e=new t.math.Vec3(this.a,this.b,this.c),i=1/e.length();return e.normalize(),this.a=e.x,this.b=e.y,this.c=e.z,this.d*=i,this},e.classifyPoint=function(e){return.001<(e=this.a*e.x+this.b*e.y+this.c*e.z+this.d)?t.math.Plane.POINT_INFRONT_OF_PLANE:-.001>e?t.math.Plane.POINT_BEHIND_PLANE:t.math.Plane.POINT_ON_PLANE}}(cc),function(t){t.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},e.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},e.exponential=function(){return this},e.identity=function(){return this.z=this.y=this.x=0,this.w=1,this},e.inverse=function(){var e=this.length();return Math.abs(e)>t.math.EPSILON?(this.w=this.z=this.y=this.x=0,this):(this.conjugate(this).scale(1/e),this)},e.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},e.length=function(){return Math.sqrt(this.lengthSq())},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},e.normalize=function(){var e=this.length();if(Math.abs(e)<=t.math.EPSILON)throw Error("current quaternion is an invalid value");return this.scale(1/e),this},e.rotationAxis=function(t,e){e*=.5;var i=Math.sin(e);return this.w=Math.cos(e),this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},t.math.Quaternion.rotationMatrix=function(e){return e?(i=[],e=e.mat,i[0]=e[0],i[1]=e[3],i[2]=e[6],i[4]=e[1],i[5]=e[4],i[6]=e[7],i[8]=e[2],i[9]=e[5],i[10]=e[8],i[15]=1,(i=(r=i[0])[0]+r[5]+r[10]+1)>t.math.EPSILON?(o=2*Math.sqrt(i),i=(r[9]-r[6])/o,e=(r[2]-r[8])/o,n=(r[4]-r[1])/o,r=.25*o):r[0]>r[5]&&r[0]>r[10]?(i=.25*(o=2*Math.sqrt(1+r[0]-r[5]-r[10])),e=(r[4]+r[1])/o,n=(r[2]+r[8])/o,r=(r[9]-r[6])/o):r[5]>r[10]?(o=2*Math.sqrt(1+r[5]-r[0]-r[10]),i=(r[4]+r[1])/o,e=.25*o,n=(r[9]+r[6])/o,r=(r[2]-r[8])/o):(o=2*Math.sqrt(1+r[10]-r[0]-r[5]),i=(r[2]+r[8])/o,e=(r[9]+r[6])/o,n=.25*o,r=(r[4]-r[1])/o),new t.math.Quaternion(i,e,n,r)):null;var i,n,r,o},t.math.Quaternion.rotationYawPitchRoll=function(e,i,n){var r,o,c,s,a;r=t.degreesToRadians(i)/2,o=t.degreesToRadians(e)/2,c=t.degreesToRadians(n)/2,n=Math.cos(r),e=Math.cos(o),i=Math.cos(c),r=Math.sin(r),s=e*i,a=(o=Math.sin(o))*(c=Math.sin(c));var h=new t.math.Quaternion;return h.w=n*s+r*a,h.x=r*s-n*a,h.y=n*o*i+r*e*c,h.z=n*e*c-r*o*i,h.normalize(),h},e.slerp=function(e,i){if(this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w)return this;var n=this.dot(e),r=Math.acos(n),o=Math.sqrt(1-t.math.square(n));return n=Math.sin(i*r)/o,i=Math.sin((1-i)*r)/o,e=new t.math.Quaternion(e),this.scale(i),e.scale(n),this.add(e),this},e.toAxisAndAngle=function(){var e,i,n=new t.math.Vec3;return e=Math.acos(this.w),(i=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)))>-t.math.EPSILON&&i<t.math.EPSILON||i<2*Math.PI+t.math.EPSILON&&i>2*Math.PI-t.math.EPSILON?(e=0,n.x=0,n.y=0,n.z=1):(e*=2,n.x=this.x/i,n.y=this.y/i,n.z=this.z/i,n.normalize()),{axis:n,angle:e}},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.math.Quaternion.rotationBetweenVec3=function(e,i,n){var r=new t.math.Vec3(e),o=new t.math.Vec3(i);r.normalize(),o.normalize();var c=r.dot(o);return i=new t.math.Quaternion,1<=c?(i.identity(),i):(-.999999>c?Math.abs(n.lengthSq())<t.math.EPSILON?i.rotationAxis(n,Math.PI):((r=new t.math.Vec3(1,0,0)).cross(e),Math.abs(r.lengthSq())<t.math.EPSILON&&(r.fill(0,1,0),r.cross(e)),r.normalize(),i.rotationAxis(r,Math.PI)):(n=1/(e=Math.sqrt(2*(1+c))),r.cross(o),i.x=r.x*n,i.y=r.y*n,i.z=r.z*n,i.w=.5*e,i.normalize()),i)},e.multiplyVec3=function(e){var i=this.x,n=this.y,r=this.z,o=new t.math.Vec3(e),c=new t.math.Vec3(i,n,r);return i=new t.math.Vec3(i,n,r),c.cross(e),i.cross(c),c.scale(2*q.w),i.scale(2),o.add(c),o.add(i),o}}(cc),cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t},function(t){t.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[],this.lastUpdated=0},t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0,this.top=null},t.km_mat4_stack_push=function(e,i){e.stack.push(e.top),e.top=new t.math.Matrix4(i)},t.km_mat4_stack_pop=function(t,e){t.top=t.stack.pop()},t.km_mat4_stack_release=function(t){t.stack=null,t.top=null},e.push=function(e){e=e||this.top,this.stack.push(this.top),this.top=new t.math.Matrix4(e)},e.pop=function(){this.top=this.stack.pop()},e.release=function(){this._matrixPool=this.top=this.stack=null},e._getFromPool=function(e){var i=this._matrixPool;return 0===i.length?new t.math.Matrix4(e):((i=i.pop()).assignFrom(e),i)},e._putInPool=function(t){this._matrixPool.push(t)}}(cc),function(t){t.KM_GL_MODELVIEW=5888,t.KM_GL_PROJECTION=5889,t.KM_GL_TEXTURE=5890,t.modelview_matrix_stack=new t.math.Matrix4Stack,t.projection_matrix_stack=new t.math.Matrix4Stack,t.texture_matrix_stack=new t.math.Matrix4Stack,t.current_stack=null,t.lazyInitialize=function(){var e=new t.math.Matrix4;t.modelview_matrix_stack.initialize(),t.projection_matrix_stack.initialize(),t.texture_matrix_stack.initialize(),t.current_stack=t.modelview_matrix_stack,t.initialized=!0,e.identity(),t.modelview_matrix_stack.push(e),t.projection_matrix_stack.push(e),t.texture_matrix_stack.push(e)},t.lazyInitialize(),t.kmGLFreeAll=function(){t.modelview_matrix_stack.release(),t.modelview_matrix_stack=null,t.projection_matrix_stack.release(),t.projection_matrix_stack=null,t.texture_matrix_stack.release(),t.texture_matrix_stack=null,t.initialized=!1,t.current_stack=null},t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)},t.kmGLPushMatrixWitMat4=function(e){t.current_stack.stack.push(t.current_stack.top),e.assignFrom(t.current_stack.top),t.current_stack.top=e},t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()},t.kmGLMatrixMode=function(e){switch(e){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw Error("Invalid matrix mode specified")}t.current_stack.lastUpdated=t.director.getTotalFrames()},t.kmGLLoadIdentity=function(){t.current_stack.top.identity()},t.kmGLLoadMatrix=function(e){t.current_stack.top.assignFrom(e)},t.kmGLMultMatrix=function(e){t.current_stack.top.multiply(e)};var e=new t.math.Matrix4;t.kmGLTranslatef=function(i,n,r){i=t.math.Matrix4.createByTranslation(i,n,r,e),t.current_stack.top.multiply(i)};var i=new t.math.Vec3;t.kmGLRotatef=function(n,r,o,c){i.fill(r,o,c),n=t.math.Matrix4.createByAxisAndAngle(i,t.degreesToRadians(n),e),t.current_stack.top.multiply(n)},t.kmGLScalef=function(i,n,r){i=t.math.Matrix4.createByScale(i,n,r,e),t.current_stack.top.multiply(i)},t.kmGLGetMatrix=function(e,i){switch(e){case t.KM_GL_MODELVIEW:i.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:i.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:i.assignFrom(t.texture_matrix_stack.top);break;default:throw Error("Invalid matrix mode specified")}}}(cc),cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_SPRITE_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}",cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_SPRITE_POSITION_TEXTURECOLOR_GRAY:11,TYPE_MAX:11,_keyMap:[cc.SHADER_POSITION_TEXTURECOLOR,cc.SHADER_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_POSITION_COLOR,cc.SHADER_POSITION_TEXTURE,cc.SHADER_POSITION_TEXTURE_UCOLOR,cc.SHADER_POSITION_TEXTUREA8COLOR,cc.SHADER_POSITION_UCOLOR,cc.SHADER_POSITION_LENGTHTEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_SPRITE_POSITION_COLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY],_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case cc.SHADER_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_POSITION_TEXTURE:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTUREA8COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case cc.SHADER_POSITION_LENGTHTEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){for(var t=0;t<this.TYPE_MAX;++t)this.programForKey(this._keyMap[t])},reloadDefaultShaders:function(){var t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_TEXTURECOLOR),(t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)).reset(),this._loadDefaultShader(t,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_TEXTURECOLORALPHATEST),(t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)).reset(),this._loadDefaultShader(t,cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),(t=this.programForKey(cc.SHADER_POSITION_COLOR)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_COLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTURE)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_TEXTURE),(t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG)).reset(),this._loadDefaultShader(t,cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG),(t=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_TEXTURE_UCOLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_TEXTUREA8COLOR),(t=this.programForKey(cc.SHADER_POSITION_UCOLOR)).reset(),this._loadDefaultShader(t,cc.SHADER_POSITION_UCOLOR)},programForKey:function(t){if(!this._programs[t]){var e=new cc.GLProgram;this._loadDefaultShader(e,t),this._programs[t]=e}return this._programs[t]},getProgram:function(t){return this.programForKey(t)},addProgram:function(t,e){this._programs[e]=t}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_projectionUpdated:-1,_updateUniform:function(t){if(!t)return!1;var e,i=!1,n=this._hashForUniforms[t];if(Array.isArray(arguments[1]))e=arguments[1];else{e=Array(arguments.length-1);for(var r=1;r<arguments.length;r+=1)e[r-1]=arguments[r]}if(n&&n.length===e.length)for(r=0;r<e.length;r+=1)e[r]===n[r]&&"object"!=typeof e[r]||(n[r]=e[r],i=!0);else this._hashForUniforms[t]=[].concat(e),i=!0;return i},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";return this._glContext.shaderSource(t,n+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i),this._glContext.compileShader(t),(i=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS))||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),!0===i},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._hashForUniforms=this._uniforms=this._fragShader=this._vertShader=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;return this._programObj=i.createProgram(),this._fragShader=this._vertShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader),0<Object.keys(this._hashForUniforms).length&&(this._hashForUniforms={}),cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw Error("Please load the resource firset : "+t);if(!(t=cc.loader.getRes(e)))throw Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,t)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){return this._programObj?(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._fragShader=this._vertShader=null,!(cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)&&(cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,1))):(cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1)},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._addUniformLocation(cc.UNIFORM_PMATRIX_S),this._addUniformLocation(cc.UNIFORM_MVMATRIX_S),this._addUniformLocation(cc.UNIFORM_MVPMATRIX_S),this._addUniformLocation(cc.UNIFORM_TIME_S),this._addUniformLocation(cc.UNIFORM_SINTIME_S),this._addUniformLocation(cc.UNIFORM_COSTIME_S),this._addUniformLocation(cc.UNIFORM_RANDOM01_S),this._addUniformLocation(cc.UNIFORM_SAMPLER_S),this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME_S]||null!=this._uniforms[cc.UNIFORM_SINTIME_S]||null!=this._uniforms[cc.UNIFORM_COSTIME_S],this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER_S],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);return e&&(e._name=t),this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[t]||this._addUniformLocation(t)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX_S]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform1i(t,e)):this._glContext.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n="string"==typeof t,r=n?t:t&&t._name;r?this._updateUniform(r,e,i)&&(n&&(t=this.getUniformLocationForName(r)),this._glContext.uniform2i(t,e,i)):this._glContext.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r="string"==typeof t,o=r?t:t&&t._name;o?this._updateUniform(o,e,i,n)&&(r&&(t=this.getUniformLocationForName(o)),this._glContext.uniform3i(t,e,i,n)):this._glContext.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var o="string"==typeof t,c=o?t:t&&t._name;c?this._updateUniform(c,e,i,n,r)&&(o&&(t=this.getUniformLocationForName(c)),this._glContext.uniform4i(t,e,i,n,r)):this._glContext.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform2iv(t,e)):this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform3iv(t,e)):this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform4iv(t,e)):this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform1f(t,e)):this._glContext.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n="string"==typeof t,r=n?t:t&&t._name;r?this._updateUniform(r,e,i)&&(n&&(t=this.getUniformLocationForName(r)),this._glContext.uniform2f(t,e,i)):this._glContext.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r="string"==typeof t,o=r?t:t&&t._name;o?this._updateUniform(o,e,i,n)&&(r&&(t=this.getUniformLocationForName(o)),this._glContext.uniform3f(t,e,i,n)):this._glContext.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var o="string"==typeof t,c=o?t:t&&t._name;c?this._updateUniform(c,e,i,n,r)&&(o&&(t=this.getUniformLocationForName(c)),this._glContext.uniform4f(t,e,i,n,r)):(this._glContext.uniform4f(t,e,i,n,r),cc.log("uniform4f",e,i,n,r))},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform2fv(t,e)):this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform3fv(t,e)):this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniform4fv(t,e)):(this._glContext.uniform4fv(t,e),cc.log("uniform4fv",e))},setUniformLocationWithMatrix2fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniformMatrix2fv(t,!1,e)):this._glContext.uniformMatrix2fv(t,!1,e)},setUniformLocationWithMatrix3fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniformMatrix3fv(t,!1,e)):this._glContext.uniformMatrix3fv(t,!1,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t,n=i?t:t&&t._name;n?this._updateUniform(n,e)&&(i&&(t=this.getUniformLocationForName(n)),this._glContext.uniformMatrix4fv(t,!1,e)):this._glContext.uniformMatrix4fv(t,!1,e)},setUniformLocationF32:function(){if(!(2>arguments.length))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new cc.math.Matrix4,e=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),cc.kmMat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],i.mat,1),this._usesTime&&(t=(t=cc.director).getTotalFrames()*t.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],t/10,t,2*t,4*t),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],t/8,t/4,t/2,Math.sin(t)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],t/8,t/4,t/2,Math.cos(t))),-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e),cc.kmMat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],i.mat,1),this._usesTime&&(t=(t=cc.director).getTotalFrames()*t.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],t/10,t,2*t,4*t),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],t/8,t/4,t/2,Math.sin(t)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],t/8,t/4,t/2,Math.cos(t))),-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){cc.kmMat4Multiply(t,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],cc.modelview_matrix_stack.top.mat),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw Error("modelView matrix is undefined.");this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],t.mat),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var t=cc.projection_matrix_stack;t.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,t.top.mat),this._projectionUpdated=t.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._fragShader=this._vertShader=null,0<Object.keys(this._uniforms).length&&(this._uniforms={}),this._glContext.deleteProgram(this._programObj),this._programObj=null,0<Object.keys(this._hashForUniforms).length&&(this._hashForUniforms={})},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(t,e){return new cc.GLProgram(t,e)},cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var t=cc._renderContext;return t.getShaderPrecisionFormat&&null==cc.GLProgram._highpSupported&&(t=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),cc.GLProgram._highpSupported=0!==t.precision),cc.GLProgram._highpSupported},cc.setProgram=function(t,e){if(t.shaderProgram=e,t=t.children)for(var i=0;i<t.length;i++)cc.setProgram(t[i],e)};var types={GL_FLOAT:0,GL_INT:1,GL_FLOAT_VEC2:2,GL_FLOAT_VEC3:3,GL_FLOAT_VEC4:4,GL_FLOAT_MAT4:5,GL_CALLBACK:6,GL_TEXTURE:7};function setProgram(t,e){if(t.shaderProgram=e,t=t.children)for(var i=0;i<t.length;i++)setProgram(t[i],e)}cc.UniformValue=function(t,e){this._uniform=t,this._glprogram=e,this._value=null,this._type=-1},cc.UniformValue.prototype={setFloat:function(t){this._value=t,this._type=types.GL_FLOAT},setInt:function(t){this._value=t,this._type=types.GL_INT},setVec2:function(t,e){this._value=[t,e],this._type=types.GL_FLOAT_VEC2},setVec2v:function(t){this._value=t.slice(0),this._type=types.GL_FLOAT_VEC2},setVec3:function(t,e,i){this._value=[t,e,i],this._type=types.GL_FLOAT_VEC3},setVec3v:function(t){this._value=t.slice(0),this._type=types.GL_FLOAT_VEC3},setVec4:function(t,e,i,n){this._value=[t,e,i,n],this._type=types.GL_FLOAT_VEC4},setVec4v:function(t){this._value=t.slice(0),this._type=types.GL_FLOAT_VEC4},setMat4:function(t){this._value=t.slice(0),this._type=types.GL_FLOAT_MAT4},setCallback:function(t){this._value=t,this._type=types.GL_CALLBACK},setTexture:function(t,e){this._value=e,this._textureId=t,this._type=types.GL_TEXTURE},apply:function(){switch(this._type){case types.GL_INT:this._glprogram.setUniformLocationWith1i(this._uniform._location,this._value);break;case types.GL_FLOAT:this._glprogram.setUniformLocationWith1f(this._uniform._location,this._value);break;case types.GL_FLOAT_VEC2:this._glprogram.setUniformLocationWith2fv(this._uniform._location,this._value);break;case types.GL_FLOAT_VEC3:this._glprogram.setUniformLocationWith3fv(this._uniform._location,this._value);break;case types.GL_FLOAT_VEC4:this._glprogram.setUniformLocationWith4fv(this._uniform._location,this._value);break;case types.GL_FLOAT_MAT4:this._glprogram.setUniformLocationWithMatrix4fv(this._uniform._location,this._value);break;case types.GL_CALLBACK:this._value(this._glprogram,this._uniform);break;case types.GL_TEXTURE:this._glprogram.setUniformLocationWith1i(this._uniform._location,this._value),cc.glBindTexture2DN(this._value,this._textureId)}}},cc.GLProgramState=function(t){this._glprogram=t,this._uniforms={},this._boundTextureUnits={},this._textureUnitIndex=1;for(var e=t._glContext.getProgramParameter(t._programObj,t._glContext.ACTIVE_UNIFORMS),i=0;i<e;i+=1){var n=t._glContext.getActiveUniform(t._programObj,i);if(0!==n.name.indexOf("CC_")){n._location=t._glContext.getUniformLocation(t._programObj,n.name),n._location._name=n.name;var r=new cc.UniformValue(n,t);this._uniforms[n.name]=r}}},cc.GLProgramState.prototype={apply:function(t){for(var e in this._glprogram.use(),t&&this._glprogram._setUniformForMVPMatrixWithMat4(t),this._uniforms)this._uniforms[e].apply()},setGLProgram:function(t){this._glprogram=t},getGLProgram:function(){return this._glprogram},getUniformCount:function(){return this._uniforms.length},getUniformValue:function(t){return this._uniforms[t]},setUniformInt:function(t,e){var i=this.getUniformValue(t);i?i.setInt(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformFloat:function(t,e){var i=this.getUniformValue(t);i?i.setFloat(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec2:function(t,e,i){var n=this.getUniformValue(t);n?n.setVec2(e,i):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec2v:function(t,e){var i=this.getUniformValue(t);i?i.setVec2v(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec3:function(t,e,i,n){var r=this.getUniformValue(t);r?r.setVec3(e,i,n):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec3v:function(t,e){var i=this.getUniformValue(t);i?i.setVec3v(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec4:function(t,e,i,n,r){var o=this.getUniformValue(t);o?o.setVec4(e,i,n,r):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformVec4v:function(t,e){var i=this.getUniformValue(t);i?i.setVec4v(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformMat4:function(t,e){var i=this.getUniformValue(t);i?i.setMat4(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformCallback:function(t,e){var i=this.getUniformValue(t);i?i.setCallback(e):cc.log("cocos2d: warning: Uniform not found: "+t)},setUniformTexture:function(t,e){var i=this.getUniformValue(t);if(i){var n=this._boundTextureUnits[t];n?i.setTexture(e,n):(i.setTexture(e,this._textureUnitIndex),this._boundTextureUnits[t]=this._textureUnitIndex++)}}},cc.GLProgramState._cache={},cc.GLProgramState.getOrCreateWithGLProgram=function(t){var e=cc.GLProgramState._cache[t.__instanceId];return e||(e=new cc.GLProgramState(t),cc.GLProgramState._cache[t.__instanceId]=e),e},cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0)),cc.glInvalidateStateCache=function(){if(cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var t=0;t<cc.MAX_ACTIVETEXTURE;t++)cc._currentBoundTexture[t]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=cc.ENABLE_GL_STATE_CACHE?function(t){t!==cc._currentShaderProgram&&(cc._currentShaderProgram=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.glDeleteProgram=function(t){cc.ENABLE_GL_STATE_CACHE&&t===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),gl.deleteProgram(t)},cc.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.glBlendFunc=cc.ENABLE_GL_STATE_CACHE?function(t,e){t===cc._blendingSource&&e===cc._blendingDest||(cc._blendingSource=t,cc._blendingDest=e,cc.setBlending(t,e))}:cc.setBlending,cc.glBlendFuncForParticle=function(t,e){if(t!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=t,cc._blendingDest=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.glBlendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glBindTexture2D=function(t){cc.glBindTexture2DN(0,t)},cc.glBindTexture2DN=cc.ENABLE_GL_STATE_CACHE?function(t,e){if(cc._currentBoundTexture[t]!==e){cc._currentBoundTexture[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)},cc.glDeleteTexture=function(t){cc.glDeleteTextureN(0,t)},cc.glDeleteTextureN=function(t,e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentBoundTexture[t]&&(cc._currentBoundTexture[t]=-1),cc._renderContext.deleteTexture(e._webTextureObj)},cc.glBindVAO=function(t){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==t&&(cc._uVAO=t)},cc.glEnable=function(t){},cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=9,cc.NextPOT=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16)},cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(t,e,i,n||0)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},visit:function(t){var e=this._renderCmd;if(t=t?t._renderCmd:null,this._visible){var i=cc.renderer;e.visit(t),i.pushRenderCommand(e),this.sprite.visit(this),e._dirtyFlag=0}else e._propagateFlagsDown(t)},cleanup:function(){cc.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,o){var c=cc._renderContext;r=r||c.COLOR_BUFFER_BIT,o=o||c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,n,r,o,c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,o,c){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,o,c)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}}),_p=cc.RenderTexture.prototype,cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor),cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)},function(){cc.RenderTexture.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.RenderTexture.CanvasRenderCmd,t.cleanup=function(){this._cacheCanvas=this._cacheContext=null},t.clearStencil=function(t){},t.setVirtualViewport=function(t,e,i){},t.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},t.initWithWidthAndHeight=function(t,e,i,n){i=this._node,n=this._cacheCanvas;var r=cc.contentScaleFactor();return n.width=0|t*r,n.height=0|e*r,(t=new cc.Texture2D).initWithElement(n),t.handleLoadedTexture(),(t=i.sprite=new cc.Sprite(t)).setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA),i.autoDraw=!1,i.addChild(t),!0},t.begin=function(){},t._beginWithClear=function(t,e,i,n,r,o,c){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n,r=this._cacheContext.getContext(),o=this._cacheCanvas,r.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),r.clearRect(0,0,o.width,o.height),r.fillRect(0,0,o.width,o.height)},t.end=function(){var t=this._node,e=cc.contentScaleFactor();cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId,e,e),(t=t.sprite._renderCmd)._notifyRegionStatus&&t._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty)},t.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},t.clearDepth=function(t){cc.log("clearDepth isn't supported on Cocos2d-Html5")}}(),function(){cc.RenderTexture.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._depthRenderBuffer=this._textureCopy=this._oldFBO=this._fBO=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var t=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},t.needDraw=function(){return this._needDraw&&this._node.autoDraw},t.rendering=function(t){var e=t||cc._renderContext;if((t=this._node).autoDraw){t.begin();var i=t.clearFlags;if(i){var n=[0,0,0,0],r=0,o=0;i&e.COLOR_BUFFER_BIT&&(n=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(t._clearColor.r/255,t._clearColor.g/255,t._clearColor.b/255,t._clearColor.a/255)),i&e.DEPTH_BUFFER_BIT&&(r=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(t.clearDepthVal)),i&e.STENCIL_BUFFER_BIT&&(o=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(t.clearStencilVal)),e.clear(i),i&e.COLOR_BUFFER_BIT&&e.clearColor(n[0],n[1],n[2],n[3]),i&e.DEPTH_BUFFER_BIT&&e.clearDepth(r),i&e.STENCIL_BUFFER_BIT&&e.clearStencil(o)}for(t.sortAllChildren(),e=t._children,i=0;i<e.length;i++)(n=e[i])!==t.sprite&&n.visit(t.sprite);t.end()}},t.clearStencil=function(t){var e=cc._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},t.cleanup=function(){this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(t){},t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;i===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o,c=cc._renderContext,s=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,t,e),this._fullViewport=new cc.Rect(0,0,t,e),t=0|t*s,e=0|e*s,this._oldFBO=c.getParameter(c.FRAMEBUFFER_BINDING),cc.configuration.supportsNPOT()?(s=t,o=e):(s=cc.NextPOT(t),o=cc.NextPOT(e));for(var a=new Uint8Array(s*o*4),h=0;h<s*o*4;h++)a[h]=0;if(this._pixelFormat=i,h=r._texture=new cc.Texture2D,!r._texture)return!1;if(h.initWithData(a,r._pixelFormat,s,o,cc.size(t,e)),i=c.getParameter(c.RENDERBUFFER_BINDING),cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(a,r._pixelFormat,s,o,cc.size(t,e))}return this._fBO=c.createFramebuffer(),c.bindFramebuffer(c.FRAMEBUFFER,this._fBO),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,h._webTextureObj,0),0!==n&&(this._depthRenderBuffer=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this._depthRenderBuffer),c.renderbufferStorage(c.RENDERBUFFER,n,s,o),n===c.DEPTH_STENCIL?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):n===c.STENCIL_INDEX||n===c.STENCIL_INDEX8?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer):n===c.DEPTH_COMPONENT16&&c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer)),c.checkFramebufferStatus(c.FRAMEBUFFER)!==c.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),h.setAliasTexParameters(),(t=r.sprite=new cc.Sprite(h)).scaleY=-1,t.setBlendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.bindRenderbuffer(c.RENDERBUFFER,i),c.bindFramebuffer(c.FRAMEBUFFER,this._oldFBO),r.autoDraw=!1,r.addChild(t),!0},t.begin=function(){var t=this._node;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix();var e=cc._renderContext;(r=cc.director).setProjection(r.getProjection());var i=t._texture.getContentSizeInPixels(),n=cc.director.getWinSizeInPixels(),r=n.width/i.width;i=n.height/i.height,r=cc.math.Matrix4.createOrthographicProjection(-1/r,1/r,-1/i,1/i,-1,1),cc.kmGLMultMatrix(r),(r=new cc.Rect(0,0,0,0)).width=this._fullViewport.width,r.height=this._fullViewport.height,i=r.height/this._fullRect.height,r.x=r.width/this._fullRect.width*(this._fullRect.x-this._rtTextureRect.x),r.y=(this._fullRect.y-this._rtTextureRect.y)*i,e.viewport(r.x,r.y,r.width,r.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},t._beginWithClear=function(t,e,i,n,r,o,c){t/=255,e/=255,i/=255,n/=255;var s=cc._renderContext,a=[0,0,0,0],h=0,l=0;c&s.COLOR_BUFFER_BIT&&(a=s.getParameter(s.COLOR_CLEAR_VALUE),s.clearColor(t,e,i,n)),c&s.DEPTH_BUFFER_BIT&&(h=s.getParameter(s.DEPTH_CLEAR_VALUE),s.clearDepth(r)),c&s.STENCIL_BUFFER_BIT&&(l=s.getParameter(s.STENCIL_CLEAR_VALUE),s.clearStencil(o)),s.clear(c),c&s.COLOR_BUFFER_BIT&&s.clearColor(a[0],a[1],a[2],a[3]),c&s.DEPTH_BUFFER_BIT&&s.clearDepth(h),c&s.STENCIL_BUFFER_BIT&&s.clearStencil(l)},t.end=function(){cc.renderer._renderingToBuffer(this._node.__instanceId);var t=cc._renderContext,e=cc.director;t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),e.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},t.clearRect=function(t,e,i,n){},t.clearDepth=function(t){var e=this._node;e.begin();var i=cc._renderContext,n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(n),e.end()}}(),cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.create=function(){return new cc.DrawNode},cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)cc._DrawNodeElement=function(t,e,i,n,r,o,c,s,a){this.type=t,this.verts=e||null,this.fillColor=i||null,this.lineWidth=n||0,this.lineColor=r||null,this.lineCap=o||"butt",this.isClosePolygon=c||!1,this.isFill=s||!1,this.isStroke=a||!1},cc.extend(cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.init(),this._localBB=new cc.Rect},setLocalBB:function(t,e,i,n){var r=this._localBB;void 0===e?(r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height):(r.x=t,r.y=e,r.width=i,r.height=n)},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,null==(r=r||this.getDrawColor()).a&&(r.a=255),t=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],(e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY)).verts=t,e.lineWidth=n,e.lineColor=r,e.isClosePolygon=!0,e.isStroke=!0,e.lineCap="butt",(e.fillColor=i)&&(null==i.a&&(i.a=255),e.isFill=!0),this._buffer.push(e)},drawCircle:function(t,e,i,n,r,o,c){o=o||this._lineWidth,null==(c=c||this.getDrawColor()).a&&(c.a=255);for(var s=2*Math.PI/n,a=[],h=0;h<=n;h++){var l=h*s;a.push(cc.p(e*Math.cos(l+i)+t.x,e*Math.sin(l+i)+t.y))}r&&a.push(cc.p(t.x,t.y)),(t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY)).verts=a,t.lineWidth=o,t.lineColor=c,t.isClosePolygon=!0,t.isStroke=!0,this._buffer.push(t)},drawQuadBezier:function(t,e,i,n,r,o){r=r||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var c=[],s=0,a=0;a<n;a++)c.push(cc.p(Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x,Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y)),s+=1/n;c.push(cc.p(i.x,i.y)),(t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY)).verts=c,t.lineWidth=r,t.lineColor=o,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawCubicBezier:function(t,e,i,n,r,o,c){o=o||this._lineWidth,null==(c=c||this.getDrawColor()).a&&(c.a=255);for(var s=[],a=0,h=0;h<r;h++)s.push(cc.p(Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x,Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y)),a+=1/r;s.push(cc.p(n.x,n.y)),(t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY)).verts=s,t.lineWidth=o,t.lineColor=c,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var o,c,s=[],a=1/t.length,h=0;h<i+1;h++)1==(c=h/i)?(o=t.length-1,c=1):c=(c-a*(o=0|c/a))/a,o=cc.cardinalSplineAt(cc.getControlPointAt(t,o-1),cc.getControlPointAt(t,o-0),cc.getControlPointAt(t,o+1),cc.getControlPointAt(t,o+2),e,c),s.push(o);(t=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY)).verts=s,t.lineWidth=n,t.lineColor=r,t.isStroke=!0,t.lineCap="round",this._buffer.push(t)},drawDot:function(t,e,i){null==(i=i||this.getDrawColor()).a&&(i.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=i,this._buffer.push(n)},drawDots:function(t,e,i){if(t&&0!=t.length){null==(i=i||this.getDrawColor()).a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,n){i=i||this._lineWidth,null==(n=n||this.getDrawColor()).a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e],r.lineWidth=2*i,r.lineColor=n,r.isStroke=!0,r.lineCap="round",this._buffer.push(r)},drawPoly_:function(t,e,i,n){i=null==i?this._lineWidth:i,null==(n=n||this.getDrawColor()).a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=t,r.fillColor=e,r.lineWidth=i,r.lineColor=n,r.isClosePolygon=!0,r.isStroke=!0,r.lineCap="round",e&&(r.isFill=!0),this._buffer.push(r)},drawPoly:function(t,e,i,n){for(var r=[],o=0;o<t.length;o++)r.push(cc.p(t[o].x,t[o].y));return this.drawPoly_(r,e,i,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}});else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=null,e=[],i=cc.p(),n=cc.p(),r=new Uint32Array(1),o=cc.p(),c=cc.p(),s=cc.p(),a=cc.p(),h=[];cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_vertexCount:0,_offset:0,_occupiedSize:0,_f32Buffer:null,_ui32Buffer:null,_dirty:!1,_className:"DrawNodeWebGL",manualRelease:!1,ctor:function(e,i){cc.Node.prototype.ctor.call(this),t||(t=new GlobalVertexBuffer(cc._renderContext,20*cc.DRAWNODE_TOTAL_VERTICES)),this._renderCmd._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this._bufferCapacity=e||64,this.manualRelease=i,this._dirty=!0},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._occupiedSize<this._bufferCapacity&&this._ensureCapacity(this._bufferCapacity)},onExit:function(){this.manualRelease||this.release(),cc.Node.prototype.onExit.call(this)},release:function(){0<this._occupiedSize&&(this._vertexCount=0,t.freeBuffer(this._offset,20*this._occupiedSize),this._occupiedSize=0)},_ensureCapacity:function(e){var i=this._occupiedSize,n=this._offset;if(e>i||this._bufferCapacity>i){var r=Math.max(Math.min(i+i,200),e,this._bufferCapacity);if(0!==i&&(t.freeBuffer(n,20*i),this._occupiedSize=0),0<=(e=this._offset=t.requestBuffer(20*r))){if(this._occupiedSize=this._bufferCapacity=r,this._f32Buffer=new Float32Array(t.data,e,5*this._occupiedSize),this._ui32Buffer=new Uint32Array(t.data,e,5*this._occupiedSize),0!==i&&n!==e)for(i=n/4+5*i,e/=4,n/=4;n<i;e++,n++)t.dataArray[e]=t.dataArray[n];return!0}return cc.warn("Failed to allocate buffer for DrawNode: buffer for "+r+" vertices requested"),!1}return!0},drawRect:function(t,i,n,r,o){r=null==r?this._lineWidth:r,o=o||this._drawColor,e.length=0,e.push(t.x,t.y,i.x,t.y,i.x,i.y,t.x,i.y),null==n?this._drawSegments(e,r,o,!0):this.drawPoly(e,n,r,o),e.length=0},drawCircle:function(t,r,o,c,s,a,h){a=a||this._lineWidth,h=h||this._drawColor;var l,d=2*Math.PI/c;for(l=e.length=0;l<=c;l++){var u=l*d;e.push(r*Math.cos(u+o)+t.x,r*Math.sin(u+o)+t.y)}for(s&&e.push(t.x,t.y),a*=.5,l=0,t=e.length-2;l<t;l+=2)i.x=e[l],i.y=e[l+1],n.x=e[l+2],n.y=e[l+3],this.drawSegment(i,n,a,h);e.length=0},drawQuadBezier:function(t,i,n,r,o,c){o=o||this._lineWidth,c=c||this._drawColor;for(var s=0,a=e.length=0;a<r;a++)e.push(Math.pow(1-s,2)*t.x+2*(1-s)*s*i.x+s*s*n.x,Math.pow(1-s,2)*t.y+2*(1-s)*s*i.y+s*s*n.y),s+=1/r;e.push(n.x,n.y),this._drawSegments(e,o,c,!1),e.length=0},drawCubicBezier:function(t,i,n,r,o,c,s){c=c||this._lineWidth,s=s||this._drawColor;for(var a=0,h=e.length=0;h<o;h++)e.push(Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*i.x+3*(1-a)*a*a*n.x+a*a*a*r.x,Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*i.y+3*(1-a)*a*a*n.y+a*a*a*r.y),a+=1/o;e.push(r.x,r.y),this._drawSegments(e,c,s,!1),e.length=0},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,r,o,c,s){c=c||this._lineWidth,s=s||this._drawColor;for(var a,h,l=1/t.length,d=e.length=0;d<o+1;d++)1==(h=d/o)?(a=t.length-1,h=1):h=(h-l*(a=0|h/l))/l,cc.cardinalSplineAt(cc.getControlPointAt(t,a-1),cc.getControlPointAt(t,a-0),cc.getControlPointAt(t,a+1),cc.getControlPointAt(t,a+2),r,h,i),e.push(i.x,i.y);for(c*=.5,t=0,r=e.length-2;t<r;t+=2)i.x=e[t],i.y=e[t+1],n.x=e[t+2],n.y=e[t+3],this.drawSegment(i,n,c,s);e.length=0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this._drawColor;for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},_render:function(){var e=cc._renderContext;0>this._offset||0>=this._vertexCount||(this._dirty?(t.updateSubData(this._offset,this._f32Buffer),this._dirty=!1):e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,20,8),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,20,12),e.drawArrays(e.TRIANGLES,this._offset/20,this._vertexCount),cc.incrementGLDraws(1))},appendVertexData:function(t,e,i,n,o){var c=this._f32Buffer,s=5*this._vertexCount;c[s]=t,c[s+1]=e,r[0]=i.a<<24|i.b<<16|i.g<<8|i.r,this._ui32Buffer[s+2]=r[0],c[s+3]=n,c[s+4]=o,this._vertexCount++},drawDot:function(t,e,i){null==(i=i||this._drawColor).a&&(i.a=255);var n=t.x-e,r=t.y-e,o=t.x+e;t=t.y+e,this._ensureCapacity(this._vertexCount+6)&&(this.appendVertexData(n,r,i,-1,-1),this.appendVertexData(n,t,i,-1,1),this.appendVertexData(o,t,i,1,1),this.appendVertexData(n,r,i,-1,-1),this.appendVertexData(o,t,i,1,1),this.appendVertexData(o,r,i,1,-1),this._dirty=!0)},drawSegment:function(t,e,i,n){if(null==(n=n||this.getDrawColor()).a&&(n.a=255),i=i||.5*this._lineWidth,this._ensureCapacity(this._vertexCount+18)){o.x=t.y-e.y,o.y=e.x-t.x,cc.pNormalizeIn(o),c.x=-o.y,c.y=o.x;var r=i;s.x=o.x*r,s.y=o.y*r,a.x=c.x*i,a.y=c.y*i,i=e.x+s.x-a.x,r=e.y+s.y-a.y;var h=o.x-c.x,l=o.y-c.y,d=e.x-s.x,u=e.y-s.y,_=-o.x,p=-o.y,f=e.x+s.x,g=e.y+s.y,m=o.x,T=o.y,y=t.x-s.x,E=t.y-s.y,S=t.x+s.x,C=t.y+s.y,v=o.x,x=o.y,R=t.x-s.x+a.x,A=t.y-s.y+a.y,I=c.x-o.x,b=c.y-o.y,P=t.x+s.x+a.x;t=t.y+s.y+a.y;var L=o.x+c.x,w=o.y+c.y;this.appendVertexData(e.x-s.x-a.x,e.y-s.y-a.y,n,-(o.x+c.x),-(o.y+c.y)),this.appendVertexData(i,r,n,h,l),this.appendVertexData(d,u,n,_,p),this.appendVertexData(f,g,n,m,T),this.appendVertexData(i,r,n,h,l),this.appendVertexData(d,u,n,_,p),this.appendVertexData(f,g,n,m,T),this.appendVertexData(y,E,n,_,p),this.appendVertexData(d,u,n,_,p),this.appendVertexData(f,g,n,m,T),this.appendVertexData(y,E,n,_,p),this.appendVertexData(S,C,n,v,x),this.appendVertexData(R,A,n,I,b),this.appendVertexData(y,E,n,_,p),this.appendVertexData(S,C,n,v,x),this.appendVertexData(R,A,n,I,b),this.appendVertexData(P,t,n,L,w),this.appendVertexData(S,C,n,v,x),this._dirty=!0}},drawPoly:function(t,i,n,r){if("object"==typeof t[0]){for(var c=e.length=0;c<t.length;c++)e.push(t[c].x,t[c].y);t=e}if(null==i)this._drawSegments(t,n,r,!0);else{null==i.a&&(i.a=255),null==r.a&&(r.a=255),n=null==n?this._lineWidth:n,n*=.5;var a,l,d,u,_,p,f,g=t.length;for(c=h.length=0;c<g;c+=2)a=t[(c-2+g)%g],l=t[(c-1+g)%g],d=t[c],u=t[c+1],_=t[(c+2)%g],p=t[(c+3)%g],o.x=l-u,o.y=d-a,s.x=u-p,s.y=_-d,cc.pNormalizeIn(o),cc.pNormalizeIn(s),u=o.x*s.x+o.y*s.y+1,f=(o.x+s.x)/u,u=(o.y+s.y)/u,h.push(f,u,s.x,s.y);if(g/=2,f=0<n,this._ensureCapacity(this._vertexCount+3*(3*g-2))){var m,T,y,E,S=0==f?.5:0;for(c=0;c<g-2;c++)a=t[0]-h[0]*S,l=t[1]-h[1]*S,d=t[2*c+2]-h[4*(c+1)]*S,u=t[2*c+3]-h[4*(c+1)+1]*S,_=t[2*c+4]-h[4*(c+2)]*S,p=t[2*c+5]-h[4*(c+2)+1]*S,this.appendVertexData(a,l,i,0,0),this.appendVertexData(d,u,i,0,0),this.appendVertexData(_,p,i,0,0);for(n=f?n:.5,i=f?r:i,c=0;c<g;c++)r=(c+1)%g,a=t[2*c],l=t[2*c+1],d=t[2*r],u=t[2*r+1],o.x=h[4*c+2],o.y=h[4*c+3],s.x=f?-o.x:0,s.y=f?-o.y:0,m=h[4*c],T=h[4*c+1],y=h[4*r],E=h[4*r+1],r=a-m*n,_=l-T*n,p=d-y*n,S=u-E*n,a+=m*n,l+=T*n,d+=y*n,u+=E*n,this.appendVertexData(r,_,i,s.x,s.y),this.appendVertexData(p,S,i,s.x,s.y),this.appendVertexData(d,u,i,o.x,o.y),this.appendVertexData(r,_,i,s.x,s.y),this.appendVertexData(a,l,i,o.x,o.y),this.appendVertexData(d,u,i,o.x,o.y);h.length=0,e.length=0,this._dirty=!0}}},_drawSegments:function(t,e,i,n){if(!(0>=(e=null==e?this._lineWidth:e))){null==(i=i||this._drawColor).a&&(i.a=255),e*=.5;var r,c,a,l,d,u,_,p=t.length;for(_=h.length=0;_<p;_+=2)r=t[(_-2+p)%p],c=t[(_-1+p)%p],a=t[_],l=t[_+1],d=t[(_+2)%p],u=t[(_+3)%p],o.x=c-l,o.y=a-r,s.x=l-u,s.y=d-a,cc.pNormalizeIn(o),cc.pNormalizeIn(s),a=o.x*s.x+o.y*s.y+1,l=(o.x+s.x)/a,a=(o.y+s.y)/a,h.push(l,a,s.x,s.y);if(p/=2,this._ensureCapacity(this._vertexCount+3*(3*p-2))){var f,g,m,T,y,E;for(n=n?p:p-1,_=0;_<n;_++)d=(_+1)%p,r=t[2*_],c=t[2*_+1],a=t[2*d],l=t[2*d+1],o.x=h[4*_+2],o.y=h[4*_+3],f=h[4*_],g=h[4*_+1],m=h[4*d],T=h[4*d+1],d=r-f*e,u=c-g*e,y=a-m*e,E=l-T*e,r+=f*e,c+=g*e,a+=m*e,l+=T*e,this.appendVertexData(d,u,i,-o.x,-o.y),this.appendVertexData(y,E,i,-o.x,-o.y),this.appendVertexData(a,l,i,o.x,o.y),this.appendVertexData(d,u,i,-o.x,-o.y),this.appendVertexData(r,c,i,o.x,o.y),this.appendVertexData(a,l,i,o.x,o.y);h.length=0,this._dirty=!0}}},clear:function(){this.release(),this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}})}})),cc.DrawNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._blendFunc=this._drawColor=this._buffer=null},cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype),cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd,cc.DrawNode.CanvasRenderCmd.prototype.getLocalBB=function(){return this._node._localBB},cc.extend(cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,i){if((t=t||cc._renderContext).getContext(),0!=(n=this._displayedOpacity/255)){t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(n),this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE&&t.setCompositeOperation("lighter");for(var n,r=0,o=(n=this._buffer).length;r<o;r++){var c=n[r];switch(c.type){case cc.DrawNode.TYPE_DOT:this._drawDot(t,c,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(t,c,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(t,c,e,i)}}}},_drawDot:function(t,e){var i=e.fillColor,n=e.verts[0];e=e.lineWidth;var r=t.getContext();t.setFillStyle("rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b)+","+i.a/255+")"),r.beginPath(),r.arc(n.x,-n.y,e,0,2*Math.PI,!1),r.closePath(),r.fill()},_drawSegment:function(t,e,i){var n=e.lineColor,r=e.verts[0],o=e.verts[1],c=e.lineWidth;e=e.lineCap;var s=t.getContext();t.setStrokeStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")"),s.lineWidth=c*i,s.beginPath(),s.lineCap=e,s.moveTo(r.x,-r.y),s.lineTo(o.x,-o.y),s.stroke()},_drawPoly:function(t,e,i){var n=e.verts,r=e.lineCap;if(null!=n){var o=e.fillColor,c=e.lineWidth,s=e.lineColor,a=e.isClosePolygon,h=e.isFill;e=e.isStroke;var l=t.getContext(),d=n[0];for(l.lineCap=r,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),c&&(l.lineWidth=c*i),s&&t.setStrokeStyle("rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")"),l.beginPath(),l.moveTo(d.x,-d.y),t=1,i=n.length;t<i;t++)l.lineTo(n[t].x,-n[t].y);a&&l.closePath(),h&&l.fill(),e&&l.stroke()}}}),cc.DrawNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){if(0<(t=this._node)._vertexCount){var e=this._worldTransform;this._matrix.mat[0]=e.a,this._matrix.mat[4]=e.c,this._matrix.mat[12]=e.tx,this._matrix.mat[1]=e.b,this._matrix.mat[5]=e.d,this._matrix.mat[13]=e.ty,cc.glBlendFunc(t._blendFunc.src,t._blendFunc.dst),this._glProgramState.apply(this._matrix),t._render()}},cc.stencilBits=-1,cc.ClippingNode=cc.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(t){t=t||null,cc.Node.prototype.ctor.call(this),(this._stencil=t)&&(this._originStencilProgram=t.getShaderProgram()),this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._stencil&&this._stencil._performRecursive(cc.Node._stateCallbackType.onEnter)},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil&&this._stencil._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil._performRecursive(cc.Node._stateCallbackType.onExit),cc.Node.prototype.onExit.call(this)},visit:function(t){this._renderCmd.clippingVisit(t&&t._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&this.sortAllChildren();for(var t,e=this._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._visible&&t.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(t){1===t&&t!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil(),this._alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&(t&&(this._originStencilProgram=t.getShaderProgram()),this._renderCmd.setStencil(t))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),_p=cc.ClippingNode.prototype,cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil),cc.defineGetterSetter(_p,"alphaThreshold",_p.getAlphaThreshold,_p.setAlphaThreshold),cc.ClippingNode.create=function(t){return new cc.ClippingNode(t)},function(){cc.ClippingNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._clipElemType=this._godhelpme=this._needDraw=!1,this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var t=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ClippingNode.CanvasRenderCmd,t.resetProgramByStencil=function(){},t.initStencilBits=function(){},t.setStencil=function(t){if(null!=t)if(this._node._stencil=t,t instanceof cc.DrawNode){if(t._buffer)for(var e=0;e<t._buffer.length;e++)t._buffer[e].isFill=!1,t._buffer[e].isStroke=!1;t._renderCmd.rendering=function(t,e,i){},t._renderCmd._canUseDirtyRegion=!0,this._rendererSaveCmd._canUseDirtyRegion=!0,this._rendererClipCmd._canUseDirtyRegion=!0,this._rendererRestoreCmd._canUseDirtyRegion=!0}else t._parent=this._node},t._saveCmdCallback=function(t,e,i){var n=t||cc._renderContext;t=n.getContext(),this._clipElemType?(e=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),i=t.canvas,e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0)):(n.save(),n.setTransform(this._worldTransform,e,i),this._node.inverted&&(t.beginPath(),t.rect(0,0,t.canvas.width,-t.canvas.height),t.clip()))},t._setStencilCompositionOperation=function(t){if(t){var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr&&(t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in"),t._children){e=0;for(var i=(t=t._children).length;e<i;e++)this._setStencilCompositionOperation(t[e])}}},t._clipCmdCallback=function(t){var e=this._node;if(t=(t||cc._renderContext).getContext(),this._clipElemType)this._setStencilCompositionOperation(e._stencil);else{if((e=this._node._stencil)instanceof cc.DrawNode){t.beginPath();var i=e._renderCmd._transform;for(t.transform(i.a,i.b,i.c,i.d,i.tx,-i.ty),i=0;i<e._buffer.length;i++){var n=e._buffer[i].verts,r=n[0];for(t.moveTo(r.x,-r.y),r=n.length-1;0<r;r--)t.lineTo(n[r].x,-n[r].y)}}t.clip()}},t._restoreCmdCallback=function(t){var e=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),i=(t=t||cc._renderContext).getContext();this._clipElemType?(i.save(),i.setTransform(1,0,0,1,0,0),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),this._dirtyFlag=0):t.restore()},t.transform=function(t,e){this.originTransform(t,e),(t=this._node)._stencil&&t._stencil._renderCmd&&(t._stencil._renderCmd.transform(this,!0),t._stencil._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty)},t._cangodhelpme=function(t){return!0!==t&&!1!==t||(cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t),cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme},t.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),this._clipElemType=!(!this._cangodhelpme()&&e._stencil instanceof cc.DrawNode),e._stencil&&e._stencil.visible){if(cc.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType?e._visitChildren():e._stencil.visit(e),cc.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)e._stencil.visit(e);else{this._cangodhelpme(!0);var i,n=(t=e._children).length;if(0<n)for(e.sortAllChildren(),i=0;i<n;i++)t[i].visit(e);this._cangodhelpme(!1)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}else this.inverted&&e._visitChildren()},cc.ClippingNode.CanvasRenderCmd._sharedCache=null,cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}}(),function(){cc.ClippingNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._mask_layer_le=this._currentStencilEnabled=null};var t=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),0>=cc.stencilBits&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&(i._stencil._renderCmd.transform(this,!0),i._stencil._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty)},t.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),1>cc.stencilBits)e._visitChildren();else if(e._stencil&&e._stencil.visible)if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits)cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),e._visitChildren();else{if(cc.renderer.pushRenderCommand(this._beforeVisitCmd),e._stencil.visit(e),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd),(t=e._children)&&0<t.length){var i=t.length;e.sortAllChildren();for(var n=0;n<i;n++)t[n].visit(e)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0}else e.inverted&&e._visitChildren()},t.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},t.resetProgramByStencil=function(){var t=this._node;t._stencil&&setProgram(t._stencil,t._originStencilProgram)},t._onBeforeVisit=function(t){var e=t||cc._renderContext;t=this._node,cc.ClippingNode.WebGLRenderCmd._layer++;var i=1<<cc.ClippingNode.WebGLRenderCmd._layer;this._mask_layer_le=i|i-1,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.depthMask(!1),e.stencilFunc(e.NEVER,i,i),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.stencilMask(i),e.clear(e.STENCIL_BUFFER_BIT),1>t.alphaThreshold&&(e=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),cc.glUseProgram(e.getProgram()),e.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,t.alphaThreshold),e.setUniformLocationWithMatrix4fv(cc.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),cc.setProgram(t._stencil,e))},t._onAfterDrawStencil=function(t){(t=t||cc._renderContext).depthMask(!0),t.stencilFunc(this._node.inverted?t.NOTEQUAL:t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},t._onAfterVisit=function(t){if(t=t||cc._renderContext,cc.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled){var e=1<<cc.ClippingNode.WebGLRenderCmd._layer,i=e|e-1;t.stencilMask(e),t.stencilFunc(t.EQUAL,i,i)}else t.disable(t.STENCIL_TEST)}}(),cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null,this.tag=cc.ACTION_TAG_INVALID},copy:function(){return cc.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.target=this.originalTarget=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.action=function(){return new cc.Action},cc.Action.create=cc.action,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Speed.create=cc.speed,cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundaryFullyCovered=this._boundarySet=!1,this._fullScreenSize=this._halfScreenSize=null,this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect;return e=new cc.Rect(e.x,e.y,e.width,e.height),t.initWithTarget(this._followedNode,e),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw Error("cc.Follow.initWithAction(): followedNode must be non nil");return e=e||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=e,this._boundarySet=!cc._rectEqualToZero(e),this._boundaryFullyCovered=!1,t=cc.director.getWinSize(),this._fullScreenSize=cc.p(t.width,t.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(e.x+e.width-this._fullScreenSize.x),this.rightBoundary=-e.x,this.topBoundary=-e.y,this.bottomBoundary=-(e.y+e.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(t){t=this._followedNode.x;var e=this._followedNode.y;t=this._halfScreenSize.x-t,e=this._halfScreenSize.y-e,this.target._renderCmd._dirtyFlag=0,this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(t,this.leftBoundary,this.rightBoundary),cc.clampf(e,this.bottomBoundary,this.topBoundary)):this.target.setPosition(t,e)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)},cc.Follow.create=cc.follow,cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._timesForRepeat=this._speed=1,this._repeatForever=!1,this.MAX_VALUE=2,this._speedMethod=this._repeatMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t,t=1>(t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7))?t:1,this.update(0<t?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return 0>=t?(cc.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||1>t?(cc.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.ActionInterval.create=cc.actionInterval,cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(0<=i&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),0<=i){for(var n=e[0],r=1;r<i;r++)e[r]&&(n=cc.Sequence._actionOneTwo(n,e[r]));this.initWithTwoActions(n,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");return this.initWithDuration(t._duration+e._duration),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e=0,i=this._split,n=this._actions,r=this._last;(t=this._computeEaseTime(t))<i?(t=0!==i?t/i:1,0===e&&1===r&&(n[1].update(0),n[1].stop())):(e=1,t=1===i?1:(t-i)/(1-i),-1===r&&(n[0].startWithTarget(this.target),n[0].update(1),n[0].stop()),r||(n[0].update(1),n[0].stop())),n=n[e],r===e&&n.isDone()||(r!==e&&n.startWithTarget(this.target),t*=n._timesForRepeat,n.update(1<t?t%1:t),this._last=e)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e,i,n,r,o=t instanceof Array?t:arguments;for(0<o.length&&null==o[o.length-1]&&cc.log("parameters should not be ending with null in Javascript");o&&0<o.length;)for(r=(i=Array.prototype.shift.call(o))._timesForRepeat||1,i._repeatMethod=!1,i._timesForRepeat=1,n=0,e||(e=i,n=1);n<r;n++)e=cc.Sequence._actionOneTwo(e,i);return e},cc.Sequence.create=cc.sequence,cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){return!!this.initWithDuration(t._duration*e)&&(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,--this._times),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),this._nextDt=r+=e._duration/i;1<=t&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.Repeat.create=cc.repeat,cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.RepeatForever.create=cc.repeatForever,cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){var e,i,n;if(cc.ActionInterval.prototype.ctor.call(this),this._two=this._one=null,t instanceof Array)i=t;else for(i=Array(arguments.length),e=0;e<arguments.length;++e)i[e]=arguments[e];if(0<=(n=i.length-1)&&null==i[n]&&cc.log("parameters should not be ending with null in Javascript"),0<=n){var r=i[0];for(e=1;e<n;e++)i[e]&&(r=cc.Spawn._actionOneTwo(r,i[e]));this.initWithTwoActions(r,i[n])}},initWithTwoActions:function(t,e){if(!t||!e)throw Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;0<e.length&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn.create=cc.spawn,cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=e||0,this._dstAngleY=void 0!==i?i:this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;180<i&&(i-=360),-180>i&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360,180<(t=this._dstAngleY-this._startAngleY)&&(t-=360),-180>t&&(t+=360),this._diffAngleY=t},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateTo.create=cc.rotateTo,cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=e||0,this._angleY=i||this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.RotateBy.create=cc.rotateBy,cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t;t*=this._positionDelta.y;var i=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var n=this.target.getPositionX(),r=this.target.getPositionY(),o=this._previousPosition;i.x=i.x+n-o.x,i.y=i.y+r-o.y,e+=i.x,t+=i.y,o.x=e,o.y=t,this.target.setPosition(e,t)}else this.target.setPosition(i.x+e,i.y+t)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveBy.create=cc.moveBy,cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.MoveTo.create=cc.moveTo,cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),-180>this._deltaX&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),-180>this._deltaY&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewTo.create=cc.skewTo,cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.SkewBy.create=cc.skewBy,cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1;e=(e=4*this._height*e*(1-e))+this._delta.y*t,t*=this._delta.x;var i=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var n=this.target.getPositionX(),r=this.target.getPositionY(),o=this._previousPosition;i.x=i.x+n-o.x,i.y=i.y+r-o.y,t+=i.x,e+=i.y,o.x=t,o.y=e,this.target.setPosition(t,e)}else this.target.setPosition(i.x+t,i.y+e)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpBy.create=cc.jumpBy,cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.JumpTo.create=cc.jumpTo,cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();t=t.getPositionY(),this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=(r=this._config)[0].y,i=r[1].y,n=r[2].y,r=cc.bezierAt(0,r[0].x,r[1].x,r[2].x,t);if(t=cc.bezierAt(0,e,i,n,t),e=this._startPosition,cc.ENABLE_STACKABLE_ACTIONS){i=this.target.getPositionX(),n=this.target.getPositionY();var o=this._previousPosition;e.x=e.x+i-o.x,e.y=e.y+n-o.y,r+=e.x,t+=e.y,o.x=r,o.y=t,this.target.setPosition(r,t)}else this.target.setPosition(e.x+r,e.y+t)}},reverse:function(){var t=this._config;return t=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],t=new cc.BezierBy(this._duration,t),this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierBy.create=cc.bezierBy,cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t),t=this._startPosition;var e=this._toConfig,i=this._config;i[0]=cc.pSub(e[0],t),i[1]=cc.pSub(e[1],t),i[2]=cc.pSub(e[2],t)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.BezierTo.create=cc.bezierTo,cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleTo.create=cc.scaleTo,cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.ScaleBy.create=cc.scaleBy,cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times;this.target.visible=t%e>e/2}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.visible},stop:function(){this.target.visible=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.Blink.create=cc.blink,cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeTo.create=cc.fadeTo,cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeIn.create=cc.fadeIn,cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.FadeOut.create=cc.fadeOut,cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintTo.create=cc.tintTo,cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),t=t.color,this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.TintBy.create=cc.tintBy,cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.DelayTime.create=cc.delayTime,cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.ReverseTime.create=cc.reverseTime,cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes,n=i.length=0,r=e/t.getTotalDelayUnits();t=t.getFrames(),cc.arrayVerifyType(t,cc.AnimationFrame);for(var o=0;o<t.length;o++){var c=n*r/e;n+=t[o].getDelayUnits(),i.push(c)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.getSpriteFrame()),this._executedLoops=this._nextFrame=0},update:function(t){1>(t=this._computeEaseTime(t))&&((0|(t*=this._animation.getLoops()))>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1);for(var e=this._animation.getFrames(),i=e.length,n=this._splitTimes,r=this._nextFrame;r<i&&n[r]<=t;r++)_currFrameIndex=r,this.target.setSpriteFrame(e[_currFrameIndex].getSpriteFrame()),this._nextFrame=r+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.arrayVerifyType(e,cc.AnimationFrame),0<e.length)for(var n=e.length-1;0<=n;n--){var r=e[n];if(!r)break;i.push(r.clone())}return(e=new cc.Animation(i,t.getDelayPerUnit(),t.getLoops())).setRestoreOriginalFrame(t.getRestoreOriginalFrame()),t=new cc.Animate(e),this._cloneDecoration(t),this._reverseEaseList(t),t},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.Animate.create=cc.animate,cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)},cc.TargetedAction.create=cc.targetedAction,cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Show.create=cc.show,cc.Hide=cc.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.Hide.create=cc.hide,cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.ToggleVisibility.create=cc.toggleVisibility,cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.RemoveSelf.create=cc.removeSelf,cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipX.create=cc.flipX,cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.FlipY.create=cc.flipY,cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._y=this._x=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.Place.create=cc.place,cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)},cc.CallFunc.create=cc.callFunc,cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0)},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.ActionEase.create=cc.actionEase,cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=e,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseRateAction.create=cc.easeRateAction,cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseIn.create=function(t,e){return new cc.EaseIn(t,e)},cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseOut.create=function(t,e){return new cc.EaseOut(t,e)},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){1>(t*=2)?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.EaseInOut.create=function(t,e){return new cc.EaseInOut(t,e)},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return 1>(t*=2)?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialIn.create=function(t){return new cc.EaseExponentialIn(t)},cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:1-Math.pow(2,-10*t))},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialOut.create=function(t){return new cc.EaseExponentialOut(t)},cc._easeExponentialOutObj={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t=1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialInOut.create=function(t){return new cc.EaseExponentialInOut(t)},cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineIn.create=function(t){return new cc.EaseSineIn(t)},cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineOut.create=function(t){return new cc.EaseSineOut(t)},cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc.EaseSineInOut.create=function(t){return new cc.EaseSineInOut(t)},cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElastic.create=function(t,e){return new cc.EaseElastic(t,e)},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){if(0!==t&&1!==t){var e=this._period/4;--t,t=-Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/this._period)}this._inner.update(t)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn.create=function(t,e){return new cc.EaseElasticIn(t,e)},cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){this._inner.update(0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticOut.create=function(t,e){return new cc.EaseElasticOut(t,e)},cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=this._period;if(0!==t&&1!==t){e||(e=this._period=.3*1.5);var i=e/4;t=0>(t=2*t-1)?-.5*Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/e):Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/e)*.5+1}this._inner.update(t)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticInOut.create=function(t,e){return new cc.EaseElasticInOut(t,e)},cc.easeElasticInOut=function(t){return{_period:t||.3,easing:function(t){var e=this._period;if(0!==t&&1!==t){e||(e=this._period=.3*1.5);var i=e/4;t=0>(t=2*t-1)?-.5*Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/e):Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/e)*.5+1}return t},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounce.create=function(t){return new cc.EaseBounce(t)},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){t=1-this.bounceTime(1-t),this._inner.update(t)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceIn.create=function(t){return new cc.EaseBounceIn(t)},cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){t=this.bounceTime(t),this._inner.update(t)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceOut.create=function(t){return new cc.EaseBounceOut(t)},cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){t=.5>t?.5*(1-this.bounceTime(1-2*t)):.5*this.bounceTime(2*t-1)+.5,this._inner.update(t)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc.EaseBounceInOut.create=function(t){return new cc.EaseBounceInOut(t)},cc._easeBounceInOutObj={easing:function(t){return.5>t?.5*(1-cc._bounceTime(1-2*t)):.5*cc._bounceTime(2*t-1)+.5},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t||1===t?t:t*t*(2.70158*t-1.70158))},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackIn.create=function(t){return new cc.EaseBackIn(t)},cc._easeBackInObj={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){--t,this._inner.update(t*t*(2.70158*t+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackOut.create=function(t){return new cc.EaseBackOut(t)},cc._easeBackOutObj={easing:function(t){return--t*t*(2.70158*t+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){1>(t*=2)?this._inner.update(t*t*(3.5949095*t-2.5949095)/2):(t-=2,this._inner.update(t*t*(3.5949095*t+2.5949095)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc.EaseBackInOut.create=function(t){return new cc.EaseBackInOut(t)},cc._easeBackInOutObj={easing:function(t){return 1>(t*=2)?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){t=this._updateTime(this._p0,this._p1,this._p2,this._p3,t),this._inner.update(t)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.EaseBezierAction.create=function(t){return new cc.EaseBezierAction(t)},cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc.EaseQuadraticActionIn.create=function(t){return new cc.EaseQuadraticActionIn(t)},cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc.EaseQuadraticActionOut.create=function(t){return new cc.EaseQuadraticActionOut(t)},cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t=1>(t*=2)?t*t*.5:-.5*(--t*(t-2)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc.EaseQuadraticActionInOut.create=function(t){return new cc.EaseQuadraticActionInOut(t)},cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc.EaseQuarticActionIn.create=function(t){return new cc.EaseQuarticActionIn(t)},cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-(--t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc.EaseQuarticActionOut.create=function(t){return new cc.EaseQuarticActionOut(t)},cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc.EaseQuarticActionInOut.create=function(t){return new cc.EaseQuarticActionInOut(t)},cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc.EaseQuinticActionIn.create=function(t){return new cc.EaseQuinticActionIn(t)},cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return--t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc.EaseQuinticActionOut.create=function(t){return new cc.EaseQuinticActionOut(t)},cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc.EaseQuinticActionInOut.create=function(t){return new cc.EaseQuinticActionInOut(t)},cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc.EaseCircleActionIn.create=function(t){return new cc.EaseCircleActionIn(t)},cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return--t,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc.EaseCircleActionOut.create=function(t){return new cc.EaseCircleActionOut(t)},cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc.EaseCircleActionInOut.create=function(t){return new cc.EaseCircleActionInOut(t)},cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc.EaseCubicActionIn.create=function(t){return new cc.EaseCubicActionIn(t)},cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return--t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc.EaseCubicActionOut.create=function(t){return new cc.EaseCubicActionOut(t)},cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc.EaseCubicActionInOut.create=function(t){return new cc.EaseCubicActionInOut(t)},cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut},cc.cardinalSplineAt=function(t,e,i,n,r,o,c){var s=o*o,a=s*o,h=(1-r)/2;r=h*(2*s-a-o);var l=h*(-a+s)+(2*a-3*s+1);if(o=h*(a-2*s+o)+(-2*a+3*s),a=h*(a-s),s=t.x*r+e.x*l+i.x*o+n.x*a,t=t.y*r+e.y*l+i.y*o+n.y*a,void 0===c)return cc.p(s,t);c.x=s,c.y=t},cc.reverseControlPoints=function(t){for(var e=[],i=t.length-1;0<=i;i--)e.push(cc.p(t[i].x,t[i].y));return e},cc.cloneControlPoints=function(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e},cc.copyControlPoints=cc.cloneControlPoints,cc.getControlPointAt=function(t,e){return t[Math.min(t.length-1,Math.max(e,0))]},cc.reverseControlPointsInline=function(t){for(var e=t.length,i=0|e/2,n=0;n<i;++n){var r=t[n];t[n]=t[e-n-1],t[e-n-1]=r}},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i=this._points;if(1===t)e=i.length-1,t=1;else{var n=this._deltaT;t=(t-n*(e=0|t/n))/n}e=cc.cardinalSplineAt(cc.getControlPointAt(i,e-1),cc.getControlPointAt(i,e-0),cc.getControlPointAt(i,e+1),cc.getControlPointAt(i,e+2),this._tension,t),cc.ENABLE_STACKABLE_ACTIONS&&(i=this.target.getPositionX()-this._previousPosition.x,t=this.target.getPositionY()-this._previousPosition.y,0!==i||0!==t)&&(i=(n=this._accumulatedDiff).x+i,t=n.y+t,n.x=i,n.y=t,e.x+=i,e.y+=t),this.updatePosition(e)},reverse:function(){var t=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineTo.create=cc.cardinalSplineTo,cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],n=1;n<e.length;++n)t=e[n],e[n]=cc.pSub(t,i),i=t;for(i=(e=cc.reverseControlPoints(e))[e.length-1],e.pop(),i.x=-i.x,i.y=-i.y,e.unshift(i),n=1;n<e.length;++n)(t=e[n]).x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,i=e[n]=t;return cc.cardinalSplineBy(this._duration,e,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x;t=t.y+e.y,this._previousPosition.x=i,this._previousPosition.y=t,this.target.setPosition(i,t)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CardinalSplineBy.create=cc.cardinalSplineBy,cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomTo.create=cc.catmullRomTo,cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,cc.copyControlPoints(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)},cc.CatmullRomBy.create=cc.catmullRomBy,cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(t,e){}}),cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this.key="",void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.key=e,this.to=n,this.from=i,!0)},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");cc.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new cc.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}}),cc.actionTween=function(t,e,i,n){return new cc.ActionTween(t,e,i,n)},cc.ActionTween.create=cc.actionTween,cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){cc.Node.prototype.ctor.call(this),this._type=cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},onEnter:function(){this._super(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},cleanup:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData(),this._super()},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=cc.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},setSprite:function(t){this._sprite!==t&&((this._sprite=t)?(this.setContentSize(t.width,t.height),t.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.resetVertexData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=cc.p(.5,.5),this.barChangeRate=cc.p(1,1),this.setSprite(t),this._renderCmd.resetVertexData(),!0},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProgressTimer.CanvasRenderCmd(this):new cc.ProgressTimer.WebGLRenderCmd(this)}}),_p=cc.ProgressTimer.prototype,cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint),cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate),cc.defineGetterSetter(_p,"type",_p.getType,_p.setType),cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage),cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite),cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection),cc.ProgressTimer.create=function(t){return new cc.ProgressTimer(t)},cc.ProgressTimer.TEXTURE_COORDS_COUNT=4,cc.ProgressTimer.TEXTURE_COORDS=75,cc.ProgressTimer.TYPE_RADIAL=0,cc.ProgressTimer.TYPE_BAR=1,cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._from=this._to=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=e,!0)},clone:function(){var t=new cc.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressTo=function(t,e){return new cc.ProgressTo(t,e)},cc.ProgressTo.create=cc.progressTo,cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._from=this._to=0,void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=i,this._from=e,!0)},clone:function(){var t=new cc.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressFromTo=function(t,e,i){return new cc.ProgressFromTo(t,e,i)},cc.ProgressFromTo.create=cc.progressFromTo,function(){cc.ProgressTimer.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=cc.rect(0,0,0,0),this._origin=cc.p(0,0),this._radius=0,this._endAngle=this._startAngle=270,this._counterClockWise=!1,this._canUseDirtyRegion=!0};var t=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ProgressTimer.CanvasRenderCmd,t.rendering=function(t,e,i){var n=(t=t||cc._renderContext).getContext(),r=this._node,o=r._sprite,c=o._renderCmd._textureCoord,s=o._renderCmd._displayedOpacity/255;if(0!==c.width&&0!==c.height&&o._texture&&c.validRect&&0!==s){t.setTransform(this._worldTransform,e,i),t.setCompositeOperation(o._blendFuncStr),t.setGlobalAlpha(s);var a=o._rect,h=o._offsetPosition;e=h.x,i=-h.y-a.height,s=a.width,a=a.height,t.save(),o._flippedX&&(e=-e-s,n.scale(-1,1)),o._flippedY&&(i=h.y,n.scale(1,-1)),r._type===cc.ProgressTimer.TYPE_BAR?(r=this._barRect,n.beginPath(),n.rect(r.x,r.y,r.width,r.height),n.clip(),n.closePath()):r._type===cc.ProgressTimer.TYPE_RADIAL&&(r=this._origin.x,h=this._origin.y,n.beginPath(),n.arc(r,h,this._radius,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),n.lineTo(r,h),n.clip(),n.closePath()),r=(o._renderCmd._textureToRender||o._texture).getHtmlElementObj(),o._renderCmd._colorized?n.drawImage(r,0,0,c.width,c.height,e,i,s,a):n.drawImage(r,c.renderX,c.renderY,c.width,c.height,e,i,s,a),t.restore(),cc.g_NumberOfDraws++}},t.releaseData=function(){},t.resetVertexData=function(){},t._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);var t=this._node,e=t._sprite,i=e.width,n=e.height,r=t._midPoint;if(t._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(i*i+n*n));var o,c=!1,s=this._origin;s.x=i*r.x,s.y=-n*r.y,t._reverseDirection?(o=270,r=270-3.6*t._percentage):(r=-90,o=3.6*t._percentage-90),e._flippedX&&(s.x-=2*i*t._midPoint.x,r=-r-180,o=-o-180,c=!c),e._flippedY&&(s.y+=2*n*t._midPoint.y,c=!c,r=-r,o=-o),this._startAngle=r,this._endAngle=o,this._counterClockWise=c}else c=t._barChangeRate,s=t._percentage/100,t=this._barRect,c=cc.size(i*(1-c.x),n*(1-c.y)),s=cc.size((i-c.width)*s,(n-c.height)*s),c=cc.size(c.width+s.width,c.height+s.height),s=(o=cc.p(i*r.x,n*r.y)).x-c.width/2,.5<r.x&&c.width/2>=i-o.x&&(s=i-c.width),i=o.y-c.height/2,.5<r.y&&c.height/2>=n-o.y&&(i=n-c.height),t.x=0,n=1,e._flippedX&&(t.x-=c.width,n=-1),0<s&&(t.x+=s*n),t.y=0,n=1,e._flippedY&&(t.y+=c.height,n=-1),0<i&&(t.y-=i*n),t.width=c.width,t.height=-c.height},t._syncStatus=function(t){if((n=this._node)._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;(r=t?t._node:null)&&r._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty),this._dirtyFlag=i;var n,r=(o=(n=n._sprite._renderCmd)._dirtyFlag)&e.colorDirty,o=o&e.opacityDirty;r&&(n._syncDisplayColor(),n._dirtyFlag&=~e.colorDirty,this._dirtyFlag&=~e.colorDirty),o&&(n._syncDisplayOpacity(),n._dirtyFlag&=~e.opacityDirty,this._dirtyFlag&=~e.opacityDirty),(r||o)&&n._updateColor(),i&e.transformDirty&&this.transform(t),i&e.orderDirty&&(this._dirtyFlag&=~e.orderDirty)}},t.updateStatus=function(){if((t=this._node)._sprite){var t,e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=(r=(t=t._sprite._renderCmd)._dirtyFlag)&e.colorDirty,r=r&e.opacityDirty;n&&(t._updateDisplayColor(),t._dirtyFlag^=t._dirtyFlag&e.colorDirty,this._dirtyFlag^=this._dirtyFlag&e.colorDirty),r&&(t._updateDisplayOpacity(),t._dirtyFlag^=t._dirtyFlag&e.opacityDirty,this._dirtyFlag^=this._dirtyFlag&e.opacityDirty),(n||r)&&t._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),i&e.contentDirty&&this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag=0}}}(),function(){cc.ProgressTimer.WebGLRenderCmd=function(t){this._rootCtor(t),this._progressDirty=this._needDraw=!0,this._bl=cc.p(),this._tr=cc.p(),this._transformUpdating=!1,this.initCmd()};var t=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ProgressTimer.WebGLRenderCmd,t.transform=function(t,e){this.originTransform(t,e),(n=this._node._sprite)._renderCmd.transform(this,e),t=(e=n._offsetPosition.x)+n._rect.width;var i=n._offsetPosition.y,n=i+n._rect.height,r=this._worldTransform;this._bl.x=e*r.a+i*r.c+r.tx,this._bl.y=e*r.b+i*r.d+r.ty,this._tr.x=t*r.a+n*r.c+r.tx,this._tr.y=t*r.b+n*r.d+r.ty,this._transformUpdating=!0,this._updateProgressData(),this._transformUpdating=!1},t.rendering=function(t){var e=this._node;if(t=t||cc._renderContext,0!==this._vertexDataCount&&e._sprite){this._glProgramState.apply(),this._shaderProgram._updateProjectionUniform();var i=e._sprite._blendFunc;cc.glBlendFunc(i.src,i.dst),cc.glBindTexture2D(e._sprite.texture),t.bindBuffer(t.ARRAY_BUFFER,this._vertexWebGLBuffer),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),this._vertexDataDirty&&(t.bufferSubData(t.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1),i=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT,t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,i,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,i,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,i,16),e._type===cc.ProgressTimer.TYPE_RADIAL?t.drawArrays(t.TRIANGLE_FAN,0,this._vertexDataCount):e._type===cc.ProgressTimer.TYPE_BAR&&(e._reverseDirection?(t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount/2),t.drawArrays(t.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++}},t._syncStatus=function(t){if((n=this._node)._sprite){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;(r=t?t._node:null)&&r._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty),this._dirtyFlag=i;var n,r=(i|(o=(n=n._sprite._renderCmd)._dirtyFlag))&e.colorDirty,o=(i|o)&e.opacityDirty;r&&(n._syncDisplayColor(),n._dirtyFlag&=~e.colorDirty,this._dirtyFlag&=~e.colorDirty),o&&(n._syncDisplayOpacity(),n._dirtyFlag&=~e.opacityDirty,this._dirtyFlag&=~e.opacityDirty),(r||o)&&this._updateColor(),i&e.transformDirty&&this.transform(t),i&e.textureDirty&&(this._updateProgressData(),this._dirtyFlag&=~e.textureDirty),n._dirtyFlag=0}},t.updateStatus=function(){if((t=this._node)._sprite){var t,e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=(i|(r=(t=t._sprite._renderCmd)._dirtyFlag))&e.colorDirty,r=(i|r)&e.opacityDirty;n&&(t._updateDisplayColor(),t._dirtyFlag^=t._dirtyFlag&e.colorDirty,this._dirtyFlag^=this._dirtyFlag&e.colorDirty),r&&(t._updateDisplayOpacity(),t._dirtyFlag^=t._dirtyFlag&e.opacityDirty,this._dirtyFlag^=this._dirtyFlag&e.opacityDirty),(n||r)&&this._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),i&e.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&e.orderDirty),i&e.textureDirty&&(this._updateProgressData(),this._dirtyFlag^=this._dirtyFlag&e.textureDirty)}},t.releaseData=function(){if(this._vertexData){var t=this._vertexWebGLBuffer;setTimeout((function(){cc._renderContext.deleteBuffer(t)}),.1),this._vertexArrayBuffer=this._float32View=this._vertexData=this._vertexWebGLBuffer=null,this._vertexDataCount=0}},t.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=cc._renderContext.createBuffer();var t=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*t),this._float32View=new Float32Array(this._vertexArrayBuffer),this._vertexData=[];for(var e=0;8>e;e++)this._vertexData[e]=new cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*t);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW),this._vertexDataCount=0,this._vertexDataDirty=!0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}},t.resetVertexData=function(){this._vertexDataCount=0},t._updateProgressData=function(){var t=this._node._type;t===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():t===cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},t._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textureDirty)},t._updateBar=function(){if((i=this._node)._sprite){var t=i._percentage/100,e=i._barChangeRate,i=(e=cc.pMult(cc.p(1-e.x+t*e.x,1-e.y+t*e.y),.5),t=cc.pSub(i._midPoint,e),cc.pAdd(i._midPoint,e));0>t.x&&(i.x+=-t.x,t.x=0),1<i.x&&(t.x-=i.x-1,i.x=1),0>t.y&&(i.y+=-t.y,t.y=0),1<i.y&&(t.y-=i.y-1,i.y=1),this._reverseDirection?(e=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(e[0].texCoords,0,1),this._vertexFromAlphaPoint(e[0].vertices,0,1),this._textureCoordFromAlphaPoint(e[1].texCoords,0,0),this._vertexFromAlphaPoint(e[1].vertices,0,0),this._textureCoordFromAlphaPoint(e[6].texCoords,1,1),this._vertexFromAlphaPoint(e[6].vertices,1,1),this._textureCoordFromAlphaPoint(e[7].texCoords,1,0),this._vertexFromAlphaPoint(e[7].vertices,1,0)),this._textureCoordFromAlphaPoint(e[2].texCoords,t.x,i.y),this._vertexFromAlphaPoint(e[2].vertices,t.x,i.y),this._textureCoordFromAlphaPoint(e[3].texCoords,t.x,t.y),this._vertexFromAlphaPoint(e[3].vertices,t.x,t.y),this._textureCoordFromAlphaPoint(e[4].texCoords,i.x,i.y),this._vertexFromAlphaPoint(e[4].vertices,i.x,i.y),this._textureCoordFromAlphaPoint(e[5].texCoords,i.x,t.y),this._vertexFromAlphaPoint(e[5].vertices,i.x,t.y)):(this._vertexDataCount||(this._vertexDataCount=4),e=this._vertexData,this._textureCoordFromAlphaPoint(e[0].texCoords,t.x,i.y),this._vertexFromAlphaPoint(e[0].vertices,t.x,i.y),this._textureCoordFromAlphaPoint(e[1].texCoords,t.x,t.y),this._vertexFromAlphaPoint(e[1].vertices,t.x,t.y),this._textureCoordFromAlphaPoint(e[2].texCoords,i.x,i.y),this._vertexFromAlphaPoint(e[2].vertices,i.x,i.y),this._textureCoordFromAlphaPoint(e[3].texCoords,i.x,t.y),this._vertexFromAlphaPoint(e[3].vertices,i.x,t.y)),this._updateColor()}},t._updateRadial=function(){if((n=this._node)._sprite){var t,e=n._midPoint;t=n._percentage/100;var i=2*cc.PI*(n._reverseDirection?t:1-t),n=cc.p(e.x,1),r=cc.pRotateByAngle(n,e,i);if(i=0,0===t)r=n,i=0;else if(1===t)r=n,i=4;else{var o=cc.FLT_MAX,c=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(t=0;t<=c;++t){var s=(t+(c-1))%c,a=this._boundaryTexCoord(t%c);s=this._boundaryTexCoord(s),0===t?s=cc.pLerp(a,s,1-e.x):4===t&&(a=cc.pLerp(a,s,1-e.x));var h=cc.p(0,0);cc.pLineIntersect(a,s,e,r,h)&&(0!==t&&4!==t||0<=h.x&&1>=h.x)&&0<=h.y&&h.y<o&&(o=h.y,i=t)}r=cc.pAdd(e,cc.pMult(cc.pSub(r,e),o))}if(t=!0,this._vertexDataCount!==i+3&&(t=!1,this._vertexDataCount=i+3),this._updateColor(),o=this._vertexData,this._transformUpdating||!t)for(this._textureCoordFromAlphaPoint(o[0].texCoords,e.x,e.y),this._vertexFromAlphaPoint(o[0].vertices,e.x,e.y),this._textureCoordFromAlphaPoint(o[1].texCoords,n.x,n.y),this._vertexFromAlphaPoint(o[1].vertices,n.x,n.y),t=0;t<i;t++)e=this._boundaryTexCoord(t),this._textureCoordFromAlphaPoint(o[t+2].texCoords,e.x,e.y),this._vertexFromAlphaPoint(o[t+2].vertices,e.x,e.y);this._textureCoordFromAlphaPoint(o[this._vertexDataCount-1].texCoords,r.x,r.y),this._vertexFromAlphaPoint(o[this._vertexDataCount-1].vertices,r.x,r.y)}},t._boundaryTexCoord=function(t){if(t<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var e=cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?cc.p(e>>7-(t<<1)&1,e>>7-(1+(t<<1))&1):cc.p(e>>1+(t<<1)&1,e>>(t<<1)&1)}return cc.p(0,0)},t._textureCoordFromAlphaPoint=function(t,e,i){var n=this._node._sprite;if(n){var r=(o=n._renderCmd._vertices)[1],o=o[2];r=cc.p(r.u,r.v),o=cc.p(o.u,o.v),n.textureRectRotated&&(n=e,e=i,i=n),t.u=r.x*(1-e)+o.x*e,t.v=r.y*(1-i)+o.y*i}else t.u=0,t.v=0},t._vertexFromAlphaPoint=function(t,e,i){t.x=this._bl.x*(1-e)+this._tr.x*e,t.y=this._bl.y*(1-i)+this._tr.y*i,t.z=this._node._vertexZ},t._updateColor=function(){var t=this._node._sprite;if(this._vertexDataCount&&t){var e=this._displayedColor,i=(r=t._renderCmd._displayedColor).r,n=r.g,r=r.b,o=t._renderCmd._displayedOpacity/255;for(t._opacityModifyRGB&&(i*=o,n*=o,r*=o),e.r=i,e.g=n,e.b=r,e.a=t._renderCmd._displayedOpacity,t=this._vertexData,i=0,n=this._vertexDataCount;i<n;++i)t[i].colors=e;this._vertexDataDirty=!0}}}(),cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(t,e){if(e?this._initialString=t:this._string=t,t=this._children)for(var i=0;i<t.length;i++){var n=t[i];n&&n.setVisible(!1)}this._textureLoaded&&(this._string&&0<this._string.length&&this.createFontChars(),e&&this.updateLabel())},ctor:function(t,e,i,n,r){cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=cc.p(0,0),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0,this.initWithString(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB=t,t=this._children)for(var e=0;e<t.length;e++){var i=t[e];i&&(i.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,i,n,r){var o;if(t=t||"",this._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported"),e){if(!(o=cc.loader.getRes(e))&&!(o=cc.FntFrameCache[e]||cc.FntFrameCache[cc.path.basename(e)]))return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;this._config=o,this._fntFile=e,e=o.atlasName,(e=cc.spriteFrameCache.getSpriteFrame(e)||cc.spriteFrameCache.getSpriteFrame(cc.path.basename(e)))?(o=e.getTexture(),this._spriteFrame=e):o=cc.textureCache.addImage(o.atlasName),(this._textureLoaded=e=o.isLoaded())||o.addEventListener("load",(function(t){this._textureLoaded=!0,this.initWithTexture(t,this._initialString.length),this.setString(this._initialString,!0),this.dispatchEvent("load")}),this)}else o=new cc.Texture2D,e=new Image,o.initWithElement(e),this._textureLoaded=!1;return!!this.initWithTexture(o,t.length)&&(this._alignment=n||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=r||cc.p(0,0),this._width=void 0===i?-1:i,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setAnchorPoint(.5,.5),this.setString(t,!0),!0)},createFontChars:function(){var t,e=this._string,i=e?e.length:0,n=this._renderCmd,r=n._texture||this._texture,o=0,c=cc.size(0,0),s=0,a=1,h=this._config,l=h.kerningDict,d=h.commonHeight,u=h.fontDefDictionary;for(t=0;t<i-1;t++)10===e.charCodeAt(t)&&a++;var _,p=d*a,f=(a=-(d-d*a),-1);for(t=0;t<i;t++)if(0!==(d=e.charCodeAt(t)))if(10===d)o=0,a-=h.commonHeight;else{f=l[f<<16|65535&d]||0,(_=u[d])||(cc.log("cocos2d: LabelBMFont: character not found "+e[t]),_={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var g=cc.rect(_.rect.x,_.rect.y,_.rect.width,_.rect.height);(g=cc.rectPixelsToPoints(g)).x+=this._imageOffset.x,g.y+=this._imageOffset.y;var m=!1;if(this._spriteFrame){var T=this._spriteFrame._rect;if(this._spriteFrame._rotated){m=!0;var y=g.x;g.x=g.y+T.x,g.y=y+T.y}else g.x+=T.x,g.y+=T.y}(T=this.getChildByTag(t))?n._updateCharTexture(T,g,d,m):((T=new cc.Sprite).initWithTexture(r,g,m),T._newTextureWhenChangeColor=!0,this.addChild(T,0,t)),T.opacityModifyRGB=this._opacityModifyRGB,n._updateCharColorAndOpacity(T),g=cc.p(o+_.xOffset+.5*_.rect.width+f,a+(h.commonHeight-_.yOffset)-.5*g.height*cc.contentScaleFactor()),T.setPosition(cc.pointPixelsToPoints(g)),o+=_.xAdvance+f,f=d,s<o&&(s=o)}c.width=_&&_.xAdvance<_.rect.width?s-_.xAdvance+_.rect.width:s,c.height=p,this.setContentSize(cc.sizePixelsToPoints(c))},updateString:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];r&&(r.visible=!1)}this._config&&this._string&&0<this._string.length&&this.createFontChars(),t||this.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){void 0===e&&(e=!0),void 0!==(t=String(t))&&"string"==typeof t||(t+=""),this._initialString=t,this._setString(t,e)},_setStringForSetter:function(t){this.setString(t,!1)},setCString:function(t){this.setString(t,!0)},_getCharsWidth:function(t,e){if(0>=e)return 0;var i=this.getChildByTag(t);return t=this.getChildByTag(t+e),this._getLetterPosXLeft(t)-this._getLetterPosXLeft(i)},_checkWarp:function(t,e,i,n){for(var r=t[e],o=0,c=0;c<e;c++)o+=t[c].length;o=o+e-n;var s=this._getCharsWidth(o,t[e].length-1);if(s>i&&1<r.length){n=i/s*r.length|0,c=r.substr(n);for(var a,h=s-this._getCharsWidth(o+n,c.length-1),l=0,d=0;h>i&&100>d++;)n*=i/h,n|=0,c=r.substr(n),h=s-this._getCharsWidth(o+n,c.length-1);for(d=0;h<i&&100>d++;)c&&(l=(a=cc.LabelTTF._wordRex.exec(c))?a[0].length:1,a=c),this._lineBreakWithoutSpaces&&(l=0),n+=l,c=r.substr(n),h=s-this._getCharsWidth(o+n,c.length-1);0==(n-=l)&&(n=1,a=a.substr(1)),i=r.substr(0,n),cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(a||c)&&(l=(o=cc.LabelTTF._lastWordRex.exec(i))?o[0].length:0,this._lineBreakWithoutSpaces&&(l=0),n-=l,a=r.substr(n),i=r.substr(0,n)),cc.LabelTTF._firsrEnglish.test(a)&&(o=cc.LabelTTF._lastEnglish.exec(i))&&i!==o[0]&&(l=o[0].length,this._lineBreakWithoutSpaces&&(l=0),n-=l,a=r.substr(n),i=r.substr(0,n)),t[e]=a||c,t.splice(e,0,i)}},updateLabel:function(){var t,e,i;if(this.string=this._initialString,0<this._width){var n,r=this.string.split("\n"),o="",c=0;for(t=0;t<r.length;t++)n=r.length,this._checkWarp(r,t,this._width*this._scaleX,c),n<r.length&&c++,0<t&&(o+="\n"),o+=r[t];o+=String.fromCharCode(0),this._setString(o,!1)}if(this._alignment!==cc.TEXT_ALIGNMENT_LEFT)for(r=t=0,o=this._string.length,c=[],n=0;n<o;n++)if(10===this._string[n].charCodeAt(0)||0===this._string[n].charCodeAt(0)){var s=c.length;if(0===s)r++;else if(!(0>(i=t+s-1+r))){var a=this.getChildByTag(i);if(null!=a){switch(e=a.getPositionX()+a._getWidth()/2,a=0,this._alignment){case cc.TEXT_ALIGNMENT_CENTER:a=this.width/2-e/2;break;case cc.TEXT_ALIGNMENT_RIGHT:a=this.width-e}if(0!==a)for(e=0;e<s;e++)0>(i=t+e+r)||(i=this.getChildByTag(i))&&(i.x+=a);t+=s,r++,c.length=0}}}else c.push(this._string[t])},setAlignment:function(t){this._alignment=t,this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t,this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t,this.updateLabel()},setScale:function(t,e){cc.Node.prototype.setScale.call(this,t,e),this.updateLabel()},setScaleX:function(t){cc.Node.prototype.setScaleX.call(this,t),this.updateLabel()},setScaleY:function(t){cc.Node.prototype.setScaleY.call(this,t),this.updateLabel()},setFntFile:function(t){if(null!=t&&t!==this._fntFile){var e=cc.loader.getRes(t);e?(this._fntFile=t,this._config=e,t=cc.textureCache.addImage(e.atlasName),(this._textureLoaded=e=t.isLoaded())?(this.setTexture(t),this._string&&0<this._string.length&&this.createFontChars()):t.addEventListener("load",(function(t){this._textureLoaded=!0,this.setTexture(t),this._string&&0<this._string.length&&this.createFontChars(),this._changeTextureColor(),this.updateLabel(),this.dispatchEvent("load")}),this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file")}},getFntFile:function(){return this._fntFile},setTexture:function(t){this._texture=t,this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){cc.Node.prototype.setAnchorPoint.call(this,t,e),this.updateLabel()},_setAnchorX:function(t){cc.Node.prototype._setAnchorX.call(this,t),this.updateLabel()},_setAnchorY:function(t){cc.Node.prototype._setAnchorY.call(this,t),this.updateLabel()},_atlasNameFromFntFile:function(t){},_kerningAmountForFirst:function(t,e){var i=0;return this._configuration.kerningDictionary&&(t=this._configuration.kerningDictionary[(t<<16|65535&e).toString()])&&(i=t.amount),i},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){return 9<=(t=t.charCodeAt(0))&&13>=t||32===t||133===t||160===t||5760===t||8192<=t&&8202>=t||8232===t||8233===t||8239===t||8287===t||12288===t},_utf8_trim_ws:function(t){var e=t.length;if(!(0>=e)&&(--e,this._isspace_unicode(t[e]))){for(var i=e-1;0<=i&&this._isspace_unicode(t[i]);--i)e=i;this._utf8_trim_from(t,e)}},_utf8_trim_from:function(t,e){var i=t.length;e>=i||0>e||t.splice(e,i)}}),function(){var t=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(t),cc.defineGetterSetter(t,"string",t.getString,t._setStringForSetter),cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth),cc.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment),cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture)}(),cc.LabelBMFont.create=function(t,e,i,n,r){return new cc.LabelBMFont(t,e,i,n,r)},cc.FntFrameCache={};var _fntLoader={FNT_HEAD:/fntframes [^\n]*(\n|$)/gi,FNT_FRAME_NAME:/fntframe [^\n]*(\n|$)/gi,INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){var e={};if(t=t.match(this.ITEM_EXP))for(var i=0,n=t.length;i<n;i++){var r,o=(r=t[i]).indexOf("="),c=r.substring(0,o);(r=r.substring(o+1)).match(this.INT_EXP)?r=parseInt(r):'"'===r[0]&&(r=r.substring(1,r.length-1)),e[c]=r}return e},_parseFntContent:function(t,e,i,n){var r=this._parseStrToObj(e.match(this.COMMON_EXP)[0]);if(t.commonHeight=r.lineHeight,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var o=cc.configuration.getMaxTextureSize();(r.scaleW>o.width||r.scaleH>o.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}for(1!==r.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page"),0!==(r=this._parseStrToObj(e.match(this.PAGE_EXP)[0])).id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),t.atlasName=n?cc.path.join(cc.path.dirname(n.path)+r.file):cc.path.changeBasename(i,r.file),r=e.match(this.CHAR_EXP),o=t.fontDefDictionary={},i=0,n=r.length;i<n;i++){var c=this._parseStrToObj(r[i]);o[c.id]={rect:{x:c.x,y:c.y,width:c.width,height:c.height},xOffset:c.xoffset,yOffset:c.yoffset,xAdvance:c.xadvance}}if(r=t.kerningDict={},e=e.match(this.KERNING_EXP))for(i=0,n=e.length;i<n;i++)r[(o=this._parseStrToObj(e[i])).first<<16|65535&o.second]=o.amount;return t},parseFnt:function(t,e){var i={},n=t.match(this.FNT_HEAD);if(n){var r=this._parseStrToObj(n[0]);if(r&&r.count)for(t=(t=t.substr(n[0].length)).split("----"),n=0;n<r.count;++n){var o=t[n],c=o.match(this.FNT_FRAME_NAME);if(c){var s=this._parseStrToObj(c[0]);if(s&&s.name){i={};var a=cc.path.join(cc.path.dirname(e),s.name);cc.FntFrameCache[a]=this._parseFntContent(i,o.substr(c[0].length),e,{path:s.name})}}}}else i=this._parseFntContent(i,t,e);return i},load:function(t,e,i,n){var r=this;cc.loader.loadTxt(t,(function(t,i){if(t)return n(t);n(null,r.parseFnt(i,e))}))}};cc.loader.register(["fnt"],_fntLoader),function(){cc.LabelBMFont.CanvasRenderCmd=function(t){this._rootCtor(t)};var t=cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.LabelBMFont.CanvasRenderCmd,t._updateCharTexture=function(t,e,i){32===i?t.setTextureRect(e,!1,cc.size(0,0)):(t.setTextureRect(e,!1),t.visible=!0)},t._updateCharColorAndOpacity=function(t){t._displayedColor=this._displayedColor,t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),t._displayedOpacity=this._displayedOpacity,t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},t.setTexture=function(t){for(var e=this._node,i=e._children,n=this._displayedColor,r=0;r<i.length;r++){var o=i[r],c=o._renderCmd,s=c._displayedColor;(e._texture===c._texture||s.r===n.r&&s.g===n.g&&s.b===n.b)&&(o.texture=t)}e._texture=t},t._changeTextureColor=function(){var t=this._node,e=t._texture,i=e.getContentSize(),n=t._texture,r=n.getHtmlElementObj(),o=this._displayedColor,c=cc.rect(0,0,r.width,r.height);e&&0<i.width&&r&&(e=n._generateColorTexture(o.r,o.g,o.b,c),t.setTexture(e))},t._updateChildrenDisplayedOpacity=function(t){cc.Node.prototype.updateDisplayedOpacity.call(t,this._displayedOpacity)},t._updateChildrenDisplayedColor=function(t){cc.Node.prototype.updateDisplayedColor.call(t,this._displayedColor)}}(),function(){cc.LabelBMFont.WebGLRenderCmd=function(t){this._rootCtor(t)};var t=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.LabelBMFont.WebGLRenderCmd,t.setTexture=function(t){this._node.setOpacityModifyRGB(this._node._texture.hasPremultipliedAlpha())},t._updateCharTexture=function(t,e,i,n){t.setTextureRect(e,n),t.visible=!0},t._changeTextureColor=function(){},t._updateCharColorAndOpacity=function(){}}(),cc.LabelAtlas=cc.LabelBMFont.extend({_className:"LabelAtlas",ctor:function(t,e,i,n,r){cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=cc.p(0,0),this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0,e&&cc.LabelAtlas.prototype.initWithString.call(this,t,e,i,n,r)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_createFntConfig:function(t,e,i,n){var r={};r.commonHeight=i;var o=r.fontDefDictionary={},c=t.pixelsWidth;t=t.pixelsHeight,n=n.charCodeAt(0);for(var s=0,a=i;a<=t;a+=i)for(var h=0;h<c;h+=e)o[n+s]={rect:{x:h,y:a-i,width:e,height:i},xOffset:0,yOffset:0,xAdvance:e},++s;return r.kerningDict={},r},initWithString:function(t,e,i,n,r){var o;if(this._string=this._initialString=t=t+""||"",void 0===i){if(r=cc.loader.getRes(e),1!==parseInt(r.version,10))return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;o=cc.path.changeBasename(e,r.textureFilename),n=cc.contentScaleFactor(),i=parseInt(r.itemWidth,10)/n,n=parseInt(r.itemHeight,10)/n,r=String.fromCharCode(parseInt(r.firstChar,10))}else o=e,i=i||0,n=n||0,r=r||" ";if(e){this._fntFile="dummy_fnt_file:"+o,e=o;var c=cc.spriteFrameCache.getSpriteFrame(e)||cc.spriteFrameCache.getSpriteFrame(cc.path.basename(e));c?(e=c.getTexture(),this._spriteFrame=c):e=cc.textureCache.addImage(o),(i=this._createFntConfig(e,i,n,r)).atlasName=o,this._config=i,(this._textureLoaded=o=e.isLoaded())||e.addEventListener("load",(function(t){this._textureLoaded=!0,this.initWithTexture(t,this._initialString.length),this.setString(this._initialString,!0),this.dispatchEvent("load")}),this)}else e=new cc.Texture2D,o=new Image,e.initWithElement(o),this._textureLoaded=!1;return!!this.initWithTexture(e,t.length)&&(this._alignment=cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=cc.p(0,0),this._width=-1,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setString(t,!0),!0)},setFntFile:function(){cc.warn("setFntFile doesn't support with LabelAtlas.")}}),cc.LabelAtlas.create=function(t,e,i,n,r){return new cc.LabelAtlas(t,e,i,n,r)},function(){cc.LabelAtlas.CanvasRenderCmd=function(t){cc.AtlasNode.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(cc.AtlasNode.CanvasRenderCmd.prototype);t.constructor=cc.LabelAtlas.CanvasRenderCmd,t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!1},t.updateAtlasValues=function(){for(var t=this._node,e=t._string||"",i=e.length,n=this._textureToRender,r=t._itemWidth,o=t._itemHeight,c=0,s=-1;c<i;c++){var a=e.charCodeAt(c)-t._mapStartChar.charCodeAt(0),h=parseInt(a%t._itemsPerRow,10);if(a=parseInt(a/t._itemsPerRow,10),!(0>h||0>a||(h=cc.rect(h*r,a*o,r,o),a=n._contentSize,0>h.x||0>h.y||h.x+h.width>a.width||h.y+h.height>a.height))){s++,a=e.charCodeAt(c);var l=t.getChildByTag(c);l?32===a?(l.init(),l.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(l.initWithTexture(n,h),l.visible=!0):(l=new cc.Sprite,32===a?(l.init(),l.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):l.initWithTexture(n,h),cc.Node.prototype.addChild.call(t,l,0,c)),l.setPosition(s*r+r/2,o/2)}}this.updateContentSize(c,s+1)},t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height&&i.setContentSize(e*i._itemWidth,i._itemHeight)},t.setString=function(t){if((t=this._node)._children)for(var e=(t=t._children).length,i=0;i<e;i++){var n=t[i];n&&!n._lateChild&&(n.visible=!1)}},t._addChild=function(){child._lateChild=!0}}(),function(){cc.LabelAtlas.WebGLRenderCmd=function(t){cc.AtlasNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(cc.AtlasNode.WebGLRenderCmd.prototype);t.constructor=cc.LabelAtlas.WebGLRenderCmd,t._updateColor=function(){if(this._colorF32Array){var t=this._displayedColor,e=this._displayedOpacity/255;this._node._opacityModifyRGB?(this._colorF32Array[0]=t.r*e/255,this._colorF32Array[1]=t.g*e/255,this._colorF32Array[2]=t.b*e/255):(this._colorF32Array[0]=t.r/255,this._colorF32Array[1]=t.g/255,this._colorF32Array[2]=t.b/255),this._colorF32Array[3]=e}},t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!0},t.rendering=function(t){if(cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,t),cc.LABELATLAS_DEBUG_DRAW){t=(e=this._node).getContentSize();var e,i=(e=e.getBoundingBoxToWorld()).x,n=e.y;t.width=e.width,t.height=e.height,t=[cc.p(i,n),cc.p(i+t.width,n),cc.p(t.width+i,t.height+n),cc.p(i,n+t.height)],cc._drawingUtil.drawPoly(t,4,!0)}},t.updateAtlasValues=function(){var t=this._node,e=t._string,i=e.length,n=this._textureAtlas,r=(o=n.texture).pixelsWidth,o=o.pixelsHeight,c=t._itemWidth,s=t._itemHeight;t._ignoreContentScaleFactor||(c=t._itemWidth*cc.contentScaleFactor(),s=t._itemHeight*cc.contentScaleFactor()),i>n.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var a=n.quads,h=t._itemWidth,l=t._itemHeight,d=0,u=-1;d<i;d++){var _=e.charCodeAt(d)-t._mapStartChar.charCodeAt(0),p=_%t._itemsPerRow,f=0|_/t._itemsPerRow;if(!(0>p||0>f||p*h+h>r||f*l+l>o)){var g;u++,cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(_=(p=(2*p*c+1)/(2*r))+(2*c-2)/(2*r),g=(f=(2*f*s+1)/(2*o))+(2*s-2)/(2*o)):(_=(p=p*c/r)+c/r,g=(f=f*s/o)+s/o);var m=(E=a[d]).tl,T=E.tr,y=E.bl,E=E.br;m.texCoords.u=p,m.texCoords.v=f,T.texCoords.u=_,T.texCoords.v=f,y.texCoords.u=p,y.texCoords.v=g,E.texCoords.u=_,E.texCoords.v=g,y.vertices.x=u*h,y.vertices.y=0,y.vertices.z=0,E.vertices.x=u*h+h,E.vertices.y=0,E.vertices.z=0,m.vertices.x=u*h,m.vertices.y=t._itemHeight,m.vertices.z=0,T.vertices.x=u*h+h,T.vertices.y=t._itemHeight,T.vertices.z=0}}this._updateColor(),this.updateContentSize(d,u+1),0<i&&(n.dirty=!0,i>(t=n.totalQuads)&&n.increaseTotalQuadsWith(i-t))},t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height&&i.setContentSize(e*i._itemWidth,i._itemHeight)},t.setString=function(t){(t=t.length)>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(t)},t._addChild=function(){}}(),cc.Codec={name:"Jacob__Codec"},cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[t])},cc.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,o=[];for(i=0,r=(t=this.unzipBase64(t)).length/e;i<r;i++)for(o[i]=0,n=e-1;0<=n;--n)o[i]+=t.charCodeAt(i*e+n)<<8*n;return o},cc.unzipAsArray=function(t,e){e=e||1;var i,n,r,o=[];for(i=0,r=(t=this.unzip(t)).length/e;i<r;i++)for(o[i]=0,n=e-1;0<=n;--n)o[i]+=t.charCodeAt(i*e+n)<<8*n;return o},cc.StringToArray=function(t){t=t.split(",");var e,i=[];for(e=0;e<t.length;e++)i.push(parseInt(t[e]));return i},cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var e,i,n,r,o,c=[],s=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<t.length;)e=(e=this._keyStr.indexOf(t.charAt(s++)))<<2|(i=this._keyStr.indexOf(t.charAt(s++)))>>4,i=(15&i)<<4|(r=this._keyStr.indexOf(t.charAt(s++)))>>2,n=(3&r)<<6|(o=this._keyStr.indexOf(t.charAt(s++))),c.push(String.fromCharCode(e)),64!==r&&c.push(String.fromCharCode(i)),64!==o&&c.push(String.fromCharCode(n));return c.join("")},cc.Codec.Base64.decodeAsArray=function(t,e){var i,n,r,o=[];for(i=0,r=(t=this.decode(t)).length/e;i<r;i++)for(o[i]=0,n=e-1;0<=n;--n)o[i]+=t.charCodeAt(i*e+n)<<8*n;return o},cc.uint8ArrayToUint32Array=function(t){if(0!=t.length%4)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;n<e;n++){var r=4*n;i[n]=t[r]+256*t[r+1]+65536*t[r+2]+16777216*t[r+3]}return i},cc.PNGReader=cc.Class.extend({ctor:function(t){var e,i,n,r;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){for(e=this.readUInt32(),r=[],t=0;4>t;++t)r.push(String.fromCharCode(this.data[this.pos++]));switch(t=r.join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},t=this.readUInt16(),e=this.readUInt16()||100,n.delay=1e3*t/e,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===t&&(this.pos+=4,e-=4),t=(null!=n?n.data:void 0)||this.imgData,r=0;0<=e?r<e:r>e;0<=e?++r:--r)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),0<(e=255-this.transparency.indexed.length))for(t=0;0<=e?t<e:t>e;0<=e?++t:--t)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":e=(r=this.read(e)).indexOf(0),t=String.fromCharCode.apply(String,r.slice(0,e)),this.text[t]=String.fromCharCode.apply(String,r.slice(e+1));break;case"IEND":n&&this.animation.frames.push(n);t:{switch(this.colorType){case 0:case 3:case 4:n=1;break t;case 2:case 6:n=3;break t}n=void 0}this.colors=n,this.hasAlphaChannel=4===(i=this.colorType)||6===i,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i;t:{switch(this.colors){case 1:i="DeviceGray";break t;case 3:i="DeviceRGB";break t}i=void 0}return this.colorSpace=i,void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(t){var e,i,n,r,o,c,s,a,h,l,d,u,_,p,f;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);for(t=new Zlib.Inflate(t,{index:0,verify:!1}).decompress(),u=(a=this.pixelBitlength/8)*this.width,h=new Uint8Array(u*this.height),c=t.length,i=l=d=0;l<c;){switch(t[l++]){case 0:for(e=0;e<u;e+=1)h[i++]=t[l++];break;case 1:for(r=_=0;_<u;r=_+=1)e=t[l++],o=r<a?0:h[i-a],h[i++]=(e+o)%256;break;case 2:for(r=o=0;o<u;r=o+=1)e=t[l++],n=(r-r%a)/a,_=d&&h[(d-1)*u+n*a+r%a],h[i++]=(_+e)%256;break;case 3:for(r=f=0;f<u;r=f+=1)e=t[l++],n=(r-r%a)/a,o=r<a?0:h[i-a],_=d&&h[(d-1)*u+n*a+r%a],h[i++]=(e+Math.floor((o+_)/2))%256;break;case 4:for(r=f=0;f<u;r=f+=1)e=t[l++],n=(r-r%a)/a,o=r<a?0:h[i-a],0===d?_=p=0:(_=h[(d-1)*u+n*a+r%a],p=n&&h[(d-1)*u+(n-1)*a+r%a]),s=o+_-p,r=Math.abs(s-o),n=Math.abs(s-_),s=Math.abs(s-p),o=r<=n&&r<=s?o:n<=s?_:p,h[i++]=(e+o)%256;break;default:throw Error("Invalid filter algorithm: "+t[l-1])}d++}return h},copyToImageData:function(t,e){var i,n,r,o,c,s,a;if(n=this.colors,a=null,i=this.hasAlphaChannel,this.palette.length&&(a=null!=(r=this._decodedPalette)?r:this._decodedPalette=this.decodePalette(),n=4,i=!0),s=(t=t.data||t).length,o=a||e,r=c=0,1===n)for(;r<s;)n=a?4*e[r/4]:c,c=o[n++],t[r++]=c,t[r++]=c,t[r++]=c,t[r++]=i?o[n++]:255,c=n;else for(;r<s;)n=a?4*e[r/4]:c,t[r++]=o[n++],t[r++]=o[n++],t[r++]=o[n++],t[r++]=i?o[n++]:255,c=n},decodePalette:function(){var t,e,i,n,r,o,c,s,a;for(i=this.palette,o=this.transparency.indexed||[],r=new Uint8Array((o.length||0)+i.length),e=c=t=n=0,s=i.length;c<s;e=c+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(a=o[t++])?a:255;return r},render:function(t){var e;return t.width=this.width,t.height=this.height,e=(t=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}}),cc.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,n){t=[];var r=this.getFieldTypeLength(e);if(4>=r*i)!1===this.littleEndian?t.push(n>>>8*(4-r)):t.push(n);else for(var o=0;o<i;o++){var c=r*o;8<=r?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(t.push(this.getUint32(n+c)),t.push(this.getUint32(n+c+4))):cc.log("Can't handle this field type or size"):t.push(this.getBytes(r,n+c))}return"ASCII"===e&&t.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),t},getBytes:function(t,e){if(0>=t)cc.log("No bytes requested");else{if(1>=t)return this.getUint8(e);if(2>=t)return this.getUint16(e);if(3>=t)return this.getUint32(e)>>>8;if(4>=t)return this.getUint32(e);cc.log("Too many bytes requested")}},getBits:function(t,e,i){i=i||0,e+=Math.floor(i/8);var n,r,o=i+t;return t=32-t,0>=o?console.log("No bits requested"):8>=o?(n=24+i,r=this.getUint8(e)):16>=o?(n=16+i,r=this.getUint16(e)):32>=o?(n=i,r=this.getUint32(e)):console.log("Too many bits requested"),{bits:r<<n>>>t,byteOffset:e+Math.floor(o/8),bitOffset:o%8}},parseFileDirectory:function(t){var e=this.getUint16(t),i=[];t+=2;for(var n=0;n<e;t+=12,n++){var r=this.getUint16(t),o=this.getUint16(t+2),c=this.getUint32(t+4),s=this.getUint32(t+8);r=this.getFieldTagName(r),o=this.getFieldTypeName(o),c=this.getFieldValues(r,o,c,s),i[r]={type:o,values:c}}this._fileDirectories.push(i),0!==(e=this.getUint32(t))&&this.parseFileDirectory(e)},clampColorSample:function(t,e){return e=Math.pow(2,8-e),Math.floor(t*e+(e-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){t=this.getUint32(4),this._fileDirectories.length=0,this.parseFileDirectory(t);var i=this._fileDirectories[0];t=i.ImageWidth.values[0];var n=i.ImageLength.values[0];this.canvas.width=t,this.canvas.height=n;var r=[],o=i.Compression?i.Compression.values[0]:1,c=i.SamplesPerPixel.values[0],s=[],a=0,h=!1;if(i.BitsPerSample.values.forEach((function(t,e,i){s[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},0==t%8&&(s[e].hasBytesPerSample=!0,s[e].bytesPerSample=t/8),a+=t}),this),0==a%8){h=!0;var l=a/8}var d=i.StripOffsets.values,u=d.length;if(i.StripByteCounts)var _=i.StripByteCounts.values;else{if(cc.log("Missing StripByteCounts!"),1!==u)throw Error("Cannot recover from missing StripByteCounts");_=[Math.ceil(t*n*a/8)]}for(var p=0;p<u;p++){var f=d[p];r[p]=[];for(var g=_[p],m=0,T=0,y=1,E=!0,S=[],C=0,v=0,x=0;m<g;m+=y)switch(o){case 1:for(y=0,S=[];y<c;y++){if(!s[y].hasBytesPerSample){var R=this.getBits(s[y].bitsPerSample,f+m,T);throw S.push(R.bits),m=R.byteOffset-f,T=R.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}S.push(this.getBytes(s[y].bytesPerSample,f+m+s[y].bytesPerSample*y))}if(r[p].push(S),!h)throw y=0,RangeError("Cannot handle sub-byte bits per pixel");y=l;break;case 32773:if(E){E=!1;var A=1,I=1;0<=(y=this.getInt8(f+m))&&127>=y?A=y+1:-127<=y&&-1>=y?I=1-y:E=!0}else{var b=this.getUint8(f+m);for(y=0;y<I;y++){if(!s[v].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");x=x<<8*C|b,++C===s[v].bytesPerSample&&(S.push(x),x=C=0,v++),v===c&&(r[p].push(S),S=[],v=0)}0==--A&&(E=!0)}y=1}}if(e.getContext){if((e=this.canvas.getContext("2d")).fillStyle="rgba(255, 255, 255, 0)",p=i.RowsPerStrip?i.RowsPerStrip.values[0]:n,l=r.length,n=0==(n%=p)?p:n,A=p,S=0,I=i.PhotometricInterpretation.values[0],f=[],m=0,i.ExtraSamples&&(m=(f=i.ExtraSamples.values).length),i.ColorMap){R=i.ColorMap.values;var P=Math.pow(2,s[0].bitsPerSample)}for(p=0;p<l;p++){for(p+1===l&&(A=n),i=r[p].length,S*=p,c=o=0;c<i;o++)for(h=0;h<t;h++,c++){if(u=r[p][c],T=g=_=0,d=1,0<m)for(_=0;_<m;_++)if(1===f[_]||2===f[_]){d=u[3+_]/256;break}switch(I){case 0:if(s[0].hasBytesPerSample)var L=Math.pow(16,2*s[0].bytesPerSample);u.forEach((function(t,e,i){i[e]=L-t}));case 1:_=g=T=this.clampColorSample(u[0],s[0].bitsPerSample);break;case 2:_=this.clampColorSample(u[0],s[0].bitsPerSample),g=this.clampColorSample(u[1],s[1].bitsPerSample),T=this.clampColorSample(u[2],s[2].bitsPerSample);break;case 3:if(void 0===R)throw Error("Palette image missing color map");u=u[0],_=this.clampColorSample(R[u],16),g=this.clampColorSample(R[P+u],16),T=this.clampColorSample(R[2*P+u],16);break;default:throw RangeError("Unknown Photometric Interpretation:",I)}e.fillStyle="rgba("+_+", "+g+", "+T+", "+d+")",e.fillRect(h,S+o,1,1)}S=A}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}},cc.Particle=function(t,e,i,n,r,o,c,s,a,h,l,d){this.pos=t||cc.p(0,0),this.startPos=e||cc.p(0,0),this.color=i||{r:0,g:0,b:0,a:255},this.deltaColor=n||{r:0,g:0,b:0,a:255},this.size=r||0,this.deltaSize=o||0,this.rotation=c||0,this.deltaRotation=s||0,this.timeToLive=a||0,this.atlasIndex=h||0,this.modeA=l||new cc.Particle.ModeA,this.modeB=d||new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(t,e,i){this.dir=t||cc.p(0,0),this.radialAccel=e||0,this.tangentialAccel=i||0},cc.Particle.ModeB=function(t,e,i,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=i||0,this.deltaRadius=n||0},cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()],cc.ParticleSystem=cc.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){cc.Node.prototype.ctor.call(this),this.emitterMode=cc.ParticleSystem.MODE_GRAVITY,this.modeA=new cc.ParticleSystem.ModeA,this.modeB=new cc.ParticleSystem.ModeB,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._particles=[],this._sourcePosition=cc.p(0,0),this._posVar=cc.p(0,0),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._endColorVar=cc.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=cc.p(0,0),this._particleIdx=this._emitCounter=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this._totalParticles=this.emissionRate=this.endSpinVar=this.endSpin=this.startSpinVar=this.startSpin=this.endSizeVar=this.endSize=this.startSizeVar=this.startSize=this.angleVar=this.angle=this.lifeVar=this.life=this.duration=this.particleCount=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=cc.ParticleSystem.TYPE_FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||cc.isNumber(t)?(t=t||100,this.setDrawMode(cc.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(t)):cc.isString(t)?this.initWithFile(t):cc.isObject(t)&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ParticleSystem.CanvasRenderCmd(this):new cc.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition.x=t.x,this._sourcePosition.y=t.y},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar.x=t.x,this._posVar.y=t.y},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var t=this.modeA.gravity;return cc.p(t.x,t.y)},setGravity:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity"),this.modeA.gravity=t},getSpeed:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity"),this.modeA.speed=t},getSpeedVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar=t},getTangentialAccel:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir},setRotationIsDir:function(t){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir=t},getStartRadius:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius},setStartRadius:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius=t},getStartRadiusVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar=t},getEndRadius:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius},setEndRadius:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius=t},getEndRadiusVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,cc.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,cc.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.addEventListener("load",(function(t){this._textureLoaded=!0,this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))}),this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):this._blendFunc.src===t&&this._blendFunc.dst===e||(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE||this._blendFunc.src===cc.ONE&&this._blendFunc.dst===cc.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=cc.SRC_ALPHA,e.dst=cc.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){return this._plistFile=t,(t=cc.loader.getRes(t))?this.initWithDictionary(t,""):(cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(t,e){var i=!1;e=this._valueForKey;var n=parseInt(e("maxParticles",t));if(this.initWithTotalParticles(n)){if(this.angle=parseFloat(e("angle",t)),this.angleVar=parseFloat(e("angleVariance",t)),this.duration=parseFloat(e("duration",t)),this._blendFunc.src=parseInt(e("blendFuncSource",t)),this._blendFunc.dst=parseInt(e("blendFuncDestination",t)),(i=this._startColor).r=255*parseFloat(e("startColorRed",t)),i.g=255*parseFloat(e("startColorGreen",t)),i.b=255*parseFloat(e("startColorBlue",t)),i.a=255*parseFloat(e("startColorAlpha",t)),(i=this._startColorVar).r=255*parseFloat(e("startColorVarianceRed",t)),i.g=255*parseFloat(e("startColorVarianceGreen",t)),i.b=255*parseFloat(e("startColorVarianceBlue",t)),i.a=255*parseFloat(e("startColorVarianceAlpha",t)),(i=this._endColor).r=255*parseFloat(e("finishColorRed",t)),i.g=255*parseFloat(e("finishColorGreen",t)),i.b=255*parseFloat(e("finishColorBlue",t)),i.a=255*parseFloat(e("finishColorAlpha",t)),(i=this._endColorVar).r=255*parseFloat(e("finishColorVarianceRed",t)),i.g=255*parseFloat(e("finishColorVarianceGreen",t)),i.b=255*parseFloat(e("finishColorVarianceBlue",t)),i.a=255*parseFloat(e("finishColorVarianceAlpha",t)),this.startSize=parseFloat(e("startParticleSize",t)),this.startSizeVar=parseFloat(e("startParticleSizeVariance",t)),this.endSize=parseFloat(e("finishParticleSize",t)),this.endSizeVar=parseFloat(e("finishParticleSizeVariance",t)),this.setPosition(parseFloat(e("sourcePositionx",t)),parseFloat(e("sourcePositiony",t))),this._posVar.x=parseFloat(e("sourcePositionVariancex",t)),this._posVar.y=parseFloat(e("sourcePositionVariancey",t)),this.startSpin=parseFloat(e("rotationStart",t)),this.startSpinVar=parseFloat(e("rotationStartVariance",t)),this.endSpin=parseFloat(e("rotationEnd",t)),this.endSpinVar=parseFloat(e("rotationEndVariance",t)),this.emitterMode=parseInt(e("emitterType",t)),this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)(i=this.modeA).gravity.x=parseFloat(e("gravityx",t)),i.gravity.y=parseFloat(e("gravityy",t)),i.speed=parseFloat(e("speed",t)),i.speedVar=parseFloat(e("speedVariance",t)),n=e("radialAcceleration",t),i.radialAccel=n?parseFloat(n):0,n=e("radialAccelVariance",t),i.radialAccelVar=n?parseFloat(n):0,n=e("tangentialAcceleration",t),i.tangentialAccel=n?parseFloat(n):0,n=e("tangentialAccelVariance",t),i.tangentialAccelVar=n?parseFloat(n):0,null!==(n=e("rotationIsDir",t))?(n=n.toString().toLowerCase(),i.rotationIsDir="true"===n||"1"===n):i.rotationIsDir=!1;else{if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)return cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;(i=this.modeB).startRadius=parseFloat(e("maxRadius",t)),i.startRadiusVar=parseFloat(e("maxRadiusVariance",t)),i.endRadius=parseFloat(e("minRadius",t)),i.endRadiusVar=0,i.rotatePerSecond=parseFloat(e("rotatePerSecond",t)),i.rotatePerSecondVar=parseFloat(e("rotatePerSecondVariance",t))}if(this.life=parseFloat(e("particleLifespan",t)),this.lifeVar=parseFloat(e("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode)if(this._opacityModifyRGB=!1,i=e("textureFileName",t),i=cc.path.changeBasename(this._plistFile,i),n=cc.textureCache.getTextureForKey(i))this.setTexture(n);else if((t=e("textureImageData",t))&&0!==t.length){if(!(t=cc.unzipBase64AsArray(t,1)))return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;if((e=cc.getImageFormatByData(t))!==cc.FMT_TIFF&&e!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;n=document.createElement("canvas"),e===cc.FMT_PNG?new cc.PNGReader(t).render(n):cc.tiffReader.parseTIFF(t,n),cc.textureCache.cacheImage(i,n),(t=cc.textureCache.getTextureForKey(i))||cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(t)}else{if(!(n=cc.textureCache.addImage(i)))return!1;this.setTexture(n)}i=!0}return i},initWithTotalParticles:function(t){this._totalParticles=t;var e,i=this._particles;for(e=i.length=0;e<t;e++)i[e]=new cc.Particle;if(!i)return cc.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(e=0;e<this._totalParticles;e++)i[e].atlasIndex=e;return this._isActive=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.positionType=cc.ParticleSystem.TYPE_FREE,this.emitterMode=cc.ParticleSystem.MODE_GRAVITY,this._transformSystemDirty=this.autoRemoveOnFinish=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e,i,n=cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*n(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*n(),t.pos.y=this._sourcePosition.y+this._posVar.y*n(),e=this._startColor;var r=this._startColorVar,o=this._endColor;if(i=this._endColorVar,e={r:cc.clampf(e.r+r.r*n(),0,255),g:cc.clampf(e.g+r.g*n(),0,255),b:cc.clampf(e.b+r.b*n(),0,255),a:cc.clampf(e.a+r.a*n(),0,255)},i={r:cc.clampf(o.r+i.r*n(),0,255),g:cc.clampf(o.g+i.g*n(),0,255),b:cc.clampf(o.b+i.b*n(),0,255),a:cc.clampf(o.a+i.a*n(),0,255)},t.color=e,r=t.deltaColor,o=t.timeToLive,r.r=(i.r-e.r)/o,r.g=(i.g-e.g)/o,r.b=(i.b-e.b)/o,r.a=(i.a-e.a)/o,e=this.startSize+this.startSizeVar*n(),e=Math.max(0,e),t.size=e,this.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?t.deltaSize=0:(i=this.endSize+this.endSizeVar*n(),i=Math.max(0,i),t.deltaSize=(i-e)/o),e=this.startSpin+this.startSpinVar*n(),i=this.endSpin+this.endSpinVar*n(),t.rotation=e,t.deltaRotation=(i-e)/o,this.positionType===cc.ParticleSystem.TYPE_FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y),e=cc.degreesToRadians(this.angle+this.angleVar*n()),this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)o=this.modeA,i=t.modeA,r=o.speed+o.speedVar*n(),i.dir.x=Math.cos(e),i.dir.y=Math.sin(e),cc.pMultIn(i.dir,r),i.radialAccel=o.radialAccel+o.radialAccelVar*n(),i.tangentialAccel=o.tangentialAccel+o.tangentialAccelVar*n(),o.rotationIsDir&&(t.rotation=-cc.radiansToDegrees(cc.pToAngle(i.dir)));else{i=this.modeB,t=t.modeB,r=i.startRadius+i.startRadiusVar*n();var c=i.endRadius+i.endRadiusVar*n();t.radius=r,t.deltaRadius=i.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(c-r)/o,t.angle=e,t.degreesPerSecond=cc.degreesToRadians(i.rotatePerSecond+i.rotatePerSecondVar*n())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,-1!==this.duration&&this.duration<this._elapsed&&this.stopSystem()}if(this._particleIdx=0,e=cc.Particle.TemporaryPoints[0],this.positionType===cc.ParticleSystem.TYPE_FREE?cc.pIn(e,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(e.x=this._position.x,e.y=this._position.y),this._visible){for(var i=cc.Particle.TemporaryPoints[1],n=cc.Particle.TemporaryPoints[2],r=cc.Particle.TemporaryPoints[3],o=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(i),cc.pZeroIn(n),cc.pZeroIn(r);var c=o[this._particleIdx];if(c.timeToLive-=t,0<c.timeToLive){if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var s=r,a=i,h=n;c.pos.x||c.pos.y?(cc.pIn(a,c.pos),cc.pNormalizeIn(a)):cc.pZeroIn(a),cc.pIn(h,a),cc.pMultIn(a,c.modeA.radialAccel);var l=h.x;h.x=-h.y,h.y=l,cc.pMultIn(h,c.modeA.tangentialAccel),cc.pIn(s,a),cc.pAddIn(s,h),cc.pAddIn(s,this.modeA.gravity),cc.pMultIn(s,t),cc.pAddIn(c.modeA.dir,s),cc.pIn(s,c.modeA.dir),cc.pMultIn(s,t),cc.pAddIn(c.pos,s)}else(s=c.modeB).angle+=s.degreesPerSecond*t,s.radius+=s.deltaRadius*t,c.pos.x=-Math.cos(s.angle)*s.radius,c.pos.y=-Math.sin(s.angle)*s.radius;this._renderCmd._updateDeltaColor(c,t),c.size+=c.deltaSize*t,c.size=Math.max(0,c.size),c.rotation+=c.deltaRotation*t,s=i,this.positionType===cc.ParticleSystem.TYPE_FREE||this.positionType===cc.ParticleSystem.TYPE_RELATIVE?(a=n,cc.pIn(a,e),cc.pSubIn(a,c.startPos),cc.pIn(s,c.pos),cc.pSubIn(s,a)):cc.pIn(s,c.pos),this._batchNode&&(s.x+=this._position.x,s.y+=this._position.y),this._renderCmd.updateParticlePosition(c,s),++this._particleIdx}else if(c=c.atlasIndex,this._particleIdx!==this.particleCount-1&&(s=o[this._particleIdx],o[this._particleIdx]=o[this.particleCount-1],o[this.particleCount-1]=s),this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+c),o[this.particleCount-1].atlasIndex=c),--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),void this._parent.removeChild(this,!0)}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){return e&&null!=(t=e[t])?t:""},_updateBlendFunc:function(){if(this._batchNode)cc.log("Can't change blending functions when the particle is being batched");else{var t=this._texture;if(t&&t instanceof cc.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=cc.SRC_ALPHA,e.dst=cc.ONE_MINUS_SRC_ALPHA))}}},clone:function(){var t=new cc.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(cc.p(this.x,this.y)),t.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===cc.ParticleSystem.MODE_GRAVITY?(e=this.getGravity(),t.setGravity(cc.p(e.x,e.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())):this.getEmitterMode()===cc.ParticleSystem.MODE_RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar())),t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()&&(t.setOpacityModifyRGB(this.isOpacityModifyRGB()),e=this.getTexture())){var i=e.getContentSize();t.setTextureWithRect(e,cc.rect(0,0,i.width,i.height))}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffsetInPixels();0===e.x&&0===e.y||cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets"),t=t.getTexture(),this._texture!==t&&this.setTexture(t)}},setTextureWithRect:function(t,e){this._texture!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}}),_p=cc.ParticleSystem.prototype,cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB),cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode),cc.defineGetterSetter(_p,"drawMode",_p.getDrawMode,_p.setDrawMode),cc.defineGetterSetter(_p,"shapeType",_p.getShapeType,_p.setShapeType),cc.defineGetterSetter(_p,"active",_p.isActive),cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition),cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar),cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity),cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed),cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar),cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel),cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar),cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel),cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar),cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir),cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius),cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar),cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius),cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar),cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond),cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar),cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor),cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar),cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor),cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar),cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles),cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.ParticleSystem.create=function(t){return new cc.ParticleSystem(t)},cc.ParticleSystem.createWithTotalParticles=cc.ParticleSystem.create,cc.ParticleSystem.ModeA=function(t,e,i,n,r,o,c,s){this.gravity=t||cc.p(0,0),this.speed=e||0,this.speedVar=i||0,this.tangentialAccel=n||0,this.tangentialAccelVar=r||0,this.radialAccel=o||0,this.radialAccelVar=c||0,this.rotationIsDir=s||!1},cc.ParticleSystem.ModeB=function(t,e,i,n,r,o){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=i||0,this.endRadiusVar=n||0,this.rotatePerSecond=r||0,this.rotatePerSecondVar=o||0},cc.ParticleSystem.SHAPE_MODE=0,cc.ParticleSystem.TEXTURE_MODE=1,cc.ParticleSystem.STAR_SHAPE=0,cc.ParticleSystem.BALL_SHAPE=1,cc.ParticleSystem.DURATION_INFINITY=-1,cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,cc.ParticleSystem.MODE_GRAVITY=0,cc.ParticleSystem.MODE_RADIUS=1,cc.ParticleSystem.TYPE_FREE=0,cc.ParticleSystem.TYPE_RELATIVE=1,cc.ParticleSystem.TYPE_GROUPED=2,function(){cc.ParticleSystem.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._drawMode=cc.ParticleSystem.TEXTURE_MODE,this._shapeType=cc.ParticleSystem.BALL_SHAPE,this._pointRect=cc.rect(0,0,0,0),this._tintCache=null};var t=cc.ParticleSystem.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleSystem.CanvasRenderCmd,t.getDrawMode=function(){return this._drawMode},t.setDrawMode=function(t){this._drawMode=t},t.getShapeType=function(){return this._shapeType},t.setShapeType=function(t){this._shapeType=t},t.setBatchNode=function(t){this._batchNode!==t&&(this._node._batchNode=t)},t.updateQuadWithParticle=function(t,e){},t.updateParticlePosition=function(t,e){cc.pIn(t.drawPos,e)},t.rendering=function(t,e,i){var n,r,o=(t=t||cc._renderContext).getContext(),c=this._node,s=this._pointRect;t.setTransform(this._worldTransform,e,i),t.save(),c.isBlendAdditive()?o.globalCompositeOperation="lighter":o.globalCompositeOperation="source-over",i=this._node.particleCount;var a=this._node._particles;if(c.drawMode!==cc.ParticleSystem.SHAPE_MODE&&c._texture){if(!c._texture._textureLoaded)return void t.restore();var h=c._texture.getHtmlElementObj();if(!h.width||!h.height)return void t.restore();for(e=0;e<i;e++)if(0!=(r=(n=a[e]).color.a/255)){o.globalAlpha=r,o.save(),o.translate(0|n.drawPos.x,-(0|n.drawPos.y));var l=4*Math.floor(n.size/4);r=s.width;var d=s.height;o.scale(Math.max(1/r*l,1e-6),Math.max(1/d*l,1e-6)),n.rotation&&o.rotate(cc.degreesToRadians(n.rotation)),n=n.isChangeColor?this._changeTextureColor(c._texture,n.color,this._pointRect):h,o.drawImage(n,-(0|r/2),-(0|d/2)),o.restore()}}else for(h=cc._drawingUtil,e=0;e<i;e++)s=0|.5*(n=a[e]).size,0!=(r=n.color.a/255)&&(o.globalAlpha=r,o.save(),o.translate(0|n.drawPos.x,-(0|n.drawPos.y)),c.shapeType===cc.ParticleSystem.STAR_SHAPE?(n.rotation&&o.rotate(cc.degreesToRadians(n.rotation)),h.drawStar(t,s,n.color)):h.drawColorBall(t,s,n.color),o.restore());t.restore(),cc.g_NumberOfDraws++},t._changeTextureColor=function(t,e,i){this._tintCache||(this._tintCache=document.createElement("canvas"));var n=this._tintCache,r=t.getContentSize();return n.width=r.width,n.height=r.height,t._generateColorTexture(e.r,e.g,e.b,i,n)},t.initTexCoordsWithRect=function(t){this._pointRect=t},t.setTotalParticles=function(t){this._node._totalParticles=200>t?t:200},t.addParticle=function(){var t=this._node,e=t._particles;return t.particleCount<e.length?t=e[t.particleCount]:(t=new cc.Particle,e.push(t)),t},t._setupVBO=function(){},t._allocMemory=function(){return!0},t.postStep=function(){},t._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST},t._initWithTotalParticles=function(t){},t._updateDeltaColor=function(t,e){if(!this._node._dontTint){var i=t.deltaColor;t.color.r+=i.r*e,t.color.g+=i.g*e,t.color.b+=i.b*e,t.color.a+=i.a*e,t.isChangeColor=0!==i.r||0!==i.g||0!==i.b}}}(),function(){cc.ParticleSystem.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=null,this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var t=cc.ParticleSystem.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleSystem.WebGLRenderCmd,t.getDrawMode=function(){},t.setDrawMode=function(t){},t.getShapeType=function(){},t.setShapeType=function(t){},t.setBatchNode=function(t){var e=this._node;if(e._batchNode!==t){var i=e._batchNode;if(e._batchNode=t)for(var n=e._particles,r=0;r<e._totalParticles;r++)n[r].atlasIndex=r;t?i||(e._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,e.atlasIndex),cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(e._totalParticles),e.setTexture(i.getTexture()),this._setupVBO())}},t.initIndices=function(t){for(var e=this._indices,i=0;i<t;++i){var n=6*i,r=4*i;e[n+0]=r+0,e[n+1]=r+1,e[n+2]=r+2,e[n+5]=r+1,e[n+4]=r+2,e[n+3]=r+3}},t.isDifferentTexture=function(t,e){return t===e},t.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)},t.updateQuadWithParticle=function(t,e){var i,n,r,o,c=this._node;c._batchNode?(i=c._batchNode.textureAtlas.quads[c.atlasIndex+t.atlasIndex],c._batchNode.textureAtlas.dirty=!0):i=this._quads[c._particleIdx],c._opacityModifyRGB?(c=0|t.color.r*t.color.a/255,n=0|t.color.g*t.color.a/255,r=0|t.color.b*t.color.a/255):(c=0|t.color.r,n=0|t.color.g,r=0|t.color.b),o=0|t.color.a;var s=i.bl.colors,a=i.br.colors,h=i.tl.colors,l=i.tr.colors;s.r=a.r=h.r=l.r=c,s.g=a.g=h.g=l.g=n,s.b=a.b=h.b=l.b=r,s.a=a.a=h.a=l.a=o,c=t.size/2,t.rotation?(n=-c,r=-c,o=e.x,e=e.y,s=-cc.degreesToRadians(t.rotation),t=Math.cos(s),s=Math.sin(s),i.bl.vertices.x=n*t-r*s+o,i.bl.vertices.y=n*s+r*t+e,i.br.vertices.x=c*t-r*s+o,i.br.vertices.y=c*s+r*t+e,i.tl.vertices.x=n*t-c*s+o,i.tl.vertices.y=n*s+c*t+e,i.tr.vertices.x=c*t-c*s+o,i.tr.vertices.y=c*s+c*t+e):(i.bl.vertices.x=e.x-c,i.bl.vertices.y=e.y-c,i.br.vertices.x=e.x+c,i.br.vertices.y=e.y-c,i.tl.vertices.x=e.x-c,i.tl.vertices.y=e.y+c,i.tr.vertices.x=e.x+c,i.tr.vertices.y=e.y+c)},t.rendering=function(t){var e=this._node;if(e._texture){t=t||cc._renderContext,this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._glProgramState.apply(this._matrix),cc.glBindTexture2D(e._texture),cc.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.drawElements(t.TRIANGLES,6*e._particleIdx,t.UNSIGNED_SHORT,0)}},t.initTexCoordsWithRect=function(t){var e,i=this._node,n=i.texture,r=cc.contentScaleFactor(),o=cc.rect(t.x*r,t.y*r,t.width*r,t.height*r),c=(r=t.width,t.height);for(n&&(r=n.pixelsWidth,c=n.pixelsHeight),cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(n=(2*o.x+1)/(2*r),t=(2*o.y+1)/(2*c),r=n+(2*o.width-2)/(2*r),o=t+(2*o.height-2)/(2*c)):(n=o.x/r,t=o.y/c,r=n+o.width/r,o=t+o.height/c),c=o,o=t,t=c,i._batchNode?(c=i._batchNode.textureAtlas.quads,e=i.atlasIndex,i=i.atlasIndex+i._totalParticles):(c=this._quads,e=0,i=i._totalParticles);e<i;e++){c[e]||(c[e]=cc.V3F_C4B_T2F_QuadZero());var s=c[e];s.bl.texCoords.u=n,s.bl.texCoords.v=t,s.br.texCoords.u=r,s.br.texCoords.v=t,s.tl.texCoords.u=n,s.tl.texCoords.v=o,s.tr.texCoords.u=r,s.tr.texCoords.v=o}},t.setTotalParticles=function(t){var e=this._node;if(t>e._allocatedParticles){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var n=new ArrayBuffer(t*i),r=e._particles;r.length=0;for(var o=this._quads,c=o.length=0;c<t;c++)r[c]=new cc.Particle,o[c]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,c*i);if(e._allocatedParticles=t,e._totalParticles=t,e._batchNode)for(i=0;i<t;i++)r[i].atlasIndex=i;this._quadsArrayBuffer=n,this.initIndices(t),this._setupVBO(),e._texture&&this.initTexCoordsWithRect(cc.rect(0,0,e._texture.width,e._texture.height))}else e._totalParticles=t;e.resetSystem()},t.addParticle=function(){var t=this._node;return t._particles[t.particleCount]},t._setupVBO=function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},t._allocMemory=function(){if((e=this._node)._batchNode)return cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=e._totalParticles,i=this._quads;i.length=0,this._indices=new Uint16Array(6*e);for(var n=new ArrayBuffer(t*e),r=0;r<e;r++)i[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,r*t);return i&&this._indices?(this._quadsArrayBuffer=n,!0):(cc.log("cocos2d: Particle system: not enough memory"),!1)},t.postStep=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferSubData(t.ARRAY_BUFFER,0,this._quadsArrayBuffer)},t._setBlendAdditive=function(){var t=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=cc.SRC_ALPHA,t.dst=cc.ONE_MINUS_SRC_ALPHA):(t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST)},t._initWithTotalParticles=function(t){if(!this._allocMemory())return!1;this.initIndices(t),this._setupVBO(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},t._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0}}(),cc.ParticleFire=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10),t=cc.director.getWinSize(),this.setPosition(t.width/2,60),this.setPosVar(cc.p(40,20)),this.setLife(3),this.setLifeVar(.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0)}}),cc.ParticleFire.create=function(){return new cc.ParticleFire},cc.ParticleFireworks=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,255)),this.setEndColor(cc.color(26,26,26,51)),this.setEndColorVar(cc.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0)}}),cc.ParticleFireworks.create=function(){return new cc.ParticleFireworks},cc.ParticleSun=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setBlendAdditive(!0),this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(1),this.setLifeVar(.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),!0)}}),cc.ParticleSun.create=function(){return new cc.ParticleSun},cc.ParticleGalaxy=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(31,64,194,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0)}}),cc.ParticleGalaxy.create=function(){return new cc.ParticleGalaxy},cc.ParticleFlower=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,128)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0)}}),cc.ParticleFlower.create=function(){return new cc.ParticleFlower},cc.ParticleMeteor=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(51,102,179)),this.setStartColorVar(cc.color(0,0,51,26)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0)}}),cc.ParticleMeteor.create=function(){return new cc.ParticleMeteor},cc.ParticleSpiral=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,255)),this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0)}}),cc.ParticleSpiral.create=function(){return new cc.ParticleSpiral},cc.ParticleExplosion=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(.1),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(cc.color(179,26,51,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,0)),this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0)}}),cc.ParticleExplosion.create=function(){return new cc.ParticleExplosion},cc.ParticleSmoke=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5),t=cc.director.getWinSize(),this.setPosition(t.width/2,0),this.setPosVar(cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(204,204,204,255)),this.setStartColorVar(cc.color(5,5,5,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0)}}),cc.ParticleSmoke.create=function(){return new cc.ParticleSmoke},cc.ParticleSnow=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height+10),this.setPosVar(cc.p(t.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(cc.color(255,255,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(255,255,255,0)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0)}}),cc.ParticleSnow.create=function(){return new cc.ParticleSnow},cc.ParticleRain=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1e3:300)},initWithTotalParticles:function(t){return!!cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)&&(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5),t=cc.director.getWinSize(),this.setPosition(t.width/2,t.height),this.setPosVar(cc.p(t.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(cc.color(179,204,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(179,204,255,128)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0)}}),cc.ParticleRain.create=function(){return new cc.ParticleRain},cc.PARTICLE_DEFAULT_CAPACITY=500,cc.ParticleBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},cc.isString(t)?this.init(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ParticleBatchNode.CanvasRenderCmd(this):new cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){return this.textureAtlas=new cc.TextureAtlas,this.textureAtlas.initWithTexture(t,e),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,e){return t=cc.textureCache.addImage(t),this.initWithTexture(t,e)},init:function(t,e){return t=cc.textureCache.addImage(t),this.initWithTexture(t,e)},visit:function(t){var e=this._renderCmd;t=t?t._renderCmd:null,this._visible?(e.visit(t),cc.renderer.pushRenderCommand(e),e._dirtyFlag=0):e._propagateFlagsDown(t)},addChild:function(t,e,i){if(!t)throw Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children");if(e=null==e?t.zIndex:e,i=null==i?t.tag:i,t.getTexture()!==this.textureAtlas.texture)throw Error("cc.ParticleSystem.addChild() : the child is not using the same texture id");var n=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(n);else if(n.src!==this._blendFunc.src||n.dst!==this._blendFunc.dst)return void cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");e=0!==(e=this._addChildHelper(t,e,i))?(e=this._children[e-1]).getAtlasIndex()+e.getTotalParticles():0,this.insertChild(t,e),t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles(),n=this.textureAtlas,r=n.totalQuads;t.setAtlasIndex(e),r+i>n.getCapacity()&&(this._increaseAtlasCapacityTo(r+i),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i)),t.getAtlasIndex()+i!==r&&n.moveQuadsFromIndex(e,e+i),n.increaseTotalQuadsWith(i),this._updateAllAtlasIndexes()},removeChild:function(t,e){if(null!=t){if(!(t instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children");-1===this._children.indexOf(t)?cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it"):(cc.Node.prototype.removeChild.call(this,t,e),(e=this.textureAtlas).removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),e.fillWithEmptyQuadsFromIndex(e.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes())}},reorderChild:function(t,e){if(!t)throw Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(-1===this._children.indexOf(t))cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");else{if(1<this._children.length){var i=this._getCurrentIndex(t,e);if(i.oldIndex!==i.newIndex){this._children.splice(i.oldIndex,1),this._children.splice(i.newIndex,0,t),i=t.getAtlasIndex(),this._updateAllAtlasIndexes();for(var n=0,r=this._children,o=0;o<r.length;o++)if(r[o]===t){n=t.getAtlasIndex();break}this.textureAtlas.moveQuadsFromIndex(i,t.getTotalParticles(),n),t.updateWithNoTime()}}t._setLocalZOrder(e)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,i=0;i<e.length;i++)e[i].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){(t=this.textureAtlas.quads[t]).br.vertices.x=t.br.vertices.y=t.tr.vertices.x=t.tr.vertices.y=t.tl.vertices.x=t.tl.vertices.y=t.bl.vertices.x=t.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST&&(e.src=cc.SRC_ALPHA,e.dst=cc.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=e)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),this.textureAtlas.resizeCapacity(t)||cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,i=e.length,n=0;n<i;n++)if(e[n].zIndex>t)return n;return i},_getCurrentIndex:function(t,e){for(var i=!1,n=!1,r=0,o=0,c=0,s=this._children,a=s.length,h=0;h<a;h++){var l=s[h];if(l.zIndex>e&&!n&&(r=h,n=!0,i&&n))break;if(t===l&&(o=h,n||(c=-1),(i=!0)&&n))break}return n||(r=a),{newIndex:r+c,oldIndex:o}},_addChildHelper:function(t,e,i){if(!t)throw Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var n=this._searchNewPositionInChildrenForZ(e);return this._children.splice(n,0,t),t.tag=i,t._setLocalZOrder(e),t.parent=this,this._running&&(t._performRecursive(cc.Node._stateCallbackType.onEnter),t._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)),n},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}}),_p=cc.ParticleBatchNode.prototype,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.ParticleBatchNode.create=function(t,e){return new cc.ParticleBatchNode(t,e)},function(){cc.ParticleBatchNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1};var t=cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.CanvasRenderCmd,t._initWithTexture=function(){}}(),function(){cc.ParticleBatchNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()};var t=cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.WebGLRenderCmd,t.rendering=function(t){if(0!==(t=this._node).textureAtlas.totalQuads){var e=this._worldTransform;this._matrix.mat[0]=e.a,this._matrix.mat[4]=e.c,this._matrix.mat[12]=e.tx,this._matrix.mat[1]=e.b,this._matrix.mat[5]=e.d,this._matrix.mat[13]=e.ty,this._glProgramState.apply(this._matrix),cc.glBlendFuncForParticle(t._blendFunc.src,t._blendFunc.dst),t.textureAtlas.drawQuads()}},t._initWithTexture=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)}}(),function(){var t=cc.sys,e={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1,ONE_SOURCE:!1};t.browserType===t.BROWSER_TYPE_FIREFOX&&(e.DELAY_CREATE_CTX=!0,e.USE_LOADER_EVENT="canplay"),t.os===t.OS_IOS&&(e.USE_LOADER_EVENT="loadedmetadata"),t.os===t.OS_ANDROID&&t.browserType===t.BROWSER_TYPE_UC&&(e.ONE_SOURCE=!0),window.__audioSupport=e}(),cc.Audio=cc.Class.extend({interruptPlay:!1,src:null,_element:null,_AUDIO_TYPE:"AUDIO",ctor:function(t){this.src=t},setBuffer:function(t){this._AUDIO_TYPE="WEBAUDIO",this._element=new cc.Audio.WebAudio(t)},setElement:function(t){this._AUDIO_TYPE="AUDIO",this._element=t,t.addEventListener("ended",(function(){t.loop||(t.paused=!0)}))},play:function(t,e){this._element?(this._element.loop=e,this._element.play(),"AUDIO"===this._AUDIO_TYPE&&this._element.paused&&(this.stop(),cc.Audio.touchPlayList.push({loop:e,offset:t,audio:this._element})),!1===cc.Audio.bindTouch&&(cc.Audio.bindTouch=!0,cc.game.canvas.addEventListener("touchstart",cc.Audio.touchStart))):this.interruptPlay=!1},getPlaying:function(){return!this._element||!this._element.paused},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}}else this.interruptPlay=!0},pause:function(){this._element?this._element.pause():this.interruptPlay=!0},resume:function(){this._element?this._element.play():this.interruptPlay=!1},setVolume:function(t){this._element&&(this._element.volume=t)},getVolume:function(){if(this._element)return this._element.volume},cloneNode:function(){var t=new cc.Audio(this.src);if("AUDIO"===this._AUDIO_TYPE){for(var e=document.createElement("audio"),i=e.getElementsByTagName("source"),n=0;n<i.length;n++)e.appendChild(i[n]);e.src=this.src,t.setElement(e)}else t.setBuffer(this._element.buffer);return t}}),cc.Audio.touchPlayList=[],cc.Audio.bindTouch=!1,cc.Audio.touchStart=function(){for(var t,e=cc.Audio.touchPlayList;t=e.pop();)t.audio.loop=!!t.loop,t.audio.play(t.offset)},cc.Audio.WebAudio=function(t){this.buffer=t,this.context=cc.Audio._context,(t=this.context.createGain()).gain.value=1,t.connect(this.context.destination),this._volume=t,this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null},cc.Audio.WebAudio.prototype={constructor:cc.Audio.WebAudio,get paused(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this.context.currentTime-this._startTime>this.buffer.duration)},set paused(t){},get loop(){return this._loop},set loop(t){return this._loop=t},get volume(){return this._volume.gain.value},set volume(t){return this._volume.gain.value=t},get currentTime(){return this.playedLength},set currentTime(t){return this.playedLength=t},play:function(t){this._currentSource&&!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var e=this.context.createBufferSource();e.buffer=this.buffer,e.connect(this._volume),e.loop=this._loop,this._startTime=this.context.currentTime,t=t||this.playedLength;var i=this.buffer.duration;if(this._loop?e.start?e.start(0):e.notoGrainOn?e.noteGrainOn(0):e.noteOn(0):e.start?e.start(0,t,i-t):e.notoGrainOn?e.noteGrainOn(0,t,i-t):e.noteOn(0,t,i-t),this._currentSource=e,0===this.context.currentTime){var n=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout((function(){0===n.context.currentTime&&cc.Audio.touchPlayList.push({offset:t,audio:n})}),10)}},pause:function(){this.playedLength=this.context.currentTime-this._startTime,this.playedLength%=this.buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},function(t){var e=t.WEB_AUDIO,i=t.ONLY_ONE,n=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');e&&""!==e&&n.push(".ogg"),(e=t.canPlayType("audio/mpeg"))&&""!==e&&n.push(".mp3"),(e=t.canPlayType('audio/wav; codecs="1"'))&&""!==e&&n.push(".wav"),(e=t.canPlayType("audio/mp4"))&&""!==e&&n.push(".mp4"),(t=t.canPlayType("audio/x-m4a"))&&""!==t&&n.push(".m4a")}}();try{if(e){var r=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);if(cc.Audio._context=r,!(r.createBufferSource&&r.createGain&&r.destination&&r.decodeAudioData))throw"context is incomplete";t.DELAY_CREATE_CTX&&setTimeout((function(){r=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),cc.Audio._context=r}),0)}}catch(t){e=!1,cc.log("browser don't support web audio")}var o={cache:{},useWebAudio:!0,loadBuffer:function(t,i){if(e){var n=cc.loader.getXMLHttpRequest();n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){0<=n._timeoutId&&clearTimeout(n._timeoutId),r.decodeAudioData(n.response,(function(t){i(null,t)}),(function(){i("decode error - "+t)}))},n.onerror=function(){i("request error - "+t)},void 0===n.ontimeout&&(n._timeoutId=setTimeout((function(){n.ontimeout()}),n.timeout)),n.ontimeout=function(){i("request timeout - "+t)},n.send()}},load:function(t,e,i,r){if(0===n.length)return r("can not support audio!");var o=cc.loader.getRes(e);if(o)return r(null,o);cc.loader.audioPath&&(t=cc.path.join(cc.loader.audioPath,t)),i=[o=cc.path.extname(t)];for(var c=0;c<n.length;c++)o!==n[c]&&i.push(n[c]);return o=new cc.Audio(t),cc.loader.cache[e]=o,this.loadAudioFromExtList(t,i,o,r),o},loadAudioFromExtList:function(i,r,o,c){if(0===r.length){var s=(s="can not found the resource of audio! Last match url is : ")+i.replace(/\.(.*)?$/,"(");return n.forEach((function(t){s+=t+"|"})),s=s.replace(/\|$/,")"),c({status:520,errorMessage:s},null)}if(e&&this.useWebAudio)this.loadBuffer(i,(function(t,e){t&&cc.log(t),e&&o.setBuffer(e),c(null,o)}));else{for(var a=t.ONE_SOURCE?1:r.length,h=document.createElement("audio"),l=0;l<a;l++){var d=document.createElement("source");d.src=cc.path.changeExtname(i,r[l]),h.appendChild(d)}o.setElement(h);var u=setTimeout((function(){0===h.readyState?p():_()}),8e3),_=function(){h.removeEventListener("canplaythrough",_,!1),h.removeEventListener("error",p,!1),h.removeEventListener("emptied",_,!1),t.USE_LOADER_EVENT&&h.removeEventListener(t.USE_LOADER_EVENT,_,!1),clearTimeout(u),c(null,o)},p=function(){cc.log("load audio failure - "+i),_()};h.addEventListener("canplaythrough",_,!1),h.addEventListener("error",p,!1),t.USE_LOADER_EVENT&&h.addEventListener(t.USE_LOADER_EVENT,_,!1)}}};cc.loader.register(["mp3","ogg","wav","mp4","m4a"],o),cc.audioEngine={_currMusic:null,_musicVolume:1,features:t,willPlayMusic:function(){return!1},playMusic:function(t,e){var i=this._currMusic;i&&i.getPlaying()&&i.stop();var n=this._musicVolume,r=cc.loader.getRes(t);r||(cc.loader.load(t,(function(){r.getPlaying()||r.interruptPlay||(r.setVolume(n),r.play(0,e||!1))})),r=cc.loader.getRes(t)),r.setVolume(n),r.play(0,e||!1),this._currMusic=r},stopMusic:function(t){var e=this._currMusic;if(e){for(var i=cc.Audio.touchPlayList,n=i.length-1;0<=n;--n)this[n]&&this[n].audio===e._element&&i.splice(n,1);e.stop(),this._currMusic=null,t&&cc.loader.release(e.src)}},pauseMusic:function(){var t=this._currMusic;t&&t.pause()},resumeMusic:function(){var t=this._currMusic;t&&t.resume()},rewindMusic:function(){var t=this._currMusic;t&&(t.stop(),t.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t-=0,isNaN(t)&&(t=1),1<t&&(t=1),0>t&&(t=0),this._musicVolume=t;var e=this._currMusic;e&&e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;return!!t&&t.getPlaying()},_audioPool:{},_maxAudioInstance:10,_effectVolume:1,playEffect:function(t,n){if(i&&this._currMusic&&this._currMusic.getPlaying())return cc.log("Browser is only allowed to play one audio"),null;var r,c=this._audioPool[t];c||(c=this._audioPool[t]=[]);for(var s=0;s<c.length&&c[s].getPlaying();s++);if(!e&&s>this._maxAudioInstance&&((s=c.shift()).stop(),c.push(s),s=c.length-1),c[s])return(r=c[s]).setVolume(this._effectVolume),r.play(0,n||!1),r;if((r=cc.loader.getRes(t))&&e&&"AUDIO"===r._AUDIO_TYPE&&(cc.loader.release(t),r=null),r){if(!e||"AUDIO"!==r._AUDIO_TYPE)return(r=r.cloneNode()).setVolume(this._effectVolume),r.play(0,n||!1),c.push(r),r;o.loadBuffer(t,(function(t,e){r.setBuffer(e),r.setVolume(cc.audioEngine._effectVolume),r.getPlaying()||r.play(0,n||!1)}))}return s=o.useWebAudio,o.useWebAudio=!0,cc.loader.load(t,(function(e){(e=(e=cc.loader.getRes(t)).cloneNode()).setVolume(cc.audioEngine._effectVolume),e.play(0,n||!1),c.push(e)})),o.useWebAudio=s,r},setEffectsVolume:function(t){t-=0,isNaN(t)&&(t=1),1<t&&(t=1),0>t&&(t=0),this._effectVolume=t;var e,i=this._audioPool;for(e in i){var n=i[e];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){t&&t.pause()},pauseAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].getPlaying()&&i[n].pause()},resumeEffect:function(t){t&&t.resume()},resumeAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].resume()},stopEffect:function(t){t&&t.stop()},stopAllEffects:function(){var t,e=this._audioPool;for(t in e){for(var i=e[t],n=0;n<i.length;n++)i[n].stop();i.length=0}e.length=0},unloadEffect:function(t){if(t){cc.loader.release(t);var e=this._audioPool[t];if(e){for(var i=0;i<e.length;i++)e[i].stop();e.length=0}delete this._audioPool[t]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){(e=this._currMusic)&&e.getPlaying()&&(e.pause(),this._pauseCache.push(e));var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].getPlaying()&&(i[n].pause(),this._pauseCache.push(i[n]))},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}}}(window.__audioSupport),cc.CONTROL_EVENT_TOTAL_NUMBER=9,cc.CONTROL_EVENT_TOUCH_DOWN=1,cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=2,cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=4,cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=8,cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=16,cc.CONTROL_EVENT_TOUCH_UP_INSIDE=32,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=64,cc.CONTROL_EVENT_TOUCH_CANCEL=128,cc.CONTROL_EVENT_VALUECHANGED=256,cc.CONTROL_STATE_NORMAL=1,cc.CONTROL_STATE_HIGHLIGHTED=2,cc.CONTROL_STATE_DISABLED=4,cc.CONTROL_STATE_SELECTED=8,cc.CONTROL_STATE_INITIAL=8,cc.Control=cc.Layer.extend({_isOpacityModifyRGB:!1,_hasVisibleParents:!1,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(t){this._isOpacityModifyRGB=t;for(var e=this.getChildren(),i=0,n=e.length;i<n;i++){var r=e[i];r&&r.setOpacityModifyRGB(t)}},_state:cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:!1,_selected:!1,_highlighted:!1,_dispatchTable:null,setEnabled:function(t){this._state=(this._enabled=t)?cc.CONTROL_STATE_NORMAL:cc.CONTROL_STATE_DISABLED,this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(t){this._selected=t,this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(t){this._highlighted=t,this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){for(var t=this.getParent();null!=t;t=t.getParent())if(!t.isVisible())return!1;return!0},ctor:function(){cc.Layer.prototype.ctor.call(this),this._dispatchTable={},this._color=cc.color.WHITE},init:function(){this._state=cc.CONTROL_STATE_NORMAL,this._enabled=!0,this._highlighted=this._selected=!1;var t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0});return this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,!0},onEnter:function(){var t=this._touchListener;t._isRegistered()||cc.eventManager.addListener(t,this),cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(t){for(var e=0,i=cc.CONTROL_EVENT_TOTAL_NUMBER;e<i;e++)if(t&1<<e)for(var n=this._dispatchListforControlEvent(1<<e),r=0,o=n.length;r<o;r++)n[r].invoke(this)},addTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++)i&1<<n&&this._addTargetWithActionForControlEvent(t,e,1<<n)},removeTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++)i&1<<n&&this._removeTargetWithActionForControlEvent(t,e,1<<n)},getTouchLocation:function(t){return t=t.getLocation(),this.convertToNodeSpace(t)},isTouchInside:function(t){return t=t.getLocation(),t=this.getParent().convertToNodeSpace(t),cc.rectContainsPoint(this.getBoundingBox(),t)},_invocationWithTargetAndActionForControlEvent:function(t,e,i){return null},_dispatchListforControlEvent:function(t){return t=t.toString(),this._dispatchTable[t]||(this._dispatchTable[t]=[]),this._dispatchTable[t]},_addTargetWithActionForControlEvent:function(t,e,i){t=new cc.Invocation(t,e,i),this._dispatchListforControlEvent(i).push(t)},_removeTargetWithActionForControlEvent:function(t,e,i){if(i=this._dispatchListforControlEvent(i),t||e)for(var n=0;n<i.length;){var r=i[n],o=!0;t&&(o=t===r.getTarget()),e&&(o=o&&e===r.getAction()),o?cc.arrayRemoveObject(i,r):n++}else i.length=0},needsLayout:function(){}}),_p=cc.Control.prototype,cc.defineGetterSetter(_p,"state",_p.getState),cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted),_p=null,cc.Control.create=function(){var t=new cc.Control;return t&&t.init()?t:null},cc.CONTROL_ZOOM_ACTION_TAG=3435855873,cc.ControlButton=cc.Control.extend({_doesAdjustBackgroundImage:!1,zoomOnTouchDown:!1,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:!1,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:!1,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this),this._preferredSize=cc.size(0,0),this._labelAnchorPoint=cc.p(0,0),this._currentTitle="",this._currentTitleColor=cc.color.WHITE,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},null!=i?this.initWithTitleAndFontNameAndFontSize(t,e,i):null!=e?this.initWithLabelAndBackgroundSprite(t,e):null!=t?this.initWithBackgroundSprite(t):this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new cc.LabelTTF("","Arial",12),new cc.Scale9Sprite)},needsLayout:function(){if(this._parentInited){this._titleLabel&&this._titleLabel.setVisible(!1),this._backgroundSprite&&this._backgroundSprite.setVisible(!1),this.setLabelAnchorPoint(this._labelAnchorPoint);var t=this._state;this._currentTitle=this.getTitleForState(t),this._currentTitleColor=this.getTitleColorForState(t);var e=this._titleLabel=this.getTitleLabelForState(t);e&&e.setString&&e.setString(this._currentTitle),e&&e.setColor(this._currentTitleColor);var i=this.getContentSize();if(e&&e.setPosition(i.width/2,i.height/2),(t=this._backgroundSprite=this.getBackgroundSpriteForState(t))&&t.setPosition(i.width/2,i.height/2),i=cc.size(0,0),e){var n=e.getBoundingBox();i.width=n.width,i.height=n.height}this._doesAdjustBackgroundImage?t&&t.setContentSize(i.width+2*this._marginH,i.height+2*this._marginV):t&&(n=t.getPreferredSize(),0>=(n=cc.size(n.width,n.height)).width&&(n.width=i.width),0>=n.height&&(n.height=i.height),t.setContentSize(n)),i=e?e.getBoundingBox():cc.rect(0,0,0,0),n=t?t.getBoundingBox():cc.rect(0,0,0,0),i=cc.rectUnion(i,n),this.setContentSize(i.width,i.height),i=this.getContentSize(),e&&(e.setPosition(i.width/2,i.height/2),e.setVisible(!0)),t&&(t.setPosition(i.width/2,i.height/2),t.setVisible(!0))}},initWithLabelAndBackgroundSprite:function(t,e){if(!t)throw Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null");if(!e)throw Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null");if(cc.Control.prototype.init.call(this,!0)){this._parentInited=!0,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},this._isPushed=!1,this.zoomOnTouchDown=!0,this._currentTitle=null,this.setAdjustBackgroundImage(!0),this.setPreferredSize(cc.size(0,0)),this.zoomOnTouchDown=!0,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this._titleLabel=t,this._backgroundSprite=e,this.setOpacity(255),this.setOpacityModifyRGB(!0);var i=t.getString();return this.setTitleForState(i,cc.CONTROL_STATE_NORMAL),this.setTitleColorForState(t.getColor(),cc.CONTROL_STATE_NORMAL),this.setTitleLabelForState(t,cc.CONTROL_STATE_NORMAL),this.setBackgroundSpriteForState(e,cc.CONTROL_STATE_NORMAL),this._state=cc.CONTROL_STATE_NORMAL,this._marginH=24,this._marginV=12,this._labelAnchorPoint=cc.p(.5,.5),this.setPreferredSize(cc.size(0,0)),this.needsLayout(),!0}return!1},initWithTitleAndFontNameAndFontSize:function(t,e,i){return t=new cc.LabelTTF(t,e,i),this.initWithLabelAndBackgroundSprite(t,new cc.Scale9Sprite)},initWithBackgroundSprite:function(t){var e=new cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(e,t)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(t){this._doesAdjustBackgroundImage=t,this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(t){return this.zoomOnTouchDown=t},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(t){if(0===t.width&&0===t.height)this._doesAdjustBackgroundImage=!0;else{this._doesAdjustBackgroundImage=!1;var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setPreferredSize(t)}this._preferredSize=t,this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(t){this._labelAnchorPoint=t,this._titleLabel&&this._titleLabel.setAnchorPoint(t)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},getOpacity:function(){return this._opacity},setOpacity:function(t){cc.Control.prototype.setOpacity.call(this,t);var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setOpacity(t)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e,i=this._backgroundSpriteDispatchTable;for(e in i)i[e].setColor(t)},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},setMargins:function(t,e){this._marginV=e,this._marginH=t,this.needsLayout()},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t),this.needsLayout()},setSelected:function(t){cc.Control.prototype.setSelected.call(this,t),this.needsLayout()},setHighlighted:function(t){this._state=t?cc.CONTROL_STATE_HIGHLIGHTED:cc.CONTROL_STATE_NORMAL,cc.Control.prototype.setHighlighted.call(this,t),(t=this.getActionByTag(cc.CONTROL_ZOOM_ACTION_TAG))&&this.stopAction(t),this.zoomOnTouchDown&&(t=this.isHighlighted()&&this.isEnabled()&&!this.isSelected()?1.1:1,(t=cc.scaleTo(.05,t)).setTag(cc.CONTROL_ZOOM_ACTION_TAG),this.runAction(t))},onTouchBegan:function(t,e){return!!(this.isTouchInside(t)&&this.isEnabled()&&this.isVisible()&&this.hasVisibleParents())&&(this._isPushed=!0,this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DOWN),!0)},onTouchMoved:function(t,e){this._enabled&&this._isPushed&&!this._selected?(t=this.isTouchInside(t))&&!this._highlighted?(this.setHighlighted(!0),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)):t&&this._highlighted?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE):!t&&this._highlighted?(this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)):t||this._highlighted||this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE):this._highlighted&&this.setHighlighted(!1)},onTouchEnded:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.isTouchInside(t)?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_INSIDE):this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)},onTouchCancelled:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(t){var e=this._titleDispatchTable;return e?e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]:""},setTitleForState:function(t,e){this._titleDispatchTable[e]=t||"",this.getState()===e&&this.needsLayout()},getTitleColorForState:function(t){return(t=this._titleColorDispatchTable[t])||(t=this._titleColorDispatchTable[cc.CONTROL_STATE_NORMAL])?t:cc.color.WHITE},setTitleColorForState:function(t,e){this._titleColorDispatchTable[e]=t,this.getState()===e&&this.needsLayout()},getTitleLabelForState:function(t){var e=this._titleLabelDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(t,e){var i=this._titleLabelDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t,1),this.getState()===e&&this.needsLayout()},setTitleTTFForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelTTF(i,t,12),e)},getTitleTTFForState:function(t){return null!=(t=this.getTitleLabelForState(t))&&t instanceof cc.LabelTTF?t.getFontName():""},setTitleTTFSizeForState:function(t,e){null!=(e=this.getTitleLabelForState(e))&&e instanceof cc.LabelTTF&&e.setFontSize(t)},getTitleTTFSizeForState:function(t){return null!=(t=this.getTitleLabelForState(t))&&t instanceof cc.LabelTTF?t.getFontSize():0},setTitleBMFontForState:function(t,e){var i=this.getTitleForState(e);i||(i=""),this.setTitleLabelForState(new cc.LabelBMFont(i,t),e)},getTitleBMFontForState:function(t){return null!=(t=this.getTitleLabelForState(t))&&t instanceof cc.LabelBMFont?t.getFntFile():""},getBackgroundSpriteForState:function(t){var e=this._backgroundSpriteDispatchTable;return e[t]?e[t]:e[cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(t,e){var i=this._backgroundSpriteDispatchTable;if(i[e]){var n=i[e];n&&this.removeChild(n,!0)}i[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t),0===(i=this._preferredSize).width&&0===i.height||t.setPreferredSize(i),this._state===e&&this.needsLayout()},setBackgroundSpriteFrameForState:function(t,e){t=cc.Scale9Sprite.createWithSpriteFrame(t),this.setBackgroundSpriteForState(t,e)}}),_p=cc.ControlButton.prototype,cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage),cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint),_p=null,cc.ControlButton.create=function(t,e,i){return new cc.ControlButton(t,e,i)},cc.RGBA=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},cc.HSV=function(t,e,i){this.h=t,this.s=e,this.v=i},cc.ControlUtils={},cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(t,e,i,n){return(t=new cc.Sprite("#"+t))?(t.setPosition(i),t.setAnchorPoint(n),e.addChild(t),t):null},cc.ControlUtils.HSVfromRGB=function(t){var e,i,n=new cc.HSV;return e=(e=t.r<t.g?t.r:t.g)<t.b?e:t.b,i=(i=t.r>t.g?t.r:t.g)>t.b?i:t.b,n.v=i,e=i-e,0<i?(n.s=e/i,n.h=t.r>=i?(t.g-t.b)/e:t.g>=i?2+(t.b-t.r)/e:4+(t.r-t.g)/e,n.h*=60,0>n.h&&(n.h+=360),n):(n.s=0,n.h=-1,n)},cc.ControlUtils.RGBfromHSV=function(t){var e,i,n,r,o=new cc.RGBA;if(o.a=1,0>=t.s)return t.h?(o.r=0,o.g=0,o.b=0,o):(o.r=t.v,o.g=t.v,o.b=t.v,o);switch(360<=(e=t.h)&&(e=0),n=(e/=60)-(r=0|e),e=t.v*(1-t.s),i=t.v*(1-t.s*n),n=t.v*(1-t.s*(1-n)),r){case 0:o.r=t.v,o.g=n,o.b=e;break;case 1:o.r=i,o.g=t.v,o.b=e;break;case 2:o.r=e,o.g=t.v,o.b=n;break;case 3:o.r=e,o.g=i,o.b=t.v;break;case 4:o.r=n,o.g=e,o.b=t.v;break;default:o.r=t.v,o.g=e,o.b=i}return o},cc.ControlUtils.CCRectUnion=function(t,e){return cc.rectUnion(t,e)},cc.Invocation=cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(t,e,i){this._target=t,this._action=e,this._controlEvent=i},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(t){this._target&&this._action&&(cc.isString(this._action)?this._target[this._action](t,this._controlEvent):this._action.call(this._target,t,this._controlEvent))}}),cc.SCROLLVIEW_DIRECTION_NONE=-1,cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0,cc.SCROLLVIEW_DIRECTION_VERTICAL=1,cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=.95,SCROLL_DEACCEL_DIST=1,BOUNCE_DURATION=.15,INSET_RATIO=.2,MOVE_INCH=.04375,BOUNCE_BACK_FACTOR=.35;cc.convertDistanceFromPointToInch=function(t){var e;return t*(e=((e=cc.view).getScaleX()+e.getScaleY())/2)/160},cc.ScrollViewDelegate=cc.Class.extend({scrollViewDidScroll:function(t){},scrollViewDidZoom:function(t){}}),cc.ScrollView=cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:!1,_contentOffset:null,_container:null,_touchMoved:!1,_maxInset:null,_minInset:null,_bounceable:!1,_clippingToBounds:!1,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:!1,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(t,e){cc.Layer.prototype.ctor.call(this),this._contentOffset=cc.p(0,0),this._maxInset=cc.p(0,0),this._minInset=cc.p(0,0),this._scrollDistance=cc.p(0,0),this._touchPoint=cc.p(0,0),this._touches=[],this._viewSize=cc.size(0,0),this._parentScissorRect=new cc.Rect(0,0,0,0),this._tmpViewRect=new cc.Rect(0,0,0,0),null!=e?this.initWithViewSize(t,e):this.initWithViewSize(cc.size(200,200),null)},init:function(){return this.initWithViewSize(cc.size(200,200),null)},initWithViewSize:function(t,e){var i=cc.p(0,0);return!!cc.Layer.prototype.init.call(this)&&(e||this._container||(e=new cc.Layer),e&&this.setContainer(e),this.setViewSize(t),this.setTouchEnabled(!0),this._touches.length=0,this._delegate=null,this._clippingToBounds=this._bounceable=!0,this._direction=cc.SCROLLVIEW_DIRECTION_BOTH,this._container.setPosition(i),this._touchLength=0,this._minScale=this._maxScale=1,!0)},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){t=cc.renderer,e.visit(i),this._clippingToBounds&&t.pushRenderCommand(e.startCmd);var n=this._children,r=n.length;if(0<r)for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<r;i++)n[i].visit(this);this._clippingToBounds&&t.pushRenderCommand(e.endCmd),e._dirtyFlag=0}else e._propagateFlagsDown(i)},setContentOffset:function(t,e){if(e)this.setContentOffsetInDuration(t,BOUNCE_DURATION);else{if(!this._bounceable){e=this.minContainerOffset();var i=this.maxContainerOffset();t.x=Math.max(e.x,Math.min(i.x,t.x)),t.y=Math.max(e.y,Math.min(i.y,t.y))}this._container.setPosition(t),null!=(t=this._delegate)&&t.scrollViewDidScroll&&t.scrollViewDidScroll(this)}},getContentOffset:function(){var t=this._container.getPosition();return cc.p(t.x,t.y)},setContentOffsetInDuration:function(t,e){t=cc.moveTo(e,t),e=cc.callFunc(this._stoppedAnimatedScroll,this),this._container.runAction(cc.sequence(t,e)),this.schedule(this._performedAnimatedScroll)},setZoomScale:function(t,e){if(e)this.setZoomScaleInDuration(t,BOUNCE_DURATION);else if((e=this._container).getScale()!==t){var i,n;0===this._touchLength?(n=this._viewSize,n=cc.p(.5*n.width,.5*n.height),n=this.convertToWorldSpace(n)):n=this._touchPoint,i=e.convertToNodeSpace(n),e.setScale(Math.max(this._minScale,Math.min(this._maxScale,t))),t=e.convertToWorldSpace(i),t=cc.pSub(n,t),this._delegate&&this._delegate.scrollViewDidZoom&&this._delegate.scrollViewDidZoom(this),this.setContentOffset(cc.pAdd(e.getPosition(),t))}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(t,e){if(0<e){var i=this._container.getScale();i!==t&&(t=cc.actionTween(e,"zoomScale",i,t),this.runAction(t))}else this.setZoomScale(t)},minContainerOffset:function(){var t=this._container,e=t.getContentSize(),i=this._viewSize;return cc.p(i.width-e.width*t.getScaleX(),i.height-e.height*t.getScaleY())},maxContainerOffset:function(){return cc.p(0,0)},isNodeVisible:function(t){var e=this.getContentOffset(),i=this.getViewSize(),n=this.getZoomScale();return e=cc.rect(-e.x/n,-e.y/n,i.width/n,i.height/n),cc.rectIntersectsRect(e,t.getBoundingBox())},pause:function(t){this._container.pause(),t=this._container.getChildren();for(var e=0;e<t.length;e++)t[e].pause();this._super()},resume:function(t){for(var e=0,i=(t=this._container.getChildren()).length;e<i;e++)t[e].resume();this._container.resume(),this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(t){this._bounceable=t},getViewSize:function(){return this._viewSize},setViewSize:function(t){this._viewSize=t,cc.Node.prototype.setContentSize.call(this,t)},getContainer:function(){return this._container},setContainer:function(t){t&&(this.removeAllChildren(!0),this._container=t,t.ignoreAnchorPointForPosition(!1),t.setAnchorPoint(0,0),this.addChild(t),this.setViewSize(this._viewSize))},getDirection:function(){return this._direction},setDirection:function(t){this._direction=t},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},onTouchBegan:function(t,e){for(e=this;null!=e;e=e.parent)if(!e.isVisible())return!1;e=this._getViewRect();var i=this._container,n=i.convertToWorldSpace(i.convertTouchToNodeSpace(t)),r=this._touches;return!(2<r.length||this._touchMoved||!cc.rectContainsPoint(e,n)||(r.push(t),1===r.length?(this._touchPoint=this.convertTouchToNodeSpace(t),this._touchMoved=!1,this._dragging=!0,this._scrollDistance.x=0,this._touchLength=this._scrollDistance.y=0):2===r.length&&(this._touchPoint=cc.pMidpoint(this.convertTouchToNodeSpace(r[0]),this.convertTouchToNodeSpace(r[1])),this._touchLength=cc.pDistance(i.convertTouchToNodeSpace(r[0]),i.convertTouchToNodeSpace(r[1])),this._dragging=!1),0))},onTouchMoved:function(t,e){if(this.isVisible())if(this.setNodeDirty(),1===this._touches.length&&this._dragging){this._touchMoved=!0,this._getViewRect(),e=this.convertTouchToNodeSpace(t),t=cc.pSub(e,this._touchPoint);var i,n,r=this._direction;if(r===cc.SCROLLVIEW_DIRECTION_VERTICAL)i=t.y,n=this._container.getPositionY(),this.minContainerOffset().y<=n&&n<=this.maxContainerOffset().y||(t.y*=BOUNCE_BACK_FACTOR);else if(r===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)i=t.x,n=this._container.getPositionX(),this.minContainerOffset().x<=n&&n<=this.maxContainerOffset().x||(t.x*=BOUNCE_BACK_FACTOR);else{i=Math.sqrt(t.x*t.x+t.y*t.y),n=this._container.getPositionY();var o=this.minContainerOffset(),c=this.maxContainerOffset();o.y<=n&&n<=c.y||(t.y*=BOUNCE_BACK_FACTOR),n=this._container.getPositionX(),o.x<=n&&n<=c.x||(t.x*=BOUNCE_BACK_FACTOR)}if((this._touchMoved||!(Math.abs(cc.convertDistanceFromPointToInch(i))<MOVE_INCH))&&(this._touchMoved||(t.x=0,t.y=0),this._touchPoint=e,this._touchMoved=!0,this._dragging)){switch(r){case cc.SCROLLVIEW_DIRECTION_VERTICAL:t.x=0;break;case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t.y=0}e=(i=this._container.getPosition()).x+t.x,i=i.y+t.y,this._scrollDistance=t,this.setContentOffset(cc.p(e,i))}}else 2!==this._touches.length||this._dragging||(t=cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1])),this.setZoomScale(this.getZoomScale()*t/this._touchLength))},onTouchEnded:function(t,e){this.isVisible()&&(1===this._touches.length&&this._touchMoved&&this.schedule(this._deaccelerateScrolling),this._touches.length=0,this._touchMoved=this._dragging=!1)},onTouchCancelled:function(t,e){this.isVisible()&&(this._touches.length=0,this._touchMoved=this._dragging=!1)},setContentSize:function(t,e){null!==this.getContainer()&&(void 0===e?this.getContainer().setContentSize(t):this.getContainer().setContentSize(t,e),this.updateInset())},_setWidth:function(t){var e=this.getContainer();null!==e&&(e._setWidth(t),this.updateInset())},_setHeight:function(t){var e=this.getContainer();null!==e&&(e._setHeight(t),this.updateInset())},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(null!==this.getContainer()){var t=this._viewSize,e=this.maxContainerOffset();this._maxInset.x=e.x+t.width*INSET_RATIO,this._maxInset.y=e.y+t.height*INSET_RATIO,e=this.minContainerOffset(),this._minInset.x=e.x-t.width*INSET_RATIO,this._minInset.y=e.y-t.height*INSET_RATIO}},isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(t){this._clippingToBounds=t},addChild:function(t,e,i){if(!t)throw Error("child must not nil!");e=e||t.getLocalZOrder(),i=i||t.getTag(),this._container!==t?this._container.addChild(t,e,i):cc.Layer.prototype.addChild.call(this,t,e,i)},isTouchEnabled:function(){return null!==this._touchListener},setTouchEnabled:function(t){this._touchListener&&cc.eventManager.removeListener(this._touchListener),this._touchListener=null,t?(t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,cc.eventManager.addListener(t,this)):(this._touchMoved=this._dragging=!1,this._touches.length=0)},_initWithViewSize:function(t){return null},_relocateContainer:function(t){var e=this.minContainerOffset(),i=this.maxContainerOffset(),n=this._direction,r=this._container.getPosition(),o=r.x,c=r.y;n!==cc.SCROLLVIEW_DIRECTION_BOTH&&n!==cc.SCROLLVIEW_DIRECTION_HORIZONTAL||(o=Math.max(o,e.x),o=Math.min(o,i.x)),n!==cc.SCROLLVIEW_DIRECTION_BOTH&&n!==cc.SCROLLVIEW_DIRECTION_VERTICAL||(c=Math.min(c,i.y),c=Math.max(c,e.y)),c===r.y&&o===r.x||this.setContentOffset(cc.p(o,c),t)},_deaccelerateScrolling:function(t){if(this._dragging)this.unschedule(this._deaccelerateScrolling);else{var e,i;e=this._container.getPosition(),t=this._scrollDistance,this._container.setPosition(e.x+t.x,e.y+t.y),this._bounceable?(e=this._maxInset,i=this._minInset):(e=this.maxContainerOffset(),i=this.minContainerOffset());var n=this._container.getPositionX(),r=this._container.getPositionY();t.x*=SCROLL_DEACCEL_RATE,t.y*=SCROLL_DEACCEL_RATE,this.setContentOffset(cc.p(n,r)),(Math.abs(t.x)<=SCROLL_DEACCEL_DIST&&Math.abs(t.y)<=SCROLL_DEACCEL_DIST||r>e.y||r<i.y||n>e.x||n<i.x||n===e.x||n===i.x||r===e.y||r===i.y)&&(this.unschedule(this._deaccelerateScrolling),this._relocateContainer(!0))}},_performedAnimatedScroll:function(t){this._dragging?this.unschedule(this._performedAnimatedScroll):this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_stoppedAnimatedScroll:function(t){this.unschedule(this._performedAnimatedScroll),this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_handleZoom:function(){},_getViewRect:function(){for(var t=this.convertToWorldSpace(cc.p(0,0)),e=this._viewSize,i=this.getScaleX(),n=this.getScaleY(),r=this._parent;null!=r;r=r.getParent())i*=r.getScaleX(),n*=r.getScaleY();return 0>i&&(t.x+=e.width*i,i=-i),0>n&&(t.y+=e.height*n,n=-n),(r=this._tmpViewRect).x=t.x,r.y=t.y,r.width=e.width*i,r.height=e.height*n,r},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ScrollView.CanvasRenderCmd(this):new cc.ScrollView.WebGLRenderCmd(this)}}),_p=cc.ScrollView.prototype,cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset),cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset),cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable),cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize),cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer),cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate),cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds),_p=null,cc.ScrollView.create=function(t,e){return new cc.ScrollView(t,e)},function(){cc.ScrollView.CanvasRenderCmd=function(t){this._layerCmdCtor(t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.startCmd._canUseDirtyRegion=!0,this.endCmd=new cc.CustomRenderCmd(this,this._endCmd),this.endCmd._canUseDirtyRegion=!0};var t=cc.ScrollView.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.ScrollView.CanvasRenderCmd,t._startCmd=function(t,e,i){var n=this._node,r=t||cc._renderContext;t=r.getContext(),r.save(),n._clippingToBounds&&(this._scissorRestored=!1,r.setTransform(this._worldTransform,e,i),i=n.getScaleX(),e=n.getScaleY(),i*=n._viewSize.width,n=n._viewSize.height*e,t.beginPath(),t.rect(0,0,i,-n),t.closePath(),t.clip())},t._endCmd=function(t){(t=t||cc._renderContext).restore()}}(),function(){cc.ScrollView.WebGLRenderCmd=function(t){this._layerCmdCtor(t),this._needDraw=!1,this.startCmd=new cc.CustomRenderCmd(this,this._startCmd),this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.ScrollView.WebGLRenderCmd,t._startCmd=function(){var t=this._node,e=cc.view,i=t._getViewRect();if(e.isScissorEnabled()){if(t._scissorRestored=!0,t._parentScissorRect=e.getScissorRect(),cc.rectIntersection(i,t._parentScissorRect)){t=t._parentScissorRect;var n=Math.max(i.x,t.x),r=Math.max(i.y,t.y);e.setScissorInPoints(n,r,Math.min(i.x+i.width,t.x+t.width)-n,Math.min(i.y+i.height,t.y+t.height)-r)}}else(t=cc._renderContext).enable(t.SCISSOR_TEST),e.setScissorInPoints(i.x,i.y,i.width,i.height)},t._endCmd=function(){var t=this._node;t._scissorRestored?(t=t._parentScissorRect,cc.view.setScissorInPoints(t.x,t.y,t.width,t.height)):(t=cc._renderContext).disable(t.SCISSOR_TEST)}}();var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),spine;!function(t){var e,i,n,r=function(){function t(t,e,i){if(null==t)throw Error("name cannot be null.");if(null==e)throw Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=i}return t.prototype.apply=function(t,e,i,n,r,o,c,s){if(null==t)throw Error("skeleton cannot be null.");n&&0!=this.duration&&(i%=this.duration,0<e&&(e%=this.duration));for(var a=0,h=(n=this.timelines).length;a<h;a++)n[a].apply(t,e,i,r,o,c,s)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var n=0,r=t.length/i-2;if(0==r)return i;for(var o=r>>>1;;){if(t[(o+1)*i]<=e?n=o+1:r=o,n==r)return(n+1)*i;o=n+r>>>1}},t.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},t}();t.Animation=r,function(t){t[t.setup=0]="setup",t[t.current=1]="current",t[t.currentLayered=2]="currentLayered"}(e=t.MixPose||(t.MixPose={})),function(t){t[t.in=0]="in",t[t.out=1]="out"}(i=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(n=t.TimelineType||(t.TimelineType={}));var o=function(){function e(i){if(0>=i)throw Error("frameCount must be > 0: "+i);this.curves=t.Utils.newFloatArray((i-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){return(t*=e.BEZIER_SIZE)==this.curves.length||(t=this.curves[t])==e.LINEAR?e.LINEAR:t==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,i,n,r,o){var c=.03*(2*-n+o),s=2*(h=.03*(2*-i+r))+(r=.006*(3*(i-r)+1)),a=2*c+(o=.006*(3*(n-o)+1));i=.3*i+h+.16666667*r,n=.3*n+c+.16666667*o,t*=e.BEZIER_SIZE,(c=this.curves)[t++]=e.BEZIER;for(var h=i,l=n,d=t+e.BEZIER_SIZE-1;t<d;t+=2)c[t]=h,c[t+1]=l,i+=s,n+=a,s+=r,a+=o,h+=i,l+=n},e.prototype.getCurvePercent=function(i,n){n=t.MathUtils.clamp(n,0,1);var r=this.curves;if((o=r[i*=e.BEZIER_SIZE])==e.LINEAR)return n;if(o==e.STEPPED)return 0;for(var o=0,c=++i,s=i+e.BEZIER_SIZE-1;i<s;i+=2)if((o=r[i])>=n)return i==c?s=c=0:(c=r[i-2],s=r[i-1]),s+(r[i+1]-s)*(n-c)/(o-c);return(r=r[i-1])+(1-r)*(n-o)/(1-o)},e}();o.LINEAR=0,o.STEPPED=1,o.BEZIER=2,o.BEZIER_SIZE=19,t.CurveTimeline=o;var c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e<<1),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.rotate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+o.ROTATION]=i},o.prototype.apply=function(t,i,n,c,s,a,h){if(i=this.frames,t=t.bones[this.boneIndex],n<i[0])switch(a){case e.setup:t.rotation=t.data.rotation;break;case e.current:a=t.data.rotation-t.rotation,t.rotation+=(a-360*(16384-(16384.499999999996-a/360|0)))*s}else if(n>=i[i.length-o.ENTRIES])a==e.setup?t.rotation=t.data.rotation+i[i.length+o.PREV_ROTATION]*s:(a=t.data.rotation+i[i.length+o.PREV_ROTATION]-t.rotation,t.rotation+=(a-360*(16384-(16384.499999999996-a/360|0)))*s);else{c=i[(h=r.binarySearch(i,n,o.ENTRIES))+o.PREV_ROTATION];var l=i[h];n=this.getCurvePercent((h>>1)-1,1-(n-l)/(i[h+o.PREV_TIME]-l)),i=c+((i=i[h+o.ROTATION]-c)-360*(16384-(16384.499999999996-i/360|0)))*n,a==e.setup?t.rotation=t.data.rotation+(i-360*(16384-(16384.499999999996-i/360|0)))*s:(i=t.data.rotation+i-t.rotation,t.rotation+=(i-360*(16384-(16384.499999999996-i/360|0)))*s)}},o}(o);c.ENTRIES=2,c.PREV_TIME=-2,c.PREV_ROTATION=-1,c.ROTATION=1,t.RotateTimeline=c,c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.translate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i,n){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.X]=i,this.frames[t+o.Y]=n},o.prototype.apply=function(t,i,n,c,s,a,h){if(i=this.frames,t=t.bones[this.boneIndex],n<i[0])switch(a){case e.setup:t.x=t.data.x,t.y=t.data.y;break;case e.current:t.x+=(t.data.x-t.x)*s,t.y+=(t.data.y-t.y)*s}else{if(n>=i[i.length-o.ENTRIES])c=i[i.length+o.PREV_X],h=i[i.length+o.PREV_Y];else{var l=r.binarySearch(i,n,o.ENTRIES);c=i[l+o.PREV_X],h=i[l+o.PREV_Y];var d=i[l];n=this.getCurvePercent(l/o.ENTRIES-1,1-(n-d)/(i[l+o.PREV_TIME]-d)),c+=(i[l+o.X]-c)*n,h+=(i[l+o.Y]-h)*n}a==e.setup?(t.x=t.data.x+c*s,t.y=t.data.y+h*s):(t.x+=(t.data.x+c-t.x)*s,t.y+=(t.data.y+h-t.y)*s)}},o}(o),c.ENTRIES=3,c.PREV_TIME=-3,c.PREV_X=-2,c.PREV_Y=-1,c.X=1,c.Y=2,t.TranslateTimeline=c;var s=function(o){function c(t){return o.call(this,t)||this}return __extends(c,o),c.prototype.getPropertyId=function(){return(n.scale<<24)+this.boneIndex},c.prototype.apply=function(n,o,s,a,h,l,d){var u=this.frames;if(n=n.bones[this.boneIndex],s<u[0])switch(l){case e.setup:n.scaleX=n.data.scaleX,n.scaleY=n.data.scaleY;break;case e.current:n.scaleX+=(n.data.scaleX-n.scaleX)*h,n.scaleY+=(n.data.scaleY-n.scaleY)*h}else{if(s>=u[u.length-c.ENTRIES])o=u[u.length+c.PREV_X]*n.data.scaleX,a=u[u.length+c.PREV_Y]*n.data.scaleY;else{var _=r.binarySearch(u,s,c.ENTRIES);o=u[_+c.PREV_X],a=u[_+c.PREV_Y];var p=u[_];s=this.getCurvePercent(_/c.ENTRIES-1,1-(s-p)/(u[_+c.PREV_TIME]-p)),o=(o+(u[_+c.X]-o)*s)*n.data.scaleX,a=(a+(u[_+c.Y]-a)*s)*n.data.scaleY}1==h?(n.scaleX=o,n.scaleY=a):(l==e.setup?(l=n.data.scaleX,s=n.data.scaleY):(l=n.scaleX,s=n.scaleY),d==i.out?(o=Math.abs(o)*t.MathUtils.signum(l),a=Math.abs(a)*t.MathUtils.signum(s)):(l=Math.abs(l)*t.MathUtils.signum(o),s=Math.abs(s)*t.MathUtils.signum(a)),n.scaleX=l+(o-l)*h,n.scaleY=s+(a-s)*h)}},c}(c);t.ScaleTimeline=s,c=function(t){function i(e){return t.call(this,e)||this}return __extends(i,t),i.prototype.getPropertyId=function(){return(n.shear<<24)+this.boneIndex},i.prototype.apply=function(t,n,o,c,s,a,h){if(n=this.frames,t=t.bones[this.boneIndex],o<n[0])switch(a){case e.setup:t.shearX=t.data.shearX,t.shearY=t.data.shearY;break;case e.current:t.shearX+=(t.data.shearX-t.shearX)*s,t.shearY+=(t.data.shearY-t.shearY)*s}else{if(o>=n[n.length-i.ENTRIES])c=n[n.length+i.PREV_X],h=n[n.length+i.PREV_Y];else{var l=r.binarySearch(n,o,i.ENTRIES);c=n[l+i.PREV_X],h=n[l+i.PREV_Y];var d=n[l];o=this.getCurvePercent(l/i.ENTRIES-1,1-(o-d)/(n[l+i.PREV_TIME]-d)),c+=(n[l+i.X]-c)*o,h+=(n[l+i.Y]-h)*o}a==e.setup?(t.shearX=t.data.shearX+c*s,t.shearY=t.data.shearY+h*s):(t.shearX+=(t.data.shearX+c-t.shearX)*s,t.shearY+=(t.data.shearY+h-t.shearY)*s)}},i}(c),t.ShearTimeline=c,c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.color<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,n,r,c){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=n,this.frames[t+o.B]=r,this.frames[t+o.A]=c},o.prototype.apply=function(t,i,n,c,s,a,h){t=t.slots[this.slotIndex];var l=this.frames;if(n<l[0])switch(a){case e.setup:t.color.setFromColor(t.data.color);break;case e.current:n=t.color,a=t.data.color,n.add((a.r-n.r)*s,(a.g-n.g)*s,(a.b-n.b)*s,(a.a-n.a)*s)}else{var d;if(n>=l[l.length-o.ENTRIES])i=l[(n=l.length)+o.PREV_R],c=l[n+o.PREV_G],h=l[n+o.PREV_B],d=l[n+o.PREV_A];else{var u=r.binarySearch(l,n,o.ENTRIES);i=l[u+o.PREV_R],c=l[u+o.PREV_G],h=l[u+o.PREV_B],d=l[u+o.PREV_A];var _=l[u];n=this.getCurvePercent(u/o.ENTRIES-1,1-(n-_)/(l[u+o.PREV_TIME]-_)),i+=(l[u+o.R]-i)*n,c+=(l[u+o.G]-c)*n,h+=(l[u+o.B]-h)*n,d+=(l[u+o.A]-d)*n}1==s?t.color.set(i,c,h,d):(n=t.color,a==e.setup&&n.setFromColor(t.data.color),n.add((i-n.r)*s,(c-n.g)*s,(h-n.b)*s,(d-n.a)*s))}},o}(o),c.ENTRIES=5,c.PREV_TIME=-5,c.PREV_R=-4,c.PREV_G=-3,c.PREV_B=-2,c.PREV_A=-1,c.R=1,c.G=2,c.B=3,c.A=4,t.ColorTimeline=c,c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.twoColor<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,n,r,c,s,a,h){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=n,this.frames[t+o.B]=r,this.frames[t+o.A]=c,this.frames[t+o.R2]=s,this.frames[t+o.G2]=a,this.frames[t+o.B2]=h},o.prototype.apply=function(t,i,n,c,s,a,h){t=t.slots[this.slotIndex];var l=this.frames;if(n<l[0])switch(a){case e.setup:t.color.setFromColor(t.data.color),t.darkColor.setFromColor(t.data.darkColor);break;case e.current:n=t.color,l=t.darkColor,a=t.data.color,t=t.data.darkColor,n.add((a.r-n.r)*s,(a.g-n.g)*s,(a.b-n.b)*s,(a.a-n.a)*s),l.add((t.r-l.r)*s,(t.g-l.g)*s,(t.b-l.b)*s,0)}else{var d,u,_,p;if(n>=l[l.length-o.ENTRIES])i=l[(n=l.length)+o.PREV_R],c=l[n+o.PREV_G],h=l[n+o.PREV_B],d=l[n+o.PREV_A],u=l[n+o.PREV_R2],_=l[n+o.PREV_G2],p=l[n+o.PREV_B2];else{var f=r.binarySearch(l,n,o.ENTRIES);i=l[f+o.PREV_R],c=l[f+o.PREV_G],h=l[f+o.PREV_B],d=l[f+o.PREV_A],u=l[f+o.PREV_R2],_=l[f+o.PREV_G2],p=l[f+o.PREV_B2];var g=l[f];n=this.getCurvePercent(f/o.ENTRIES-1,1-(n-g)/(l[f+o.PREV_TIME]-g)),i+=(l[f+o.R]-i)*n,c+=(l[f+o.G]-c)*n,h+=(l[f+o.B]-h)*n,d+=(l[f+o.A]-d)*n,u+=(l[f+o.R2]-u)*n,_+=(l[f+o.G2]-_)*n,p+=(l[f+o.B2]-p)*n}1==s?(t.color.set(i,c,h,d),t.darkColor.set(u,_,p,1)):(n=t.color,l=t.darkColor,a==e.setup&&(n.setFromColor(t.data.color),l.setFromColor(t.data.darkColor)),n.add((i-n.r)*s,(c-n.g)*s,(h-n.b)*s,(d-n.a)*s),l.add((u-l.r)*s,(_-l.g)*s,(p-l.b)*s,0))}},o}(o),c.ENTRIES=8,c.PREV_TIME=-8,c.PREV_R=-7,c.PREV_G=-6,c.PREV_B=-5,c.PREV_A=-4,c.PREV_R2=-3,c.PREV_G2=-2,c.PREV_B2=-1,c.R=1,c.G=2,c.B=3,c.A=4,c.R2=5,c.G2=6,c.B2=7,t.TwoColorTimeline=c,c=function(){function o(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=Array(e)}return o.prototype.getPropertyId=function(){return(n.attachment<<24)+this.slotIndex},o.prototype.getFrameCount=function(){return this.frames.length},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},o.prototype.apply=function(t,n,o,c,s,a,h){n=t.slots[this.slotIndex],h==i.out&&a==e.setup?(o=n.data.attachmentName,n.setAttachment(null==o?null:t.getAttachment(this.slotIndex,o))):o<(h=this.frames)[0]?a==e.setup&&(o=n.data.attachmentName,n.setAttachment(null==o?null:t.getAttachment(this.slotIndex,o))):(o=o>=h[h.length-1]?h.length-1:r.binarySearch(h,o,1)-1,o=this.attachmentNames[o],t.slots[this.slotIndex].setAttachment(null==o?null:t.getAttachment(this.slotIndex,o)))},o}(),t.AttachmentTimeline=c;var a=null;c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e),n.frameVertices=Array(e),null==a&&(a=t.Utils.newFloatArray(64)),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.deform<<27)+ +this.attachment.id+this.slotIndex},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},o.prototype.apply=function(i,n,o,c,s,h,l){var d=(n=i.slots[this.slotIndex]).getAttachment();if(d instanceof t.VertexAttachment&&d.applyDeform(this.attachment)){i=(l=this.frameVertices)[0].length,n=t.Utils.setArraySize(n.attachmentVertices,i);var u=this.frames;if(o<u[0])switch(h){case e.setup:null==d.bones?s=d.vertices:(s=a).length<i&&(a=s=t.Utils.newFloatArray(i)),t.Utils.arrayCopy(s,0,n,0,i);break;case e.current:if(1!=s)if(null==d.bones)for(c=d.vertices,h=0;h<i;h++)n[h]+=(c[h]-n[h])*s;else for(s=1-s,h=0;h<i;h++)n[h]*=s}else if(o>=u[u.length-1])if(c=l[u.length-1],1==s)t.Utils.arrayCopy(c,0,n,0,i);else if(h==e.setup)if(null==d.bones)for(l=d.vertices,o=0;o<i;o++)h=l[o],n[o]=h+(c[o]-h)*s;else for(h=0;h<i;h++)n[h]=c[h]*s;else for(h=0;h<i;h++)n[h]+=(c[h]-n[h])*s;else{var _=r.binarySearch(u,o);c=l[_-1],l=l[_];var p=u[_];if(o=this.getCurvePercent(_-1,1-(o-p)/(u[_-1]-p)),1==s)for(s=0;s<i;s++)d=c[s],n[s]=d+(l[s]-d)*o;else if(h==e.setup)if(null==d.bones)for(u=d.vertices,_=0;_<i;_++)d=c[_],h=u[_],n[_]=h+(d+(l[_]-d)*o-h)*s;else for(h=0;h<i;h++)d=c[h],n[h]=(d+(l[h]-d)*o)*s;else for(h=0;h<i;h++)d=c[h],n[h]+=(d+(l[h]-d)*o-n[h])*s}}},o}(o),t.DeformTimeline=c,c=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=Array(e)}return e.prototype.getPropertyId=function(){return n.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,i,n,o,c,s){if(null!=n){var a=this.frames,h=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,n,o,c,s),e=-1;else if(e>=a[h-1])return;if(!(i<a[0])){if(e<a[0])t=0;else for(e=a[t=r.binarySearch(a,e)];0<t&&a[t-1]==e;)t--;for(;t<h&&i>=a[t];t++)n.push(this.events[t])}}},e}(),t.EventTimeline=c,c=function(){function o(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=Array(e)}return o.prototype.getPropertyId=function(){return n.drawOrder<<24},o.prototype.getFrameCount=function(){return this.frames.length},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},o.prototype.apply=function(n,o,c,s,a,h,l){if(o=n.drawOrder,s=n.slots,l==i.out&&h==e.setup)t.Utils.arrayCopy(n.slots,0,n.drawOrder,0,n.slots.length);else if(c<(l=this.frames)[0])h==e.setup&&t.Utils.arrayCopy(n.slots,0,n.drawOrder,0,n.slots.length);else if(n=c>=l[l.length-1]?l.length-1:r.binarySearch(l,c)-1,null==(n=this.drawOrders[n]))t.Utils.arrayCopy(s,0,o,0,s.length);else for(c=0,h=n.length;c<h;c++)o[c]=s[n[c]]},o}(),t.DrawOrderTimeline=c,c=function(o){function c(e){var i=o.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*c.ENTRIES),i}return __extends(c,o),c.prototype.getPropertyId=function(){return(n.ikConstraint<<24)+this.ikConstraintIndex},c.prototype.setFrame=function(t,e,i,n){t*=c.ENTRIES,this.frames[t]=e,this.frames[t+c.MIX]=i,this.frames[t+c.BEND_DIRECTION]=n},c.prototype.apply=function(t,n,o,s,a,h,l){if(n=this.frames,t=t.ikConstraints[this.ikConstraintIndex],o<n[0])switch(h){case e.setup:t.mix=t.data.mix,t.bendDirection=t.data.bendDirection;break;case e.current:t.mix+=(t.data.mix-t.mix)*a,t.bendDirection=t.data.bendDirection}else if(o>=n[n.length-c.ENTRIES])h==e.setup?(t.mix=t.data.mix+(n[n.length+c.PREV_MIX]-t.data.mix)*a,t.bendDirection=l==i.out?t.data.bendDirection:n[n.length+c.PREV_BEND_DIRECTION]):(t.mix+=(n[n.length+c.PREV_MIX]-t.mix)*a,l==i.in&&(t.bendDirection=n[n.length+c.PREV_BEND_DIRECTION]));else{var d=n[(s=r.binarySearch(n,o,c.ENTRIES))+c.PREV_MIX],u=n[s];o=this.getCurvePercent(s/c.ENTRIES-1,1-(o-u)/(n[s+c.PREV_TIME]-u)),h==e.setup?(t.mix=t.data.mix+(d+(n[s+c.MIX]-d)*o-t.data.mix)*a,t.bendDirection=l==i.out?t.data.bendDirection:n[s+c.PREV_BEND_DIRECTION]):(t.mix+=(d+(n[s+c.MIX]-d)*o-t.mix)*a,l==i.in&&(t.bendDirection=n[s+c.PREV_BEND_DIRECTION]))}},c}(o),c.ENTRIES=3,c.PREV_TIME=-3,c.PREV_MIX=-2,c.PREV_BEND_DIRECTION=-1,c.MIX=1,c.BEND_DIRECTION=2,t.IkConstraintTimeline=c,c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.transformConstraint<<24)+this.transformConstraintIndex},o.prototype.setFrame=function(t,e,i,n,r,c){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=n,this.frames[t+o.SCALE]=r,this.frames[t+o.SHEAR]=c},o.prototype.apply=function(t,i,n,c,s,a,h){if(i=this.frames,t=t.transformConstraints[this.transformConstraintIndex],n<i[0])switch(n=t.data,a){case e.setup:t.rotateMix=n.rotateMix,t.translateMix=n.translateMix,t.scaleMix=n.scaleMix,t.shearMix=n.shearMix;break;case e.current:t.rotateMix+=(n.rotateMix-t.rotateMix)*s,t.translateMix+=(n.translateMix-t.translateMix)*s,t.scaleMix+=(n.scaleMix-t.scaleMix)*s,t.shearMix+=(n.shearMix-t.shearMix)*s}else{var l,d;if(n>=i[i.length-o.ENTRIES])c=i[(n=i.length)+o.PREV_ROTATE],h=i[n+o.PREV_TRANSLATE],l=i[n+o.PREV_SCALE],d=i[n+o.PREV_SHEAR];else{var u=r.binarySearch(i,n,o.ENTRIES);c=i[u+o.PREV_ROTATE],h=i[u+o.PREV_TRANSLATE],l=i[u+o.PREV_SCALE],d=i[u+o.PREV_SHEAR];var _=i[u];n=this.getCurvePercent(u/o.ENTRIES-1,1-(n-_)/(i[u+o.PREV_TIME]-_)),c+=(i[u+o.ROTATE]-c)*n,h+=(i[u+o.TRANSLATE]-h)*n,l+=(i[u+o.SCALE]-l)*n,d+=(i[u+o.SHEAR]-d)*n}a==e.setup?(n=t.data,t.rotateMix=n.rotateMix+(c-n.rotateMix)*s,t.translateMix=n.translateMix+(h-n.translateMix)*s,t.scaleMix=n.scaleMix+(l-n.scaleMix)*s,t.shearMix=n.shearMix+(d-n.shearMix)*s):(t.rotateMix+=(c-t.rotateMix)*s,t.translateMix+=(h-t.translateMix)*s,t.scaleMix+=(l-t.scaleMix)*s,t.shearMix+=(d-t.shearMix)*s)}},o}(o),c.ENTRIES=5,c.PREV_TIME=-5,c.PREV_ROTATE=-4,c.PREV_TRANSLATE=-3,c.PREV_SCALE=-2,c.PREV_SHEAR=-1,c.ROTATE=1,c.TRANSLATE=2,c.SCALE=3,c.SHEAR=4,t.TransformConstraintTimeline=c,c=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.pathConstraintPosition<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.VALUE]=i},o.prototype.apply=function(t,i,n,c,s,a,h){if(i=this.frames,t=t.pathConstraints[this.pathConstraintIndex],n<i[0])switch(a){case e.setup:t.position=t.data.position;break;case e.current:t.position+=(t.data.position-t.position)*s}else{if(n>=i[i.length-o.ENTRIES])c=i[i.length+o.PREV_VALUE];else{c=i[(h=r.binarySearch(i,n,o.ENTRIES))+o.PREV_VALUE];var l=i[h];n=this.getCurvePercent(h/o.ENTRIES-1,1-(n-l)/(i[h+o.PREV_TIME]-l)),c+=(i[h+o.VALUE]-c)*n}t.position=a==e.setup?t.data.position+(c-t.data.position)*s:t.position+(c-t.position)*s}},o}(o),c.ENTRIES=2,c.PREV_TIME=-2,c.PREV_VALUE=-1,c.VALUE=1,t.PathConstraintPositionTimeline=c,c=function(t){function i(e){return t.call(this,e)||this}return __extends(i,t),i.prototype.getPropertyId=function(){return(n.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(t,n,o,c,s,a,h){if(n=this.frames,t=t.pathConstraints[this.pathConstraintIndex],o<n[0])switch(a){case e.setup:t.spacing=t.data.spacing;break;case e.current:t.spacing+=(t.data.spacing-t.spacing)*s}else{if(o>=n[n.length-i.ENTRIES])c=n[n.length+i.PREV_VALUE];else{c=n[(h=r.binarySearch(n,o,i.ENTRIES))+i.PREV_VALUE];var l=n[h];o=this.getCurvePercent(h/i.ENTRIES-1,1-(o-l)/(n[h+i.PREV_TIME]-l)),c+=(n[h+i.VALUE]-c)*o}t.spacing=a==e.setup?t.data.spacing+(c-t.data.spacing)*s:t.spacing+(c-t.spacing)*s}},i}(c),t.PathConstraintSpacingTimeline=c,o=function(i){function o(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return __extends(o,i),o.prototype.getPropertyId=function(){return(n.pathConstraintMix<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i,n){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=n},o.prototype.apply=function(t,i,n,c,s,a,h){if(i=this.frames,t=t.pathConstraints[this.pathConstraintIndex],n<i[0])switch(a){case e.setup:t.rotateMix=t.data.rotateMix,t.translateMix=t.data.translateMix;break;case e.current:t.rotateMix+=(t.data.rotateMix-t.rotateMix)*s,t.translateMix+=(t.data.translateMix-t.translateMix)*s}else{if(n>=i[i.length-o.ENTRIES])c=i[i.length+o.PREV_ROTATE],h=i[i.length+o.PREV_TRANSLATE];else{var l=r.binarySearch(i,n,o.ENTRIES);c=i[l+o.PREV_ROTATE],h=i[l+o.PREV_TRANSLATE];var d=i[l];n=this.getCurvePercent(l/o.ENTRIES-1,1-(n-d)/(i[l+o.PREV_TIME]-d)),c+=(i[l+o.ROTATE]-c)*n,h+=(i[l+o.TRANSLATE]-h)*n}a==e.setup?(t.rotateMix=t.data.rotateMix+(c-t.data.rotateMix)*s,t.translateMix=t.data.translateMix+(h-t.data.translateMix)*s):(t.rotateMix+=(c-t.rotateMix)*s,t.translateMix+=(h-t.translateMix)*s)}},o}(o),o.ENTRIES=3,o.PREV_TIME=-3,o.PREV_ROTATE=-2,o.PREV_TRANSLATE=-1,o.ROTATE=1,o.TRANSLATE=2,t.PathConstraintMixTimeline=o}(spine||(spine={})),function(t){var e=function(){function e(e){this.tracks=[],this.events=[],this.listeners=[],this.queue=new r(this),this.propertyIDs=new t.IntSet,this.mixingTo=[],this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new t.Pool((function(){return new i})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,n=e.length;i<n;i++){var r=e[i];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var o=t*r.timeScale;if(0<r.delay){if(r.delay-=o,0<r.delay)continue;o=-r.delay,r.delay=0}var c=r.next;if(null!=c){var s=r.trackLast-c.delay;if(0<=s){for(c.delay=0,c.trackTime=s+t*c.timeScale,r.trackTime+=o,this.setCurrent(i,c,!0);null!=c.mixingFrom;)c.mixTime+=o,c=c.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[i]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t))for(c=r.mixingFrom,r.mixingFrom=null;null!=c;)this.queue.end(c),c=c.mixingFrom;r.trackTime+=o}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var n=this.updateMixingFrom(i,e);return 0<t.mixTime&&(t.mixTime>=t.mixDuration||0==t.timeScale)?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),n):(i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,i.trackTime+=e*i.timeScale,t.mixTime+=e*t.timeScale,!1)},e.prototype.apply=function(i){if(null==i)throw Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var n=this.events,r=this.tracks,o=!1,c=0,s=r.length;c<s;c++){var a=r[c];if(!(null==a||0<a.delay)){o=!0;var h=0==c?t.MixPose.current:t.MixPose.currentLayered,l=a.alpha;null!=a.mixingFrom?l*=this.applyMixingFrom(a,i,h):a.trackTime>=a.trackEnd&&null==a.next&&(l=0);var d=a.animationLast,u=a.getAnimationTime(),_=a.animation.timelines.length,p=a.animation.timelines;if(1==l)for(var f=0;f<_;f++)p[f].apply(i,d,u,n,1,t.MixPose.setup,t.MixDirection.in);else{var g=a.timelineData,m=0==a.timelinesRotation.length;m&&t.Utils.setArraySize(a.timelinesRotation,_<<1,null);var T=a.timelinesRotation;for(f=0;f<_;f++){var y=p[f],E=g[f]>=e.FIRST?t.MixPose.setup:h;y instanceof t.RotateTimeline?this.applyRotateTimeline(y,i,u,l,E,T,f<<1,m):y.apply(i,d,u,n,l,E,t.MixDirection.in)}}this.queueEvents(a,u),n.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime}}return this.queue.drain(),o},e.prototype.applyMixingFrom=function(i,n,r){var o,c=i.mixingFrom;null!=c.mixingFrom&&this.applyMixingFrom(c,n,r),(0==i.mixDuration||1<(o=i.mixTime/i.mixDuration))&&(o=1);var s=o<c.eventThreshold?this.events:null,a=o<c.attachmentThreshold,h=o<c.drawOrderThreshold,l=c.animationLast,d=c.getAnimationTime(),u=c.animation.timelines.length,_=c.animation.timelines,p=c.timelineData,f=c.timelineDipMix,g=0==c.timelinesRotation.length;g&&t.Utils.setArraySize(c.timelinesRotation,u<<1,null);for(var m,T,y=c.timelinesRotation,E=c.alpha*i.interruptAlpha,S=E*(1-o),C=c.totalAlpha=0;C<u;C++){var v=_[C];switch(p[C]){case e.SUBSEQUENT:if(!a&&v instanceof t.AttachmentTimeline)continue;if(!h&&v instanceof t.DrawOrderTimeline)continue;m=r,T=S;break;case e.FIRST:m=t.MixPose.setup,T=S;break;case e.DIP:m=t.MixPose.setup,T=E;break;default:m=t.MixPose.setup,T=E;var x=f[C];T*=Math.max(0,1-x.mixTime/x.mixDuration)}c.totalAlpha+=T,v instanceof t.RotateTimeline?this.applyRotateTimeline(v,n,d,T,m,y,C<<1,g):v.apply(n,l,d,s,T,m,t.MixDirection.out)}return 0<i.mixDuration&&this.queueEvents(c,d),this.events.length=0,c.nextAnimationLast=d,c.nextTrackLast=c.trackTime,o},e.prototype.applyRotateTimeline=function(e,i,n,r,o,c,s,a){if(a&&(c[s]=0),1==r)e.apply(i,0,n,null,1,o,t.MixDirection.in);else{var h=e.frames;if(i=i.bones[e.boneIndex],n<h[0])o==t.MixPose.setup&&(i.rotation=i.data.rotation);else{if(n>=h[h.length-t.RotateTimeline.ENTRIES])h=i.data.rotation+h[h.length+t.RotateTimeline.PREV_ROTATION];else{var l=t.Animation.binarySearch(h,n,t.RotateTimeline.ENTRIES),d=h[l+t.RotateTimeline.PREV_ROTATION],u=h[l];e=e.getCurvePercent((l>>1)-1,1-(n-u)/(h[l+t.RotateTimeline.PREV_TIME]-u)),h=d+((h=h[l+t.RotateTimeline.ROTATION]-d)-360*(16384-(16384.499999999996-h/360|0)))*e+i.data.rotation,h-=360*(16384-(16384.499999999996-h/360|0))}0==(h-=o=o==t.MixPose.setup?i.data.rotation:i.rotation)?n=c[s]:(h-=360*(16384-(16384.499999999996-h/360|0)),a?(a=0,n=h):(a=c[s],n=c[s+1]),d=0<h,e=0<=a,t.MathUtils.signum(n)!=t.MathUtils.signum(h)&&90>=Math.abs(n)&&(180<Math.abs(a)&&(a+=360*t.MathUtils.signum(a)),e=d),n=h+a-a%360,e!=d&&(n+=360*t.MathUtils.signum(a)),c[s]=n),c[s+1]=h,o+=n*r,i.rotation=o-360*(16384-(16384.499999999996-o/360|0))}}},e.prototype.queueEvents=function(t,e){for(var i=t.animationStart,n=t.animationEnd,r=n-i,o=t.trackLast%r,c=this.events,s=0,a=c.length;s<a;s++){var h=c[s];if(h.time<o)break;h.time>n||this.queue.event(t,h)}for((t.loop?o>t.trackTime%r:e>=n&&t.animationLast<n)&&this.queue.complete(t);s<a;s++)c[s].time<i||this.queue.event(t,c[s])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)&&null!=(t=this.tracks[t])){this.queue.end(t),this.disposeNext(t);for(var e=t;;){var i=e.mixingFrom;if(null==i)break;this.queue.end(i),e.mixingFrom=null,e=i}this.tracks[t.trackIndex]=null,this.queue.drain()}},e.prototype.setCurrent=function(t,e,i){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(i&&this.queue.interrupt(n),e.mixingFrom=n,e.mixTime=0,null!=n.mixingFrom&&0<n.mixDuration&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw Error("Animation not found: "+e);return this.setAnimationWith(t,n,i)},e.prototype.setAnimationWith=function(t,e,i){if(null==e)throw Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t);return null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r)),e=this.trackEntry(t,e,i,r),this.setCurrent(t,e,n),this.queue.drain(),e},e.prototype.addAnimation=function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw Error("Animation not found: "+e);return this.addAnimationWith(t,r,i,n)},e.prototype.addAnimationWith=function(t,e,i,n){if(null==e)throw Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;return i=this.trackEntry(t,e,i,r),null==r?(this.setCurrent(t,i,!0),this.queue.drain()):(r.next=i,0>=n&&(n=0!=(t=r.animationEnd-r.animationStart)?n+(t*(1+(r.trackTime/t|0))-this.data.getMix(r.animation,e)):0)),i.delay=n,i},e.prototype.setEmptyAnimation=function(t,i){return(t=this.setAnimationWith(t,e.emptyAnimation,!1)).mixDuration=i,t.trackEnd=i,t},e.prototype.addEmptyAnimation=function(t,i,n){return 0>=n&&(n-=i),(t=this.addAnimationWith(t,e.emptyAnimation,!1,n)).mixDuration=i,t.trackEnd=i,t},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,n=this.tracks.length;i<n;i++){var r=this.tracks[i];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e-this.tracks.length+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,i,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=i,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==n?0:this.data.getMix(n.animation,e),r},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1;var t=this.propertyIDs;t.clear();for(var e=this.mixingTo,i=0,n=this.tracks.length;i<n;i++){var r=this.tracks[i];null!=r&&r.setTimelineData(null,e,t)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){0<=(t=this.listeners.indexOf(t))&&this.listeners.splice(t,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e}();e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.DIP=2,e.DIP_MIX=3,t.AnimationState=e;var i=function(){function i(){this.timelineData=[],this.timelineDipMix=[],this.timelinesRotation=[]}return i.prototype.reset=function(){this.listener=this.animation=this.mixingFrom=this.next=null,this.timelineData.length=0,this.timelineDipMix.length=0,this.timelinesRotation.length=0},i.prototype.setTimelineData=function(i,n,r){null!=i&&n.push(i);var o=null!=this.mixingFrom?this.mixingFrom.setTimelineData(this,n,r):this;null!=i&&n.pop();var c=n.length-1,s=this.animation.timelines,a=this.animation.timelines.length,h=t.Utils.setArraySize(this.timelineData,a);this.timelineDipMix.length=0;var l=t.Utils.setArraySize(this.timelineDipMix,a),d=0;t:for(;d<a;d++){var u=s[d].getPropertyId();if(r.add(u))if(null!=i&&i.hasTimeline(u)){for(var _=c;0<=_;_--){var p=n[_];if(!p.hasTimeline(u)&&0<p.mixDuration){h[d]=e.DIP_MIX,l[d]=p;continue t}}h[d]=e.DIP}else h[d]=e.FIRST;else h[d]=e.SUBSEQUENT}return o},i.prototype.hasTimeline=function(t){for(var e=this.animation.timelines,i=0,n=e.length;i<n;i++)if(e[i].getPropertyId()==t)return!0;return!1},i.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},i.prototype.setAnimationLast=function(t){this.nextAnimationLast=this.animationLast=t},i.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},i.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},i}();t.TrackEntry=i;var n,r=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(n.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(n.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(n.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(n.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(n.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(n.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var r=t[i+1];switch(t[i]){case n.start:null!=r.listener&&r.listener.start&&r.listener.start(r);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(r);break;case n.interrupt:for(null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(r);break;case n.end:for(null!=r.listener&&r.listener.end&&r.listener.end(r),o=0;o<e.length;o++)e[o].end&&e[o].end(r);case n.dispose:for(null!=r.listener&&r.listener.dispose&&r.listener.dispose(r),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(r);this.animState.trackEntryPool.free(r);break;case n.complete:for(null!=r.listener&&r.listener.complete&&r.listener.complete(r),o=0;o<e.length;o++)e[o].complete&&e[o].complete(r);break;case n.event:var c=t[2+i++];for(null!=r.listener&&r.listener.event&&r.listener.event(r,c),o=0;o<e.length;o++)e[o].event&&e[o].event(r,c)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=r,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(n=t.EventType||(t.EventType={}));var o=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,e){},t}();t.AnimationStateAdapter2=o}(spine||(spine={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(null==n)throw Error("Animation not found: "+t);if(null==(t=this.skeletonData.findAnimation(e)))throw Error("Animation not found: "+e);this.setMixWith(n,t,i)},t.prototype.setMixWith=function(t,e,i){if(null==t)throw Error("from cannot be null.");if(null==e)throw Error("to cannot be null.");this.animationToMixTime[t.name+e.name]=i},t.prototype.getMix=function(t,e){return void 0===(t=this.animationToMixTime[t.name+e.name])?this.defaultMix:t},t}();t.AnimationStateData=e}(spine||(spine={})),function(t){var e=function(){function t(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.loaded=this.toLoad=0,this.textureLoader=t,this.pathPrefix=e}return t.prototype.loadText=function(t,e,i){var n=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200<=r.status&&300>r.status?(n.assets[t]=r.responseText,e&&e(t,r.responseText)):(n.errors[t]="Couldn't load text "+t+": status "+r.status+", "+r.responseText,i&&i(t,"Couldn't load text "+t+": status "+r.status+", "+r.responseText)),n.toLoad--,n.loaded++)},r.open("GET",t,!0),r.send()},t.prototype.loadTexture=function(t,e,i){var n=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(i){i=n.textureLoader(r),n.assets[t]=i,n.toLoad--,n.loaded++,e&&e(t,r)},r.onerror=function(e){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,i&&i(t,"Couldn't load image "+t)},r.src=t},t.prototype.loadTextureData=function(t,e,i,n){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++;var o=new Image;o.onload=function(e){e=r.textureLoader(o),r.assets[t]=e,r.toLoad--,r.loaded++,i&&i(t,o)},o.onerror=function(e){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,n&&n(t,"Couldn't load image "+t)},o.src=e},t.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},t.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},t.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},t.prototype.isLoadingComplete=function(){return 0==this.toLoad},t.prototype.getToLoad=function(){return this.toLoad},t.prototype.getLoaded=function(){return this.loaded},t.prototype.dispose=function(){this.removeAll()},t.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},t.prototype.getErrors=function(){return this.errors},t}();t.AssetManager=e}(spine||(spine={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,i,n){if(null==(e=this.atlas.findRegion(n)))throw Error("Region not found in atlas: "+n+" (region attachment: "+i+")");return e.renderObject=e,(i=new t.RegionAttachment(i)).setRegion(e),i},e.prototype.newMeshAttachment=function(e,i,n){if(null==(e=this.atlas.findRegion(n)))throw Error("Region not found in atlas: "+n+" (mesh attachment: "+i+")");return e.renderObject=e,(i=new t.MeshAttachment(i)).region=e,i},e.prototype.newBoundingBoxAttachment=function(e,i){return new t.BoundingBoxAttachment(i)},e.prototype.newPathAttachment=function(e,i){return new t.PathAttachment(i)},e.prototype.newPointAttachment=function(e,i){return new t.PointAttachment(i)},e.prototype.newClippingAttachment=function(e,i){return new t.ClippingAttachment(i)},e}();t.AtlasAttachmentLoader=e}(spine||(spine={})),function(t){(t=t.BlendMode||(t.BlendMode={}))[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(spine||(spine={})),function(t){var e=function(){function e(t,e,i){if(this.children=[],this.ashearY=this.ashearX=this.ascaleY=this.ascaleX=this.arotation=this.ay=this.ax=this.shearY=this.shearX=this.scaleY=this.scaleX=this.rotation=this.y=this.x=0,this.appliedValid=!1,this.worldY=this.d=this.c=this.worldX=this.b=this.a=0,this.sorted=!1,null==t)throw Error("data cannot be null.");if(null==e)throw Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,i,n,r,o,c,s){if(this.ax=e,this.ay=i,this.arotation=n,this.ascaleX=r,this.ascaleY=o,this.ashearX=c,this.ashearY=s,this.appliedValid=!0,null==(a=this.parent)){s=n+90+s;var a=t.MathUtils.cosDeg(n+c)*r,h=t.MathUtils.cosDeg(s)*o;r*=t.MathUtils.sinDeg(n+c),o*=t.MathUtils.sinDeg(s),(l=this.skeleton).flipX&&(e=-e,a=-a,h=-h),l.flipY&&(i=-i,r=-r,o=-o),this.a=a,this.b=h,this.c=r,this.d=o,this.worldX=e+l.x,this.worldY=i+l.y}else{var l=a.a,d=a.b,u=a.c,_=a.d;switch(this.worldX=l*e+d*i+a.worldX,this.worldY=u*e+_*i+a.worldY,this.data.transformMode){case t.TransformMode.Normal:return s=n+90+s,a=t.MathUtils.cosDeg(n+c)*r,h=t.MathUtils.cosDeg(s)*o,r*=t.MathUtils.sinDeg(n+c),o*=t.MathUtils.sinDeg(s),this.a=l*a+d*r,this.b=l*h+d*o,this.c=u*a+_*r,void(this.d=u*h+_*o);case t.TransformMode.OnlyTranslation:s=n+90+s,this.a=t.MathUtils.cosDeg(n+c)*r,this.b=t.MathUtils.cosDeg(s)*o,this.c=t.MathUtils.sinDeg(n+c)*r,this.d=t.MathUtils.sinDeg(s)*o;break;case t.TransformMode.NoRotationOrReflection:1e-4<(a=l*l+u*u)?(d=u*(a=Math.abs(l*_-d*u)/a),_=l*a,a=Math.atan2(u,l)*t.MathUtils.radDeg):(u=l=0,a=90-Math.atan2(_,d)*t.MathUtils.radDeg),c=n+c-a,s=n+s-a+90,a=t.MathUtils.cosDeg(c)*r,h=t.MathUtils.cosDeg(s)*o,r*=t.MathUtils.sinDeg(c),o*=t.MathUtils.sinDeg(s),this.a=l*a-d*r,this.b=l*h-d*o,this.c=u*a+_*r,this.d=u*h+_*o;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:n=l*(a=t.MathUtils.cosDeg(n))+d*(h=t.MathUtils.sinDeg(n)),e=u*a+_*h,1e-5<(a=Math.sqrt(n*n+e*e))&&(a=1/a),n*=a,e*=a,a=Math.sqrt(n*n+e*e),h=Math.PI/2+Math.atan2(e,n),i=Math.cos(h)*a;var p=Math.sin(h)*a;return a=t.MathUtils.cosDeg(c)*r,h=t.MathUtils.cosDeg(90+s)*o,r*=t.MathUtils.sinDeg(c),o*=t.MathUtils.sinDeg(90+s),(this.data.transformMode!=t.TransformMode.NoScaleOrReflection?0>l*_-d*u:this.skeleton.flipX!=this.skeleton.flipY)&&(i=-i,p=-p),this.a=n*a+i*r,this.b=n*h+i*o,this.c=e*a+p*r,void(this.d=e*h+p*o)}this.skeleton.flipX&&(this.a=-this.a,this.b=-this.b),this.skeleton.flipY&&(this.c=-this.c,this.d=-this.d)}},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){if(this.appliedValid=!0,null==(s=this.parent))this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg;else{var e=s.a,i=s.b,n=s.c,r=s.d,o=1/(e*r-i*n),c=this.worldX-s.worldX,s=this.worldY-s.worldY;this.ax=c*r*o-s*i*o,this.ay=s*e*o-c*n*o,r*=o,e*=o,i*=o,o*=n,n=r*this.a-i*this.c,i=r*this.b-i*this.d,r=e*this.c-o*this.a,o=e*this.d-o*this.b,this.ashearX=0,this.ascaleX=Math.sqrt(n*n+r*r),1e-4<this.ascaleX?(e=n*o-i*r,this.ascaleY=e/this.ascaleX,this.ashearY=Math.atan2(n*i+r*o,e)*t.MathUtils.radDeg,this.arotation=Math.atan2(r,n)*t.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(i*i+o*o),this.ashearY=0,this.arotation=90-Math.atan2(o,i)*t.MathUtils.radDeg)}},e.prototype.worldToLocal=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,o=1/(e*r-i*n),c=t.x-this.worldX,s=t.y-this.worldY;return t.x=c*r*o-s*i*o,t.y=s*e*o-c*n*o,t},e.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var i=t.MathUtils.sinDeg(e);return e=t.MathUtils.cosDeg(e),Math.atan2(this.a*i-this.c*e,this.d*e-this.b*i)*t.MathUtils.radDeg},e.prototype.localToWorldRotation=function(e){var i=t.MathUtils.sinDeg(e);return e=t.MathUtils.cosDeg(e),Math.atan2(e*this.c+i*this.d,e*this.a+i*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var i=this.a,n=this.b,r=this.c,o=this.d,c=t.MathUtils.cosDeg(e);e=t.MathUtils.sinDeg(e),this.a=c*i-e*r,this.b=c*n-e*o,this.c=e*i+c*r,this.d=e*n+c*o,this.appliedValid=!1},e}();t.Bone=e}(spine||(spine={})),function(t){var e;t.BoneData=function(t,i,n){if(this.rotation=this.y=this.x=0,this.scaleY=this.scaleX=1,this.shearY=this.shearX=0,this.transformMode=e.Normal,0>t)throw Error("index must be >= 0.");if(null==i)throw Error("name cannot be null.");this.index=t,this.name=i,this.parent=n},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(spine||(spine={})),(spine||(spine={})).Event=function(t,e){if(null==e)throw Error("data cannot be null.");this.time=t,this.data=e},(spine||(spine={})).EventData=function(t){this.name=t},function(t){var e=function(){function e(t,e){if(this.mix=1,this.bendDirection=0,null==t)throw Error("data cannot be null.");if(null==e)throw Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return e.prototype.getOrder=function(){return this.data.order},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}},e.prototype.apply1=function(e,i,n,r){e.appliedValid||e.updateAppliedTransform();var o=e.parent,c=1/(o.a*o.d-o.b*o.c);i-=o.worldX,n-=o.worldY,o=Math.atan2((n*o.a-i*o.c)*c-e.ay,(i*o.d-n*o.b)*c-e.ax)*t.MathUtils.radDeg-e.ashearX-e.arotation,0>e.ascaleX&&(o+=180),180<o?o-=360:-180>o&&(o+=360),e.updateWorldTransformWith(e.ax,e.ay,e.arotation+o*r,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,i,n,r,o,c){if(0==c)i.updateWorldTransform();else{e.appliedValid||e.updateAppliedTransform(),i.appliedValid||i.updateAppliedTransform();var s,a,h,l=e.ax,d=e.ay,u=e.ascaleX,_=e.ascaleY,p=i.ascaleX;0>u?(u=-u,s=180,h=-1):(s=0,h=1),0>_&&(_=-_,h=-h),0>p?(p=-p,a=180):a=0;var f,g,m,T=i.ax,y=e.a,E=e.b,S=e.c,C=e.d,v=1e-4>=Math.abs(u-_);v?(g=y*T+E*(f=i.ay)+e.worldX,m=S*T+C*f+e.worldY):(f=0,g=y*T+e.worldX,m=S*T+e.worldY),y=(I=e.parent).a,E=I.b,S=I.c;var x=1/(y*(C=I.d)-E*S),R=((n-=I.worldX)*C-(r-=I.worldY)*E)*x-l,A=(r*y-n*S)*x-d;E=((n=g-I.worldX)*C-(r=m-I.worldY)*E)*x-l,y=(r*y-n*S)*x-d,n=Math.sqrt(E*E+y*y),E=i.data.length*p;t:if(v)E*=u,y=(R*R+A*A-n*n-E*E)/(2*n*E),-1>y?y=-1:1<y&&(y=1),o*=Math.acos(y),y=n+E*y,E*=Math.sin(o),y=Math.atan2(A*y-R*E,R*y+A*E);else{if(r=(y=u*E)*y,p=(E*=_)*E,v=R*R+A*A,R=Math.atan2(A,R),0<=(C=(A=-2*p*n)*A-4*(x=p-r)*(S=p*n*n+r*v-r*p))&&(C=Math.sqrt(C),0>A&&(C=-C),A=(C=-(A+C)/2)/x,S/=C,(S=Math.abs(A)<Math.abs(S)?A:S)*S<=v)){r=Math.sqrt(v-S*S)*o,y=R-Math.atan2(r,S),o=Math.atan2(r/_,(S-n)/u);break t}u=t.MathUtils.PI,x=(A=n-y)*A,_=g=0;var I=(m=n+y)*m,b=0;-1<=(S=-y*n/(r-p))&&1>=S&&(S=Math.acos(S),(C=(n=y*Math.cos(S)+n)*n+(r=E*Math.sin(S))*r)<x&&(u=S,x=C,A=n,g=r),C>I&&(_=S,I=C,m=n,b=r)),v<=(x+I)/2?(y=R-Math.atan2(g*o,A),o*=u):(y=R-Math.atan2(b*o,m),o*=_)}E=Math.atan2(f,T)*h,S=e.arotation,180<(y=(y-E)*t.MathUtils.radDeg+s-S)?y-=360:-180>y&&(y+=360),e.updateWorldTransformWith(l,d,S+y*c,e.ascaleX,e.ascaleY,0,0),S=i.arotation,180<(o=((o+E)*t.MathUtils.radDeg-i.ashearX)*h+a-S)?o-=360:-180>o&&(o+=360),i.updateWorldTransformWith(T,f,S+o*c,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}},e}();t.IkConstraint=e}(spine||(spine={})),(spine||(spine={})).IkConstraintData=function(t){this.order=0,this.bones=[],this.mix=this.bendDirection=1,this.name=t},function(t){var e=function(){function e(t,e){if(this.translateMix=this.rotateMix=this.spacing=this.position=0,this.spaces=[],this.positions=[],this.world=[],this.curves=[],this.lengths=[],this.segments=[],null==t)throw Error("data cannot be null.");if(null==e)throw Error("skeleton cannot be null.");this.data=t,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.apply=function(){this.update()},e.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof t.PathAttachment){var i=this.rotateMix,n=this.translateMix,r=0<i;if(0<n||r){var o=this.data,c=(I=o.spacingMode)==t.SpacingMode.Length,s=o.rotateMode,a=s==t.RotateMode.Tangent,h=s==t.RotateMode.ChainScale,l=this.bones.length,d=a?l:l+1,u=this.bones,_=t.Utils.setArraySize(this.spaces,d),p=null,f=this.spacing;if(h||c){h&&(p=t.Utils.setArraySize(this.lengths,l));for(var g=0,m=d-1;g<m;){0==(x=(E=u[g]).data.length)&&(x=1e-7);var T=x*E.a,y=x*E.c,E=Math.sqrt(T*T+y*y);h&&(p[g]=E),_[++g]=(c?x+f:f)*E/x}}else for(g=1;g<d;g++)_[g]=f;for(I=(e=this.computeWorldPositions(e,d,a,o.positionMode==t.PositionMode.Percent,I==t.SpacingMode.Percent))[0],c=e[1],0==(o=o.offsetRotation)?s=s==t.RotateMode.Chain:(s=!1,o*=0<(d=this.target.bone).a*d.d-d.b*d.c?t.MathUtils.degRad:-t.MathUtils.degRad),g=0,d=3;g<l;g++,d+=3){if((E=u[g]).worldX+=(I-E.worldX)*n,E.worldY+=(c-E.worldY)*n,f=(T=e[d])-I,m=(y=e[d+1])-c,h&&0!=(I=p[g])&&(I=(Math.sqrt(f*f+m*m)/I-1)*i+1,E.a*=I,E.c*=I),I=T,c=y,r){T=E.a,y=E.b;var S,C,v,x=E.c,R=E.d;if(S=a?e[d-1]:0==_[g+1]?e[d+2]:Math.atan2(m,f),S-=Math.atan2(x,T),s){C=Math.cos(S),v=Math.sin(S);var A=E.data.length,I=I+(A*(C*T-v*x)-f)*i;c+=(A*(v*T+C*x)-m)*i}else S+=o;S>t.MathUtils.PI?S-=t.MathUtils.PI2:S<-t.MathUtils.PI&&(S+=t.MathUtils.PI2),S*=i,C=Math.cos(S),v=Math.sin(S),E.a=C*T-v*x,E.b=C*y-v*R,E.c=v*T+C*x,E.d=v*y+C*R}E.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(i,n,r,o,c){var s,a=this.target,h=this.position,l=this.spaces,d=t.Utils.setArraySize(this.positions,3*n+2),u=i.closed,_=i.worldVerticesLength,p=_/6,f=e.NONE;if(!i.constantSpeed){var g=(R=i.lengths)[p-=u?1:2];if(o&&(h*=g),c)for(var m=0;m<n;m++)l[m]*=g;for(s=t.Utils.setArraySize(this.world,8),c=o=m=0;m<n;m++,o+=3){var T=h+=w=l[m];if(u)0>(T%=g)&&(T+=g),c=0;else{if(0>T){f!=e.BEFORE&&(f=e.BEFORE,i.computeWorldVertices(a,2,4,s,0,2)),this.addBeforePosition(T,s,0,d,o);continue}if(T>g){f!=e.AFTER&&(f=e.AFTER,i.computeWorldVertices(a,_-6,4,s,0,2)),this.addAfterPosition(T-g,s,0,d,o);continue}}for(;;c++)if(!(T>(F=R[c]))){if(0==c)T/=F;else{var y=R[c-1];T=(T-y)/(F-y)}break}c!=f&&(f=c,u&&c==p?(i.computeWorldVertices(a,_-4,4,s,0,2),i.computeWorldVertices(a,0,4,s,4,2)):i.computeWorldVertices(a,6*c+2,8,s,0,2)),this.addCurvePosition(T,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],d,o,r||0<m&&0==w)}return d}u?(_+=2,s=t.Utils.setArraySize(this.world,_),i.computeWorldVertices(a,2,_-4,s,0,2),i.computeWorldVertices(a,0,2,s,_-4,2),s[_-2]=s[0],s[_-1]=s[1]):(p--,_-=4,s=t.Utils.setArraySize(this.world,_),i.computeWorldVertices(a,2,_,s,0,2)),i=t.Utils.setArraySize(this.curves,p),a=0;for(var E,S,C,v,x,R=s[0],A=(g=s[1],F=0),I=0,b=0,P=0,L=0,w=(m=0,2);m<p;m++,w+=6)F=s[w],A=s[w+1],I=s[w+2],b=s[w+3],v=2*(E=.1875*(R-2*F+I))+(y=.09375*(3*(F-I)-R+(P=s[w+4]))),x=2*(S=.1875*(g-2*A+b))+(C=.09375*(3*(A-b)-g+(L=s[w+5]))),E=.75*(F-R)+E+.16666667*y,S=.75*(A-g)+S+.16666667*C,a+=Math.sqrt(E*E+S*S),E+=v,S+=x,v+=y,x+=C,a+=Math.sqrt(E*E+S*S),E+=v,S+=x,a+=Math.sqrt(E*E+S*S),E+=v+y,S+=x+C,a+=Math.sqrt(E*E+S*S),i[m]=a,R=P,g=L;if(o&&(h*=a),c)for(m=0;m<n;m++)l[m]*=a;p=this.segments;var O=0;for(C=c=o=m=0;m<n;m++,o+=3){if(T=h+=w=l[m],u)0>(T%=a)&&(T+=a),c=0;else{if(0>T){this.addBeforePosition(T,s,0,d,o);continue}if(T>a){this.addAfterPosition(T-a,s,_-4,d,o);continue}}for(;;c++)if(!(T>(v=i[c]))){0==c?T/=v:T=(T-(y=i[c-1]))/(v-y);break}if(c!=f){f=c;var N=6*c,F=(R=s[N],g=s[N+1],s[N+2]);for(A=s[N+3],I=s[N+4],b=s[N+5],v=2*(E=.03*(R-2*F+I))+(y=.006*(3*(F-I)-R+(P=s[N+6]))),x=2*(S=.03*(g-2*A+b))+(C=.006*(3*(A-b)-g+(L=s[N+7]))),E=.3*(F-R)+E+.16666667*y,S=.3*(A-g)+S+.16666667*C,O=Math.sqrt(E*E+S*S),p[0]=O,N=1;8>N;N++)E+=v,S+=x,v+=y,x+=C,O+=Math.sqrt(E*E+S*S),p[N]=O;E+=v,S+=x,O+=Math.sqrt(E*E+S*S),p[8]=O,E+=v+y,S+=x+C,O+=Math.sqrt(E*E+S*S),p[9]=O,C=0}for(T*=O;;C++)if(!(T>(v=p[C]))){0==C?T/=v:T=C+(T-(y=p[C-1]))/(v-y);break}this.addCurvePosition(.1*T,R,g,F,A,I,b,P,L,d,o,r||0<m&&0==w)}return d},e.prototype.addBeforePosition=function(t,e,i,n,r){var o=e[i],c=e[i+1];e=Math.atan2(e[i+3]-c,e[i+2]-o),n[r]=o+t*Math.cos(e),n[r+1]=c+t*Math.sin(e),n[r+2]=e},e.prototype.addAfterPosition=function(t,e,i,n,r){var o=e[i+2],c=e[i+3];e=Math.atan2(c-e[i+1],o-e[i]),n[r]=o+t*Math.cos(e),n[r+1]=c+t*Math.sin(e),n[r+2]=e},e.prototype.addCurvePosition=function(t,e,i,n,r,o,c,s,a,h,l,d){(0==t||isNaN(t))&&(t=1e-4);var u,_=t*t,p=_*t,f=(u=1-t)*u,g=f*u,m=u*t,T=3*m;s=e*g+n*(u*=T)+o*(t*=T)+s*p,a=i*g+r*u+c*t+a*p,h[l]=s,h[l+1]=a,d&&(h[l+2]=Math.atan2(a-(i*f+r*m*2+c*_),s-(e*f+n*m*2+o*_)))},e.prototype.getOrder=function(){return this.data.order},e}();e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,t.PathConstraint=e}(spine||(spine={})),function(t){t.PathConstraintData=function(t){this.order=0,this.bones=[],this.name=t},function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(t.PositionMode||(t.PositionMode={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(t.SpacingMode||(t.SpacingMode={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(t.RotateMode||(t.RotateMode={}))}(spine||(spine={})),function(){var t;Math.fround||(Math.fround=(t=new Float32Array(1),function(e){return t[0]=e,t[0]}))}(),function(t){var e=function(){function t(t){this.toLoad=[],this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t,e=0;for(t in this.assets)e++;return e},t}(),i=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,i,n){var r=this.clientAssets[t];return null==r&&(r=new e(t),this.clientAssets[t]=r),null!==i&&(r.textureLoader=i),r.toLoad.push(n),this.queuedAssets[n]!==n&&(this.queuedAssets[n]=n,!0)},t.prototype.loadText=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200<=n.status&&300>n.status?i.rawAssets[e]=n.responseText:i.errors[e]="Couldn't load text "+e+": status "+n.status+", "+n.responseText)},n.open("GET",e,!0),n.send()}},t.prototype.loadJson=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200<=n.status&&300>n.status?i.rawAssets[e]=JSON.parse(n.responseText):i.errors[e]="Couldn't load text "+e+": status "+n.status+", "+n.responseText)},n.open("GET",e,!0),n.send()}},t.prototype.loadTexture=function(t,e,i){var n=this;if(i=this.pathPrefix+i,this.queueAsset(t,e,i)){var r=new Image;r.src=i,r.crossOrigin="anonymous",r.onload=function(t){n.rawAssets[i]=r},r.onerror=function(t){n.errors[i]="Couldn't load image "+i}}},t.prototype.get=function(t,e){return e=this.pathPrefix+e,null==(t=this.clientAssets[t])||t.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e],n=t.assets[i];null==n&&null!=(n=this.rawAssets[i])&&(t.assets[i]=n instanceof HTMLImageElement?t.textureLoader(n):n)}},t.prototype.isLoadingComplete=function(t){return null==(t=this.clientAssets[t])||(this.updateClientAssets(t),t.toLoad.length==t.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=i}(spine||(spine={})),function(t){var e=function(){function e(e){if(this._updateCache=[],this.updateCacheReset=[],this.time=0,this.flipY=this.flipX=!1,this.y=this.x=0,null==e)throw Error("data cannot be null.");this.data=e,this.bones=[];for(var i=0;i<e.bones.length;i++){if(null==(r=e.bones[i]).parent)r=new t.Bone(r,this,null);else{var n=this.bones[r.parent.index],r=new t.Bone(r,this,n);n.children.push(r)}this.bones.push(r)}for(this.slots=[],this.drawOrder=[],i=0;i<e.slots.length;i++)n=e.slots[i],r=this.bones[n.boneData.index],r=new t.Slot(n,r),this.slots.push(r),this.drawOrder.push(r);for(this.ikConstraints=[],i=0;i<e.ikConstraints.length;i++)this.ikConstraints.push(new t.IkConstraint(e.ikConstraints[i],this));for(this.transformConstraints=[],i=0;i<e.transformConstraints.length;i++)this.transformConstraints.push(new t.TransformConstraint(e.transformConstraints[i],this));for(this.pathConstraints=[],i=0;i<e.pathConstraints.length;i++)this.pathConstraints.push(new t.PathConstraint(e.pathConstraints[i],this));this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].sorted=!1;i=this.ikConstraints;var n=this.transformConstraints,r=this.pathConstraints,o=i.length,c=n.length,s=r.length,a=o+c+s;e=0;t:for(;e<a;e++){for(var h=0;h<o;h++){var l=i[h];if(l.data.order==e){this.sortIkConstraint(l);continue t}}for(h=0;h<c;h++)if((l=n[h]).data.order==e){this.sortTransformConstraint(l);continue t}for(h=0;h<s;h++)if((l=r[h]).data.order==e){this.sortPathConstraint(l);continue t}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(t){this.sortBone(t.target);var e=t.bones,i=e[0];if(this.sortBone(i),1<e.length){var n=e[e.length-1];-1<this._updateCache.indexOf(n)||this.updateCacheReset.push(n)}this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0},e.prototype.sortPathConstraint=function(e){var i=e.target,n=i.data.index,r=i.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(var o=0,c=this.data.skins.length;o<c;o++)this.sortPathConstraintAttachment(this.data.skins[o],n,r);for((o=i.getAttachment())instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(o,r),i=(r=e.bones).length,o=0;o<i;o++)this.sortBone(r[o]);for(this._updateCache.push(e),o=0;o<i;o++)this.sortReset(r[o].children);for(o=0;o<i;o++)r[o].sorted=!0},e.prototype.sortTransformConstraint=function(t){this.sortBone(t.target);var e=t.bones,i=e.length;if(t.data.local)for(var n=0;n<i;n++){var r=e[n];this.sortBone(r.parent),-1<this._updateCache.indexOf(r)||this.updateCacheReset.push(r)}else for(n=0;n<i;n++)this.sortBone(e[n]);for(this._updateCache.push(t),t=0;t<i;t++)this.sortReset(e[t].children);for(t=0;t<i;t++)e[t].sorted=!0},e.prototype.sortPathConstraintAttachment=function(t,e,i){if(t=t.attachments[e])for(var n in t)this.sortPathConstraintAttachmentWith(t[n],i)},e.prototype.sortPathConstraintAttachmentWith=function(e,i){if(e instanceof t.PathAttachment)if(null==(e=e.bones))this.sortBone(i);else{i=this.bones;for(var n=0;n<e.length;){var r=e[n++];for(r=n+r;n<r;n++)this.sortBone(i[e[n]])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.sorted&&this.sortReset(n.children),n.sorted=!1}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(e=0,i=(t=this._updateCache).length;e<i;e++)t[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(e=0,i=n.length;e<i;e++)(t=n[e]).bendDirection=t.data.bendDirection,t.mix=t.data.mix;var r=this.transformConstraints;for(e=0,i=r.length;e<i;e++)n=(t=r[e]).data,t.rotateMix=n.rotateMix,t.translateMix=n.translateMix,t.scaleMix=n.scaleMix,t.shearMix=n.shearMix;for(e=0,i=(r=this.pathConstraints).length;e<i;e++)n=(t=r[e]).data,t.position=n.position,t.spacing=n.spacing,t.rotateMix=n.rotateMix,t.translateMix=n.translateMix},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var i=0,n=e.length;i<n;i++)e[i].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],o=r.data.attachmentName;null!=o&&null!=(o=t.getAttachment(i,o))&&r.setAttachment(o)}this.skin=t},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw Error("slotName cannot be null.");for(var i=this.slots,n=0,r=i.length;n<r;n++){var o=i[n];if(o.data.name==t){if(i=null,null!=e&&null==(i=this.getAttachment(n,e)))throw Error("Attachment not found: "+e+", for slot: "+t);return void o.setAttachment(i)}}throw Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.getBounds=function(e,i,n){if(null==e)throw Error("offset cannot be null.");if(null==i)throw Error("size cannot be null.");for(var r=this.drawOrder,o=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=0,l=r.length;h<l;h++){var d,u=r[h],_=null;if((p=u.getAttachment())instanceof t.RegionAttachment?(d=8,_=t.Utils.setArraySize(n,d,0),p.computeWorldVertices(u.bone,_,0,2)):p instanceof t.MeshAttachment&&(d=p.worldVerticesLength,_=t.Utils.setArraySize(n,d,0),p.computeWorldVertices(u,0,d,_,0,2)),null!=_)for(u=0,d=_.length;u<d;u+=2){var p=_[u],f=_[u+1];o=Math.min(o,p),c=Math.min(c,f),s=Math.max(s,p),a=Math.max(a,f)}}e.set(o,c),i.set(s-o,a-c)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(spine||(spine={})),function(t){var e=function(){function e(){this.maxY=this.maxX=this.minY=this.minX=0,this.boundingBoxes=[],this.polygons=[],this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,i){if(null==e)throw Error("skeleton cannot be null.");var n=this.boundingBoxes,r=this.polygons,o=this.polygonPool,c=(e=e.slots).length;n.length=0,o.freeAll(r);for(var s=r.length=0;s<c;s++){var a=e[s],h=a.getAttachment();if(h instanceof t.BoundingBoxAttachment){n.push(h);var l=o.obtain();l.length!=h.worldVerticesLength&&(l=t.Utils.newFloatArray(h.worldVerticesLength)),r.push(l),h.computeWorldVertices(a,0,h.worldVerticesLength,l,0,2)}}i?this.aabbCompute():(this.minY=this.minX=Number.POSITIVE_INFINITY,this.maxY=this.maxX=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=this.polygons,o=0,c=r.length;o<c;o++)for(var s=h=r[o],a=0,h=h.length;a<h;a+=2){var l=s[a],d=s[a+1];t=Math.min(t,l),e=Math.min(e,d),i=Math.max(i,l),n=Math.max(n,d)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,i,n){var r=this.minX,o=this.minY,c=this.maxX,s=this.maxY;return!(t<=r&&i<=r||e<=o&&n<=o||t>=c&&i>=c||e>=s&&n>=s)&&((n=(i=(n-e)/(i-t))*(r-t)+e)>o&&n<s||(n=i*(c-t)+e)>o&&n<s||(o=(o-e)/i+t)>r&&o<c||(o=(s-e)/i+t)>r&&o<c)},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.containsPointPolygon(i[n],t,e))return this.boundingBoxes[n];return null},e.prototype.containsPointPolygon=function(t,e,i){for(var n=t.length,r=n-2,o=!1,c=0;c<n;c+=2){var s=t[c+1],a=t[r+1];if(s<i&&a>=i||a<i&&s>=i){var h=t[c];h+(i-s)/(a-s)*(t[r]-h)<e&&(o=!o)}r=c}return o},e.prototype.intersectsSegment=function(t,e,i,n){for(var r=this.polygons,o=0,c=r.length;o<c;o++)if(this.intersectsSegmentPolygon(r[o],t,e,i,n))return this.boundingBoxes[o];return null},e.prototype.intersectsSegmentPolygon=function(t,e,i,n,r){for(var o=t.length,c=e-n,s=i-r,a=e*r-i*n,h=t[o-2],l=t[o-1],d=0;d<o;d+=2){var u,_=t[d],p=t[d+1],f=h*p-l*_,g=l-p,m=c*g-s*(u=h-_);if(((u=(a*u-c*f)/m)>=h&&u<=_||u>=_&&u<=h)&&(u>=e&&u<=n||u>=n&&u<=e)&&((h=(a*g-s*f)/m)>=l&&h<=p||h>=p&&h<=l)&&(h>=i&&h<=r||h>=r&&h<=i))return!0;h=_,l=p}return!1},e.prototype.getPolygon=function(t){if(null==t)throw Error("boundingBox cannot be null.");return-1==(t=this.boundingBoxes.indexOf(t))?null:this.polygons[t]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(spine||(spine={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=[],this.clipOutput=[],this.clippedVertices=[],this.clippedTriangles=[],this.scratch=[]}return e.prototype.clipStart=function(i,n){if(null!=this.clipAttachment)return 0;this.clipAttachment=n;var r=n.worldVerticesLength,o=t.Utils.setArraySize(this.clippingPolygon,r);for(n.computeWorldVertices(i,0,r,o,0,2),i=this.clippingPolygon,e.makeClockwise(i),n=0,r=(i=this.clippingPolygons=this.triangulator.decompose(i,this.triangulator.triangulate(i))).length;n<r;n++)o=i[n],e.makeClockwise(o),o.push(o[0]),o.push(o[1]);return i.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clippingPolygons=this.clipAttachment=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,i,n,r,o,c,s,a){i=this.clipOutput;var h=this.clippedVertices,l=this.clippedTriangles,d=this.clippingPolygons,u=this.clippingPolygons.length,_=a?12:8,p=0;h.length=0;var f=l.length=0;t:for(;f<r;f+=3)for(var g=n[f]<<1,m=e[g],T=e[g+1],y=o[g],E=o[g+1],S=(g=n[f+1]<<1,e[g]),C=e[g+1],v=o[g],x=o[g+1],R=(g=n[f+2]<<1,e[g]),A=e[g+1],I=o[g],b=(g=o[g+1],0);b<u;b++){var P=h.length;if(!this.clip(m,T,S,C,R,A,d[b],i)){(V=t.Utils.setArraySize(h,P+3*_))[P]=m,V[P+1]=T,V[P+2]=c.r,V[P+3]=c.g,V[P+4]=c.b,V[P+5]=c.a,a?(V[P+6]=y,V[P+7]=E,V[P+8]=s.r,V[P+9]=s.g,V[P+10]=s.b,V[P+11]=s.a,V[P+12]=S,V[P+13]=C,V[P+14]=c.r,V[P+15]=c.g,V[P+16]=c.b,V[P+17]=c.a,V[P+18]=v,V[P+19]=x,V[P+20]=s.r,V[P+21]=s.g,V[P+22]=s.b,V[P+23]=s.a,V[P+24]=R,V[P+25]=A,V[P+26]=c.r,V[P+27]=c.g,V[P+28]=c.b,V[P+29]=c.a,V[P+30]=I,V[P+31]=g,V[P+32]=s.r,V[P+33]=s.g,V[P+34]=s.b,V[P+35]=s.a):(V[P+6]=y,V[P+7]=E,V[P+8]=S,V[P+9]=C,V[P+10]=c.r,V[P+11]=c.g,V[P+12]=c.b,V[P+13]=c.a,V[P+14]=v,V[P+15]=x,V[P+16]=R,V[P+17]=A,V[P+18]=c.r,V[P+19]=c.g,V[P+20]=c.b,V[P+21]=c.a,V[P+22]=I,V[P+23]=g),P=l.length,(L=t.Utils.setArraySize(l,P+3))[P]=p,L[P+1]=p+1,L[P+2]=p+2,p+=3;continue t}var L=i.length;if(0!=L){for(var w=C-A,O=R-S,N=m-R,F=A-T,D=1/(w*N+O*(T-A)),B=L>>1,M=this.clipOutput,V=t.Utils.setArraySize(h,P+B*_),W=0;W<L;W+=2){var G=M[W],z=M[W+1];V[P]=G,V[P+1]=z,V[P+2]=c.r,V[P+3]=c.g,V[P+4]=c.b,V[P+5]=c.a;var k=1-(z=(w*(G-=R)+O*(k=z-A))*D)-(G=(F*G+N*k)*D);V[P+6]=y*z+v*G+I*k,V[P+7]=E*z+x*G+g*k,a&&(V[P+8]=s.r,V[P+9]=s.g,V[P+10]=s.b,V[P+11]=s.a),P+=_}for(P=l.length,L=t.Utils.setArraySize(l,P+3*(B-2)),B--,W=1;W<B;W++)L[P]=p,L[P+1]=p+W,L[P+2]=p+W+1,P+=3;p+=B+1}}},e.prototype.clip=function(t,e,i,n,r,o,c,s){var a,h=s,l=!1;for(2<=c.length%4?(a=s,s=this.scratch):a=this.scratch,a.length=0,a.push(t),a.push(e),a.push(i),a.push(n),a.push(r),a.push(o),a.push(t),a.push(e),s.length=0,e=c.length-4,t=0;;t+=2){i=c[t],n=c[t+1];for(var d=i-(r=c[t+2]),u=n-(o=c[t+3]),_=a,p=a.length-2,f=s.length,g=0;g<p;g+=2){var m=_[g],T=_[g+1],y=_[g+2],E=_[g+3],S=0<d*(E-o)-u*(y-r);if(0<d*(T-o)-u*(m-r)){if(S){s.push(y),s.push(E);continue}l=((S=y-m)*(n-T)-(l=E-T)*(i-m))/(l*(r-i)-S*(o-n)),s.push(i+(r-i)*l),s.push(n+(o-n)*l)}else S&&(l=((S=y-m)*(n-T)-(l=E-T)*(i-m))/(l*(r-i)-S*(o-n)),s.push(i+(r-i)*l),s.push(n+(o-n)*l),s.push(y),s.push(E));l=!0}if(f==s.length)return h.length=0,!0;if(s.push(s[0]),s.push(s[1]),t==e)break;i=s,(s=a).length=0,a=i}if(h!=s)for(t=h.length=0,c=s.length-2;t<c;t++)h[t]=s[t];else h.length-=2;return l},e.makeClockwise=function(t){for(var e,i,n,r=t.length,o=t[r-2]*t[1]-t[0]*t[r-1],c=0,s=r-3;c<s;c+=2)e=t[c],i=t[c+1],n=t[c+2],o+=e*t[c+3]-n*i;if(!(0>o))for(c=0,o=r-2,s=r>>1;c<s;c+=2)r=t[c],e=t[c+1],i=o-c,t[c]=t[i],t[c+1]=t[i+1],t[i]=r,t[i+1]=e},e}();t.SkeletonClipping=e}(spine||(spine={})),function(t){var e=function(){function t(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[],this.transformConstraints=[],this.pathConstraints=[],this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw Error("skinName cannot be null.");for(var e=this.skins,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findEvent=function(t){if(null==t)throw Error("eventDataName cannot be null.");for(var e=this.events,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findAnimation=function(t){if(null==t)throw Error("animationName cannot be null.");for(var e=this.animations,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t}();t.SkeletonData=e}(spine||(spine={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=[],this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var n=this.scale,r=new t.SkeletonData,o=(i="string"==typeof i?JSON.parse(i):i).skeleton;if(null!=o&&(r.hash=o.hash,r.version=o.spine,r.width=o.width,r.height=o.height,r.fps=o.fps,r.imagesPath=o.images),i.bones)for(o=0;o<i.bones.length;o++){var c=i.bones[o],s=null;if(null!=(h=this.getValue(c,"parent",null))&&null==(s=r.findBone(h)))throw Error("Parent bone not found: "+h);(s=new t.BoneData(r.bones.length,c.name,s)).length=this.getValue(c,"length",0)*n,s.x=this.getValue(c,"x",0)*n,s.y=this.getValue(c,"y",0)*n,s.rotation=this.getValue(c,"rotation",0),s.scaleX=this.getValue(c,"scaleX",1),s.scaleY=this.getValue(c,"scaleY",1),s.shearX=this.getValue(c,"shearX",0),s.shearY=this.getValue(c,"shearY",0),s.transformMode=e.transformModeFromString(this.getValue(c,"transform","normal")),r.bones.push(s)}if(i.slots)for(o=0;o<i.slots.length;o++){var a=(c=i.slots[o]).name,h=c.bone;if(null==(s=r.findBone(h)))throw Error("Slot bone not found: "+h);s=new t.SlotData(r.slots.length,a,s),null!=(h=this.getValue(c,"color",null))&&s.color.setFromString(h),null!=(h=this.getValue(c,"dark",null))&&(s.darkColor=new t.Color(1,1,1,1),s.darkColor.setFromString(h)),s.attachmentName=this.getValue(c,"attachment",null),s.blendMode=e.blendModeFromString(this.getValue(c,"blend","normal")),r.slots.push(s)}if(i.ik)for(o=0;o<i.ik.length;o++){c=i.ik[o],(s=new t.IkConstraintData(c.name)).order=this.getValue(c,"order",0);for(var l=0;l<c.bones.length;l++){h=c.bones[l];var d=r.findBone(h);if(null==d)throw Error("IK bone not found: "+h);s.bones.push(d)}if(h=c.target,s.target=r.findBone(h),null==s.target)throw Error("IK target bone not found: "+h);s.bendDirection=this.getValue(c,"bendPositive",!0)?1:-1,s.mix=this.getValue(c,"mix",1),r.ikConstraints.push(s)}if(i.transform)for(o=0;o<i.transform.length;o++){for(c=i.transform[o],(s=new t.TransformConstraintData(c.name)).order=this.getValue(c,"order",0),l=0;l<c.bones.length;l++){if(h=c.bones[l],null==(d=r.findBone(h)))throw Error("Transform constraint bone not found: "+h);s.bones.push(d)}if(h=c.target,s.target=r.findBone(h),null==s.target)throw Error("Transform constraint target bone not found: "+h);s.local=this.getValue(c,"local",!1),s.relative=this.getValue(c,"relative",!1),s.offsetRotation=this.getValue(c,"rotation",0),s.offsetX=this.getValue(c,"x",0)*n,s.offsetY=this.getValue(c,"y",0)*n,s.offsetScaleX=this.getValue(c,"scaleX",0),s.offsetScaleY=this.getValue(c,"scaleY",0),s.offsetShearY=this.getValue(c,"shearY",0),s.rotateMix=this.getValue(c,"rotateMix",1),s.translateMix=this.getValue(c,"translateMix",1),s.scaleMix=this.getValue(c,"scaleMix",1),s.shearMix=this.getValue(c,"shearMix",1),r.transformConstraints.push(s)}if(i.path)for(o=0;o<i.path.length;o++){for(c=i.path[o],(s=new t.PathConstraintData(c.name)).order=this.getValue(c,"order",0),l=0;l<c.bones.length;l++){if(h=c.bones[l],null==(d=r.findBone(h)))throw Error("Transform constraint bone not found: "+h);s.bones.push(d)}if(h=c.target,s.target=r.findSlot(h),null==s.target)throw Error("Path target slot not found: "+h);s.positionMode=e.positionModeFromString(this.getValue(c,"positionMode","percent")),s.spacingMode=e.spacingModeFromString(this.getValue(c,"spacingMode","length")),s.rotateMode=e.rotateModeFromString(this.getValue(c,"rotateMode","tangent")),s.offsetRotation=this.getValue(c,"rotation",0),s.position=this.getValue(c,"position",0),s.positionMode==t.PositionMode.Fixed&&(s.position*=n),s.spacing=this.getValue(c,"spacing",0),s.spacingMode!=t.SpacingMode.Length&&s.spacingMode!=t.SpacingMode.Fixed||(s.spacing*=n),s.rotateMix=this.getValue(c,"rotateMix",1),s.translateMix=this.getValue(c,"translateMix",1),r.pathConstraints.push(s)}if(i.skins)for(var u in i.skins){for(a in o=i.skins[u],n=new t.Skin(u),o){if(-1==(s=r.findSlotIndex(a)))throw Error("Slot not found: "+a);var _;for(_ in c=o[a])null!=(h=this.readAttachment(c[_],n,s,_,r))&&n.addAttachment(s,_,h)}r.skins.push(n),"default"==n.name&&(r.defaultSkin=n)}for(o=0,a=this.linkedMeshes.length;o<a;o++){if(null==(n=null==(u=this.linkedMeshes[o]).skin?r.defaultSkin:r.findSkin(u.skin)))throw Error("Skin not found: "+u.skin);if(null==(_=n.getAttachment(u.slotIndex,u.parent)))throw Error("Parent mesh not found: "+u.parent);u.mesh.setParentMesh(_),u.mesh.updateUVs()}if(this.linkedMeshes.length=0,i.events)for(var p in i.events)a=i.events[p],(s=new t.EventData(p)).intValue=this.getValue(a,"int",0),s.floatValue=this.getValue(a,"float",0),s.stringValue=this.getValue(a,"string",""),r.events.push(s);if(i.animations)for(var f in i.animations)this.readAnimation(i.animations[f],f,r);return r},e.prototype.readAttachment=function(e,n,r,o,c){var s=this.scale;switch(o=this.getValue(e,"name",o),this.getValue(e,"type","region")){case"region":if(c=this.getValue(e,"path",o),null==(r=this.attachmentLoader.newRegionAttachment(n,o,c)))break;return r.path=c,r.x=this.getValue(e,"x",0)*s,r.y=this.getValue(e,"y",0)*s,r.scaleX=this.getValue(e,"scaleX",1),r.scaleY=this.getValue(e,"scaleY",1),r.rotation=this.getValue(e,"rotation",0),r.width=e.width*s,r.height=e.height*s,null!=(s=this.getValue(e,"color",null))&&r.color.setFromString(s),r.updateOffset(),r;case"boundingbox":if(null==(c=this.attachmentLoader.newBoundingBoxAttachment(n,o)))break;return this.readVertices(e,c,e.vertexCount<<1),null!=(s=this.getValue(e,"color",null))&&c.color.setFromString(s),c;case"mesh":case"linkedmesh":if(c=this.getValue(e,"path",o),null==(n=this.attachmentLoader.newMeshAttachment(n,o,c)))break;return n.path=c,null!=(s=this.getValue(e,"color",null))&&n.color.setFromString(s),null!=(s=this.getValue(e,"parent",null))?(n.inheritDeform=this.getValue(e,"deform",!0),this.linkedMeshes.push(new i(n,this.getValue(e,"skin",null),r,s)),n):(s=e.uvs,this.readVertices(e,n,s.length),n.triangles=e.triangles,n.regionUVs=s,n.updateUVs(),n.hullLength=2*this.getValue(e,"hull",0),n);case"path":if(null==(c=this.attachmentLoader.newPathAttachment(n,o)))break;for(c.closed=this.getValue(e,"closed",!1),c.constantSpeed=this.getValue(e,"constantSpeed",!0),n=e.vertexCount,this.readVertices(e,c,n<<1),r=t.Utils.newArray(n/3,0),n=0;n<e.lengths.length;n++)r[n]=e.lengths[n]*s;return c.lengths=r,null!=(s=this.getValue(e,"color",null))&&c.color.setFromString(s),c;case"point":if(null==(c=this.attachmentLoader.newPointAttachment(n,o)))break;return c.x=this.getValue(e,"x",0)*s,c.y=this.getValue(e,"y",0)*s,c.rotation=this.getValue(e,"rotation",0),null!=(s=this.getValue(e,"color",null))&&c.color.setFromString(s),c;case"clipping":if(null!=(r=this.attachmentLoader.newClippingAttachment(n,o))){if(null!=(s=this.getValue(e,"end",null))){if(null==(c=c.findSlot(s)))throw Error("Clipping end slot not found: "+s);r.endSlot=c}return n=e.vertexCount,this.readVertices(e,r,n<<1),null!=(s=this.getValue(e,"color",null))&&r.color.setFromString(s),r}}return null},e.prototype.readVertices=function(e,i,n){var r=this.scale;if(i.worldVerticesLength=n,n==(e=e.vertices).length){var o=t.Utils.toFloatArray(e);if(1!=r){n=0;for(var c=e.length;n<c;n++)o[n]*=r}i.vertices=o}else{o=[];var s=[];for(n=0,c=e.length;n<c;){var a=e[n++];for(s.push(a),a=n+4*a;n<a;n+=4)s.push(e[n]),o.push(e[n+1]*r),o.push(e[n+2]*r),o.push(e[n+3])}i.bones=s,i.vertices=t.Utils.toFloatArray(o)}},e.prototype.readAnimation=function(e,i,n){var r=this.scale,o=[],c=0;if(e.slots)for(var s in e.slots){var a=e.slots[s],h=n.findSlotIndex(s);if(-1==h)throw Error("Slot not found: "+s);for(var l in a){var d=a[l];if("attachment"==l){(S=new t.AttachmentTimeline(d.length)).slotIndex=h;for(var u=0,_=0;_<d.length;_++){var p=d[_];S.setFrame(u++,p.time,p.name)}o.push(S),c=Math.max(c,S.frames[S.getFrameCount()-1])}else if("color"==l){for((S=new t.ColorTimeline(d.length)).slotIndex=h,_=u=0;_<d.length;_++)p=d[_],(f=new t.Color).setFromString(p.color),S.setFrame(u,p.time,f.r,f.g,f.b,f.a),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=l)throw Error("Invalid timeline type for a slot: "+l+" ("+s+")");for((S=new t.TwoColorTimeline(d.length)).slotIndex=h,_=u=0;_<d.length;_++){p=d[_];var f=new t.Color,g=new t.Color;f.setFromString(p.light),g.setFromString(p.dark),S.setFrame(u,p.time,f.r,f.g,f.b,f.a,g.r,g.g,g.b),this.readCurve(p,S,u),u++}o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var m in e.bones){if(a=e.bones[m],-1==(f=n.findBoneIndex(m)))throw Error("Bone not found: "+m);for(l in a)if(d=a[l],"rotate"===l){for((S=new t.RotateTimeline(d.length)).boneIndex=f,_=u=0;_<d.length;_++)p=d[_],S.setFrame(u,p.time,p.angle),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw Error("Invalid timeline type for a bone: "+l+" ("+m+")");for(h=1,"scale"===l?S=new t.ScaleTimeline(d.length):"shear"===l?S=new t.ShearTimeline(d.length):(S=new t.TranslateTimeline(d.length),h=r),S.boneIndex=f,_=u=0;_<d.length;_++){p=d[_],g=this.getValue(p,"x",0);var T=this.getValue(p,"y",0);S.setFrame(u,p.time,g*h,T*h),this.readCurve(p,S,u),u++}o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var y in e.ik){for(a=e.ik[y],u=n.findIkConstraint(y),(S=new t.IkConstraintTimeline(a.length)).ikConstraintIndex=n.ikConstraints.indexOf(u),_=u=0;_<a.length;_++)p=a[_],S.setFrame(u,p.time,this.getValue(p,"mix",1),this.getValue(p,"bendPositive",!0)?1:-1),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(y in e.transform){for(a=e.transform[y],u=n.findTransformConstraint(y),(S=new t.TransformConstraintTimeline(a.length)).transformConstraintIndex=n.transformConstraints.indexOf(u),_=u=0;_<a.length;_++)p=a[_],S.setFrame(u,p.time,this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1),this.getValue(p,"scaleMix",1),this.getValue(p,"shearMix",1)),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}if(e.paths)for(y in e.paths){if(a=e.paths[y],-1==(m=n.findPathConstraintIndex(y)))throw Error("Path constraint not found: "+y);for(l in f=n.pathConstraints[m],a)if(d=a[l],"position"===l||"spacing"===l){for(h=1,"spacing"===l?(S=new t.PathConstraintSpacingTimeline(d.length),(f.spacingMode==t.SpacingMode.Length||f.spacingMode==t.SpacingMode.Fixed)&&(h=r)):(S=new t.PathConstraintPositionTimeline(d.length),f.positionMode==t.PositionMode.Fixed&&(h=r)),S.pathConstraintIndex=m,_=u=0;_<d.length;_++)p=d[_],S.setFrame(u,p.time,this.getValue(p,l,0)*h),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===l){for((S=new t.PathConstraintMixTimeline(d.length)).pathConstraintIndex=m,_=u=0;_<d.length;_++)p=d[_],S.setFrame(u,p.time,this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1)),this.readCurve(p,S,u),u++;o.push(S),c=Math.max(c,S.frames[(S.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var E in e.deform){if(m=e.deform[E],null==(f=n.findSkin(E)))throw Error("Skin not found: "+E);for(s in m){if(a=m[s],-1==(h=n.findSlotIndex(s)))throw Error("Slot not found: "+a.name);for(l in a){if(d=a[l],null==(u=f.getAttachment(h,l)))throw Error("Deform attachment not found: "+d.name);g=null!=u.bones,T=u.vertices;var S,C=g?T.length/3*2:T.length;for((S=new t.DeformTimeline(d.length)).slotIndex=h,S.attachment=u,y=u=0;y<d.length;y++){p=d[y];var v,x=this.getValue(p,"vertices",null);if(null==x)v=g?t.Utils.newFloatArray(C):T;else{if(v=t.Utils.newFloatArray(C),_=this.getValue(p,"offset",0),t.Utils.arrayCopy(x,0,v,_,x.length),1!=r)for(x=_+x.length;_<x;_++)v[_]*=r;if(!g)for(_=0;_<C;_++)v[_]+=T[_]}S.setFrame(u,p.time,v),this.readCurve(p,S,u),u++}o.push(S),c=Math.max(c,S.frames[S.getFrameCount()-1])}}}if(null==(r=e.drawOrder)&&(r=e.draworder),null!=r){for(S=new t.DrawOrderTimeline(r.length),s=n.slots.length,y=u=0;y<r.length;y++){if(l=r[y],E=null,null!=(d=this.getValue(l,"offsets",null))){for(E=t.Utils.newArray(s,-1),p=t.Utils.newArray(s-d.length,0),_=m=a=0;_<d.length;_++){if(f=d[_],-1==(h=n.findSlotIndex(f.slot)))throw Error("Slot not found: "+f.slot);for(;a!=h;)p[m++]=a++;E[a+f.offset]=a++}for(;a<s;)p[m++]=a++;for(_=s-1;0<=_;_--)-1==E[_]&&(E[_]=p[--m])}S.setFrame(u++,l.time,E)}o.push(S),c=Math.max(c,S.frames[S.getFrameCount()-1])}if(e.events){for(S=new t.EventTimeline(e.events.length),_=u=0;_<e.events.length;_++){if(r=e.events[_],null==(s=n.findEvent(r.name)))throw Error("Event not found: "+r.name);(h=new t.Event(t.Utils.toSinglePrecision(r.time),s)).intValue=this.getValue(r,"int",s.intValue),h.floatValue=this.getValue(r,"float",s.floatValue),h.stringValue=this.getValue(r,"string",s.stringValue),S.setFrame(u++,h)}o.push(S),c=Math.max(c,S.frames[S.getFrameCount()-1])}if(isNaN(c))throw Error("Error while parsing animation, duration is NaN");n.animations.push(new t.Animation(i,o,c))},e.prototype.readCurve=function(t,e,i){t.curve&&("stepped"===t.curve?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(t.curve)&&(t=t.curve,e.setCurve(i,t[0],t[1],t[2],t[3])))},e.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var i=function(t,e,i,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n}}(spine||(spine={})),function(t){var e=function(){function t(t){if(this.attachments=[],null==t)throw Error("name cannot be null.");this.name=t}return t.prototype.addAttachment=function(t,e,i){if(null==i)throw Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=i},t.prototype.getAttachment=function(t,e){return(t=this.attachments[t])?t[e]:null},t.prototype.attachAll=function(t,e){for(var i=0,n=0;n<t.slots.length;n++){var r=t.slots[n],o=r.getAttachment();if(o&&i<e.attachments.length){var c,s=e.attachments[i];for(c in s)if(o==s[c]){null!=(o=this.getAttachment(i,c))&&r.setAttachment(o);break}}i++}},t}();t.Skin=e}(spine||(spine={})),function(t){var e=function(){function e(e,i){if(this.attachmentVertices=[],null==e)throw Error("data cannot be null.");if(null==i)throw Error("bone cannot be null.");this.data=e,this.bone=i,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(spine||(spine={})),function(t){t.SlotData=function(e,i,n){if(this.color=new t.Color(1,1,1,1),0>e)throw Error("index must be >= 0.");if(null==i)throw Error("name cannot be null.");if(null==n)throw Error("boneData cannot be null.");this.index=e,this.name=i,this.boneData=n}}(spine||(spine={})),function(t){var e,i,n=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw Error("Unknown texture wrap "+t)}},t}();t.Texture=n,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(i=t.TextureWrap||(t.TextureWrap={})),n=function(){this.height=this.width=this.v2=this.u2=this.v=this.u=0,this.rotate=!1,this.originalHeight=this.originalWidth=this.offsetY=this.offsetX=0},t.TextureRegion=n}(spine||(spine={})),function(t){var e=function(){function e(t,e){this.pages=[],this.regions=[],this.load(t,e)}return e.prototype.load=function(e,o){if(null==o)throw Error("textureLoader cannot be null.");e=new i(e);for(var c=Array(4),s=null;null!=(h=e.readLine());)if(0==(h=h.trim()).length)s=null;else if(s){var a=new r;a.name=h,a.page=s,a.rotate="true"==e.readValue(),e.readTuple(c);var h=parseInt(c[0]),l=parseInt(c[1]);e.readTuple(c);var d=parseInt(c[0]),u=parseInt(c[1]);a.u=h/s.width,a.v=l/s.height,a.rotate?(a.u2=(h+u)/s.width,a.v2=(l+d)/s.height):(a.u2=(h+d)/s.width,a.v2=(l+u)/s.height),a.x=h,a.y=l,a.width=Math.abs(d),a.height=Math.abs(u),4==e.readTuple(c)&&4==e.readTuple(c)&&e.readTuple(c),a.originalWidth=parseInt(c[0]),a.originalHeight=parseInt(c[1]),e.readTuple(c),a.offsetX=parseInt(c[0]),a.offsetY=parseInt(c[1]),a.index=parseInt(e.readValue()),a.texture=s.texture,this.regions.push(a)}else(s=new n).name=h,2==e.readTuple(c)&&(s.width=parseInt(c[0]),s.height=parseInt(c[1]),e.readTuple(c)),e.readTuple(c),s.minFilter=t.Texture.filterFromString(c[0]),s.magFilter=t.Texture.filterFromString(c[1]),a=e.readValue(),s.uWrap=t.TextureWrap.ClampToEdge,s.vWrap=t.TextureWrap.ClampToEdge,"x"==a?s.uWrap=t.TextureWrap.Repeat:"y"==a?s.vWrap=t.TextureWrap.Repeat:"xy"==a&&(s.uWrap=s.vWrap=t.TextureWrap.Repeat),s.texture=o(h),s.texture.setFilters(s.minFilter,s.magFilter),s.texture.setWraps(s.uWrap,s.vWrap),s.width=s.texture.getImage().width,s.height=s.texture.getImage().height,this.pages.push(s)},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var i=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine();if(-1==(n=e.indexOf(":")))throw Error("Invalid line: "+e);for(var i=0,n=n+1;3>i;i++){var r=e.indexOf(",",n);if(-1==r)break;t[i]=e.substr(n,r-n).trim(),n=r+1}return t[i]=e.substring(n).trim(),i+1},t}(),n=function(){};t.TextureAtlasPage=n;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=r}(spine||(spine={})),function(t){var e=function(){function e(e,i){if(this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0,this.temp=new t.Vector2,null==e)throw Error("data cannot be null.");if(null==i)throw Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=[];for(var n=0;n<e.bones.length;n++)this.bones.push(i.findBone(e.bones[n].name));this.target=i.findBone(e.target.name)}return e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,i=this.translateMix,n=this.scaleMix,r=this.shearMix,o=this.target,c=o.a,s=o.b,a=o.c,h=o.d,l=0<c*h-s*a?t.MathUtils.degRad:-t.MathUtils.degRad,d=this.data.offsetRotation*l,u=(l=this.data.offsetShearY*l,this.bones),_=0,p=u.length;_<p;_++){var f=u[_],g=!1;if(0!=e){var m=f.a,T=(g=f.b,f.c),y=f.d;(E=Math.atan2(a,c)-Math.atan2(T,m)+d)>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2);var E=E*e,S=Math.cos(E);E=Math.sin(E),f.a=S*m-E*T,f.b=S*g-E*y,f.c=E*m+S*T,f.d=E*g+S*y,g=!0}0!=i&&(g=this.temp,o.localToWorld(g.set(this.data.offsetX,this.data.offsetY)),f.worldX+=(g.x-f.worldX)*i,f.worldY+=(g.y-f.worldY)*i,g=!0),0<n&&(g=Math.sqrt(f.a*f.a+f.c*f.c),y=Math.sqrt(c*c+a*a),1e-5<g&&(g=(g+(y-g+this.data.offsetScaleX)*n)/g),f.a*=g,f.c*=g,g=Math.sqrt(f.b*f.b+f.d*f.d),y=Math.sqrt(s*s+h*h),1e-5<g&&(g=(g+(y-g+this.data.offsetScaleY)*n)/g),f.b*=g,f.d*=g,g=!0),0<r&&(g=f.b,y=f.d,m=Math.atan2(y,g),(E=Math.atan2(h,s)-Math.atan2(a,c)-(m-Math.atan2(f.c,f.a)))>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E=m+(E+l)*r,g=Math.sqrt(g*g+y*y),f.b=Math.cos(E)*g,f.d=Math.sin(E)*g,g=!0),g&&(f.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,i=this.translateMix,n=this.scaleMix,r=this.shearMix,o=this.target,c=o.a,s=o.b,a=o.c,h=o.d,l=0<c*h-s*a?t.MathUtils.degRad:-t.MathUtils.degRad,d=this.data.offsetRotation*l,u=(l=this.data.offsetShearY*l,this.bones),_=0,p=u.length;_<p;_++){var f=u[_],g=!1;if(0!=e){g=f.a;var m=f.b,T=f.c,y=f.d;(E=Math.atan2(a,c)+d)>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2);var E=E*e,S=Math.cos(E);E=Math.sin(E),f.a=S*g-E*T,f.b=S*m-E*y,f.c=E*g+S*T,f.d=E*m+S*y,g=!0}0!=i&&(g=this.temp,o.localToWorld(g.set(this.data.offsetX,this.data.offsetY)),f.worldX+=g.x*i,f.worldY+=g.y*i,g=!0),0<n&&(g=(Math.sqrt(c*c+a*a)-1+this.data.offsetScaleX)*n+1,f.a*=g,f.c*=g,g=(Math.sqrt(s*s+h*h)-1+this.data.offsetScaleY)*n+1,f.b*=g,f.d*=g,g=!0),0<r&&((E=Math.atan2(h,s)-Math.atan2(a,c))>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),m=f.b,y=f.d,E=Math.atan2(y,m)+(E-t.MathUtils.PI/2+l)*r,g=Math.sqrt(m*m+y*y),f.b=Math.cos(E)*g,f.d=Math.sin(E)*g,g=!0),g&&(f.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var o=this.bones,c=0,s=o.length;c<s;c++){var a=o[c];a.appliedValid||a.updateAppliedTransform();var h,l=a.arotation;if(0!=t)l+=(h=(h=r.arotation-l+this.data.offsetRotation)-360*(16384-(16384.499999999996-h/360|0)))*t;var d=a.ax,u=a.ay;0!=e&&(d+=(r.ax-d+this.data.offsetX)*e,u+=(r.ay-u+this.data.offsetY)*e);var _=a.ascaleX,p=a.ascaleY;0<i&&(1e-5<_&&(_=(_+(r.ascaleX-_+this.data.offsetScaleX)*i)/_),1e-5<p&&(p=(p+(r.ascaleY-p+this.data.offsetScaleY)*i)/p));var f=a.ashearY;0<n&&(h=r.ashearY-f+this.data.offsetShearY,h-=360*(16384-(16384.499999999996-h/360|0)),a.shearY+=h*n),a.updateWorldTransformWith(d,u,l,_,p,a.ashearX,f)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var o=this.bones,c=0,s=o.length;c<s;c++){var a=o[c];a.appliedValid||a.updateAppliedTransform();var h=a.arotation;0!=t&&(h+=(r.arotation+this.data.offsetRotation)*t);var l=a.ax,d=a.ay;0!=e&&(l+=(r.ax+this.data.offsetX)*e,d+=(r.ay+this.data.offsetY)*e);var u=a.ascaleX,_=a.ascaleY;0<i&&(1e-5<u&&(u*=(r.ascaleX-1+this.data.offsetScaleX)*i+1),1e-5<_&&(_*=(r.ascaleY-1+this.data.offsetScaleY)*i+1));var p=a.ashearY;0<n&&(p+=(r.ashearY+this.data.offsetShearY)*n),a.updateWorldTransformWith(l,d,h,u,_,a.ashearX,p)}},e.prototype.getOrder=function(){return this.data.order},e}();t.TransformConstraint=e}(spine||(spine={})),(spine||(spine={})).TransformConstraintData=function(t){if(this.order=0,this.bones=[],this.offsetShearY=this.offsetScaleY=this.offsetScaleX=this.offsetY=this.offsetX=this.offsetRotation=this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0,this.local=this.relative=!1,null==t)throw Error("name cannot be null.");this.name=t},function(t){var e=function(){function e(){this.convexPolygons=[],this.convexPolygonsIndices=[],this.indicesArray=[],this.isConcaveArray=[],this.triangles=[],this.polygonPool=new t.Pool((function(){return[]})),this.polygonIndicesPool=new t.Pool((function(){return[]}))}return e.prototype.triangulate=function(t){for(var i=t.length>>1,n=this.indicesArray,r=n.length=0;r<i;r++)n[r]=r;for(var o=this.isConcaveArray,c=(r=o.length=0,i);r<c;++r)o[r]=e.isConcave(r,i,t,n);for((c=this.triangles).length=0;3<i;){for(var s=i-1,a=(r=0,1);;){t:if(!o[r]){for(var h=n[s]<<1,l=n[r]<<1,d=n[a]<<1,u=t[h],_=(h=t[h+1],t[l]),p=(l=t[l+1],t[d]),f=(d=t[d+1],(a+1)%i);f!=s;f=(f+1)%i)if(o[f]){var g=t[m=n[f]<<1],m=t[m+1];if(e.positiveArea(p,d,u,h,g,m)&&e.positiveArea(u,h,_,l,g,m)&&e.positiveArea(_,l,p,d,g,m))break t}break}if(0==a){do{if(!o[r])break;r--}while(0<r);break}s=r,r=a,a=(a+1)%i}c.push(n[(i+r-1)%i]),c.push(n[r]),c.push(n[(r+1)%i]),n.splice(r,1),o.splice(r,1),s=(--i+r-1)%i,r=r==i?0:r,o[s]=e.isConcave(s,i,t,n),o[r]=e.isConcave(r,i,t,n)}return 3==i&&(c.push(n[2]),c.push(n[0]),c.push(n[1])),c},e.prototype.decompose=function(t,i){var n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var r=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(r),r.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var c=this.polygonPool.obtain();c.length=0;for(var s=-1,a=0,h=0,l=i.length;h<l;h+=3){var d=i[h]<<1,u=i[h+1]<<1,_=i[h+2]<<1,p=t[d],f=t[d+1],g=t[u],m=t[u+1],T=t[_],y=t[_+1],E=!1;if(s==d){var S=c.length-4,C=(S=e.winding(c[S],c[S+1],c[S+2],c[S+3],T,y),e.winding(T,y,c[0],c[1],c[2],c[3]));S==a&&C==a&&(c.push(T),c.push(y),o.push(_),E=!0)}E||(0<c.length?(n.push(c),r.push(o)):(this.polygonPool.free(c),this.polygonIndicesPool.free(o)),(c=this.polygonPool.obtain()).length=0,c.push(p),c.push(f),c.push(g),c.push(m),c.push(T),c.push(y),(o=this.polygonIndicesPool.obtain()).length=0,o.push(d),o.push(u),o.push(_),a=e.winding(p,f,g,m,T,y),s=d)}for(0<c.length&&(n.push(c),r.push(o)),h=0,l=n.length;h<l;h++)if(0!=(o=r[h]).length)for(t=o[0],i=o[o.length-1],s=(c=n[h])[S=c.length-4],a=c[S+1],d=c[S+2],u=c[S+3],_=c[0],p=c[1],f=c[2],g=c[3],m=e.winding(s,a,d,u,_,p),E=0;E<l;E++)if(E!=h){var v=r[E];if(3==v.length){S=v[0],C=v[1];var x=v[2],R=n[E];T=R[R.length-2],y=R[R.length-1],S==t&&C==i&&(S=e.winding(s,a,d,u,T,y),C=e.winding(T,y,_,p,f,g),S==m&&C==m&&(R.length=0,v.length=0,c.push(T),c.push(y),o.push(x),s=d,a=u,d=T,u=y,E=0))}}for(h=n.length-1;0<=h;h--)0==(c=n[h]).length&&(n.splice(h,1),this.polygonPool.free(c),o=r[h],r.splice(h,1),this.polygonIndicesPool.free(o));return n},e.isConcave=function(t,e,i,n){var r=n[(e+t-1)%e]<<1,o=n[t]<<1;return t=n[(t+1)%e]<<1,!this.positiveArea(i[r],i[r+1],i[o],i[o+1],i[t],i[t+1])},e.positiveArea=function(t,e,i,n,r,o){return 0<=t*(o-n)+i*(e-o)+r*(n-e)},e.winding=function(t,e,i,n,r,o){return 0<=r*(n-=e)-o*(i-=t)+i*e-t*n?1:-1},e}();t.Triangulator=e}(spine||(spine={})),function(t){var e=function(){function t(){this.array=[]}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e,e=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=e,this.b=i,this.a=n}return t.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp(),this},t.prototype.clamp=function(){return 0>this.r?this.r=0:1<this.r&&(this.r=1),0>this.g?this.g=0:1<this.g&&(this.g=1),0>this.b?this.b=0:1<this.b&&(this.b=1),0>this.a?this.a=0:1<this.a&&(this.a=1),this},t}(),e.WHITE=new e(1,1,1,1),e.RED=new e(1,0,0,1),e.GREEN=new e(0,1,0,1),e.BLUE=new e(0,0,1,1),e.MAGENTA=new e(1,0,1,1),t.Color=e,e=function(){function t(){}return t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return 0<t?1:0>t?-1:0},t.toInt=function(t){return 0<t?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return 0>t?-e:e},t.randomTriangular=function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))},t.randomTriangularWith=function(t,e,i){var n=Math.random(),r=e-t;return n<=(i-t)/r?t+Math.sqrt(n*r*(i-t)):e-Math.sqrt((1-n)*r*(e-i))},t}(),e.PI=3.1415927,e.PI2=2*e.PI,e.radiansToDegrees=180/e.PI,e.radDeg=e.radiansToDegrees,e.degreesToRadians=e.PI/180,e.degRad=e.degreesToRadians,t.MathUtils=e,e=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}(),t.Interpolation=e,e=function(t){function e(e){var i=t.call(this)||this;return i.power=2,i.power=e,i}return __extends(e,t),e.prototype.applyInternal=function(t){return.5>=t?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(0==this.power%2?-2:2)+1},e}(e),t.Pow=e,e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(0==this.power%2?-1:1)+1},e}(e),t.PowOut=e,e=function(){function t(){}return t.arrayCopy=function(t,e,i,n,r){for(var o=e;o<e+r;o++,n++)i[n]=t[o]},t.setArraySize=function(t,e,i){void 0===i&&(i=0);var n=t.length;if(n==e)return t;if(t.length=e,n<e)for(;n<e;n++)t[n]=i;return t},t.ensureArrayCapacity=function(e,i,n){return void 0===n&&(n=0),e.length>=i?e:t.setArraySize(e,i,n)},t.newArray=function(t,e){for(var i=Array(t),n=0;n<t;n++)i[n]=e;return i},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);e=Array(e);for(var i=0;i<e.length;i++)e[i]=0;return e},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);e=Array(e);for(var i=0;i<e.length;i++)e[i]=0;return e},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t}(),e.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t.Utils=e,e=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t}(),t.DebugUtils=e,e=function(){function t(t){this.items=[],this.instantiator=t}return t.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}(),t.Pool=e,e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}(),t.Vector2=e,e=function(){function t(){this.maxDelta=.064,this.totalTime=this.delta=this.framesPerSecond=0,this.lastTime=Date.now()/1e3,this.frameTime=this.frameCount=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameCount=this.frameTime=0)},t}(),t.TimeKeeper=e,e=function(){function t(t){void 0===t&&(t=32),this.mean=this.lastValue=this.addedValues=0,this.dirty=!0,this.values=Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}(),t.WindowedMean=e}(spine||(spine={})),function(t){var e=function(t){if(null==t)throw Error("name cannot be null.");this.name=t};t.Attachment=e,e=function(t){function e(i){return(i=t.call(this,i)||this).id=(65535&e.nextID++)<<11,i.worldVerticesLength=0,i}return __extends(e,t),e.prototype.computeWorldVertices=function(t,e,i,n,r,o){i=r+(i>>1)*o;var c=t.bone.skeleton,s=t.attachmentVertices,a=this.vertices;if(null==(h=this.bones)){0<s.length&&(a=s),s=(t=t.bone).worldX;var h=t.worldY,l=t.a,d=(c=t.b,t.c);t=t.d;for(var u=e;r<i;u+=2,r+=o){e=a[u];var _=a[u+1];n[r]=e*l+_*c+s,n[r+1]=e*d+_*t+h}}else{for(_=t=l=0;_<e;_+=2)l+=(d=h[l])+1,t+=d;if(u=c.bones,0==s.length)for(c=3*t;r<i;r+=o){var p=0,f=0;for(d=(d=h[l++])+l;l<d;l++,c+=3){t=u[h[l]],e=a[c],_=a[c+1];var g=a[c+2];p+=(e*t.a+_*t.b+t.worldX)*g,f+=(e*t.c+_*t.d+t.worldY)*g}n[r]=p,n[r+1]=f}else{c=3*t;for(var m=t<<1;r<i;r+=o){for(f=p=0,d=h[l++],d+=l;l<d;l++,c+=3,m+=2)t=u[h[l]],e=a[c]+s[m],_=a[c+1]+s[m+1],g=a[c+2],p+=(e*t.a+_*t.b+t.worldX)*g,f+=(e*t.c+_*t.d+t.worldY)*g;n[r]=p,n[r+1]=f}}}},e.prototype.applyDeform=function(t){return this==t},e}(e),e.nextID=0,t.VertexAttachment=e}(spine||(spine={})),function(t){(t=t.AttachmentType||(t.AttachmentType={}))[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point"}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).color=new t.Color(1,1,1,1),i}return __extends(i,e),i}(t.VertexAttachment);t.BoundingBoxAttachment=e}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).color=new t.Color(.2275,.2275,.8078,1),i}return __extends(i,e),i}(t.VertexAttachment);t.ClippingAttachment=e}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).color=new t.Color(1,1,1,1),i.inheritDeform=!1,i.tempColor=new t.Color(0,0,0,0),i}return __extends(i,e),i.prototype.updateUVs=function(){var e,i,n,r;null==this.region?(e=i=0,n=r=1):(e=this.region.u,i=this.region.v,n=this.region.u2-e,r=this.region.v2-i);var o=this.regionUVs;null!=this.uvs&&this.uvs.length==o.length||(this.uvs=t.Utils.newFloatArray(o.length));var c=this.uvs;if(this.region.rotate)for(var s=0,a=c.length;s<a;s+=2)c[s]=e+o[s+1]*n,c[s+1]=i+r-o[s]*r;else for(s=0,a=c.length;s<a;s+=2)c[s]=e+o[s]*n,c[s+1]=i+o[s+1]*r},i.prototype.applyDeform=function(t){return this==t||this.inheritDeform&&this.parentMesh==t},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},i}(t.VertexAttachment);t.MeshAttachment=e}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).closed=!1,i.constantSpeed=!1,i.color=new t.Color(1,1,1,1),i}return __extends(i,e),i}(t.VertexAttachment);t.PathAttachment=e}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).color=new t.Color(.38,.94,0,1),i}return __extends(i,e),i.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},i.prototype.computeWorldRotation=function(e){var i=t.MathUtils.cosDeg(this.rotation),n=t.MathUtils.sinDeg(this.rotation);return Math.atan2(i*e.c+n*e.d,i*e.a+n*e.b)*t.MathUtils.radDeg},i}(t.VertexAttachment);t.PointAttachment=e}(spine||(spine={})),function(t){var e=function(e){function i(i){return(i=e.call(this,i)||this).x=0,i.y=0,i.scaleX=1,i.scaleY=1,i.rotation=0,i.width=0,i.height=0,i.color=new t.Color(1,1,1,1),i.offset=t.Utils.newFloatArray(8),i.uvs=t.Utils.newFloatArray(8),i.tempColor=new t.Color(1,1,1,1),i}return __extends(i,e),i.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,o=n+this.region.width*t,c=(t=r+this.region.height*e,e=this.rotation*Math.PI/180,Math.cos(e)),s=Math.sin(e),a=(e=n*c+this.x,n*=s,r*c+this.y),h=(r*=s,o*c+this.x);o*=s,c=t*c+this.y,t*=s,(s=this.offset)[i.OX1]=e-r,s[i.OY1]=a+n,s[i.OX2]=e-t,s[i.OY2]=c+n,s[i.OX3]=h-t,s[i.OY3]=c+o,s[i.OX4]=h-r,s[i.OY4]=a+o},i.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},i.prototype.computeWorldVertices=function(t,e,n,r){var o,c,s=this.offset,a=t.worldX,h=t.worldY,l=t.a,d=t.b,u=t.c;t=t.d,o=s[i.OX1],c=s[i.OY1],e[n]=o*l+c*d+a,e[n+1]=o*u+c*t+h,n+=r,o=s[i.OX2],c=s[i.OY2],e[n]=o*l+c*d+a,e[n+1]=o*u+c*t+h,n+=r,o=s[i.OX3],c=s[i.OY3],e[n]=o*l+c*d+a,e[n+1]=o*u+c*t+h,n+=r,o=s[i.OX4],c=s[i.OY4],e[n]=o*l+c*d+a,e[n+1]=o*u+c*t+h},i}(t.Attachment);e.OX1=0,e.OY1=1,e.OX2=2,e.OY2=3,e.OX3=4,e.OY3=5,e.OX4=6,e.OY4=7,e.X1=0,e.Y1=1,e.C1R=2,e.C1G=3,e.C1B=4,e.C1A=5,e.U1=6,e.V1=7,e.X2=8,e.Y2=9,e.C2R=10,e.C2G=11,e.C2B=12,e.C2A=13,e.U2=14,e.V2=15,e.X3=16,e.Y3=17,e.C3R=18,e.C3G=19,e.C3B=20,e.C3A=21,e.U3=22,e.V3=23,e.X4=24,e.Y4=25,e.C4R=26,e.C4G=27,e.C4B=28,e.C4A=29,e.U4=30,e.V4=31,t.RegionAttachment=e}(spine||(spine={})),function(t){var e=function(){function e(t,e){this.jitterY=this.jitterX=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(t){},e.prototype.transform=function(e,i,n,r){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(spine||(spine={})),function(t){var e=function(){function e(t){this.worldY=this.worldX=this.angle=this.radius=this.centerY=this.centerX=0,this.radius=t}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(i,n,r,o){o=this.angle*t.MathUtils.degreesToRadians,n=i.x-this.worldX,r=i.y-this.worldY;var c=Math.sqrt(n*n+r*r);c<this.radius&&(c=e.interpolation.apply(0,o,(this.radius-c)/this.radius),o=Math.cos(c),c=Math.sin(c),i.x=o*n-c*r+this.worldX,i.y=c*n+o*r+this.worldY)},e.prototype.end=function(){},e}();e.interpolation=new t.PowOut(2),t.SwirlEffect=e}(spine||(spine={}));var sp=sp||{};window.sp=sp,sp.spine=spine,sp=sp||{},spine=sp.spine,sp.Skeleton=cc.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,ctor:function(t,e,i){cc.Node.prototype.ctor.call(this),0===arguments.length?this.init():this.initWithArgs(t,e,i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new sp.Skeleton.CanvasRenderCmd(this):new sp.Skeleton.WebGLRenderCmd(this)},init:function(){cc.Node.prototype.init.call(this),this._premultipliedAlpha=cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){this.unscheduleUpdate(),cc.Node.prototype.onExit.call(this)},setDebugSolots:function(t){this._debugSlots=t},setDebugBones:function(t){this._debugBones=t},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){if(cc.isString(t)){if(cc.isString(e)){var n=cc.loader.getRes(e);sp._atlasLoader.setAtlasFile(e),e=new spine.TextureAtlas(n,sp._atlasLoader.load.bind(sp._atlasLoader))}i=i||1/cc.director.getContentScaleFactor(),n=new spine.AtlasAttachmentLoader(e),(n=new spine.SkeletonJson(n)).scale=i,t=cc.loader.getRes(t),t=n.readSkeletonData(t),e.dispose(n),i=!0}else i=e;this.setSkeletonData(t,i),this.init()},getBoundingBox:function(){for(var t,e=cc.FLT_MAX,i=cc.FLT_MAX,n=cc.FLT_MIN,r=cc.FLT_MIN,o=this.getScaleX(),c=this.getScaleY(),s=this._skeleton.slots,a=spine.RegionAttachment,h=0,l=s.length;h<l;++h){var d=s[h],u=d.attachment;u&&u instanceof spine.RegionAttachment&&(t=spine.Utils.setArraySize([],8,0),u.computeWorldVertices(d.bone,t,0,2),e=Math.min(e,t[a.OX1]*o,t[a.OX4]*o,t[a.OX2]*o,t[a.OX3]*o),i=Math.min(i,t[a.OY1]*c,t[a.OY4]*c,t[a.OY2]*c,t[a.OY3]*c),n=Math.max(n,t[a.OX1]*o,t[a.OX4]*o,t[a.OX2]*o,t[a.OX3]*o),r=Math.max(r,t[a.OY1]*c,t[a.OY4]*c,t[a.OY2]*c,t[a.OY3]*c))}return o=this.getPosition(),cc.rect(o.x+e,o.y+i,n-e,r-i)},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentByName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setPremultipliedAlpha:function(t){this._premultipliedAlpha=t},isPremultipliedAlpha:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){null!=t.width&&null!=t.height&&this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor()),this._skeleton=new spine.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.region},getBlendFunc:function(){var t=this._skeleton.drawOrder[0];return t?this._renderCmd._getBlendFunc(t.data.blendMode,this._premultipliedAlpha):{}},setBlendFunc:function(t,e){},update:function(t){this._skeleton.update(t)}}),cc.defineGetterSetter(sp.Skeleton.prototype,"opacityModifyRGB",sp.Skeleton.prototype.isOpacityModifyRGB),cc.defineGetterSetter(sp.Skeleton.prototype,"_blendFunc",sp.Skeleton.prototype.getBlendFunc),cc.defineGetterSetter(sp.Skeleton.prototype,"_texture",(function(){return this._renderCmd._currTexture})),sp.Skeleton.create=function(t,e,i){return new sp.Skeleton(t,e,i)},sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t){t=cc.path.join(cc.path.dirname(this.spAtlasFile),t),t=cc.textureCache.addImage(t);var e=new sp.SkeletonTexture({width:t.getPixelsWide(),height:t.getPixelsHigh()});return e.setRealTexture(t),e},unload:function(t){}},sp.ANIMATION_EVENT_TYPE={START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5},sp.TrackEntryListeners=function(t,e,i,n,r,o){this.startListener=t||null,this.endListener=e||null,this.completeListener=i||null,this.eventListener=n||null,this.interruptListener=r||null,this.disposeListener=o||null,this.skeletonNode=this.callbackTarget=this.callback=null};var proto=sp.TrackEntryListeners.prototype;proto.start=function(t){this.startListener&&this.startListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.START,null,0)},proto.interrupt=function(t){this.interruptListener&&this.interruptListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.INTERRUPT,null,0)},proto.end=function(t){this.endListener&&this.endListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.END,null,0)},proto.dispose=function(t){this.disposeListener&&this.disposeListener(t),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.DISPOSE,null,0)},proto.complete=function(t){var e=Math.floor(t.trackTime/t.animationEnd);this.completeListener&&this.completeListener(t,e),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.COMPLETE,null,e)},proto.event=function(t,e){this.eventListener&&this.eventListener(t,e),this.callback&&this.callback.call(this.callbackTarget,this.skeletonNode,t,sp.ANIMATION_EVENT_TYPE.EVENT,e,0)},sp.TrackEntryListeners.getListeners=function(t){return t.listener||(t.listener=new sp.TrackEntryListeners),t.listener},sp.SkeletonAnimation=sp.Skeleton.extend({_state:null,_ownsAnimationStateData:!1,_listener:null,init:function(){sp.Skeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new spine.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){t=new spine.AnimationState(t),this._listener=new sp.TrackEntryListeners,t.rendererObject=this,t.addListener(this._listener),this._state=t},setMix:function(t,e,i){this._state.data.setMixWith(t,e,i)},setAnimationListener:function(t,e){this._listener.callbackTarget=t,this._listener.callback=e,this._listener.skeletonNode=this},setAnimation:function(t,e,i){var n=this._skeleton.data.findAnimation(e);return n?this._state.setAnimationWith(t,n,i):(cc.log("Spine: Animation not found: "+e),null)},addAnimation:function(t,e,i,n){n=null==n?0:n;var r=this._skeleton.data.findAnimation(e);return r?this._state.addAnimationWith(t,r,i,n):(cc.log("Spine: Animation not found:"+e),null)},findAnimation:function(t){return this._skeleton.data.findAnimation(t)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty),this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._listener.startListener=t},setInterruptListener:function(t){this._listener.interruptListener=t},setEndListener:function(t){this._listener.endListener=t},setDisposeListener:function(t){this._listener.disposeListener=t},setCompleteListener:function(t){this._listener.completeListener=t},setEventListener:function(t){this._listener.eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackInterruptListener:function(t,e){sp.TrackEntryListeners.getListeners(t).interruptListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackDisposeListener:function(t,e){sp.TrackEntryListeners.getListeners(t).disposeListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},getState:function(){return this._state}}),sp.SkeletonAnimation.createWithJsonFile=sp.SkeletonAnimation.create=function(t,e,i){return new sp.SkeletonAnimation(t,e,i)},sp.SkeletonTexture=function(t){sp.spine.Texture.call(this,t)},cc.inherits(sp.SkeletonTexture,sp.spine.Texture),cc.extend(sp.SkeletonTexture.prototype,{name:"sp.SkeletonTexture",_texture:null,setRealTexture:function(t){this._texture=t},getRealTexture:function(){return this._texture},setFilters:function(t,e){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var i=cc._renderContext;this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e)}},setWraps:function(t,e){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var i=cc._renderContext;this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e)}},dispose:function(){},bind:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.glBindTexture2D(this._texture)}}),function(){var t=sp.spine;sp.Skeleton.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0};var e=sp.Skeleton.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);e.constructor=sp.Skeleton.CanvasRenderCmd,e.rendering=function(e,i,n){var r,o,c,s,a=this._node;e=e||cc._renderContext;var h=a._skeleton,l=h.drawOrder;for(r=0,o=l.length;r<o;r++)(s=(c=l[r])._slotNode)._visible&&s._renderCmd&&c.currentSprite&&(s._renderCmd.transform(this,!0),c.currentSprite._renderCmd.rendering(e,i,n),s._renderCmd._dirtyFlag=c.currentSprite._renderCmd._dirtyFlag=0);if(a._debugSlots||a._debugBones){if(e.setTransform(this._worldTransform,i,n),e.setGlobalAlpha(1),e=cc._drawingUtil,a._debugSlots)for(e.setDrawColor(0,0,255,255),e.setLineWidth(1),n=[],r=0,o=h.slots.length;r<o;r++)(c=h.drawOrder[r]).attachment&&c.attachment instanceof t.RegionAttachment&&(i=c.attachment,this._updateRegionAttachmentSlot(i,c,n),e.drawPoly(n,4,!0));if(a._debugBones){for(e.setLineWidth(2),e.setDrawColor(255,0,0,255),r=0,o=h.bones.length;r<o;r++)a=h.bones[r],e.drawLine({x:a.worldX,y:a.worldY},{x:a.data.length*a.a+a.worldX,y:a.data.length*a.c+a.worldY});for(e.setDrawColor(0,0,255,255),r=0,o=h.bones.length;r<o;r++)a=h.bones[r],e.drawPoint({x:a.worldX,y:a.worldY},4),0===r&&e.setDrawColor(0,255,0,255)}}},e.updateStatus=function(){this.originUpdateStatus(),this._updateCurrentRegions(),this._regionFlag=cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~cc.Node._dirtyFlags.contentDirty},e.getLocalBB=function(){return this._node.getBoundingBox()},e._updateRegionAttachmentSlot=function(e,i,n){if(n){var r=t.Utils.setArraySize([],8,0);e.computeWorldVertices(i.bone,r,0,2),e=t.RegionAttachment,n.length=0,n.push(cc.p(r[e.OX1],r[e.OY1])),n.push(cc.p(r[e.OX4],r[e.OY4])),n.push(cc.p(r[e.OX3],r[e.OY3])),n.push(cc.p(r[e.OX2],r[e.OY2]))}},e._createChildFormSkeletonData=function(){for(var e,i,n=this._node._skeleton,r=0,o=n.slots.length;r<o;r++){var c=n.slots[r];i=c.attachment;var s=new cc.Node;c._slotNode=s,i instanceof t.RegionAttachment&&(e=i.region.name,i=this._createSprite(c,i),c.currentSprite=i,c.currentSpriteName=e,s.addChild(i))}};var i=function(t,e,i){var n=i.region,r=new cc.Rect(n.x,n.y,n.width,n.height);t.initWithTexture(e,r,n.rotate,!1),t._rect.width=i.width,t._rect.height=i.height,t.setContentSize(i.width,i.height),t.setRotation(-i.rotation),t.setScale(n.width/n.originalWidth*i.scaleX,n.height/n.originalHeight*i.scaleY)};e._createSprite=function(t,e){var n=e.region,r=n.texture.getRealTexture(),o=new cc.Sprite;return r.isLoaded()?i(o,r,e):r.addEventListener("load",(function(){i(o,r,e)}),this),t.sprites=t.sprites||{},t.sprites[n.name]=o},e._updateChild=function(){var e,i,n,r,o,c,s,a=this._node._skeleton.slots,h=this._displayedColor,l=this._displayedOpacity;for(e=0,i=a.length;e<i;e++)if(c=(o=a[e]).attachment,s=o._slotNode,c){if(c instanceof t.RegionAttachment){if(c.region&&(!o.currentSpriteName||o.currentSpriteName!==c.name)){var d=c.region.name;void 0!==o.currentSprite&&o.currentSprite.setVisible(!1),o.sprites=o.sprites||{},void 0!==o.sprites[d]?o.sprites[d].setVisible(!0):(n=this._createSprite(o,c),s.addChild(n)),o.currentSprite=o.sprites[d],o.currentSpriteName=d}d=o.bone,0===c.region.offsetX&&0===c.region.offsetY?(n=c.x,r=c.y):(n=.5*(c.offset[0]+c.offset[4]),r=.5*(c.offset[1]+c.offset[5])),s.setPosition(d.worldX+n*d.a+r*d.b,d.worldY+n*d.c+r*d.d),s.setScale(d.getWorldScaleX(),d.getWorldScaleY()),(n=o.currentSprite)._flippedX=d.skeleton.flipX,n._flippedY=d.skeleton.flipY,n._flippedY||n._flippedX?(s.setRotation(d.getWorldRotationX()),n.setRotation(c.rotation)):(s.setRotation(-d.getWorldRotationX()),n.setRotation(-c.rotation)),n._renderCmd._displayedOpacity=0|l*o.color.a,n.setColor(cc.color(0|h.r*o.color.r,0|h.g*o.color.g,0|h.b*o.color.b)),n._renderCmd._updateColor()}else if(!(c instanceof t.MeshAttachment)){s.setVisible(!1);continue}s.setVisible(!0)}else s.setVisible(!1)}}(),function(){var t=sp.spine;sp.Skeleton.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._currTexture=null,this._currBlendFunc={},this.vertexType=cc.renderer.VertexType.CUSTOM,this.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR))};var e=sp.Skeleton.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);e.constructor=sp.Skeleton.WebGLRenderCmd,e.uploadData=function(e,i,n){var r,o,c,s=this._node,a=this._displayedColor,h=s._skeleton,l=s._premultipliedAlpha;h.r=a.r/255,h.g=a.g/255,h.b=a.b/255,h.a=this._displayedOpacity/255,l&&(h.r*=h.a,h.g*=h.a,h.b*=h.a);var d=null;for(this._node._debugSlots&&(d=[]),a=0,c=h.drawOrder.length;a<c;a++)if((o=h.drawOrder[a]).attachment){var u;if((r=o.attachment)instanceof t.RegionAttachment)u=6;else{if(!(r instanceof t.MeshAttachment))continue;u=r.regionUVs.length/2}if(0!==u){this._currTexture=s.getTextureAtlas(r).texture.getRealTexture();var _=cc.renderer._updateBatchedInfo(this._currTexture,this._getBlendFunc(o.data.blendMode,l),this._glProgramState),p=n/6+u>.5*(cc.BATCH_VERTEX_COUNT-200);if(!_&&p&&(cc.renderer._batchRendering(),_=!0),_&&(n=0),_=null,r instanceof t.RegionAttachment)_=this._uploadRegionAttachmentData(r,o,l,e,i,n);else{if(!(r instanceof t.MeshAttachment))continue;this._uploadMeshAttachmentData(r,o,l,e,i,n)}this._node._debugSlots&&(d[a]=_),r instanceof t.RegionAttachment?cc.renderer._increaseBatchingSize(u,cc.renderer.VertexType.TRIANGLE):cc.renderer._increaseBatchingSize(u,cc.renderer.VertexType.CUSTOM,r.triangles),n+=6*u}}if(s._debugBones||s._debugSlots){if(cc.renderer._batchRendering(),a=this._worldTransform,(c=this._matrix.mat)[0]=a.a,c[4]=a.c,c[12]=a.tx,c[1]=a.b,c[5]=a.d,c[13]=a.ty,cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._matrix,e=cc._drawingUtil,s._debugSlots&&d&&0<d.length)for(e.setDrawColor(0,0,255,255),e.setLineWidth(1),a=0,c=h.slots.length;a<c;a++)(i=d[a])&&e.drawPoly(i,4,!0);if(s._debugBones){for(e.setLineWidth(2),e.setDrawColor(255,0,0,255),a=0,c=h.bones.length;a<c;a++)d=(s=h.bones[a]).data.length*s.a+s.worldX,i=s.data.length*s.c+s.worldY,e.drawLine(cc.p(s.worldX,s.worldY),cc.p(d,i));for(e.setPointSize(4),e.setDrawColor(0,0,255,255),a=0,c=h.bones.length;a<c;a++)s=h.bones[a],e.drawPoint(cc.p(s.worldX,s.worldY)),0==a&&e.setDrawColor(0,255,0,255)}cc.kmGLPopMatrix()}return 0},e._getBlendFunc=function(e,i){var n=this._currBlendFunc;switch(e){case t.BlendMode.Normal:n.src=i?cc.ONE:cc.SRC_ALPHA,n.dst=cc.ONE_MINUS_SRC_ALPHA;break;case t.BlendMode.Additive:n.src=i?cc.ONE:cc.SRC_ALPHA,n.dst=cc.ONE;break;case t.BlendMode.Multiply:n.src=cc.DST_COLOR,n.dst=cc.ONE_MINUS_SRC_ALPHA;break;case t.BlendMode.Screen:n.src=cc.ONE,n.dst=cc.ONE_MINUS_SRC_COLOR;break;default:n=this._node._blendFunc}return n},e._createChildFormSkeletonData=function(){},e._updateChild=function(){},e._uploadRegionAttachmentData=function(e,i,n,r,o,c){var s=(d=this._displayedColor).r,a=d.g,h=d.b,l=this._displayedOpacity,d=t.Utils.setArraySize([],8,0);e.computeWorldVertices(i.bone,d,0,2);var u=e.uvs,_=i.bone.skeleton.color;i=i.color;var p=e.color,f=_.a*i.a*p.a;n=n?f:1,(e=e.tempColor).set(_.r*i.r*p.r*n,_.g*i.g*p.g*n,_.b*i.b*p.b*n,f),_=(g=this._worldTransform).a,n=g.b,i=g.c,p=g.d,f=g.tx;for(var g=g.ty,m=this._node.vertexZ,T=0;6>T;T++){var y=4>T?T%3:T-2,E=d[2*y],S=d[2*y+1],C=E*n+S*p+g,v=e.a*l<<24|e.b*h<<16|e.g*a<<8|e.r*s;r[c]=E*_+S*i+f,r[c+1]=C,r[c+2]=m,o[c+3]=v,r[c+4]=u[2*y],r[c+5]=u[2*y+1],c+=6}if(this._node._debugSlots)return r=t.RegionAttachment,[cc.p(d[r.OX1],d[r.OY1]),cc.p(d[r.OX2],d[r.OY2]),cc.p(d[r.OX3],d[r.OY3]),cc.p(d[r.OX4],d[r.OY4])]},e._uploadMeshAttachmentData=function(e,i,n,r,o,c){var s=(u=this._worldTransform).a,a=u.b,h=u.c,l=u.d,d=u.tx,u=u.ty,_=this._node.vertexZ,p=e.worldVerticesLength,f=t.Utils.setArraySize([],p,0);e.computeWorldVertices(i,0,p,f,0,2),p=e.uvs;var g=i.bone.skeleton.color;i=i.color;var m=e.color,T=g.a*i.a*m.a;n=n?T:1,(e=e.tempColor).set(g.r*i.r*m.r*n,g.g*i.g*m.g*n,g.b*i.b*m.b*n,T),n=(i=this._displayedColor).r,g=i.g,i=i.b,m=this._displayedOpacity,T=0;for(var y=f.length;T<y;T+=2){var E=f[T],S=f[T+1],C=E*h+S*l+u,v=e.a*m<<24|e.b*i<<16|e.g*g<<8|e.r*n;r[c]=E*s+S*a+d,r[c+1]=C,r[c+2]=_,o[c+3]=v,r[c+4]=p[T],r[c+5]=p[T+1],c+=6}}}(),cc.IMEKeyboardNotificationInfo=function(t,e,i){this.begin=t||cc.rect(0,0,0,0),this.end=e||cc.rect(0,0,0,0),this.duration=i||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(t,e){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}}),cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl,this._lastClickPosition=cc.p(0,0)},init:function(){if(!cc.sys.isMobile){this._domInputControl=cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var t=this;this._domInputControl.addEventListener("input",(function(){t._processDomInputString(t._domInputControl.value)}),!1),this._domInputControl.addEventListener("keydown",(function(e){e.keyCode===cc.KEY.tab?(e.stopPropagation(),e.preventDefault()):e.keyCode===cc.KEY.enter&&(t.dispatchInsertText("\n",1),e.stopPropagation(),e.preventDefault())}),!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",(function(e){e.keyCode===cc.KEY.backspace&&t._processDomInputString(t._domInputControl.value)}),!1),window.addEventListener("mousedown",(function(e){var i=e.pageY||0;t._lastClickPosition.x=e.pageX||0,t._lastClickPosition.y=i}),!1)}},_processDomInputString:function(t){var e,i;for(e=this._currentInputString.length<t.length?this._currentInputString.length:t.length,i=0;i<e&&t[i]===this._currentInputString[i];i++);var n=this._currentInputString.length-i,r=t.length-i;for(e=0;e<n;e++)this.dispatchDeleteBackward();for(e=0;e<r;e++)this.dispatchInsertText(t[i+e],1);this._currentInputString=t},dispatchInsertText:function(t,e){!this.impl||!t||0>=e||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},getContentText:function(){return this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.getContentText()||""},dispatchKeyboardWillShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillShow(t)}},dispatchKeyboardDidShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidShow(t)}},dispatchKeyboardWillHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillHide(t)}},dispatchKeyboardDidHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidHide(t)}},addDelegate:function(t){t&&this.impl&&(-1<this.impl._delegateList.indexOf(t)||this.impl._delegateList.splice(0,0,t))},attachDelegateWithIME:function(t){if(!this.impl||!t||-1===this.impl._delegateList.indexOf(t))return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME())return!1;var e=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,e.didDetachWithIME(),this._focusDomInput(t),!0}return!!t.canAttachWithIME()&&(this._focusDomInput(t),!0)},_focusDomInput:function(t){if(cc.sys.isMobile){this.impl._delegateWithIme=t,t.didAttachWithIME(),this._currentInputString=t.string||"",t=t.getTipMessage?t.getTipMessage():"please enter your word:";var e=window.Window;null!=(t=e&&e.prototype.prompt&&e.prototype.prompt!=prompt?e.prototype.prompt.call(window,t,this._currentInputString):prompt(t,this._currentInputString))&&this._processDomInputString(t),this.dispatchInsertText("\n",1)}else this.impl._delegateWithIme=t,this._currentInputString=t.string||"",t.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(t){return!!(this.impl&&t&&this.impl._delegateWithIme===t&&t.canDetachWithIME())&&(this.impl._delegateWithIme=null,t.didDetachWithIME(),cc._canvas.focus(),!0)},removeDelegate:function(t){this.impl&&t&&-1!==this.impl._delegateList.indexOf(t)&&(this.impl._delegateWithIme&&t===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.arrayRemoveObject(this.impl._delegateList,t))},processKeycode:function(t){32>t?t===cc.KEY.backspace?this.dispatchDeleteBackward():t===cc.KEY.enter&&this.dispatchInsertText("\n",1):255>t&&this.dispatchInsertText(String.fromCharCode(t),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++)if(this._delegateList[e]===t)return e;return null}}),cc.imeDispatcher=new cc.IMEDispatcher,document.body?cc.imeDispatcher.init():window.addEventListener("load",(function(){cc.imeDispatcher.init()}),!1),cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(t){return!1},onTextFieldDetachWithIME:function(t){return!1},onTextFieldInsertText:function(t,e,i){return!1},onTextFieldDeleteBackward:function(t,e,i){return!1},onDraw:function(t){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,i,n,r){this.colorSpaceHolder=cc.color(127,127,127),this._colorText=cc.color(255,255,255,255),cc.LabelTTF.prototype.ctor.call(this),void 0!==r?(this.initWithPlaceHolder("",e,i,n,r),t&&this.setPlaceHolder(t)):void 0===n&&void 0!==i&&(this.initWithString("",e,i),t&&this.setPlaceHolder(t))},onEnter:function(){cc.LabelTTF.prototype.onEnter.call(this),cc.imeDispatcher.addDelegate(this)},onExit:function(){cc.LabelTTF.prototype.onExit.call(this),cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r,this.colorSpaceHolder.g=t.g,this.colorSpaceHolder.b=t.b,this.colorSpaceHolder.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r,this._colorText.g=t.g,this._colorText.b=t.b,this._colorText.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,i,n,r){switch(arguments.length){case 5:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,n,r,e,i);case 3:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,arguments[1],arguments[2]);default:throw Error("Argument must be non-nil ")}},setString:function(t){this._inputText=(t=String(t))||"",this._inputText.length?(cc.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)),cc._renderType===cc.game.RENDER_TYPE_CANVAS&&this._renderCmd._updateTexture(),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"",this._inputText.length||(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(t){t=t||cc._renderContext,this.delegate&&this.delegate.onDraw(this)||cc.LabelTTF.prototype.draw.call(this,t)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!this.delegate||!this.delegate.onTextFieldAttachWithIME(this)},didAttachWithIME:function(){},canDetachWithIME:function(){return!this.delegate||!this.delegate.onTextFieldDetachWithIME(this)},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;0===t||this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-1],1)||(1>=t?(this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)):this.string=this._inputText.substring(0,t-1))},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){null!=t&&(this._tipMessage=t)},getTipMessage:function(){return this._tipMessage},insertText:function(t,e){if(-1<(t=(e=t).indexOf("\n"))&&(e=e.substring(0,t)),0<e.length){if(this.delegate&&this.delegate.onTextFieldInsertText(this,e,e.length))return;e=this._inputText+e,this._charCount=e.length,this.string=e}-1!==t&&(this.delegate&&this.delegate.onTextFieldInsertText(this,"\n",1)||this.detachWithIME())},getContentText:function(){return this._inputText},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}}),_p=cc.TextFieldTTF.prototype,cc.defineGetterSetter(_p,"charCount",_p.getCharCount),cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.TextFieldTTF.create=function(t,e,i,n,r){return new cc.TextFieldTTF(t,e,i,n,r)},cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(t),t._setLocalZOrder(e)},ctor:function(){cc.Node.prototype.ctor.call(this),this._protectedChildren=[]},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){t=cc.renderer;var n,r,o=this._children,c=o.length,s=this._protectedChildren,a=s.length;e.visit(i);var h=this.grid;for(h&&h._active&&h.beforeDraw(),this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),i=0;i<c&&0>(n=o[i])._localZOrder;i++)n.visit(this);for(n=0;n<a&&(r=s[n])&&0>r._localZOrder;n++)e._changeProtectedChild(r),r.visit(this);for(t.pushRenderCommand(e);i<c;i++)o[i].visit(this);for(;n<a;n++)(r=s[n])&&(e._changeProtectedChild(r),r.visit(this));h&&h._active&&h.afterDraw(this),e._dirtyFlag=0}else e._propagateFlagsDown(i)},addProtectedChild:function(t,e,i){cc.assert(null!=t,"child must be non-nil"),cc.assert(!t.parent,"child already added. It can't be added again"),e=e||t.getLocalZOrder(),i&&t.setTag(i),this._insertProtectedChild(t,e),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival),this._running&&(t._performRecursive(cc.Node._stateCallbackType.onEnter),this._isTransitionFinished&&t._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag");for(var e=this._protectedChildren,i=0,n=e.length;i<n;i++)if(e.getTag()===t)return e[i];return null},removeProtectedChild:function(t,e){null==e&&(e=!0);var i=this._protectedChildren;if(0!==i.length){var n=i.indexOf(t);-1<n&&(this._running&&(t._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),t._performRecursive(cc.Node._stateCallbackType.onExit)),e&&t._performRecursive(cc.Node._stateCallbackType.cleanup),t.setParent(null),i.splice(n,1))}},removeProtectedChildByTag:function(t,e){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag"),null==e&&(e=!0);var i=this.getProtectedChildByTag(t);null==i?cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",t):this.removeProtectedChild(i,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(t){null==t&&(t=!0);for(var e=this._protectedChildren,i=0,n=e.length;i<n;i++){var r=e[i];this._running&&(r._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),r._performRecursive(cc.Node._stateCallbackType.onExit)),t&&r._performRecursive(cc.Node._stateCallbackType.cleanup),r.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){cc.assert(null!=t,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,t.setOrderOfArrival(cc.s_globalOrderOfArrival++),t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var t,e,i,n=this._protectedChildren,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;0<=e;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProtectedNode.CanvasRenderCmd(this):new cc.ProtectedNode.WebGLRenderCmd(this)}}),cc.ProtectedNode.create=function(){return new cc.ProtectedNode},function(){cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(t){var e,i,n=this._node,r=this._displayedColor,o=n._realColor;if(this._cascadeColorEnabledDirty&&!n._cascadeColorEnabled){for(r.r=o.r,r.g=o.g,r.b=o.b,r=new cc.Color(255,255,255,255),o=0,t=(e=n._children).length;o<t;o++)(i=e[o])&&i._renderCmd&&i._renderCmd._updateDisplayColor(r);this._cascadeColorEnabledDirty=!1}else{if(void 0===t&&(t=(t=n._parent)&&t._cascadeColorEnabled?t.getDisplayedColor():cc.color.WHITE),r.r=0|o.r*t.r/255,r.g=0|o.g*t.g/255,r.b=0|o.b*t.b/255,n._cascadeColorEnabled)for(o=0,t=(e=n._children).length;o<t;o++)(i=e[o])&&i._renderCmd&&(i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor());for(o=0,t=(e=n._protectedChildren).length;o<t;o++)(i=e[o])&&i._renderCmd&&(i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(t){var e,i,n,r=this._node;if(this._cascadeOpacityEnabledDirty&&!r._cascadeOpacityEnabled){for(this._displayedOpacity=r._realOpacity,t=0,e=(i=r._children).length;t<e;t++)(n=i[t])&&n._renderCmd&&n._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t&&(t=255,(e=r._parent)&&e._cascadeOpacityEnabled&&(t=e.getDisplayedOpacity())),this._displayedOpacity=r._realOpacity*t/255,r._cascadeOpacityEnabled)for(t=0,e=(i=r._children).length;t<e;t++)(n=i[t])&&n._renderCmd&&(n._renderCmd._updateDisplayOpacity(this._displayedOpacity),n._renderCmd._updateColor());for(t=0,e=(i=r._protectedChildren).length;t<e;t++)(n=i[t])&&n._renderCmd&&(n._renderCmd._updateDisplayOpacity(this._displayedOpacity),n._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},_changeProtectedChild:function(t){var e=(t=t._renderCmd)._dirtyFlag,i=cc.Node._dirtyFlags;this._dirtyFlag&i.colorDirty&&(e|=i.colorDirty),this._dirtyFlag&i.opacityDirty&&(e|=i.opacityDirty);var n=e&i.colorDirty;e&=i.opacityDirty,n&&t._updateDisplayColor(this._displayedColor),e&&t._updateDisplayOpacity(this._displayedOpacity),(n||e)&&t._updateColor()}},cc.ProtectedNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._cachedParent=null,this._cacheDirty=!1};var t=cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t),t.constructor=cc.ProtectedNode.CanvasRenderCmd,t._pNodeCmdCtor=cc.ProtectedNode.CanvasRenderCmd,t.transform=function(t,e){var i=this._node;i._changePosition&&i._changePosition(),this.originTransform(t,e);var n=i._protectedChildren;if(e&&n&&0!==n.length)for(t=0,i=n.length;t<i;t++)n[t]._renderCmd.transform(this,e)},t.pNodeTransform=t.transform}(),function(){if(cc.Node.WebGLRenderCmd){cc.ProtectedNode.WebGLRenderCmd=function(t){this._rootCtor(t)};var t=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t),t.constructor=cc.ProtectedNode.WebGLRenderCmd,t._pNodeCmdCtor=cc.ProtectedNode.WebGLRenderCmd,t.transform=function(t,e){this.originTransform(t,e);var i,n=this._node._protectedChildren;if(e&&n&&0!==n.length)for(t=0,i=n.length;t<i;t++)n[t]._renderCmd.transform(this,e)},t.pNodeTransform=t.transform}}();var ccui=ccui||{};window.ccui=ccui,ccui.Class=ccui.Class||cc.Class,ccui.Class.extend=ccui.Class.extend||cc.Class.extend,ccui.Node=ccui.Node||cc.Node,ccui.Node.extend=ccui.Node.extend||cc.Node.extend,ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode,ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend,ccui.cocosGUIVersion="CocosGUI v1.0.0.0",ccui._FocusNavigationController=cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(t){this._enableFocusNavigation!==t&&((this._enableFocusNavigation=t)?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(t){this._firstFocusedWidget=t},_onKeyPressed:function(t,e){this._enableFocusNavigation&&this._firstFocusedWidget&&(t===cc.KEY.dpadDown&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)),t===cc.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)),t===cc.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)),t===cc.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)))},_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(cc.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}}),ccui.__LAYOUT_COMPONENT_NAME="__ui_layout",ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=cc.p(0,0),this._touchMovePosition=cc.p(0,0),this._touchEndPosition=cc.p(0,0),this._widgetType=ccui.Widget.TYPE_WIDGET,this._customSize=cc.size(0,0),this._layoutParameterDictionary={},this._sizeType=ccui.Widget.SIZE_ABSOLUTE,this._sizePercent=cc.p(0,0),this._positionType=ccui.Widget.POSITION_ABSOLUTE,this._positionPercent=cc.p(0,0),this._nodes=[],this._layoutParameterType=ccui.LayoutParameter.NONE,ccui.Widget.prototype.init.call(this)},init:function(){return this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange,this.onNextFocusedWidget=null,this.setAnchorPoint(cc.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0},onEnter:function(){var t=this._touchListener;t&&!t._isRegistered()&&this._touchEnabled&&cc.eventManager.addListener(t,this),this._usingLayoutComponent||this.updateSizeAndPosition(),this._sizeDirty&&this._onSizeChanged(),cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);return null==t&&(t=new ccui.LayoutComponent,this.addComponent(t)),t},getWidgetParent:function(){var t=this.getParent();return t instanceof ccui.Widget?t:null},_updateContentSizeWithTextureSize:function(t){this._unifySize?this.setContentSize(t):this.setContentSize(this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);return null==t||!(t&&!t.isEnabled())&&t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){this._touchListener&&this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){return!!this._touchListener&&this._touchListener.isSwallowTouches()},_getAncensterWidget:function(t){return null==t||null==(t=t.getParent())?null:t instanceof ccui.Widget?t:this._getAncensterWidget(t.getParent())},_isAncestorsVisible:function(t){return null==t||!((t=t.getParent())&&!t.isVisible())&&this._isAncestorsVisible(t)},setEnabled:function(t){this._enabled=t,this.setBright(t)},_initRenderer:function(){},setContentSize:function(t,e){if(cc.Node.prototype.setContentSize.call(this,t,e),t=this._contentSize.width,e=this._contentSize.height,this._customSize.width=t,this._customSize.height=e,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var i=(i=this.getWidgetParent())?i.getContentSize():this._parent.getContentSize();this._sizePercent.x=0<i.width?t/i.width:0,this._sizePercent.y=0<i.height?e/i.height:0}this._running?this._onSizeChanged():this._sizeDirty=!0},_setWidth:function(t){t!==this._contentSize.width&&(cc.Node.prototype._setWidth.call(this,t),this._customSize.width=t,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(t=this.getWidgetParent())?t.width:this._parent.width,this._sizePercent.x=0<t?this._customSize.width/t:0),this._running?this._onSizeChanged():this._sizeDirty=!0)},_setHeight:function(t){t!==this._contentSize.height&&(cc.Node.prototype._setHeight.call(this,t),this._customSize.height=t,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(t=this.getWidgetParent())?t.height:this._parent.height,this._sizePercent.y=0<t?this._customSize.height/t:0),this._running?this._onSizeChanged():this._sizeDirty=!0)},setSizePercent:function(t){if(this._usingLayoutComponent)(e=this._getOrCreateLayoutComponent()).setUsingPercentContentSize(!0),e.setPercentContentSize(t),e.refreshLayout();else{this._sizePercent.x=t.x,this._sizePercent.y=t.y;var e=this._customSize.width,i=this._customSize.height;this._running&&((i=this.getWidgetParent())?(e=i.width*t.x,i=i.height*t.y):(e=this._parent.width*t.x,i=this._parent.height*t.y)),this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(e,i),this._customSize.width=e,this._customSize.height=i}},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;this._running&&(e=((e=this.getWidgetParent())?e.width:this._parent.width)*t),this._ignoreSize?this._setWidth(this.getVirtualRendererSize().width):this._setWidth(e),this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;this._running&&(e=((e=this.getWidgetParent())?e.height:this._parent.height)*t),this._ignoreSize?this._setHeight(this.getVirtualRendererSize().height):this._setHeight(e),this._customSize.height=e},updateSizeAndPosition:function(t){switch(t||(t=(t=this.getWidgetParent())?t.getLayoutSize():this._parent.getContentSize()),this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(this._customSize),this._sizePercent.x=0<t.width?this._customSize.width/t.width:0,this._sizePercent.y=0<t.height?this._customSize.height/t.height:0;break;case ccui.Widget.SIZE_PERCENT:var e=cc.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(e),this._customSize.width=e.width,this._customSize.height=e.height}switch(this._onSizeChanged(),e=this.getPosition(),this._positionType){case ccui.Widget.POSITION_ABSOLUTE:0>=t.width||0>=t.height?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=e.x/t.width,this._positionPercent.y=e.y/t.height);break;case ccui.Widget.POSITION_PERCENT:e=cc.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y)}this._parent instanceof ccui.ImageView&&(t=this._parent._imageRenderer)&&!t._textureLoaded||this.setPosition(e)},setSizeType:function(t){this._sizeType=t,this._usingLayoutComponent&&this._getOrCreateLayoutComponent().setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){this._unifySize?this.setContentSize(this._customSize):this._ignoreSize!==t&&(this._ignoreSize=t,this.setContentSize(t?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){return this._usingLayoutComponent&&(this._sizePercent=this._getOrCreateLayoutComponent().getPercentContentSize()),this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent){for(var t=this.getChildren(),e=0,i=t.length;e<i;e++){var n=t[e];n instanceof ccui.Widget&&n.updateSizeAndPosition()}this._sizeDirty=!1}},setTouchEnabled:function(t){this._touchEnabled!==t&&((this._touchEnabled=t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){t!==this._highlight&&(this._highlight=t,this._bright?this._highlight?this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(t){(this._focused=t)&&(ccui.Widget._focusedWidget=this,ccui.Widget._focusNavigationController&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this))},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(t)){var i=e instanceof ccui.Layout;if(this.isFocused()||i){var n=this.getParent();return null!==n&&n instanceof ccui.Layout?n.findNextFocusedWidget(t,e):i?e.findNextFocusedWidget(t,e):e}return e}return t=this.onNextFocusedWidget(t),this.dispatchFocusEvent(this,t),t},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onFocusChange:function(t,e){t&&t.setFocused(!1),e&&e.setFocused(!0)},dispatchFocusEvent:function(t,e){t&&!t.isFocused()&&(t=ccui.Widget._focusedWidget),e!==t&&(e&&e.onFocusChanged&&e.onFocusChanged(t,e),t&&e.onFocusChanged&&t.onFocusChanged(t,e),cc.eventManager.dispatchEvent(new cc.EventFocus(t,e)))},setBright:function(t){(this._bright=t)?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle!==t)switch(this._brightStyle=t=t||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(t,e){return this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)&&(e=t.getLocation(),this._touchBeganPosition.x=e.x,this._touchBeganPosition.y=e.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)),!!this._hit&&(this.setHighlighted(!0),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,t),this._pushDownEvent(),!0)},propagateTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onTouchMoved:function(t,e){e=t.getLocation(),this._touchMovePosition.x=e.x,this._touchMovePosition.y=e.y,this.setHighlighted(this.hitTest(e)),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,t),this._moveEvent()},onTouchEnded:function(t,e){e=t.getLocation(),this._touchEndPosition.x=e.x,this._touchEndPosition.y=e.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,t),t=this._highlight,this.setHighlighted(!1),t?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(t){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(t){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED),this._clickEventListener&&this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){void 0===e?this._touchEventCallback=t:(this._touchEventSelector=t,this._touchEventListener=e)},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=!1;for(var e=this.getParent(),i=null;e;){if(e instanceof ccui.Layout&&e.isClippingEnabled()){this._affectByClipping=!0,i=e;break}e=e.getParent()}return!this._affectByClipping||!i||!!i.hitTest(t)&&i.isClippingParentContainsPoint(t)},checkChildInfo:function(t,e,i){var n=this.getWidgetParent();n&&n.checkChildInfo(t,e,i)},setPosition:function(t,e){if(!this._usingLayoutComponent&&this._running){var i=this.getWidgetParent();i&&(0>=(i=i.getContentSize()).width||0>=i.height?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===e?(this._positionPercent.x=t.x/i.width,this._positionPercent.y=t.y/i.height):(this._positionPercent.x=t/i.width,this._positionPercent.y=e/i.height))}cc.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){if(this._running){var e=this.getWidgetParent();e&&(e=e.width,this._positionPercent.x=0>=e?0:t/e)}cc.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){if(this._running){var e=this.getWidgetParent();e&&(e=e.height,this._positionPercent.y=0>=e?0:t/e)}cc.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.setPositionPercentY(t.y),e.refreshLayout()}else this._setXPercent(t.x),this._setYPercent(t.y),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setXPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.refreshLayout()}else this._positionPercent.x=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setYPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentY(t.x),e.refreshLayout()}else this._positionPercent.y=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(t){if(this._positionType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();t===ccui.POSITION_ABSOLUTE?(e.setPositionPercentXEnabled(!1),e.setPositionPercentYEnabled(!1)):(e.setPositionPercentXEnabled(!0),e.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){t&&(this._layoutParameterDictionary[t.getLayoutType()]=t,this._layoutParameterType=t.getLayoutType())},getLayoutParameter:function(t){return t=t||this._layoutParameterType,this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t._copyClonedWidgetChildren(this),t},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(t){t=t.getChildren();for(var e=0;e<t.length;e++){var i=t[e];i instanceof ccui.Widget&&this.addChild(i.clone())}},_copySpecialProperties:function(t){},_copyProperties:function(t){for(var e in this.setEnabled(t.isEnabled()),this.setVisible(t.isVisible()),this.setBright(t.isBright()),this.setTouchEnabled(t.isTouchEnabled()),this.setLocalZOrder(t.getLocalZOrder()),this.setTag(t.getTag()),this.setName(t.getName()),this.setActionTag(t.getActionTag()),this._ignoreSize=t._ignoreSize,this.setContentSize(t._contentSize),this._customSize.width=t._customSize.width,this._customSize.height=t._customSize.height,this._copySpecialProperties(t),this._sizeType=t.getSizeType(),this._sizePercent.x=t._sizePercent.x,this._sizePercent.y=t._sizePercent.y,this._positionType=t._positionType,this._positionPercent.x=t._positionPercent.x,this._positionPercent.y=t._positionPercent.y,this.setPosition(t.getPosition()),this.setAnchorPoint(t.getAnchorPoint()),this.setScaleX(t.getScaleX()),this.setScaleY(t.getScaleY()),this.setRotation(t.getRotation()),this.setRotationX(t.getRotationX()),this.setRotationY(t.getRotationY()),this.setFlippedX(t.isFlippedX()),this.setFlippedY(t.isFlippedY()),this.setColor(t.getColor()),this.setOpacity(t.getOpacity()),this._touchEventCallback=t._touchEventCallback,this._touchEventListener=t._touchEventListener,this._touchEventSelector=t._touchEventSelector,this._clickEventListener=t._clickEventListener,this._focused=t._focused,this._focusEnabled=t._focusEnabled,this._propagateTouchEvents=t._propagateTouchEvents,t._layoutParameterDictionary){var i=t._layoutParameterDictionary[e];i&&this.setLayoutParameter(i.clone())}},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},getLeftInParent:function(){return cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead."),this.getLeftBoundary()},getBottomInParent:function(){return cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead."),this.getBottomBoundary()},getRightInParent:function(){return cc.log("getRightInParent is deprecated. Please use getRightBoundary instead."),this.getRightBoundary()},getTopInParent:function(){return cc.log("getTopInParent is deprecated. Please use getTopBoundary instead."),this.getTopBoundary()},getTouchEndPos:function(){return cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead."),this.getTouchEndPosition()},getTouchMovePos:function(){return cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead."),this.getTouchMovePosition()},clippingParentAreaContainPoint:function(t){cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead."),this.isClippingParentContainsPoint(t)},getTouchStartPos:function(){return cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead."),this.getTouchBeganPosition()},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,i){t instanceof ccui.Widget?cc.log("Please use addChild to add a Widget."):(cc.Node.prototype.addChild.call(this,t,e,i),this._nodes.push(t))},getNodeByTag:function(t){for(var e=this._nodes,i=0;i<e.length;i++){var n=e[i];if(n&&n.getTag()===t)return n}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){cc.Node.prototype.removeChild.call(this,t,e),cc.arrayRemoveObject(this._nodes,t)},_getNormalGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},_getGrayGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY)},removeNodeByTag:function(t,e){var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++)cc.Node.prototype.removeChild.call(this,this._nodes[t]);this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=!0;for(var t=this._parent;t;){if(t._doLayout){t._doLayoutDirty=!0;break}t=t._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){this._flippedX&&(t*=-1),cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t*=-1),cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t*=-1),t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t*=-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Widget.WebGLRenderCmd(this):new ccui.Widget.CanvasRenderCmd(this)}}),_p=ccui.Widget.prototype,cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent),cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent),cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent),cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent),cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent),cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused),cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType),cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType),cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled),cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled),cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright),cc.defineGetterSetter(_p,"name",_p.getName,_p.setName),cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag),cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p=null,ccui.Widget.create=function(){return new ccui.Widget},ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null,ccui.Widget.enableDpadNavigation=function(t){t?(null==ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController=new ccui._FocusNavigationController,ccui.Widget._focusedWidget&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)),ccui.Widget._focusNavigationController.enableFocusNavigation(!0)):ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController.enableFocusNavigation(!1),ccui.Widget._focusNavigationController=null)},ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget},ccui.Widget.BRIGHT_STYLE_NONE=-1,ccui.Widget.BRIGHT_STYLE_NORMAL=0,ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1,ccui.Widget.TYPE_WIDGET=0,ccui.Widget.TYPE_CONTAINER=1,ccui.Widget.LEFT=0,ccui.Widget.RIGHT=1,ccui.Widget.UP=2,ccui.Widget.DOWN=3,ccui.Widget.LOCAL_TEXTURE=0,ccui.Widget.PLIST_TEXTURE=1,ccui.Widget.TOUCH_BEGAN=0,ccui.Widget.TOUCH_MOVED=1,ccui.Widget.TOUCH_ENDED=2,ccui.Widget.TOUCH_CANCELED=3,ccui.Widget.SIZE_ABSOLUTE=0,ccui.Widget.SIZE_PERCENT=1,ccui.Widget.POSITION_ABSOLUTE=0,ccui.Widget.POSITION_PERCENT=1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){ccui.Widget.CanvasRenderCmd=function(t){this._pNodeCmdCtor(t),this._needDraw=!1};var t=ccui.Widget.CanvasRenderCmd.prototype=Object.create(cc.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Widget.CanvasRenderCmd,t.visit=function(t){var e=this._node,i=cc.renderer;(t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),e._adaptRenderers(),this._syncStatus(t)},t.transform=function(t,e){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var i=this._node;if(i._visible&&i._running){if(i._adaptRenderers(),!this._usingLayoutComponent){var n=i.getWidgetParent();n&&0!==(n=n.getContentSize()).width&&0!==n.height&&(i._position.x=n.width*i._positionPercent.x,i._position.y=n.height*i._positionPercent.y)}this.pNodeTransform(t,e)}}}else ccui.Widget.WebGLRenderCmd=function(t){this._pNodeCmdCtor(t),this._needDraw=!1},(t=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype)).constructor=ccui.Widget.WebGLRenderCmd,t.visit=function(t){var e=this._node,i=cc.renderer;(t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),e._adaptRenderers(),this._syncStatus(t)},t.transform=function(t,e){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var i=this._node;if(i._visible&&i._running){if(i._adaptRenderers(),!this._usingLayoutComponent){var n=i.getWidgetParent();n&&0!==(n=n.getContentSize()).width&&0!==n.height&&(i._position.x=n.width*i._positionPercent.x,i._position.y=n.height*i._positionPercent.y)}this.pNodeTransform(t,e)}};t.widgetTransform=t.transform})),function(){var t,e={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort())},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}if(e)return this._pool[e].pop()}},i=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL,n={_rebuildQuads_base:function(i,n,r,o){var c,s,a,h=i._vertices,l=i._renderCmd._worldTransform;if(o)s=c=0,a=r.width,r=r.height;else{c=n._originalSize;var d=n._rect,u=n._offset;a=r.width/c.width,o=r.height/c.height;var _=u.x-(c.width-d.width)/2;s=u.y+(c.height-d.height)/2;var p=u.y-(c.height-d.height)/2;c=(u.x+(c.width-d.width)/2)*a,s*=o,a=r.width+_*a,r=r.height+p*o}8>h.length&&(e.put(h),h=e.get(8)||new Float32Array(8),i._vertices=h),t?(h[0]=c*l.a+s*l.c+l.tx,h[1]=c*l.b+s*l.d+l.ty,h[2]=a*l.a+s*l.c+l.tx,h[3]=a*l.b+s*l.d+l.ty,h[4]=c*l.a+r*l.c+l.tx,h[5]=c*l.b+r*l.d+l.ty,h[6]=a*l.a+r*l.c+l.tx,h[7]=a*l.b+r*l.d+l.ty):(h[0]=c,h[1]=s,h[2]=a,h[3]=s,h[4]=c,h[5]=r,h[6]=a,h[7]=r),i._uvsDirty&&this._calculateUVs(i,n),i._vertCount=4},_calculateUVs:function(t,n){var r=t._uvs,o=n._texture._pixelsWide,c=n._texture._pixelsHigh,s=n._rect;s=cc.rectPointsToPixels(s),8>r.length&&(e.put(r),r=e.get(8)||new Float32Array(8),t._uvs=r);var a=i?.5:0;n._rotated?(n=(s.x+a)/o,t=(s.y+s.width-a)/c,o=(s.x+s.height-a)/o,c=(s.y+a)/c,r[0]=n,r[1]=c,r[2]=n,r[3]=t,r[4]=o,r[5]=c,r[6]=o,r[7]=t):(n=(s.x+a)/o,t=(s.y+s.height-a)/c,o=(s.x+s.width-a)/o,c=(s.y+a)/c,r[0]=n,r[1]=t,r[2]=o,r[3]=t,r[4]=n,r[5]=c,r[6]=o,r[7]=c)}},r={x:Array(4),y:Array(4),_rebuildQuads_base:function(i,n,r,o,c,s,a){var h=i._vertices,l=i._renderCmd._worldTransform,d=r.width-o-c,u=r.height-s-a,_=r.width/(o+c),p=r.height/(s+a),f=this.x,g=this.y;if(f[0]=0,f[1]=o*(1<_?1:_),f[2]=f[1]+(0>d?0:d),f[3]=r.width,g[0]=0,g[1]=a*(1<p?1:p),g[2]=g[1]+(0>u?0:u),g[3]=r.height,32>h.length&&(e.put(h),h=e.get(32)||new Float32Array(32),i._vertices=h),r=0,t)for(d=0;4>d;d++)for(u=0;4>u;u++)h[r]=f[u]*l.a+g[d]*l.c+l.tx,h[r+1]=f[u]*l.b+g[d]*l.d+l.ty,r+=2;else for(d=0;4>d;d++)for(u=0;4>u;u++)h[r]=f[u],h[r+1]=g[d],r+=2;i._uvsDirty&&this._calculateUVs(i,n,o,c,s,a)},_calculateUVs:function(t,n,r,o,c,s){var a,h=t._uvs,l=n._rect,d=n._texture._pixelsWide,u=n._texture._pixelsHigh,_=n._rect;_=cc.rectPointsToPixels(_),l=cc.rectPointsToPixels(l),r*=f=cc.contentScaleFactor(),o=l.width-r-o*f,c*=f,s*=f,a=l.height-c-s,32>h.length&&(e.put(h),h=e.get(32)||new Float32Array(32),t._uvs=h),t=this.x,l=this.y;var p=i?.5:0,f=0;if(n._rotated)for(t[0]=(_.x+p)/d,t[1]=(s+_.x)/d,t[2]=(s+a+_.x)/d,t[3]=(_.x+_.height-p)/d,l[3]=(_.y+p)/u,l[2]=(r+_.y)/u,l[1]=(r+o+_.y)/u,l[0]=(_.y+_.width-p)/u,n=0;4>n;n++)for(d=0;4>d;d++)h[f]=t[n],h[f+1]=l[3-d],f+=2;else for(t[0]=(_.x+p)/d,t[1]=(r+_.x)/d,t[2]=(r+o+_.x)/d,t[3]=(_.x+_.width-p)/d,l[3]=(_.y+p)/u,l[2]=(c+_.y)/u,l[1]=(c+a+_.y)/u,l[0]=(_.y+_.height-p)/u,n=0;4>n;n++)for(d=0;4>d;d++)h[f]=t[d],h[f+1]=l[n],f+=2}};ccui.Scale9Sprite=cc.Scale9Sprite=cc.Node.extend({_spriteFrame:null,_scale9Image:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_opacityModifyRGB:!1,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!1,_textureLoaded:!1,_flippedX:!1,_flippedY:!1,_className:"Scale9Sprite",ctor:function(i,n,r){if(cc.Node.prototype.ctor.call(this),this._loader=new cc.Sprite.LoadManager,this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this.setAnchorPoint(cc.p(.5,.5)),this._rawUvs=this._rawVerts=null,this._vertices=e.get(8)||new Float32Array(8),this._uvs=e.get(8)||new Float32Array(8),void 0!==i)if(i instanceof cc.SpriteFrame)this.initWithSpriteFrame(i,n);else{var o=cc.spriteFrameCache.getSpriteFrame(i);o?this.initWithSpriteFrame(o,n):this.initWithFile(i,n,r)}void 0===t&&(t=cc._renderType===cc.game.RENDER_TYPE_WEBGL)},textureLoaded:function(){return this._textureLoaded},getCapInsets:function(){return cc.rect(this._capInsetsInternal)},_asyncSetCapInsets:function(){this.removeEventListener("load",this._asyncSetCapInsets,this),this.setCapInsets(this._cacheCapInsets),this._cacheCapInsets=null},setCapInsets:function(t){if(!this.loaded())return this._cacheCapInsets=t,this.removeEventListener("load",this._asyncSetCapInsets,this),this.addEventListener("load",this._asyncSetCapInsets,this),!1;this._capInsetsInternal=t,this._updateCapInsets(this._spriteFrame._rect,this._capInsetsInternal)},_updateCapInsets:function(t,e){e&&t&&!cc._rectEqualToZero(e)?this._capInsetsInternal=e:(t=t||{x:0,y:0,width:this._contentSize.width,height:this._contentSize.height},this._capInsetsInternal=cc.rect(t.width/3,t.height/3,t.width/3,t.height/3)),cc._rectEqualToZero(t)||(this._insetLeft=this._capInsetsInternal.x,this._insetTop=this._capInsetsInternal.y,this._insetRight=t.width-this._insetLeft-this._capInsetsInternal.width,this._insetBottom=t.height-this._insetTop-this._capInsetsInternal.height)},initWithFile:function(t,e,i){if(t instanceof cc.Rect?(i=t=e,e=cc.rect(0,0,0,0)):(e=e||cc.rect(0,0,0,0),i=i||cc.rect(0,0,0,0)),!t)throw Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");var n=cc.textureCache.getTextureForKey(t);n||(n=cc.textureCache.addImage(t));var r=n.isLoaded();return this._textureLoaded=r,this._loader.clear(),r?(cc._rectEqualToZero(e)&&(r=n.getContentSize(),e=cc.rect(0,0,r.width,r.height)),this.setTexture(n,e),this._updateCapInsets(e,i),!0):(this._loader.once(n,(function(){this.initWithFile(t,e,i),this.dispatchEvent("load")}),this),!1)},updateWithBatchNode:function(t,e,i,n){if(!t)return!1;var r=t.getTexture();return this._loader.clear(),r.isLoaded()?(this.setTexture(r,e),this._updateCapInsets(e,n),!0):(this._loader.once(r,(function(){this.updateWithBatchNode(t,e,i,n),this.dispatchEvent("load")}),this),!1)},initWithSpriteFrame:function(t,e){this.setSpriteFrame(t),e=e||cc.rect(0,0,0,0),this._updateCapInsets(t._rect,e)},initWithSpriteFrameName:function(t,e){if(!t)throw Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");if(e=e||cc.rect(0,0,0,0),null==(t=cc.spriteFrameCache.getSpriteFrame(t)))return cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1;this.setSpriteFrame(t),e=e||cc.rect(0,0,0,0),this._updateCapInsets(t._rect,e)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},setTexture:function(t,e){t=new cc.SpriteFrame(t,e),this.setSpriteFrame(t)},_updateBlendFunc:function(){var t=this._blendFunc;this._spriteFrame&&this._spriteFrame._texture.hasPremultipliedAlpha()?(t.src===cc.SRC_ALPHA&&t.dst===cc.BLEND_DST&&(t.src=cc.ONE),this._opacityModifyRGB=!0):(t.src===cc.ONE&&t.dst===cc.BLEND_DST&&(t.src=cc.SRC_ALPHA),this._opacityModifyRGB=!1)},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setSpriteFrame:function(t){if(t){this._spriteFrame=t,this._uvsDirty=this._quadsDirty=!0;var e=this,i=function(){cc.sizeEqualToSize(e._contentSize,cc.size(0,0))&&e.setContentSize(e._spriteFrame._rect),e._textureLoaded=!0,e._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty),cc.renderer.childrenOrderDirty=!0};e._textureLoaded=t.textureLoaded(),e._textureLoaded?i():(this._loader.clear(),this._loader.once(t,(function(){i(),this.dispatchEvent("load")}),this))}},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src||cc.BLEND_SRC,this._blendFunc.dst=t.dst||cc.BLEND_DST):(this._blendFunc.src=t||cc.BLEND_SRC,this._blendFunc.dst=e||cc.BLEND_DST),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setPreferredSize:function(t){t&&!cc.sizeEqualToSize(this._contentSize,t)&&this.setContentSize(t)},getPreferredSize:function(){return this.getContentSize()},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(cc.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},getContentSize:function(){return this._renderingType===ccui.Scale9Sprite.RenderingType.SIMPLE&&this._spriteFrame?this._spriteFrame._originalSize:cc.size(this._contentSize)},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._quadsDirty=!0},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._quadsDirty=!0},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._uvsDirty=this._quadsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._uvsDirty=this._quadsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._uvsDirty=this._quadsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._uvsDirty=this._quadsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._uvsDirty=this._quadsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){switch(this._updateBlendFunc(),this._isTriangle=!1,this._renderingType){case c.SIMPLE:n._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case c.SLICED:r._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;default:return this._uvsDirty=this._quadsDirty=!1,void cc.error("Can not generate quad")}this._uvsDirty=this._quadsDirty=!1}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccui.Scale9Sprite.CanvasRenderCmd(this):new ccui.Scale9Sprite.WebGLRenderCmd(this)}});var o=ccui.Scale9Sprite.prototype;cc.EventHelper.prototype.apply(o),cc.defineGetterSetter(o,"preferredSize",o.getPreferredSize,o.setPreferredSize),cc.defineGetterSetter(o,"capInsets",o.getCapInsets,o.setCapInsets),cc.defineGetterSetter(o,"insetLeft",o.getInsetLeft,o.setInsetLeft),cc.defineGetterSetter(o,"insetTop",o.getInsetTop,o.setInsetTop),cc.defineGetterSetter(o,"insetRight",o.getInsetRight,o.setInsetRight),cc.defineGetterSetter(o,"insetBottom",o.getInsetBottom,o.setInsetBottom),o=null,ccui.Scale9Sprite.create=function(t,e,i){return new ccui.Scale9Sprite(t,e,i)},ccui.Scale9Sprite.createWithSpriteFrame=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.POSITIONS_CENTRE=0,ccui.Scale9Sprite.POSITIONS_TOP=1,ccui.Scale9Sprite.POSITIONS_LEFT=2,ccui.Scale9Sprite.POSITIONS_RIGHT=3,ccui.Scale9Sprite.POSITIONS_BOTTOM=4,ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5,ccui.Scale9Sprite.POSITIONS_TOPLEFT=6,ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,ccui.Scale9Sprite.state={NORMAL:0,GRAY:1};var c=ccui.Scale9Sprite.RenderingType={SIMPLE:0,SLICED:1}}(),function(){ccui.Scale9Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._state=ccui.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var t=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.CanvasRenderCmd,t.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},t.needDraw=function(){return this._needDraw&&this._node.loaded()},t._updateDisplayColor=function(t){cc.Node.RenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},t.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},t._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},t.rendering=function(t,e,i){var n=this._node,r=(f=this._displayedOpacity)/255,o=null;if(n._spriteFrame&&(o=n._spriteFrame._texture),n.loaded()&&0!==f&&(null!==this._textureToRender&&this._originalTexture===o||(this._textureToRender=this._originalTexture=o,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture()),f=n.getDisplayedColor(),!o||255===f.r&&255===f.g&&255===f.b||(this._textureToRender=this._textureToRender._generateColorTexture(f.r,f.g,f.b))),t=(o=t||cc._renderContext).getContext(),o.setTransform(this._worldTransform,e,i),o.setCompositeOperation(cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),o.setGlobalAlpha(r),this._textureToRender)){var c,s,a,h,l,d,u;n._quadsDirty&&n._rebuildQuads(),e=this._textureToRender._pixelsWide,i=this._textureToRender._pixelsHigh,r=this._textureToRender._htmlElementObj;var _,p,f=n._vertices,g=n._uvs;if(n._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(o=0;3>o;++o)for(_=0;3>_;++_)h=f[p=8*o+2*_],l=f[p+1],d=f[p+10]-h,l=-l-(u=f[p+11]-l),n=g[p]*e,c=g[p+11]*i,s=(g[p+10]-g[p])*e,a=(g[p+1]-g[p+11])*i,0<s&&0<a&&0<d&&0<u&&t.drawImage(r,n,c,s,a,h,l,d,u);cc.g_NumberOfDraws+=9}else{var m=Math.floor(n._vertCount/4);for(p=_=0;_<m;_++)h=f[p],l=f[p+1],d=f[p+6]-h,l=-l-(u=f[p+7]-l),n=g[p]*e,c=g[p+7]*i,s=(g[p+6]-g[p])*e,a=(g[p+1]-g[p+7])*i,""!==this._textureToRender._pattern?(o.setFillStyle(t.createPattern(r,this._textureToRender._pattern)),t.fillRect(h,l,d,u)):0<s&&0<a&&0<d&&0<u&&t.drawImage(r,n,c,s,a,h,l,d,u),p+=8;cc.g_NumberOfDraws+=m}}}}(),function(){if(cc.Node.WebGLRenderCmd){ccui.Scale9Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var t=ccui.Scale9Sprite,e=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);e.constructor=ccui.Scale9Sprite.WebGLRenderCmd,e.needDraw=function(){return this._needDraw&&this._node.loaded()},e._uploadSliced=function(t,e,i,n,r,o,c){for(var s,a=0;3>a;++a)for(var h=0;3>h;++h)s=8*a+2*h,r[c]=t[s],r[c+1]=t[s+1],r[c+2]=n,o[c+3]=i[0],r[c+4]=e[s],r[c+5]=e[s+1],r[c+=6]=t[s+2],r[c+1]=t[s+3],r[c+2]=n,o[c+3]=i[0],r[c+4]=e[s+2],r[c+5]=e[s+3],r[c+=6]=t[s+8],r[c+1]=t[s+9],r[c+2]=n,o[c+3]=i[0],r[c+4]=e[s+8],r[c+5]=e[s+9],r[c+=6]=t[s+10],r[c+1]=t[s+11],r[c+2]=n,o[c+3]=i[0],r[c+4]=e[s+10],r[c+5]=e[s+11],c+=6;return 36},e.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},e._setColorDirty=function(){},e.uploadData=function(e,i,n){var r=this._node;if(0===this._displayedOpacity)return 0;r._quadsDirty&&r._rebuildQuads();var o=this._displayedOpacity,c=this._displayedColor.r,s=this._displayedColor.g,a=this._displayedColor.b;if(r._opacityModifyRGB){var h=o/255;c*=h,s*=h,a*=h}switch(this._color[0]=o<<24|a<<16|s<<8|c,o=r._vertexZ,c=r._vertices,s=r._uvs,h=t.RenderingType,a=0,r._renderingType){case h.SIMPLE:for(a=this._node._vertCount,h=r=0;r<a;r++,h+=2)e[n]=c[h],e[n+1]=c[h+1],e[n+2]=o,i[n+3]=this._color[0],e[n+4]=s[h],e[n+5]=s[h+1],n+=6;break;case h.SLICED:a=this._uploadSliced(c,s,this._color,o,e,i,n)}return a},e.setState=function(e){e===t.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR):e===t.state.GRAY&&(this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY))}}}(),ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE,this._widgetType=ccui.Widget.TYPE_CONTAINER,this._clippingType=ccui.Layout.CLIPPING_SCISSOR,this._colorType=ccui.Layout.BG_COLOR_NONE,ccui.Widget.prototype.ctor.call(this),this.ignoreContentAdaptWithSize(!1),this.setContentSize(cc.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),this._backGroundImageCapInsets=cc.rect(0,0,0,0),this._color=cc.color(255,255,255,255),this._startColor=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._alongVector=cc.p(0,-1),this._backGroundImageTextureSize=cc.size(0,0),this._clippingRect=cc.rect(0,0,0,0),this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter),this._clippingRectDirty=this._doLayoutDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit)},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){this._adaptRenderers(),this._doLayout(),e.visit(i),t=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL;var n=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_SCISSOR;t?e.stencilClippingVisit(i):n&&e.scissorClippingVisit(i);var r,o,c=this._children,s=c.length,a=this._protectedChildren,h=a.length;for(this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),i=0;i<s&&0>(r=c[i])._localZOrder;i++)r.visit(this);for(r=0;r<h&&0>(o=a[r])._localZOrder;r++)e._changeProtectedChild(o),o.visit(this);for(;i<s;i++)c[i].visit(this);for(;r<h;r++)o=a[r],e._changeProtectedChild(o),o.visit(this);t?e.postStencilVisit():n&&e.postScissorVisit(),e._dirtyFlag=0}else e._propagateFlagsDown(i)},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(t,e){if(this._isFocusPassing||this.isFocused()){var i=this.getParent();return this._isFocusPassing=!1,this.__passFocusToChild?(e=this._passFocusToChild(t,e))instanceof ccui.Layout&&i?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):e:null!=i&&i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):this}if(!(e.isFocused()||e instanceof ccui.Layout))return e;if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL)switch(t){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(t,e);case ccui.Widget.RIGHT:return this._getNextFocusedWidget(t,e);case ccui.Widget.DOWN:case ccui.Widget.UP:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);default:return cc.assert(0,"Invalid Focus Direction"),e}else{if(this._layoutType!==ccui.Layout.LINEAR_VERTICAL)return cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),e;switch(t){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);case ccui.Widget.DOWN:return this._getNextFocusedWidget(t,e);case ccui.Widget.UP:return this._getPreviousFocusedWidget(t,e);default:return cc.assert(0,"Invalid Focus Direction"),e}}},onPassFocusToChild:null,addChild:function(t,e,i){t instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(t),ccui.Widget.prototype.addChild.call(this,t,e,i),this._doLayoutDirty=!0},removeChild:function(t,e){ccui.Widget.prototype.removeChild.call(this,t,e),this._doLayoutDirty=!0},removeAllChildren:function(t){ccui.Widget.prototype.removeAllChildren.call(this,t),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(t){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,t),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},setClippingEnabled:function(t){if(t!==this._clippingEnabled)switch(this._clippingEnabled=t,this._clippingType){case ccui.Layout.CLIPPING_SCISSOR:case ccui.Layout.CLIPPING_STENCIL:t?(this._clippingStencil=new cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit),this._clippingStencil=null)}},setClippingType:function(t){if(t!==this._clippingType){var e=this.isClippingEnabled();this.setClippingEnabled(!1),this._clippingType=t,this.setClippingEnabled(e)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){if(this._clippingEnabled){var e=[];e[0]=cc.p(0,0),e[1]=cc.p(t.width,0),e[2]=cc.p(t.width,t.height),e[3]=cc.p(0,t.height);var i=cc.color.GREEN;this._clippingStencil.clear(),this._clippingStencil.setLocalBB&&this._clippingStencil.setLocalBB(0,0,t.width,t.height),this._clippingStencil.drawPoly(e,4,i,0,i)}},_getClippingRect:function(){if(this._clippingRectDirty){var t,e=this.convertToWorldSpace(cc.p(0,0)),i=this.getNodeToWorldTransform(),n=this._contentSize.width*i.a;for(i=this._contentSize.height*i.d,t=this;t;)if((t=t.getParent())&&t instanceof ccui.Layout&&t.isClippingEnabled()){this._clippingParent=t;break}this._clippingParent?(t=this._clippingParent._getClippingRect(),this._clippingRect.x=Math.max(e.x,t.x),this._clippingRect.y=Math.max(e.y,t.y),i=Math.min(e.y+i,t.y+t.height),this._clippingRect.width=Math.max(0,Math.min(e.x+n,t.x+t.width)-this._clippingRect.x),this._clippingRect.height=Math.max(0,i-this._clippingRect.y)):(this._clippingRect.x=e.x,this._clippingRect.y=e.y,this._clippingRect.width=n,this._clippingRect.height=i),this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t),this._clippingRectDirty=this._doLayoutDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(.5*t.width,.5*t.height),this._backGroundScale9Enabled&&this._backGroundImage instanceof ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(t)),this._colorRender&&this._colorRender.setContentSize(t),this._gradientRender&&this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){this._backGroundScale9Enabled!==t&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=t,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=t,this._bgImageTexType=e,e=this._backGroundImage,this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._backGroundScale9Enabled&&e.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=e.getContentSize(),e.setPosition(.5*this._contentSize.width,.5*this._contentSize.height),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(t){if(t){var e=this._backGroundImageCapInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(t)}},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(t)switch(this._layoutType){case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR);e||t.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:(e=t.getLayoutParameter(ccui.LayoutParameter.RELATIVE))||t.setLayoutParameter(new ccui.RelativeLayoutParameter)}},_addBackGroundImage:function(){var t=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(t)):this._backGroundImage=new cc.Sprite,this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(.5*t.width,.5*t.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(t){if(this._colorType!==t){switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null),this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null)}switch(this._colorType=t,this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new cc.LayerColor,this._colorRender.setContentSize(this._contentSize),this._colorRender.setOpacity(this._opacity),this._colorRender.setColor(this._color),this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new cc.LayerGradient(cc.color(255,0,0,255),cc.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1)}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){e?(this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._gradientRender&&this._gradientRender.setStartColor(t),this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._gradientRender&&this._gradientRender.setEndColor(e)):(this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._colorRender&&this._colorRender.setColor(t))},getBackGroundColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return cc.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){switch(this._opacity=t,this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t)}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._gradientRender&&this._gradientRender.setVector(t)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r,this._backGroundImageColor.g=t.g,this._backGroundImageColor.b=t.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t,t=this._children;for(var e,i=0;i<t.length;i++)(e=t[i])instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(e);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var t=ccui.getLayoutManager(this._layoutType);t&&t._doLayout(this),this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var t,e=this.getChildren(),i=cc.size(0,0),n=0,r=0,o=e.length;r<o;r++)if(null!==(t=e[r])&&t instanceof ccui.Layout)t=t._getLayoutAccumulatedSize(),i.width+=t.width,i.height+=t.height;else if(t instanceof ccui.Widget){n++;var c=t.getLayoutParameter().getMargin();t=t.getContentSize(),i.width+=t.width+.5*(c.right+c.left),i.height+=t.height+.5*(c.top+c.bottom)}return(e=this.getLayoutType())===ccui.Layout.LINEAR_HORIZONTAL&&(i.height-=i.height/n*(n-1)),e===ccui.Layout.LINEAR_VERTICAL&&(i.width-=i.width/n*(n-1)),i},_findNearestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,n=this.getChildren(),r=n.length,o=cc.FLT_MAX,c=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(t=this._getWorldCenterPoint(e);i<r;){var s=n[i];s&&s instanceof ccui.Widget&&s.isFocusEnabled()&&(s=s instanceof ccui.Layout?s._calculateNearestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(s),t)))<o&&(c=i,o=s),i++}return c}return cc.log("invalid focus direction!"),0},_findFarthestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,n=this.getChildren(),r=n.length,o=-cc.FLT_MAX,c=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(t=this._getWorldCenterPoint(e);i<r;){var s=n[i];s&&s instanceof ccui.Widget&&s.isFocusEnabled()&&(s=s instanceof ccui.Layout?s._calculateFarthestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(s),t)))>o&&(c=i,o=s),i++}return c}return cc.log("invalid focus direction!!!"),0},_calculateNearestDistance:function(t){for(var e=cc.FLT_MAX,i=this._getWorldCenterPoint(t),n=this._children,r=0,o=n.length;r<o;r++){var c=n[r];if(c instanceof ccui.Layout)c=c._calculateNearestDistance(t);else{if(!(c instanceof ccui.Widget&&c.isFocusEnabled()))continue;c=cc.pLength(cc.pSub(this._getWorldCenterPoint(c),i))}c<e&&(e=c)}return e},_calculateFarthestDistance:function(t){for(var e=-cc.FLT_MAX,i=this._getWorldCenterPoint(t),n=this._children,r=0,o=n.length;r<o;r++){var c=n[r];if(c instanceof ccui.Layout)c=c._calculateFarthestDistance(t);else{if(!(c instanceof ccui.Widget&&c.isFocusEnabled()))continue;c=this._getWorldCenterPoint(c),c=cc.pLength(cc.pSub(c,i))}c>e&&(e=c)}return e},_findProperSearchingFunctor:function(t,e){if(void 0!==e){e=this._getWorldCenterPoint(e);var i=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());t===ccui.Widget.LEFT?this.onPassFocusToChild=e.x>i.x?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:t===ccui.Widget.RIGHT?this.onPassFocusToChild=e.x>i.x?this._findFarthestChildWidgetIndex:this._findNearestChildWidgetIndex:t===ccui.Widget.DOWN?this.onPassFocusToChild=e.y>i.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:t===ccui.Widget.UP?this.onPassFocusToChild=e.y<i.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:cc.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var t=this._children,e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof ccui.Layout){if(n=n._findFirstNonLayoutWidget())return n}else if(n instanceof ccui.Widget)return n}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var t=0,e=this.getChildren(),i=e.length;t<i;){var n=e[t];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return t;t++}return 0},_findFocusEnabledChildWidgetByIndex:function(t){var e=this._getChildWidgetByIndex(t);return e?e.isFocusEnabled()?e:this._findFocusEnabledChildWidgetByIndex(t+1):null},_getWorldCenterPoint:function(t){var e=t instanceof ccui.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(cc.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var i,n;return(n=(n=(i=this._children).indexOf(e))+1)<i.length?(i=this._getChildWidgetByIndex(n))?i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e:this._loopFocus?this._checkFocusEnabledChild()?(i=this._getChildWidgetByIndex(0)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getPreviousFocusedWidget:function(t,e){var i,n;return 0<=(n=(n=(i=this._children).indexOf(e))-1)?(i=this._getChildWidgetByIndex(n)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i):this._loopFocus?this._checkFocusEnabledChild()?(n=i.length-1,(i=this._getChildWidgetByIndex(n)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getChildWidgetByIndex:function(t){for(var e=this._children,i=e.length,n=t;t<i;){var r=e[t];if(r&&r instanceof ccui.Widget)return r;t++}for(t=0;t<n;){if((i=e[t])&&i instanceof ccui.Widget)return i;t++}return null},_isLastWidgetInContainer:function(t,e){var i=t.getParent();if(null==i||!(i instanceof ccui.Layout))return!0;var n=i.getChildren();if(t=n.indexOf(t),i.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(e===ccui.Widget.LEFT)return 0===t&&this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.RIGHT)return t===n.length-1&&this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.DOWN||e===ccui.Widget.UP)return this._isLastWidgetInContainer(i,e)}else{if(i.getLayoutType()!==ccui.Layout.LINEAR_VERTICAL)return cc.log("invalid layout Type"),!1;if(e===ccui.Widget.UP)return 0===t&&this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.DOWN)return t===n.length-1&&this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(i,e)}},_isWidgetAncestorSupportLoopFocus:function(t,e){if(null==(t=t.getParent())||!(t instanceof ccui.Layout))return!1;if(t.isLoopFocus()){var i=t.getLayoutType();return i===ccui.Layout.LINEAR_HORIZONTAL?e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT||this._isWidgetAncestorSupportLoopFocus(t,e):i===ccui.Layout.LINEAR_VERTICAL?e===ccui.Widget.DOWN||e===ccui.Widget.UP||this._isWidgetAncestorSupportLoopFocus(t,e):(cc.assert(0,"invalid layout type"),!1)}return this._isWidgetAncestorSupportLoopFocus(t,e)},_passFocusToChild:function(t,e){if(this._checkFocusEnabledChild()){var i=ccui.Widget.getCurrentFocusedWidget();return this._findProperSearchingFunctor(t,i),i=this.onPassFocusToChild(t,i),(i=this._getChildWidgetByIndex(i))instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i)}return this},_checkFocusEnabledChild:function(){for(var t=this._children,e=0,i=t.length;e<i;e++){var n=t[e];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(t){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled),this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType),this.setBackGroundImageCapInsets(t._backGroundImageCapInsets),this.setBackGroundColorType(t._colorType),this.setBackGroundColor(t._color),this.setBackGroundColor(t._startColor,t._endColor),this.setBackGroundColorOpacity(t._opacity),this.setBackGroundColorVector(t._alongVector),this.setLayoutType(t._layoutType),this.setClippingEnabled(t._clippingEnabled),this.setClippingType(t._clippingType),this._loopFocus=t._loopFocus,this.__passFocusToChild=t.__passFocusToChild,this._isInterceptTouch=t._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Layout.WebGLRenderCmd(this):new ccui.Layout.CanvasRenderCmd(this)}}),_p=ccui.Layout.prototype,cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled),cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType),cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType),_p=null,ccui.Layout.create=function(){return new ccui.Layout},ccui.Layout.BG_COLOR_NONE=0,ccui.Layout.BG_COLOR_SOLID=1,ccui.Layout.BG_COLOR_GRADIENT=2,ccui.Layout.ABSOLUTE=0,ccui.Layout.LINEAR_VERTICAL=1,ccui.Layout.LINEAR_HORIZONTAL=2,ccui.Layout.RELATIVE=3,ccui.Layout.CLIPPING_STENCIL=0,ccui.Layout.CLIPPING_SCISSOR=1,ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1,ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2,function(){ccui.Layout.CanvasRenderCmd=function(t){this._pNodeCmdCtor(t),this._needDraw=!1,this._rendererRestoreCmd=this._rendererClipCmd=this._rendererSaveCmd=null};var t=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Layout.CanvasRenderCmd,t._layoutCmdCtor=ccui.Layout.CanvasRenderCmd,t._onRenderSaveCmd=function(t,e,i){var n=t||cc._renderContext;for(t=n.getContext(),n.save(),n.save(),n.setTransform(this._worldTransform,e,i),i=0,n=(e=this._node._clippingStencil._renderCmd._buffer).length;i<n;i++){var r=e[i].verts,o=r[0];t.beginPath(),t.moveTo(o.x,-o.y),o=1;for(var c=r.length;o<c;o++)t.lineTo(r[o].x,-r[o].y);t.closePath()}},t._onRenderClipCmd=function(t){var e=(t=t||cc._renderContext).getContext();t.restore(),e.clip()},t._onRenderRestoreCmd=function(t){(t=t||cc._renderContext).getContext(),t.restore()},t.rebindStencilRendering=function(t){t._renderCmd.rendering=this.__stencilDraw,t._renderCmd._canUseDirtyRegion=!0},t.__stencilDraw=function(t,e,i){},t.stencilClippingVisit=t.scissorClippingVisit=function(t){(t=this._node)._clippingStencil&&t._clippingStencil.isVisible()&&(this._rendererSaveCmd||(this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._onRenderRestoreCmd)),cc.renderer.pushRenderCommand(this._rendererSaveCmd),t._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd))},t.postStencilVisit=t.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._rendererRestoreCmd)},ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=document.createElement("canvas"))}}(),function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.Layout.WebGLRenderCmd=function(t){this._pNodeCmdCtor(t),this._needDraw=!1,this._currentStencilEnabled=0,this._scissorOldState=!1,this._clippingOldRect=null,this._mask_layer_le=0,this._afterVisitCmdScissor=this._beforeVisitCmdScissor=this._afterVisitCmdStencil=this._afterDrawStencilCmd=this._beforeVisitCmdStencil=null};var t=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Layout.WebGLRenderCmd,t._layoutCmdCtor=ccui.Layout.CanvasRenderCmd,t._syncStatus=function(t){this._originSyncStatus(t),t&&t._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._node._clippingRectDirty=!0)},t._onBeforeVisitStencil=function(t){t=t||cc._renderContext,ccui.Layout.WebGLRenderCmd._layer++;var e=1<<ccui.Layout.WebGLRenderCmd._layer;this._mask_layer_le=e|e-1,this._currentStencilEnabled=t.isEnabled(t.STENCIL_TEST),t.clear(t.DEPTH_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.depthMask(!1),t.stencilFunc(t.NEVER,e,e),t.stencilOp(t.REPLACE,t.KEEP,t.KEEP),t.stencilMask(e),t.clear(t.STENCIL_BUFFER_BIT)},t._onAfterDrawStencil=function(t){(t=t||cc._renderContext).depthMask(!0),t.stencilFunc(t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},t._onAfterVisitStencil=function(t){if(t=t||cc._renderContext,ccui.Layout.WebGLRenderCmd._layer--,this._currentStencilEnabled){var e=1<<ccui.Layout.WebGLRenderCmd._layer,i=e|e-1;t.stencilMask(e),t.stencilFunc(t.EQUAL,i,i)}else t.disable(t.STENCIL_TEST)},t._onBeforeVisitScissor=function(t){this._node._clippingRectDirty=!0;var e=this._node._getClippingRect();t=t||cc._renderContext,(this._scissorOldState=t.isEnabled(t.SCISSOR_TEST))?(this._clippingOldRect=cc.view.getScissorRect(),cc.rectEqualToRect(this._clippingOldRect,e)||cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)):(t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(e.x,e.y,e.width,e.height))},t._onAfterVisitScissor=function(t){t=t||cc._renderContext,this._scissorOldState?cc.rectEqualToRect(this._clippingOldRect,this._node._clippingRect)||cc.view.setScissorInPoints(this._clippingOldRect.x,this._clippingOldRect.y,this._clippingOldRect.width,this._clippingOldRect.height):t.disable(t.SCISSOR_TEST)},t.rebindStencilRendering=function(t){},t.transform=function(t,e){var i=this._node;this.pNodeTransform(t,e),i._clippingStencil&&i._clippingStencil._renderCmd.transform(this,e)},t.stencilClippingVisit=function(t){if((t=this._node)._clippingStencil&&t._clippingStencil.isVisible())if(ccui.Layout.WebGLRenderCmd._layer+1===cc.stencilBits)ccui.Layout.WebGLRenderCmd._visit_once=!0,ccui.Layout.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1);else{this._beforeVisitCmdStencil||(this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new cc.CustomRenderCmd(this,this._onAfterVisitStencil)),cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var e=cc.current_stack;e.stack.push(e.top),e.top=this._stackMatrix,t._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd)}},t.postStencilVisit=function(){renderer.pushRenderCommand(cmd._afterVisitCmdStencil),cc.current_stack.top=cc.current_stack.stack.pop()},t.scissorClippingVisit=function(t){this._beforeVisitCmdScissor||(this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor)),cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor)},t.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)},ccui.Layout.WebGLRenderCmd._layer=-1,ccui.Layout.WebGLRenderCmd._visit_once=null}}(),ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,i,n){void 0!==t&&void 0===e&&(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom),void 0!==n&&(this.left=t,this.top=e,this.right=i,this.bottom=n)},setMargin:function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}}),ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)},ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin,this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(t,e,i,n){cc.isObject(t)?(this._margin.left=t.left,this._margin.top=t.top,this._margin.right=t.right,this._margin.bottom=t.bottom):(this._margin.left=t,this._margin.top=e,this._margin.right=i,this._margin.bottom=n)},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom,this._margin.left=t._margin.left,this._margin.right=t._margin.right,this._margin.top=t._margin.top}}),ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter},ccui.LayoutParameter.NONE=0,ccui.LayoutParameter.LINEAR=1,ccui.LayoutParameter.RELATIVE=2,ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._linearGravity=ccui.LinearLayoutParameter.NONE,this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.LinearLayoutParameter&&this.setGravity(t._linearGravity)}}),ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter},ccui.LinearLayoutParameter.NONE=0,ccui.LinearLayoutParameter.LEFT=1,ccui.LinearLayoutParameter.TOP=2,ccui.LinearLayoutParameter.RIGHT=3,ccui.LinearLayoutParameter.BOTTOM=4,ccui.LinearLayoutParameter.CENTER_VERTICAL=5,ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6,ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=ccui.RelativeLayoutParameter.NONE,this._relativeLayoutName=this._relativeWidgetName="",this._put=!1,this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.RelativeLayoutParameter&&(this.setAlign(t._relativeAlign),this.setRelativeToWidgetName(t._relativeWidgetName),this.setRelativeName(t._relativeLayoutName))}}),ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter},ccui.RelativeLayoutParameter.NONE=0,ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1,ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3,ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4,ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5,ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7,ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9,ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10,ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11,ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18,ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19,ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20,ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21,ccui.LINEAR_GRAVITY_NONE=0,ccui.LINEAR_GRAVITY_LEFT=1,ccui.LINEAR_GRAVITY_TOP=2,ccui.LINEAR_GRAVITY_RIGHT=3,ccui.LINEAR_GRAVITY_BOTTOM=4,ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5,ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6,ccui.RELATIVE_ALIGN_NONE=0,ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1,ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3,ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4,ccui.RELATIVE_ALIGN_PARENT_CENTER=5,ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7,ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12,ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13,ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14,ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18,ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19,ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20,ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21,ccui.getLayoutManager=function(t){switch(t){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null},ccui.linearVerticalLayoutManager={_doLayout:function(t){var e=t._getLayoutContentSize();t=t._getLayoutElements();for(var i=e.height,n=0,r=t.length;n<r;n++){var o=t[n];if(o){var c=o.getLayoutParameter();if(c){var s=c.getGravity(),a=o.getAnchorPoint(),h=o.getContentSize(),l=a.x*h.width;switch(i-=(1-a.y)*h.height,s){case ccui.LinearLayoutParameter.RIGHT:l=e.width-(1-a.x)*h.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:l=e.width/2-h.width*(.5-a.x)}l+=(c=c.getMargin()).left,i-=c.top,o.setPosition(l,i),i=o.getPositionY()-a.y*h.height-c.bottom}}}}},ccui.linearHorizontalLayoutManager={_doLayout:function(t){for(var e=t._getLayoutContentSize(),i=0,n=0,r=(t=t._getLayoutElements()).length;n<r;n++){var o=t[n];if(o){var c=o.getLayoutParameter();if(c){var s=c.getGravity(),a=o.getAnchorPoint(),h=o.getContentSize(),l=(i+=a.x*h.width,e.height-(1-a.y)*h.height);switch(s){case ccui.LinearLayoutParameter.BOTTOM:l=a.y*h.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:l=e.height/2-h.height*(.5-a.y)}i+=(c=c.getMargin()).left,l-=c.top,o.setPosition(i,l),i=o.getRightBoundary()+c.right}}}}},ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(t){for(var e=this._widgetChildren=this._getAllWidgets(t);0<this._unlayoutChildCount;){for(var i=0,n=e.length;i<n;i++){this._widget=e[i];var r=this._widget.getLayoutParameter();r&&!r._put&&this._calculateFinalPositionWithRelativeWidget(t)&&(this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),r._put=!0)}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(t){t=t._getLayoutElements();for(var e=this._widgetChildren,i=e.length=0,n=t.length;i<n;i++){var r=t[i];r&&r instanceof ccui.Widget&&(r.getLayoutParameter()._put=!1,this._unlayoutChildCount++,e.push(r))}return e},_getRelativeWidget:function(t){var e=null;if((t=t.getLayoutParameter().getRelativeToWidgetName())&&0!==t.length)for(var i=this._widgetChildren,n=0,r=i.length;n<r;n++){var o=i[n];if(o){var c=o.getLayoutParameter();if(c&&c.getRelativeName()===t){e=o,this._relativeWidgetLP=c;break}}}return e},_calculateFinalPositionWithRelativeWidget:function(t){var e=(r=this._widget).getAnchorPoint(),i=r.getContentSize();this._finalPositionY=this._finalPositionX=0;var n=this._getRelativeWidget(r),r=r.getLayoutParameter().getAlign();switch(t=t._getLayoutContentSize(),r){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=e.x*i.width,this._finalPositionY=t.height-(1-e.y)*i.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=.5*t.width-i.width*(.5-e.x),this._finalPositionY=t.height-(1-e.y)*i.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=t.width-(1-e.x)*i.width,this._finalPositionY=t.height-(1-e.y)*i.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=e.x*i.width,this._finalPositionY=.5*t.height-i.height*(.5-e.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=.5*t.width-i.width*(.5-e.x),this._finalPositionY=.5*t.height-i.height*(.5-e.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=t.width-(1-e.x)*i.width,this._finalPositionY=.5*t.height-i.height*(.5-e.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=e.x*i.width,this._finalPositionY=e.y*i.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=.5*t.width-i.width*(.5-e.x),this._finalPositionY=e.y*i.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=t.width-(1-e.x)*i.width,this._finalPositionY=e.y*i.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getTopBoundary()+e.y*i.height,this._finalPositionX=n.getLeftBoundary()+e.x*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=n.getContentSize(),this._finalPositionY=n.getTopBoundary()+e.y*i.height,this._finalPositionX=n.getLeftBoundary()+.5*t.width+e.x*i.width-.5*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getTopBoundary()+e.y*i.height,this._finalPositionX=n.getRightBoundary()-(1-e.x)*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getTopBoundary()-(1-e.y)*i.height,this._finalPositionX=n.getLeftBoundary()-(1-e.x)*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=n.getContentSize(),this._finalPositionX=n.getLeftBoundary()-(1-e.x)*i.width,this._finalPositionY=n.getBottomBoundary()+.5*t.height+e.y*i.height-.5*i.height}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getBottomBoundary()+e.y*i.height,this._finalPositionX=n.getLeftBoundary()-(1-e.x)*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getTopBoundary()-(1-e.y)*i.height,this._finalPositionX=n.getRightBoundary()+e.x*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=n.getContentSize(),this._finalPositionX=n.getRightBoundary()+e.x*i.width,this._finalPositionY=n.getBottomBoundary()+.5*t.height+e.y*i.height-.5*i.height}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getBottomBoundary()+e.y*i.height,this._finalPositionX=n.getRightBoundary()+e.x*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getBottomBoundary()-(1-e.y)*i.height,this._finalPositionX=n.getLeftBoundary()+e.x*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;t=n.getContentSize(),this._finalPositionY=n.getBottomBoundary()-(1-e.y)*i.height,this._finalPositionX=n.getLeftBoundary()+.5*t.width+e.x*i.width-.5*i.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(n){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=n.getBottomBoundary()-(1-e.y)*i.height,this._finalPositionX=n.getRightBoundary()-(1-e.x)*i.width}}return!0},_calculateFinalPositionWithRelativeAlign:function(){var t=this._widget.getLayoutParameter(),e=t.getMargin();switch(t.getAlign()){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=e.top,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=e.top,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=e.top}}},ccui.HBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL),t&&this.setContentSize(t)}}),ccui.HBox.create=function(t){return new ccui.HBox(t)},ccui.RelativeBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.RELATIVE),t&&this.setContentSize(t)}}),ccui.RelativeBox.create=function(t){return new ccui.RelativeBox(t)},ccui.VBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_VERTICAL),t&&this.setContentSize(t)},initWithSize:function(t){return!!this.init()}}),ccui.VBox.create=function(t){return new ccui.VBox(t)},ccui.helper={seekWidgetByTag:function(t,e){if(!t)return null;if(t.getTag()===e)return t;for(var i=(t=t.getChildren()).length,n=0;n<i;n++){var r=ccui.helper.seekWidgetByTag(t[n],e);if(null!==r)return r}return null},seekWidgetByName:function(t,e){if(!t)return null;if(t.getName()===e)return t;for(var i=(t=t.getChildren()).length,n=0;n<i;n++){var r=ccui.helper.seekWidgetByName(t[n],e);if(null!==r)return r}return null},seekWidgetByRelativeName:function(t,e){if(!t)return null;for(var i=(t=t.getChildren()).length,n=0;n<i;n++){var r=t[n],o=r.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(o&&o.getRelativeName()===e)return r}return null},seekActionWidgetByActionTag:function(t,e){if(!t)return null;if(t.getActionTag()===e)return t;t=t.getChildren();for(var i=0;i<t.length;i++){var n=ccui.helper.seekActionWidgetByActionTag(t[i],e);if(null!==n)return n}return null},_activeLayout:!0,doLayout:function(t){if(this._activeLayout)for(var e,i=0,n=(t=t.getChildren()).length;i<n;i++){var r=(e=t[i]).getComponent(ccui.LayoutComponent.NAME);e=e.getParent(),null!=r&&null!==e&&r.refreshLayout&&r.refreshLayout()}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var i=t.x,n=t.y,r=t.width;return t=t.height,e.width<r&&(r=i=0),e.height<t&&(t=n=0),cc.rect(i,n,r,t)},_createSpriteFromBase64:function(t,e){var i=cc.textureCache.getTextureForKey(e);return i||((i=new Image).src=t,cc.textureCache.cacheImage(e,i),i=cc.textureCache.getTextureForKey(e)),new cc.Sprite(i)}},ccui.Button=ccui.Widget.extend({_buttonScale9Renderer:null,_buttonNormalSpriteFrame:null,_buttonClickedSpriteFrame:null,_buttonDisableSpriteFrame:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,i,n){this._capInsetsNormal=cc.rect(0,0,0,0),this._normalTextureSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),this._normalLoader=new cc.Sprite.LoadManager,this._clickedLoader=new cc.Sprite.LoadManager,this._disabledLoader=new cc.Sprite.LoadManager,t&&this.loadTextures(t,e,i,n)},_createTitleRendererIfNeeded:function(){this._titleRenderer||(this._titleRenderer=new cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this._titleColor=cc.color.WHITE,this._titleRenderer.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1))},_initRenderer:function(){this._buttonScale9Renderer=new ccui.Scale9Sprite,this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this.addProtectedChild(this._buttonScale9Renderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,(this._scale9Enabled=t)?this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsetsNormal),this.setBright(this._bright),this._normalTextureAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){this._unifySize?this._updateContentSize():(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&this._titleRenderer&&0<this._titleRenderer.getString().length?this._titleRenderer.getContentSize():cc.size(this._normalTextureSize)},loadTextures:function(t,e,i,n){this.loadTextureNormal(t,n),this.loadTexturePressed(e,n),this.loadTextureDisabled(i,n)},_createSpriteFrameWithFile:function(t){var e=cc.textureCache.getTextureForKey(t);return e||(e=cc.textureCache.addImage(t)),e._textureLoaded?(t=e.getContentSize(),t=cc.rect(0,0,t.width,t.height),new cc.SpriteFrame(e,t)):e},_createSpriteFrameWithName:function(t){return null==(t=cc.spriteFrameCache.getSpriteFrame(t))?(cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),null):t},loadTextureNormal:function(t,e){if(t){var i;switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._normalFileName=t,this._normalTexType=e,this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:i=this._createSpriteFrameWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:"#"===t[0]&&(t=t.substr(1,t.length-1)),i=this._createSpriteFrameWithName(t)}i&&(i._textureLoaded?(this._normalTextureLoaded=i._textureLoaded,this._buttonNormalSpriteFrame=i,this._buttonScale9Renderer.setSpriteFrame(i),this._scale9Enabled&&this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),!this._ignoreSize&&cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._buttonScale9Renderer.getContentSize()),this._normalTextureSize=this._buttonScale9Renderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=!0,this._findLayout()):(this._normalLoader.clear(),this._normalLoader.once(i,(function(){this.loadTextureNormal(this._normalFileName,this._normalTexType)}),this)))}},loadTexturePressed:function(t,e){if(t){var i;switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._clickedFileName=t,this._pressedTexType=e,this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:i=this._createSpriteFrameWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:"#"===t[0]&&(t=t.substr(1,t.length-1)),i=this._createSpriteFrameWithName(t)}i&&(i._textureLoaded?(this._buttonClickedSpriteFrame=i,this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0):(this._clickedLoader.clear(),this._clickedLoader.once(i,(function(){this.loadTexturePressed(this._clickedFileName,this._pressedTexType)}),this)))}},loadTextureDisabled:function(t,e){if(t){var i;switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._disabledFileName=t,this._disabledTexType=e,this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:i=this._createSpriteFrameWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:"#"===t[0]&&(t=t.substr(1,t.length-1)),i=this._createSpriteFrameWithName(t)}i&&(i._textureLoaded?(this._buttonDisableSpriteFrame=i,this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._findLayout()):(this._disabledLoader.clear(),this._disabledLoader.once(i,(function(){this.loadTextureDisabled(this._disabledFileName,this._disabledTexType)}),this)))}},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t)},setCapInsetsNormalRenderer:function(t){if(t&&this._scale9Enabled){var e=t.x,i=t.y,n=t.width;t=t.height,this._normalTextureSize.width<n&&(n=e=0),this._normalTextureSize.height<t&&(t=i=0);var r=this._capInsetsNormal;r.x=e,r.y=i,r.width=n,r.height=t,this._capInsetsNormal=r,this._buttonScale9Renderer.setCapInsets(r)}},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){this.setCapInsetsNormalRenderer(t)},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsDisabledRenderer:function(t){this.setCapInsetsNormalRenderer(t)},getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsNormal)},_onPressStateChangedToNormal:function(){if(this._buttonScale9Renderer.setSpriteFrame(this._buttonNormalSpriteFrame),this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this.pressedActionEnabled&&(this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._titleRenderer))if(this._titleRenderer.stopAllActions(),this._unifySize){var t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(t)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._scale9Enabled&&this._buttonScale9Renderer.setColor(cc.color.WHITE),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1))},_onPressStateChangedToPressed:function(){if(this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),this.pressedActionEnabled){this._buttonScale9Renderer.stopAllActions();var t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale);this._buttonScale9Renderer.runAction(t),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale)))}}else this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1+this._zoomScale,1+this._zoomScale),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?this._buttonScale9Renderer.setSpriteFrame(this._buttonDisableSpriteFrame):this._normalTextureLoaded&&this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.GRAY),this._buttonScale9Renderer.setScale(1)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var t=this._getNormalSize();ccui.ProtectedNode.setContentSize(t)}this._onSizeChanged()}else this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._titleRenderer&&this._updateTitleLocation(),this._normalTextureAdaptDirty=!0},getVirtualRenderer:function(){return this._buttonScale9Renderer},_normalTextureScaleChangedWithSize:function(){this._buttonScale9Renderer.setContentSize(this._contentSize),this._buttonScale9Renderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){t!==this.getTitleText()&&(this._createTitleRendererIfNeeded(),this._titleRenderer.setString(t),this._ignoreSize?(t=this.getVirtualRendererSize(),this.setContentSize(t)):this._titleRenderer._renderCmd._updateTTF())},getTitleText:function(){return this._titleRenderer?this._titleRenderer.getString():""},setTitleColor:function(t){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer?this._titleRenderer._getFillStyle():cc.color.WHITE},setTitleFontSize:function(t){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontSize(t),this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer?this._titleRenderer.getFontSize():this._fontSize},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontName(t),this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer?this._titleRenderer.getFontName():this._fontName},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this._capInsetsNormal=t._capInsetsNormal,this.setScale9Enabled(t._scale9Enabled),this.loadTextureNormal(t._normalFileName,t._normalTexType),this.loadTexturePressed(t._clickedFileName,t._pressedTexType),this.loadTextureDisabled(t._disabledFileName,t._disabledTexType),t._titleRenderer&&t._titleRenderer._string&&(this.setTitleText(t.getTitleText()),this.setTitleFontName(t.getTitleFontName()),this.setTitleFontSize(t.getTitleFontSize()),this.setTitleColor(t.getTitleColor())),this.setPressedActionEnabled(t.pressedActionEnabled),this.setZoomScale(t._zoomScale)},_getNormalSize:function(){var t;null!==this._titleRenderer&&(t=this._titleRenderer.getContentSize());var e=this._buttonScale9Renderer.getContentSize();return cc.size(t.width>e.width?t.width:e.width,t.height>e.height?t.height:e.height)}}),_p=ccui.Button.prototype,cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText),cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont),cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize),cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName),cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor),_p=null,ccui.Button.create=function(t,e,i,n){return new ccui.Button(t,e,i,n)},ccui.Button.NORMAL_RENDERER_ZORDER=-2,ccui.Button.PRESSED_RENDERER_ZORDER=-2,ccui.Button.DISABLED_RENDERER_ZORDER=-2,ccui.Button.TITLE_RENDERER_ZORDER=-1,ccui.Button.ZOOM_ACTION_TIME_STEP=.05,ccui.Button.SYSTEM=0,ccui.Button.TTF=1,ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(t,e,i,n,r,o){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var c=0,s=0;s<arguments.length;s++){var a=typeof arguments[s];"string"===a?isNaN(arguments[s]-0)?c++:(o=arguments[s],arguments[s]=void 0):"number"===a&&c++}2===c&&(o=i,i=e,e=void 0),o=void 0===o?0:o,this._isSelected=!0,this.setSelected(!1),this.loadTextures(t,e,i,n,r,o)},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite,this._backGroundSelectedBoxRenderer=new cc.Sprite,this._frontCrossRenderer=new cc.Sprite,this._backGroundBoxDisabledRenderer=new cc.Sprite,this._frontCrossDisabledRenderer=new cc.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,i,n,r,o){t&&this.loadTextureBackGround(t,o),e&&this.loadTextureBackGroundSelected(e,o),i&&this.loadTextureFrontCross(i,o),n&&this.loadTextureBackGroundDisabled(n,o),r&&this.loadTextureFrontCrossDisabled(r,o)},loadTextureBackGround:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundFileName=t,this._backGroundTexType=e,(e=this._backGroundBoxRenderer)._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):e.addEventListener("load",(function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)}),this),this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=t,this._backGroundSelectedTexType=e,(e=this._backGroundSelectedBoxRenderer)._textureLoaded||e.addEventListener("load",(function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)}),this),this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossFileName=t,this._frontCrossTexType=e,(e=this._frontCrossRenderer)._textureLoaded||e.addEventListener("load",(function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)}),this),this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=t,this._backGroundDisabledTexType=e,(e=this._backGroundBoxDisabledRenderer)._textureLoaded||e.addEventListener("load",(function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)}),this),this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(t,e){if(t){switch(e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=t,this._frontCrossDisabledTexType=e,(e=this._frontCrossDisabledRenderer)._textureLoaded||e.addEventListener("load",(function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)}),this),this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){t!==this._isSelected&&(this._isSelected=t,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t,this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._frontCrossDisabledRendererAdaptDirty=this._backGroundBoxDisabledRendererAdaptDirty=this._frontCrossRendererAdaptDirty=this._backGroundSelectedBoxRendererAdaptDirty=this._backGroundBoxRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{if(0>=(n=t.getContentSize()).width||0>=n.height)return t.setScale(1),void(this._backgroundTextureScaleX=this._backgroundTextureScaleY=1);var i=e.width/n.width,n=e.height/n.height;this._backgroundTextureScaleX=i,this._backgroundTextureScaleY=n,t.setScaleX(i),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}t.setPosition(.5*e.width,.5*e.height)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(t){t instanceof ccui.CheckBox&&(this.loadTextureBackGround(t._backGroundFileName,t._backGroundTexType),this.loadTextureBackGroundSelected(t._backGroundSelectedFileName,t._backGroundSelectedTexType),this.loadTextureFrontCross(t._frontCrossFileName,t._frontCrossTexType),this.loadTextureBackGroundDisabled(t._backGroundDisabledFileName,t._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(t._frontCrossDisabledFileName,t._frontCrossDisabledTexType),this.setSelected(t._isSelected),this._checkBoxEventListener=t._checkBoxEventListener,this._checkBoxEventSelector=t._checkBoxEventSelector,this._ccEventCallback=t._ccEventCallback,this._zoomScale=t._zoomScale,this._backgroundTextureScaleX=t._backgroundTextureScaleX,this._backgroundTextureScaleY=t._backgroundTextureScaleY)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}}),_p=ccui.CheckBox.prototype,cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),_p=null,ccui.CheckBox.create=function(t,e,i,n,r,o){return new ccui.CheckBox(t,e,i,n,r,o)},ccui.CheckBox.EVENT_SELECTED=0,ccui.CheckBox.EVENT_UNSELECTED=1,ccui.CheckBox.BOX_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1,ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(t,e){this._capInsets=cc.rect(0,0,0,0),this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height),ccui.Widget.prototype.ctor.call(this),t?this.loadTexture(t,void 0===e?0:e):this._imageTexType=ccui.Widget.LOCAL_TEXTURE},_initRenderer:function(){this._imageRenderer=new ccui.Scale9Sprite,this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(t,e){if(t&&(this._textureFile!=t||this._imageTexType!=e)){var i=this;e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._imageTexType=e;var n=i._imageRenderer;switch(i._imageTexType){case ccui.Widget.LOCAL_TEXTURE:i._scale9Enabled?(n.initWithFile(t),n.setCapInsets(i._capInsets)):n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i._scale9Enabled?(n.initWithSpriteFrameName(t),n.setCapInsets(i._capInsets)):n.initWithSpriteFrameName(t)}if(!n._textureLoaded){var r=function(){n.removeEventListener("load",r),!i._ignoreSize&&cc.sizeEqualToSize(i._customSize,cc.size(0,0))&&(i._customSize=i._imageRenderer.getContentSize()),i._imageTextureSize=n.getContentSize(),i._updateChildrenDisplayedRGBA(),i._updateContentSizeWithTextureSize(i._imageTextureSize)};n.addEventListener("load",r)}!this._ignoreSize&&cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._imageRenderer.getContentSize()),i._imageTextureSize=n.getContentSize(),this._updateChildrenDisplayedRGBA(),i._updateContentSizeWithTextureSize(i._imageTextureSize),i._imageRendererAdaptDirty=!0,i._findLayout()}},setTextureRect:function(){cc.warn("ImageView.setTextureRect  is deprecated!")},setScale9Enabled:function(t){this._scale9Enabled!==t&&((this._scale9Enabled=t)?this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._imageRenderer.setCapInsets(t)}},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){this._imageRenderer.setContentSize(this._contentSize),this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(t){t instanceof ccui.ImageView&&(this._prevIgnoreSize=t._prevIgnoreSize,this._capInsets=t._capInsets,this.loadTexture(t._textureFile,t._imageTexType),this.setScale9Enabled(t._scale9Enabled))},setContentSize:function(t,e){e&&(t=cc.size(t,e)),ccui.Widget.prototype.setContentSize.call(this,t),this._imageRenderer.setContentSize(t)}}),ccui.ImageView.create=function(t,e){return new ccui.ImageView(t,e)},ccui.ImageView.RENDERER_ZORDER=-1,ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(t,e){this._direction=ccui.LoadingBar.TYPE_LEFT,this._barRendererTextureSize=cc.size(0,0),this._capInsets=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),void 0!==t&&this.loadTexture(t),void 0!==e&&this.setPercent(e)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(t){if(this._direction!==t)switch(this._direction=t,this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,.5),this._barRenderer.setPosition(0,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,.5),this._barRenderer.setPosition(this._totalLength,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!0)}},getDirection:function(){return this._direction},loadTexture:function(t,e){if(t){this._renderBarTexType=e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,e=this._barRenderer;var i=this;switch(e._textureLoaded||e.addEventListener("load",(function(){i.loadTexture(i._textureFile,i._renderBarTexType),i._setPercent(i._percent)})),this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}switch(t=e.getContentSize(),this._barRendererTextureSize.width=t.width,this._barRendererTextureSize.height=t.height,this._direction){case ccui.LoadingBar.TYPE_LEFT:e.setAnchorPoint(0,.5),this._scale9Enabled||e.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:e.setAnchorPoint(1,.5),this._scale9Enabled||e.setFlippedX(!0)}this._scale9Enabled&&e.setCapInsets(this._capInsets),this._updateChildrenDisplayedRGBA(),this._barRendererScaleChangedWithSize(),this._updateContentSizeWithTextureSize(this._barRendererTextureSize),this._barRendererAdaptDirty=!0,this._findLayout()}},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsets:function(){return cc.rect(this._capInsets)},setPercent:function(t){100<t&&(t=100),0>t&&(t=0),t!==this._percent&&(this._percent=t,this._setPercent(t))},_setPercent:function(){var t,e,i,n;0>=this._totalLength||(t=this._percent/100,this._scale9Enabled?this._setScale9Scale():(i=this._barRenderer,n=this._barRendererTextureSize,(e=i.getTextureRect()).width=n.width*t,i.setTextureRect(cc.rect(e.x,e.y,n.width*t,n.height),i._rectRotated)))},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),this._totalLength=void 0===e?t.width:t},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var t=this._barRenderer,e=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,t.setScale(1));else if(this._totalLength=e.width,this._scale9Enabled)this._setScale9Scale(),t.setScale(1);else{var i=this._barRendererTextureSize;if(0>=i.width||0>=i.height)return void t.setScale(1);var n=e.height/i.height;t.setScaleX(e.width/i.width),t.setScaleY(n)}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:t.setPosition(0,.5*e.height);break;case ccui.LoadingBar.TYPE_RIGHT:t.setPosition(this._totalLength,.5*e.height)}},_setScale9Scale:function(){this._barRenderer.setPreferredSize(cc.size(this._percent/100*this._totalLength,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(t){t instanceof ccui.LoadingBar&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._renderBarTexType),this.setCapInsets(t._capInsets),this.setPercent(t._percent),this.setDirection(t._direction))}}),_p=ccui.LoadingBar.prototype,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.LoadingBar.create=function(t,e){return new ccui.LoadingBar(t,e)},ccui.LoadingBar.TYPE_LEFT=0,ccui.LoadingBar.TYPE_RIGHT=1,ccui.LoadingBar.RENDERER_ZORDER=-1,ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(t,e,i){this._barTextureSize=cc.size(0,0),this._progressBarTextureSize=cc.size(0,0),this._capInsetsBarRenderer=cc.rect(0,0,0,0),this._capInsetsProgressBarRenderer=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),i=i||0,this.setTouchEnabled(!0),t&&this.loadBarTexture(t,i),e&&this.loadSlidBallTextures(e,i)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite,this._progressBarRenderer.setAnchorPoint(0,.5),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._slidBallNormalRenderer=new cc.Sprite,this._slidBallPressedRenderer=new cc.Sprite,this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer=new cc.Sprite,this._slidBallDisabledRenderer.setVisible(!1),this._slidBallRenderer=new cc.Node,this._slidBallRenderer.addChild(this._slidBallNormalRenderer),this._slidBallRenderer.addChild(this._slidBallPressedRenderer),this._slidBallRenderer.addChild(this._slidBallDisabledRenderer),this._slidBallRenderer.setCascadeColorEnabled(!0),this._slidBallRenderer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._barTexType=e,e=this._barRenderer;var i=this;switch(e._textureLoaded||e.addEventListener("load",(function(){i.loadBarTexture(i._textureFile,i._barTexType)})),this._barTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize()),this._findLayout(),this._barTextureSize=this._barRenderer.getContentSize()}},loadProgressBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._progressBarTextureFile=t,this._progressBarTexType=e,e=this._progressBarRenderer;var i=this;switch(e._textureLoaded||e.addEventListener("load",(function(){i.loadProgressBarTexture(i._progressBarTextureFile,i._progressBarTexType)})),this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:e.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:e.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._progressBarRenderer.setAnchorPoint(cc.p(0,.5)),t=this._progressBarRenderer.getContentSize(),this._progressBarTextureSize={width:t.width,height:t.height},this._progressBarRendererDirty=!0,this._findLayout()}},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer,!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._progressBarRenderer=this._barRenderer=null,this._scale9Enabled?(this._barRenderer=new ccui.Scale9Sprite,this._progressBarRenderer=new ccui.Scale9Sprite):(this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){this.setCapInsetsBarRenderer(t),this.setCapInsetProgressBarRenderer(t)},setCapInsetsBarRenderer:function(t){if(t){var e=this._capInsetsBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsetsBarRenderer:function(){return cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(t){if(t){var e=this._capInsetsProgressBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._progressBarRenderer.setCapInsets(t)}},getCapInsetsProgressBarRenderer:function(){return cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(t,e,i,n){this.loadSlidBallTextureNormal(t,n),this.loadSlidBallTexturePressed(e,n),this.loadSlidBallTextureDisabled(i,n)},loadSlidBallTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallNormalTextureFile=t,this._ballNTexType=e;var i=this;switch(this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.addEventListener("load",(function(){i.loadSlidBallTextureNormal(i._slidBallNormalTextureFile,i._ballNTexType)})),this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallPressedTextureFile=t,this._ballPTexType=e;var i=this;switch(this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.addEventListener("load",(function(){i.loadSlidBallTexturePressed(i._slidBallPressedTextureFile,i._ballPTexType)})),this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallDisabledTextureFile=t,this._ballDTexType=e;var i=this;switch(this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.addEventListener("load",(function(){i.loadSlidBallTextureDisabled(i._slidBallDisabledTextureFile,i._ballDTexType)})),this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},setPercent:function(t){if(100<t&&(t=100),0>t&&(t=0),this._percent=t,t=t/100*this._barLength,this._slidBallRenderer.setPosition(t,this._contentSize.height/2),this._scale9Enabled)this._progressBarRenderer.setPreferredSize(cc.size(t,this._contentSize.height));else{var e=this._progressBarRenderer,i=e.getTextureRect();e.setTextureRect(cc.rect(i.x,i.y,t/e._scaleX,i.height),e.isTextureRectRotated())}},hitTest:function(t){t=this._slidBallNormalRenderer.convertToNodeSpace(t);var e=this._slidBallNormalRenderer.getContentSize();return e=cc.rect(0,0,e.width,e.height),t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},onTouchBegan:function(t,e){return t=ccui.Widget.prototype.onTouchBegan.call(this,t,e),this._hit&&(e=this.convertToNodeSpace(this._touchBeganPosition),this.setPercent(this._getPercentWithBallPos(e.x)),this._percentChangedEvent()),t},onTouchMoved:function(t,e){t=t.getLocation(),t=this.convertToNodeSpace(t),this.setPercent(this._getPercentWithBallPos(t.x)),this._percentChangedEvent()},onTouchEnded:function(t,e){ccui.Widget.prototype.onTouchEnded.call(this,t,e)},onTouchCancelled:function(t,e){ccui.Widget.prototype.onTouchCancelled.call(this,t,e)},_getPercentWithBallPos:function(t){return t/this._barLength*100},addEventListenerSlider:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._sliderEventSelector=t,this._sliderEventListener=e},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,this,ccui.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED)),this._ccEventCallback&&this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1),this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var t=this._barTextureSize;if(0>=t.width||0>=t.height)this._barRenderer.setScale(1);else{var e=this._contentSize.height/t.height;this._barRenderer.setScaleX(this._contentSize.width/t.width),this._barRenderer.setScaleY(e)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2),this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize){if(!this._scale9Enabled){var t=this._progressBarTextureSize,e=this._contentSize.width/t.width;t=this._contentSize.height/t.height,this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(t)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{if(0>=(t=this._progressBarTextureSize).width||0>=t.height)return void this._progressBarRenderer.setScale(1);e=this._contentSize.width/t.width,t=this._contentSize.height/t.height,this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(t)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2),this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0),this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!1),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)):(this._slidBallNormalRenderer.setVisible(!0),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getGrayGLProgram())),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getSlidBallNormalRenderer:function(){return this._slidBallNormalRenderer},getSlidBallPressedRenderer:function(){return this._slidBallPressedRenderer},getSlidBallDisabledRenderer:function(){return this._slidBallDisabledRenderer},getSlidBallRenderer:function(){return this._slidBallRenderer},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadBarTexture(t._textureFile,t._barTexType),this.loadProgressBarTexture(t._progressBarTextureFile,t._progressBarTexType),this.loadSlidBallTextureNormal(t._slidBallNormalTextureFile,t._ballNTexType),this.loadSlidBallTexturePressed(t._slidBallPressedTextureFile,t._ballPTexType),this.loadSlidBallTextureDisabled(t._slidBallDisabledTextureFile,t._ballDTexType),this.setPercent(t.getPercent()),this._sliderEventListener=t._sliderEventListener,this._sliderEventSelector=t._sliderEventSelector,this._zoomScale=t._zoomScale,this._ccEventCallback=t._ccEventCallback}}),_p=ccui.Slider.prototype,cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.Slider.create=function(t,e,i){return new ccui.Slider(t,e,i)},ccui.Slider.EVENT_PERCENT_CHANGED=0,ccui.Slider.BASEBAR_RENDERER_ZORDER=-3,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2,ccui.Slider.BALL_RENDERER_ZORDER=-1,ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:.5,_labelRenderer:null,_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(t,e,i){this._type=ccui.Text.Type.SYSTEM,this._textAreaSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),void 0!==i?(this.setFontName(e),this.setFontSize(i),this.setString(t)):this.setFontName(this._fontName)},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF,this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelRenderer.getString()&&(this._setString(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()))},_setString:function(t){this._labelRenderer.setString(t),this._labelRendererAdaptDirty=!0},getStringValue:function(){return cc.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._setFontSize(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setFontSize:function(t){this._labelRenderer.setFontSize(t),this._fontSize=t,this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(t){this._setFontName(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setFontName:function(t){this._fontName=t,this._labelRenderer.setFontName(t),this._labelRendererAdaptDirty=!0},_updateUITextContentSize:function(){this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},getFontName:function(){return this._fontName},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._labelRenderer._setFont(t),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._setTextAreaSize(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setTextAreaSize:function(t){this._labelRenderer.setDimensions(t),this._ignoreSize||(this._customSize=t),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._setTextHorizontalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._setTextVerticalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),t=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize)this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{if(this._labelRenderer.setDimensions(cc.size(t.width,t.height)),0>=(i=this._labelRenderer.getContentSize()).width||0>=i.height)return void this._labelRenderer.setScale(1);var e=t.width/i.width,i=t.height/i.height;this._labelRenderer.setScaleX(e),this._labelRenderer.setScaleY(i),this._normalScaleValueX=e,this._normalScaleValueY=i}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,i){this._labelRenderer.enableShadow(t,e,i)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(t)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(t){t instanceof ccui.Text&&(this.setFontName(t._fontName),this.setFontSize(t.getFontSize()),this.setString(t.getString()),this.setTouchScaleChangeEnabled(t.touchScaleEnabled),this.setTextAreaSize(t._textAreaSize),this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment()),this.setContentSize(t.getContentSize()),this.setTextColor(t.getTextColor()))},_setBoundingWidth:function(t){this._textAreaSize.width=t,this._labelRenderer._setBoundingWidth(t),this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t,this._labelRenderer._setBoundingHeight(t),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){cc.ProtectedNode.prototype.setColor.call(this,t),this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}}),_p=ccui.Text.prototype,cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth),cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight),cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"stringLength",_p.getStringLength),cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment),cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment),_p=null,ccui.Label=ccui.Text.create=function(t,e,i){return new ccui.Text(t,e,i)},ccui.Text.RENDERER_ZORDER=-1,ccui.Text.Type={SYSTEM:0,TTF:1},ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(t,e,i,n,r){ccui.Widget.prototype.ctor.call(this),void 0!==r&&this.setProperty(t,e,i,n,r)},_initRenderer:function(){this._labelAtlasRenderer=new cc.LabelAtlas,this._labelAtlasRenderer.setAnchorPoint(cc.p(.5,.5)),this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,-1),this._labelAtlasRenderer.addEventListener("load",(function(){this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._findLayout()}),this)},setProperty:function(t,e,i,n,r){this._stringValue=t,this._charMapFileName=e,this._itemWidth=i,this._itemHeight=n,this._startCharMap=r,this._labelAtlasRenderer.initWithString(t,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0},setString:function(t){t!==this._labelAtlasRenderer.getString()&&(this._stringValue=t,this._labelAtlasRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(t){cc.log("Please use the setString"),this.setString(t)},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var t=this._labelAtlasRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(0>=e.width||0>=e.height)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(t){t&&this.setProperty(t._stringValue,t._charMapFileName,t._itemWidth,t._itemHeight,t._startCharMap)},_createCloneInstance:function(){return new ccui.TextAtlas}}),_p=ccui.TextAtlas.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextAtlas.create=function(t,e,i,n,r){return new ccui.TextAtlas(t,e,i,n,r)},ccui.TextAtlas.RENDERER_ZORDER=-1,ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(t,e){ccui.Widget.prototype.ctor.call(this),this._loader=new cc.Sprite.LoadManager,void 0!==e&&(this.setFntFile(e),this.setString(t))},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){if(t){this._fntFileName=t,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,t),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0;var e=this;(t=e._labelBMFontRenderer)._textureLoaded||t.addEventListener("load",(function(){e.setFntFile(e._fntFileName)}))}},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){this._loader.clear(),this._labelBMFontRenderer._textureLoaded?t!==this._labelBMFontRenderer.getString()&&(this._stringValue=t,this._labelBMFontRenderer.setString(t),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0)):this._loader.add(this._labelBMFontRenderer,(function(){this.setString(t)}),this)},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(0>=e.width||0>=e.height)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName),this.setString(t._stringValue)}}),_p=ccui.TextBMFont.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextBMFont.create=function(t,e){return new ccui.TextBMFont(t,e)},ccui.TextBMFont.RENDERER_ZORDER=-1,ccui._TextFieldRenderer=cc.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){cc.TextFieldTTF.prototype.ctor.call(this),this._maxLengthEnabled=!1,this._maxLength=0,this._passwordEnabled=!1,this._passwordStyleText="*",this._deleteBackward=this._insertText=this._detachWithIME=this._attachWithIME=!1},onEnter:function(){cc.TextFieldTTF.prototype.onEnter.call(this),cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(t){return this.setAttachWithIME(!0),!1},onTextFieldInsertText:function(t,e,i){return(1!==i||"\n"!==e)&&(this.setInsertText(!0),this._maxLengthEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength)},onTextFieldDeleteBackward:function(t,e,i){return this.setDeleteBackward(!0),!1},onTextFieldDetachWithIME:function(t){return this.setDetachWithIME(!0),!1},insertText:function(t,e){"\n"!==t&&this._maxLengthEnabled&&this.getString().length>=this._maxLength?this._passwordEnabled&&this.setPasswordText(this.getString()):(cc.TextFieldTTF.prototype.insertText.call(this,t,e),this._passwordEnabled&&0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this.setPasswordText(this.getString()))},deleteBackward:function(){cc.TextFieldTTF.prototype.deleteBackward.call(this),0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){cc.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(t){this._maxLengthEnabled=t},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(t){this._maxLength=t},getMaxLength:function(){return this._maxLength},getCharCount:function(){return cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(t){this._passwordEnabled=t},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(t){if(!(1<t.length)){var e=t.charCodeAt(0);33>e||126<e||(this._passwordStyleText=t)}},setPasswordText:function(t){var e="",i=t.length;for(t=i,this._maxLengthEnabled&&i>this._maxLength&&(t=this._maxLength),i=0;i<t;++i)e+=this._passwordStyleText;cc.LabelTTF.prototype.setString.call(this,e)},setAttachWithIME:function(t){this._attachWithIME=t},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(t){this._detachWithIME=t},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(t){this._insertText=t},getInsertText:function(){return this._insertText},setDeleteBackward:function(t){this._deleteBackward=t},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(t){return!1}}),ccui._TextFieldRenderer.create=function(t,e,i){var n=new ccui._TextFieldRenderer;return n&&n.initWithString("",e,i)?(t&&n.setPlaceHolder(t),n):null},ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(t,e,i){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),e&&this.setFontName(e),i&&this.setFontSize(i),t&&this.setPlaceHolder(t)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20),this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(t){this._touchWidth=t.width,this._touchHeight=t.height},setTouchAreaEnabled:function(t){this._useTouchArea=t},hitTest:function(t){if(this._useTouchArea){t=this.convertToNodeSpace(t);var e=cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}return ccui.Widget.prototype.hitTest.call(this,t)},getTouchSize:function(){return cc.size(this._touchWidth,this._touchHeight)},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){null!=t&&(t=String(t),this.isMaxLengthEnabled()&&(t=t.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(t),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(t,t.length)):this._textFieldRenderer.setString(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(t){this._textFieldRenderer.setPlaceHolder(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(t){this._textFieldRenderer.setColorSpaceHolder(t)},setTextColor:function(t){this._textFieldRenderer.setTextColor(t)},setFontSize:function(t){this._textFieldRenderer.setFontSize(t),this._fontSize=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(t){this._textFieldRenderer.setFontName(t),this._fontName=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(t,e){var i=this;return t=ccui.Widget.prototype.onTouchBegan.call(i,t,e),i._hit?setTimeout((function(){i._textFieldRenderer.attachWithIME()}),0):setTimeout((function(){i._textFieldRenderer.detachWithIME()}),0),t},setMaxLengthEnabled:function(t){this._textFieldRenderer.setMaxLengthEnabled(t)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(t){this._textFieldRenderer.setMaxLength(t),this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(t){this._textFieldRenderer.setPasswordEnabled(t)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(t){this._textFieldRenderer.setPasswordStyleText(t),this._passwordStyleText=t,this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(t){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1)),this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1)),this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._insertTextEvent(),this.setInsertText(!1)),this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(t){this._textFieldRenderer.setAttachWithIME(t)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(t){this._textFieldRenderer.setDetachWithIME(t)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(t){this._textFieldRenderer.setInsertText(t)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(t){this._textFieldRenderer.setDeleteBackward(t)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_ATTACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,ccui.TextField.EVENT_DELETE_BACKWARD)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._textFieldEventSelector=t,this._textFieldEventListener=e},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize),this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var t=this._textFieldRenderer.getContentSize();return this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),t=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(t){this.setString(t._textFieldRenderer.getString()),this.setPlaceHolder(t.getString()),this.setFontSize(t._textFieldRenderer.getFontSize()),this.setFontName(t._textFieldRenderer.getFontName()),this.setMaxLengthEnabled(t.isMaxLengthEnabled()),this.setMaxLength(t.getMaxLength()),this.setPasswordEnabled(t.isPasswordEnabled()),this.setPasswordStyleText(t._passwordStyleText),this.setAttachWithIME(t.getAttachWithIME()),this.setDetachWithIME(t.getDetachWithIME()),this.setInsertText(t.getInsertText()),this.setDeleteBackward(t.getDeleteBackward()),this._ccEventCallback=t._ccEventCallback,this._textFieldEventListener=t._textFieldEventListener,this._textFieldEventSelector=t._textFieldEventSelector},setTextAreaSize:function(t){this.setContentSize(t)},setTextHorizontalAlignment:function(t){this._textFieldRenderer.setHorizontalAlignment(t)},setTextVerticalAlignment:function(t){this._textFieldRenderer.setVerticalAlignment(t)},_setFont:function(t){this._textFieldRenderer._setFont(t),this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}}),ccui.TextField.create=function(t,e,i){return new ccui.TextField(t,e,i)},_p=ccui.TextField.prototype,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled),cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled),_p=null,ccui.TextField.EVENT_ATTACH_WITH_IME=0,ccui.TextField.EVENT_DETACH_WITH_IME=1,ccui.TextField.EVENT_INSERT_TEXT=2,ccui.TextField.EVENT_DELETE_BACKWARD=3,ccui.TextField.RENDERER_ZORDER=-1,ccui.VideoPlayer=ccui.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.setURL(t)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},visit:function(){var t=this._renderCmd,e=cc.container,i=cc.eventManager;this._visible?(e.appendChild(t._video),null===this._listener&&(this._listener=cc.eventManager.addCustomListener(cc.game.EVENT_RESIZE,(function(){t.resize()})))):(("contains"in e?e.contains(t._video):e.compareDocumentPosition(t._video)%16)&&e.removeChild(t._video),i.removeListener(t._listener),t._listener=null),t.updateStatus(),t.resize()},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){var t=this,e=this._renderCmd._video;e&&(this._played=!0,e.pause(),!1===this._stopped&&!1===this._playing&&!0===this._played||(e.currentTime=0),ccui.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout((function(){e.play(),t._playing=!0,t._stopped=!1}),20):(e.play(),this._playing=!0,this._stopped=!1))},pause:function(){var t=this._renderCmd._video;t&&!0===this._playing&&!1===this._stopped&&(t.pause(),this._playing=!1)},resume:function(){!1===this._stopped&&!1===this._playing&&!0===this._played&&this.play()},stop:function(){var t=this,e=this._renderCmd._video;e&&(e.pause(),e.currentTime=0,this._playing=!1,this._stopped=!0),setTimeout((function(){t._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)}),0)},seekTo:function(t){var e=this._renderCmd._video;e&&(e.currentTime=t,ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout((function(){e.play()}),20))},isPlaying:function(){return ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout((function(){video.play()}),20),this._playing},setKeepAspectRatioEnabled:function(t){cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?cc.screen.requestFullScreen(e):cc.screen.exitFullScreen(e))},isFullScreenEnabled:function(){cc.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){(t=this._EventList[t])&&t.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(t)for(var e=0;e<t.length;e++)t[e].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);var t=ccui.VideoPlayer.elements;-1===t.indexOf(this)&&t.push(this)},onExit:function(){ccui.Widget.prototype.onExit.call(this);var t=ccui.VideoPlayer.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1)}}),ccui.VideoPlayer.elements=[],ccui.VideoPlayer.pauseElements=[],cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,(function(){for(var t,e=ccui.VideoPlayer.elements,i=0;i<e.length;i++)t=e[i],e[i]._playing&&(t.pause(),ccui.VideoPlayer.pauseElements.push(t))})),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,(function(){for(var t=ccui.VideoPlayer.pauseElements,e=t.pop();e;)e.play(),e=t.pop()})),ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"},function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]};var e=document.createElement("video");e.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),e.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),e.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm"),cc.sys.OS_IOS===cc.sys.os&&(t._polyfill.devicePixelRatio=!0,t._polyfill.event="progress"),cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0),(t=document.createElement("style")).innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(t)}(ccui.VideoPlayer),function(t){var e=null;e=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd,ccui.VideoPlayer.RenderCmd=function(t){this._rootCtor(t),this._listener=null,this._url="",this.initStyle()},(e=ccui.VideoPlayer.RenderCmd.prototype=Object.create(e.prototype)).constructor=ccui.VideoPlayer.RenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)},e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled();var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty),i&e.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&e.orderDirty)},e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;e._parent&&e._visible?this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY):(i.removeListener(this._listener),this._listener=null)},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio&&(i/=c=cc.view.getDevicePixelRatio(),n/=c),!1!==this._loaded){var o=cc.game.container.style,c=parseInt(o.paddingLeft),s=(o=parseInt(o.paddingBottom),r._contentSize.width),a=r._contentSize.height;e="matrix("+e.a*i+","+e.b+","+e.c+","+e.d*n+","+(c+e.tx*i-s/2+s*r._scaleX/2*i)+","+-(o+e.ty*n-a/2+a*r._scaleY/2*n)+")",this._video.style.transform=e,this._video.style["-webkit-transform"]=e}},e.updateURL=function(e){var i,n,r,o=this._node;if(this._url!=e){this._url=e,cc.loader.resPath&&!/^http/.test(e)&&(e=cc.path.join(cc.loader.resPath,e)),i=!1,(i="contains"in(r=cc.container)?r.contains(this._video):r.compareDocumentPosition(this._video)%16)&&r.removeChild(this._video),n=this._video=document.createElement("video"),this.bindEvent();var c=this,s=function(){1!=c._loaded&&(c._loaded=!0,c.changeSize(),c.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),n.removeEventListener(t.event,s),n.currentTime=0,n.style.visibility="visible",n.play(),o._played||(n.pause(),n.currentTime=0))};n.addEventListener(t.event,s),n.preload="metadata",n.style.visibility="hidden",this._loaded=!1,o._played=!1,o._playing=!1,o._stopped=!0,this.initStyle(),this._node.visit(),(i=document.createElement("source")).src=e,n.appendChild(i),r=cc.path.extname(e);for(var a=0;a<t.canPlayType.length;a++)r!==t.canPlayType[a]&&((i=document.createElement("source")).src=e.replace(r,t.canPlayType[a]),n.appendChild(i))}},e.bindEvent=function(){var t=this,e=this._node,i=this._video;i.addEventListener("ended",(function(){e._renderCmd.updateMatrix(t._worldTransform,cc.view._scaleX,cc.view._scaleY),e._playing=!1,e._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)})),i.addEventListener("play",(function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)})),i.addEventListener("pause",(function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)}))},e.initStyle=function(){if(this._video){var t=this._video;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo"}},e.changeSize=function(t,e){var i=this._node._contentSize;t=t||i.width,e=e||i.height,(i=this._video)&&(0!==t&&(i.width=t),0!==e&&(i.height=e))},e.removeDom=function(){var t=this._video;t&&("contains"in cc.container?cc.container.contains(t):cc.container.compareDocumentPosition(t)%16)&&cc.container.removeChild(t)}}(ccui.VideoPlayer._polyfill),ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(t,e,i){this._type=0,this._tag=t||0,this._color=cc.color(255,255,255,255),e&&(this._color.r=e.r,this._color.g=e.g,this._color.b=e.b),this._opacity=i||0,this._color.a=void 0===i?e.a:i}}),ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(t,e,i,n,r,o){var c=e;e&&e instanceof cc.FontDefinition&&(c=e.fillStyle,r=e.fontName,o=e.fontSize,this._fontDefinition=e),ccui.RichElement.prototype.ctor.call(this,t,c,i),this._type=ccui.RichElement.TEXT,this._text=n,this._fontName=r,this._fontSize=o}}),ccui.RichElementText.create=function(t,e,i,n,r,o){return new ccui.RichElementText(t,e,i,n,r,o)},ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this,t,e,i),this._type=ccui.RichElement.IMAGE,this._filePath=n||"",this._textureRect=cc.rect(0,0,0,0),this._textureType=0}}),ccui.RichElementImage.create=function(t,e,i,n){return new ccui.RichElementImage(t,e,i,n)},ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this,t,e,i),this._type=ccui.RichElement.CUSTOM,this._customNode=n||null}}),ccui.RichElementCustomNode.create=function(t,e,i,n){return new ccui.RichElementCustomNode(t,e,i,n)},ccui.RichText=ccui.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this),this._formatTextDirty=!1,this._richElements=[],this._elementRenders=[],this._verticalSpace=this._leftSpaceWidth=0,this._textHorizontalAlignment=cc.TEXT_ALIGNMENT_LEFT,this._textVerticalAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP},_initRenderer:function(){this._elementRenderersContainer=new cc.Node,this._elementRenderersContainer.setAnchorPoint(.5,.5),this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(t,e){this._richElements.splice(e,0,t),this._formatTextDirty=!0},pushBackElement:function(t){this._richElements.push(t),this._formatTextDirty=!0},removeElement:function(t){cc.isNumber(t)?this._richElements.splice(t,1):cc.arrayRemoveObject(this._richElements,t),this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren(),this._elementRenders.length=0;var t,e,i=this._richElements;if(this._ignoreSize)for(this._addNewLine(),t=0;t<i.length;t++){var n=null;switch((e=i[t])._type){case ccui.RichElement.TEXT:n=e._fontDefinition?new cc.LabelTTF(e._text,e._fontDefinition):new cc.LabelTTF(e._text,e._fontName,e._fontSize);break;case ccui.RichElement.IMAGE:n=new cc.Sprite(e._filePath);break;case ccui.RichElement.CUSTOM:n=e._customNode}n.setColor(e._color),n.setOpacity(e._color.a),this._pushToContainer(n)}else for(this._addNewLine(),t=0;t<i.length;t++)switch(e=i[t],e._type){case ccui.RichElement.TEXT:e._fontDefinition?this._handleTextRenderer(e._text,e._fontDefinition,e._fontDefinition.fontSize,e._fontDefinition.fillStyle):this._handleTextRenderer(e._text,e._fontName,e._fontSize,e._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(e._filePath,e._color,e._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(e._customNode)}this.formatRenderers(),this._formatTextDirty=!1}},_handleTextRenderer:function(t,e,i,n){if(""!==t)if("\n"===t)this._addNewLine();else{var r=(o=e instanceof cc.FontDefinition?new cc.LabelTTF(t,e):new cc.LabelTTF(t,e,i)).getContentSize().width;if(this._leftSpaceWidth-=r,0>this._leftSpaceWidth){var o=t.length*(1- -this._leftSpaceWidth/r),c=(r=t.substr(0,o),t.substr(o,t.length-1)),s=0<o;this._lineBreakOnSpace&&(o=-1===(c=r.lastIndexOf(" "))?o:c+1,c=t.substr(o,t.length-1),s=0<o&&" "!==c),s&&(e instanceof cc.FontDefinition?(t=new cc.LabelTTF(r.substr(0,o),e)).setOpacity(e.fillStyle.a):((t=new cc.LabelTTF(r.substr(0,o),e,i)).setColor(n),t.setOpacity(n.a)),this._pushToContainer(t)),this._addNewLine(),this._handleTextRenderer(c,e,i,n)}else e instanceof cc.FontDefinition?o.setOpacity(e.fillStyle.a):(o.setColor(n),o.setOpacity(n.a)),this._pushToContainer(o)}},_handleImageRenderer:function(t,e,i){t=new cc.Sprite(t),this._handleCustomRenderer(t)},_handleCustomRenderer:function(t){var e=t.getContentSize();this._leftSpaceWidth-=e.width,0>this._leftSpaceWidth?(this._addNewLine(),this._pushToContainer(t),this._leftSpaceWidth-=e.width):this._pushToContainer(t)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width,this._elementRenders.push([])},formatRenderers:function(){var t,e,i,n,r,o,c=0,s=this._elementRenderersContainer,a=this._elementRenders;if(this._ignoreSize){for(t=0,i=a[0],e=n=0;e<i.length;e++)(r=i[e]).setAnchorPoint(cc.p(0,0)),r.setPosition(n,0),s.addChild(r,1,e),o=r.getLineHeight?r.getLineHeight():c,t+=(r=r.getContentSize()).width,c=Math.max(Math.min(c,o),r.height),n+=r.width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT)for(o=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?o=this._contentSize.width-n:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(o=(this._contentSize.width-n)/2),e=0;e<i.length;e++)i[e].x+=o;s.setContentSize(t,c)}else{var h=[];for(t=0;t<a.length;t++){for(i=a[t],e=n=0;e<i.length;e++)o=(r=i[e]).getLineHeight?r.getLineHeight():r.getContentSize().height,n=Math.max(Math.min(r.getContentSize().height,o),n);h[t]=n,c+=h[t]}var l=this._customSize.height;for(t=0;t<a.length;t++){for(i=a[t],n=0,l-=h[t]+this._verticalSpace,e=0;e<i.length;e++)(r=i[e]).setAnchorPoint(cc.p(0,0)),r.setPosition(cc.p(n,l)),s.addChild(r,1),n+=r.getContentSize().width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==cc.VERTICAL_TEXT_ALIGNMENT_TOP)for(o=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?o=this._contentSize.width-n:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(o=(this._contentSize.width-n)/2),n=0,this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?n=this._customSize.height-c:this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(n=(this._customSize.height-c)/2),e=0;e<i.length;e++)(r=i[e]).x+=o,r.y-=n}s.setContentSize(this._contentSize)}for(c=a.length,t=0;t<c;t++)a[t].length=0;this._elementRenders.length=0,this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._updateContentSizeWithTextureSize(this._contentSize),s.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},_pushToContainer:function(t){0>=this._elementRenders.length||this._elementRenders[this._elementRenders.length-1].push(t)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(t){this._verticalSpace=t},setAnchorPoint:function(t){ccui.Widget.prototype.setAnchorPoint.call(this,t),this._elementRenderersContainer.setAnchorPoint(t)},_setAnchorX:function(t){ccui.Widget.prototype._setAnchorX.call(this,t),this._elementRenderersContainer._setAnchorX(t)},_setAnchorY:function(t){ccui.Widget.prototype._setAnchorY.call(this,t),this._elementRenderersContainer._setAnchorY(t)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(t){this._ignoreSize!==t&&(this._formatTextDirty=!0,ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t))},getContentSize:function(){return this.formatText(),cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this.formatText(),cc.Node.prototype._getWidth.call(this)},_getHeight:function(){return this.formatText(),cc.Node.prototype._getHeight.call(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,void 0===e?t.width:t,void 0===e?t.height:e),this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(t){ccui.Widget.prototype.setCascadeOpacityEnabled.call(this,t),this._elementRenderersContainer.setCascadeOpacityEnabled(t)},setLineBreakOnSpace:function(t){this._lineBreakOnSpace=t,this._formatTextDirty=!0,this.formatText()},setTextHorizontalAlignment:function(t){t!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=t,this.formatText())},setTextVerticalAlignment:function(t){t!==this._textVerticalAlignment&&(this._textVerticalAlignment=t,this.formatText())}}),ccui.RichText.create=function(){return new ccui.RichText},ccui.RichElement.TEXT=0,ccui.RichElement.IMAGE=1,ccui.RichElement.CUSTOM=2,ccui.WebView=ccui.Widget.extend({ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.loadURL(t)},visit:function(){var t=this._renderCmd,e=t._div,i=cc.container,n=cc.eventManager;this._visible?(i.appendChild(e),null===this._listener&&(this._listener=n.addCustomListener(cc.game.EVENT_RESIZE,(function(){t.resize()})))):(("contains"in i?i.contains(e):i.compareDocumentPosition(e)%16)&&i.removeChild(e),e=n._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),n._removeListenerInVector(e,t._listener),t._listener=null),t.updateStatus(),t.resize(cc.view)},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){cc.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;t&&(t=t.contentWindow)&&t.location&&t.location.reload()},canGoBack:function(){return cc.log("Web does not support query history"),!0},canGoForward:function(){return cc.log("Web does not support query history"),!0},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)try{e.history.back.call(e)}catch(t){e.history.back()}}}catch(t){cc.log(t)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)try{e.history.forward.call(e)}catch(t){e.history.forward()}}}catch(t){cc.log(t)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){e=e.contentWindow;try{e.eval(t),this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(t){console.error(t)}}},setScalesPageToFit:function(){cc.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){(t=this._EventList[t])&&t.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}}),ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"},function(){var t=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(t.enableDiv=!0),cc.sys.isMobile?cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):cc.sys.browserType===cc.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){var e=null;e=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd,ccui.WebView.RenderCmd=function(e){this._rootCtor(e),this._iframe=this._div=null,t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._iframe.addEventListener("load",(function(){e._dispatchEvent(ccui.WebView.EventType.LOADED)})),this._iframe.addEventListener("error",(function(){e._dispatchEvent(ccui.WebView.EventType.ERROR)})),this._div.style.background="#FFF",this._div.style.height="200px",this._div.style.width="300px",this._div.style.overflow="scroll",this._div.style.border="none",this._listener=null,this.initStyle()},(e=ccui.WebView.RenderCmd.prototype=Object.create(e.prototype)).constructor=ccui.WebView.RenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)},e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled();var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty),i&e.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&e.orderDirty)},e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;e._parent&&e._visible?this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY):(t=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),i._removeListenerInVector(t,this._listener),this._listener=null)},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio&&(i/=c=cc.view.getDevicePixelRatio(),n/=c),!1!==this._loaded){var o=cc.game.container.style,c=parseInt(o.paddingLeft),s=(o=parseInt(o.paddingBottom),r._contentSize.width),a=r._contentSize.height;e="matrix("+e.a*i+","+e.b+","+e.c+","+e.d*n+","+(c+e.tx*i-s/2+s*r._scaleX/2*i)+","+-(o+e.ty*n-a/2+a*r._scaleY/2*n)+")",this._div.style.transform=e,this._div.style["-webkit-transform"]=e}},e.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},e.updateURL=function(t){var e=this._iframe;e.src=t;var i=this,n=function(){i._loaded=!0,e.removeEventListener("load",n)};e.addEventListener("load",n)},e.changeSize=function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},e.removeDom=function(){var t=this._div;t&&("contains"in cc.container?cc.container.contains(t):cc.container.compareDocumentPosition(t)%16)&&cc.container.removeChild(t)}}(ccui.WebView._polyfill),ccui.ScrollViewBar=ccui.ProtectedNode.extend({_parentScroll:null,_direction:null,_upperHalfCircle:null,_lowerHalfCircle:null,_body:null,_opacity:255,_marginFromBoundary:0,_marginForLength:0,_touching:!1,_autoHideEnabled:!0,autoHideTime:0,_autoHideRemainingTime:0,_className:"ScrollViewBar",ctor:function(t,e){cc.ProtectedNode.prototype.ctor.call(this),this._direction=e,this._parentScroll=t,this._marginForLength=this._marginFromBoundary=ccui.ScrollViewBar.DEFAULT_MARGIN,this.opacity=255*ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY,this.autoHideTime=ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME,this._autoHideEnabled=!0,ccui.ScrollViewBar.prototype.init.call(this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},init:function(){this._upperHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._upperHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._lowerHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle.setScaleY(-1),this.addProtectedChild(this._upperHalfCircle),this.addProtectedChild(this._lowerHalfCircle),this._body=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY),this._body.setAnchorPoint(cc.p(.5,0)),this.addProtectedChild(this._body),this.setColor(ccui.ScrollViewBar.DEFAULT_COLOR),this.onScrolled(cc.p(0,0)),cc.ProtectedNode.prototype.setOpacity.call(this,0),this._autoHideRemainingTime=0,this._direction===ccui.ScrollView.DIR_HORIZONTAL&&this.setRotation(90)},setPositionFromCorner:function(t){this._direction===ccui.ScrollView.DIR_VERTICAL?(this._marginForLength=t.y,this._marginFromBoundary=t.x):(this._marginForLength=t.x,this._marginFromBoundary=t.y)},onEnter:function(){cc.ProtectedNode.prototype.onEnter.call(this),this.scheduleUpdate()},getPositionFromCorner:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._marginFromBoundary,this._marginForLength):cc.p(this._marginForLength,this._marginFromBoundary)},setWidth:function(t){t/=this._body.width,this._body.setScaleX(t),this._upperHalfCircle.setScale(t),this._lowerHalfCircle.setScale(-t)},getWidth:function(){return this._body.getBoundingBox().width},setAutoHideEnabled:function(t){this._autoHideEnabled=t,!this._autoHideEnabled&&!this._touching&&0>=this._autoHideRemainingTime?cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity):cc.ProtectedNode.prototype.setOpacity.call(this,0)},isAutoHideEnabled:function(){return this._autoHideEnabled},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},_updateLength:function(t){var e=t/this._body.getTextureRect().height;this._body.setScaleY(e),this._upperHalfCircle.setPositionY(this._body.getPositionY()+t)},_processAutoHide:function(t){!this._autoHideEnabled||0>=this._autoHideRemainingTime||this._touching||(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),cc.ProtectedNode.prototype.setOpacity.call(this,this._autoHideRemainingTime/this.autoHideTime*this._opacity)))},update:function(t){this._processAutoHide(t)},onTouchBegan:function(){this._autoHideEnabled&&(this._touching=!0)},onTouchEnded:function(){this._autoHideEnabled&&(this._touching=!1,0>=this._autoHideRemainingTime||(this._autoHideRemainingTime=this.autoHideTime))},onScrolled:function(t){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var e=this._parentScroll.getInnerContainer(),i=0,n=0,r=0,o=0;this._direction===ccui.ScrollView.DIR_VERTICAL?(i=e.height,n=this._parentScroll.height,r=t.y,o=-e.getPositionY()):this._direction===ccui.ScrollView.DIR_HORIZONTAL&&(i=e.width,n=this._parentScroll.width,r=t.x,o=-e.getPositionX()),t=this._calculateLength(i,n,r),i=this._calculatePosition(i,n,o,r,t),this._updateLength(t),this.setPosition(i)},_calculateLength:function(t,e,i){return 0!==i&&(t+=20*(0<i?i:-i)),e/t*Math.abs(e-2*this._marginForLength)},_calculatePosition:function(t,e,i,n,r){return t-=e,0!==n&&(t+=Math.abs(n)),n=0,0!==t&&(n=Math.max(i/t,0),n=Math.min(n,1)),e=(e-r-2*this._marginForLength)*n+this._marginForLength,this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._parentScroll.width-this._marginFromBoundary,e):cc.p(e,this._marginFromBoundary)}}),_p=ccui.ScrollViewBar.prototype,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"autoHideEnabled",_p.isAutoHideEnabled,_p.setAutoHideEnabled),ccui.ScrollViewBar.DEFAULT_COLOR=cc.color(52,65,87),ccui.ScrollViewBar.DEFAULT_MARGIN=20,ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME=.2,ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY=.4,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY="/__half_circle_image",ccui.ScrollViewBar.HALF_CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMABgcbbW7Hz9Dz+PmlcJP5AAAAMElEQVR4AUXHwQ2AQAhFwYcLH1H6r1djzDK3ASxUpTBeK/uTCyz7dx54b44m4p5cD1MwAooEJyk3AAAAAElFTkSuQmCC",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY="/__body_image_height",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAABCAMAAADdNb8LAAAAA1BMVEX///+nxBvIAAAACklEQVR4AWNABgAADQABYc2cpAAAAABJRU5ErkJggg==",ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,_direction:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_touchMoveDisplacements:null,_touchMoveTimeDeltas:null,_touchMovePreviousTimestamp:0,_touchTotalTimeThreshold:.5,_autoScrolling:!1,_autoScrollTargetDelta:null,_autoScrollAttenuate:!0,_autoScrollStartPosition:null,_autoScrollTotalTime:0,_autoScrollAccumulatedTime:0,_autoScrollCurrentlyOutOfBoundary:!1,_autoScrollBraking:!1,_autoScrollBrakingStartPosition:null,_bePressed:!1,_childFocusCancelOffset:0,bounceEnabled:!1,_outOfBoundaryAmount:null,_outOfBoundaryAmountDirty:!0,inertiaScrollEnabled:!1,_scrollBarEnabled:!0,_verticalScrollBar:null,_horizontalScrollBar:null,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this),this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),this._direction=ccui.ScrollView.DIR_NONE,this._childFocusCancelOffset=5,this.inertiaScrollEnabled=!0,this._outOfBoundaryAmount=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollStartPosition=cc.p(0,0),this._autoScrollBrakingStartPosition=cc.p(0,0),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._scrollBarEnabled=!0,this._initScrollBar(),this.setTouchEnabled(!0)},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){cc.renderer._removeCache(this.__instanceId),ccui.Layout.prototype.onExit.call(this)},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){this._adaptRenderers(),this._doLayout(),t=cc.renderer,e.visit(i),t.pushRenderCommand(e),e instanceof ccui.ScrollView.WebGLRenderCmd&&t._turnToCacheMode(this.__instanceId);var n=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL,r=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_SCISSOR;n?e.stencilClippingVisit(i):r&&e.scissorClippingVisit(i);var o,c,s=this._children,a=s.length,h=(i=this._protectedChildren).length;for(this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),o=0;o<a;o++)(c=s[o])&&c._visible&&c.visit(this);for(o=0;o<h;o++)(s=i[o])&&s._visible&&(e._changeProtectedChild(s),s.visit(this));n?e.postStencilVisit():r&&e.postScissorVisit(),e instanceof ccui.ScrollView.WebGLRenderCmd&&t._turnToNormalMode(),this.updateChildren(),e._dirtyFlag=0}else e._propagateFlagsDown(i)},findNextFocusedWidget:function(t,e){return this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(t,e):ccui.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this),this._innerContainer=new ccui.Layout,this._innerContainer.setColor(cc.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.ScrollView.WebGLRenderCmd(this):new ccui.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize;this._topBoundary=t.height,this._rightBoundary=t.width;var e=this._innerContainer.getContentSize();this._innerContainer.setContentSize(cc.size(Math.max(e.width,t.width),Math.max(e.height,t.height))),this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height),this._verticalScrollBar&&this._verticalScrollBar.onScrolled(this._getHowMuchOutOfBoundary()),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(this._getHowMuchOutOfBoundary())},setInnerContainerSize:function(t){var e=this._innerContainer,i=this._contentSize,n=i.width,r=i.height;t.width<i.width?cc.log("Inner width <= ScrollView width, it will be force sized!"):n=t.width,t.height<i.height?cc.log("Inner height <= ScrollView height, it will be force sized!"):r=t.height,e.setContentSize(cc.size(n,r)),t=this._innerContainer.getPosition(),e=this._innerContainer.getAnchorPoint(),0!=this._innerContainer.getLeftBoundary()&&(t.x=e.x*n),this._innerContainer.getTopBoundary()!=this._contentSize.height&&(t.y=this._contentSize.height-(1-e.y)*r),this.setInnerContainerPosition(t),this._updateScrollBar(cc.p(0,0))},_setInnerWidth:function(t){var e=this._contentSize.width,i=e,n=this._innerContainer,r=n.width;switch(t<e?cc.log("Inner width <= scrollview width, it will be force sized!"):i=t,n.width=i,this._direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:n.getRightBoundary()<=e&&this._scrollChildren(r-n.width,0)}t=n.anchorX,0<n.getLeftBoundary()&&(n.x=t*i),n.getRightBoundary()<e&&(n.x=e-(1-t)*i)},_setInnerHeight:function(t){var e=this._contentSize.height,i=e,n=this._innerContainer,r=n.height;switch(t<e?cc.log("Inner height <= scrollview height, it will be force sized!"):i=t,n.height=i,this._direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:this._scrollChildren(0,r-i)}t=n.anchorY,0<n.getLeftBoundary()&&(n.y=t*i),n.getRightBoundary()<e&&(n.y=e-(1-t)*i)},setInnerContainerPosition:function(t){if(t.x!==this._innerContainer.getPositionX()||t.y!==this._innerContainer.getPositionY()){if(this._innerContainer.setPosition(t),this._outOfBoundaryAmountDirty=!0,this.bounceEnabled)for(t=ccui.ScrollView.MOVEDIR_TOP;t<ccui.ScrollView.MOVEDIR_RIGHT;++t)this._isOutOfBoundary(t)&&this._processScrollEvent(t,!0);this._dispatchEvent(ccui.ScrollView.EVENT_CONTAINER_MOVED)}},getInnerContainerPosition:function(){return this._innerContainer.getPosition()},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(t){if(!this._clippingEnabled)return!0;var e=t._position,i=t._contentSize;t=t._anchorPoint;var n,r=this._customSize,o=this._innerContainer._position,c=0;return!((n=e.y-t.y*i.height)>=r.height-o.y||n+i.height<=-o.y||(c=e.x-t.x*i.width)>=r.width-o.x||c+i.width<=-o.x)},updateChildren:function(){var t,e,i,n=this._innerContainer._children;for(e=0,i=n.length;e<i;e++)!0===(t=n[e])._inViewRect&&!1===this._isInContainer(t)?t._inViewRect=!1:!1===t._inViewRect&&!0===this._isInContainer(t)&&(t._inViewRect=!0)},addChild:function(t,e,i){return!!t&&(!1===this._isInContainer(t)&&(t._inViewRect=!1),e=e||t.getLocalZOrder(),i=i||t.getTag(),this._innerContainer.addChild(t,e,i))},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_flattenVectorByDirection:function(t){var e=cc.p(0,0);return e.x=this._direction===ccui.ScrollView.DIR_VERTICAL?0:t.x,e.y=this._direction===ccui.ScrollView.DIR_HORIZONTAL?0:t.y,e},_getHowMuchOutOfBoundary:function(t){if(void 0===t&&(t=cc.p(0,0)),0===t.x&&0===t.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.p(0,0);return this._innerContainer.getLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._innerContainer.getLeftBoundary()+t.x):this._innerContainer.getRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._innerContainer.getRightBoundary()+t.x)),this._innerContainer.getTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._innerContainer.getTopBoundary()+t.y):this._innerContainer.getBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._innerContainer.getBottomBoundary()+t.y)),0===t.x&&0===t.y&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e},_isOutOfBoundary:function(t){var e=this._getHowMuchOutOfBoundary();if(void 0===t)return!this._fltEqualZero(e);switch(t){case ccui.ScrollView.MOVEDIR_TOP:return 0<e.y;case ccui.ScrollView.MOVEDIR_BOTTOM:return 0>e.y;case ccui.ScrollView.MOVEDIR_LEFT:return 0>e.x;case ccui.ScrollView.MOVEDIR_RIGHT:return 0<e.x}return!1},_moveInnerContainer:function(t,e){t=this._flattenVectorByDirection(t),this.setInnerContainerPosition(cc.pAdd(this.getInnerContainerPosition(),t)),t=this._getHowMuchOutOfBoundary(),this._updateScrollBar(t),this.bounceEnabled&&e&&this._startBounceBackIfNeeded()},_updateScrollBar:function(t){this._verticalScrollBar&&this._verticalScrollBar.onScrolled(t),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(t)},_calculateTouchMoveVelocity:function(){for(var t=0,e=0;e<this._touchMoveTimeDeltas.length;++e)t+=this._touchMoveTimeDeltas[e];if(0==t||t>=this._touchTotalTimeThreshold)return cc.p(0,0);var i=cc.p(0,0);for(e=0;e<this._touchMoveDisplacements.length;++e)i.x+=this._touchMoveDisplacements[e].x,i.y+=this._touchMoveDisplacements[e].y;return cc.pMult(i,1/t)},setTouchTotalTimeThreshold:function(t){this._touchTotalTimeThreshold=t},getTouchTotalTimeThreshold:function(){return this._touchTotalTimeThreshold},_startInertiaScroll:function(t){var e=cc.pMult(t,.7);this._startAttenuatingAutoScroll(e,t)},_startBounceBackIfNeeded:function(){if(!this.bounceEnabled)return!1;var t=this._getHowMuchOutOfBoundary();return!this._fltEqualZero(t)&&(this._startAutoScroll(t,1,!0),!0)},_startAutoScrollToDestination:function(t,e,i){this._startAutoScroll(cc.pSub(t,this._innerContainer.getPosition()),e,i)},_calculateAutoScrollTimeByInitialSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAttenuatingAutoScroll:function(t,e){e=this._calculateAutoScrollTimeByInitialSpeed(cc.pLength(e)),this._startAutoScroll(t,e,!0)},_startAutoScroll:function(t,e,i){t=this._flattenVectorByDirection(t),this._autoScrolling=!0,this._autoScrollTargetDelta=t,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this._innerContainer.getPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),e=this._getHowMuchOutOfBoundary(),!this._fltEqualZero(e)&&(this._autoScrollCurrentlyOutOfBoundary=!0,i=this._getHowMuchOutOfBoundary(t),0<e.x*i.x||0<e.y*i.y)&&(this._autoScrollBraking=!0)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAttenuate=!0,this._autoScrollAccumulatedTime=this._autoScrollTotalTime=0},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollBraking=this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBrakingStartPosition=this.getInnerContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_getAutoScrollStopEpsilon:function(){return 1e-4},_fltEqualZero:function(t){return 1e-4>=Math.abs(t.x)&&1e-4>=Math.abs(t.y)},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake()?.05:1;this._autoScrollAccumulatedTime+=1/e*t;var i=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=--i*i*i*i*i+1),t=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,i)),i=Math.abs(i-1)<=this._getAutoScrollStopEpsilon(),this.bounceEnabled?t=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(t,this._autoScrollBrakingStartPosition),e)):(e=cc.pSub(t,this.getInnerContainerPosition()),e=this._getHowMuchOutOfBoundary(e),this._fltEqualZero(e)||(t.x+=e.x,t.y+=e.y,i=!0)),i&&(this._autoScrolling=!1,this._dispatchEvent(ccui.ScrollView.EVENT_AUTOSCROLL_ENDED)),this._moveInnerContainer(cc.pSub(t,this.getInnerContainerPosition()),i)},_jumpToDestination:function(t,e){void 0===t.x&&(t=cc.p(t,e)),this._autoScrolling=!1,this._moveInnerContainer(cc.pSub(t,this.getInnerContainerPosition()),!0)},_scrollChildren:function(t){if(this.bounceEnabled){var e=this._getHowMuchOutOfBoundary();t.x*=0==e.x?1:.5,t.y*=0==e.y?1:.5}this.bounceEnabled||(e=this._getHowMuchOutOfBoundary(t),t.x+=e.x,t.y+=e.y);var i=e=!1,n=!1,r=!1;0<t.y?this._innerContainer.getBottomBoundary()+t.y>=this._bottomBoundary&&(r=!0):0>t.y&&this._innerContainer.getTopBoundary()+t.y<=this._topBoundary&&(n=!0),0>t.x?this._innerContainer.getRightBoundary()+t.x<=this._rightBoundary&&(i=!0):0<t.x&&this._innerContainer.getLeftBoundary()+t.x>=this._leftBoundary&&(e=!0),this._moveInnerContainer(t,!1),0==t.x&&0==t.y||this._processScrollingEvent(),r&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_BOTTOM,!1),n&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_TOP,!1),e&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_LEFT,!1),i&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_RIGHT,!1)},scrollToBottom:function(t,e){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollToDestination(cc.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){if(this._direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll direction is not both!");else{var i=this._innerContainer.getContentSize();this._startAutoScrollToDestination(cc.p(this._contentSize.width-i.width,this._contentSize.height-i.height),t,e)}},scrollToBottomLeft:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,0),t,e)},scrollToBottomRight:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,i){var n=this._contentSize.height-this._innerContainer.getContentSize().height,r=-n;this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),n+t*r/100),e,i)},scrollToPercentHorizontal:function(t,e,i){var n=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-t*n/100,this._innerContainer.getPositionY()),e,i)},scrollToPercentBothDirection:function(t,e,i){if(this._direction===ccui.ScrollView.DIR_BOTH){var n=this._contentSize.height-this._innerContainer.getContentSize().height,r=-n,o=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-t.x*o/100,n+t.y*r/100),e,i)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll _direction is not both!");else{var t=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height)}},jumpToBottomLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,0)},jumpToBottomRight:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height,i=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*i/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-t*e/100,this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){if(this._direction===ccui.ScrollView.DIR_BOTH){var e=this._innerContainer.getContentSize(),i=this._contentSize.height-e.height;this._jumpToDestination(-t.x*(e.width-this._contentSize.width)/100,i+t.y*-i/100)}},_gatherTouchMove:function(t){for(;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(t),t=(new Date).getTime(),this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},_handlePressLogic:function(t){this._bePressed=!0,this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._verticalScrollBar&&this._verticalScrollBar.onTouchBegan(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan()},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation());t=this.convertToNodeSpace(t.getPreviousLocation()),e=cc.pSub(e,t),this._scrollChildren(e),this._gatherTouchMove(e)},_handleReleaseLogic:function(t){var e=this.convertToNodeSpace(t.getLocation());t=this.convertToNodeSpace(t.getPreviousLocation()),e=cc.pSub(e,t),this._gatherTouchMove(e),this._bePressed=!1,!this._startBounceBackIfNeeded()&&this.inertiaScrollEnabled&&(0===(e=this._calculateTouchMoveVelocity()).x&&0===e.y||this._startInertiaScroll(e)),this._verticalScrollBar&&this._verticalScrollBar.onTouchEnded(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded()},onTouchBegan:function(t,e){return e=ccui.Layout.prototype.onTouchBegan.call(this,t,e),this._isInterceptTouch||this._hit&&this._handlePressLogic(t),e},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)},interceptTouchEvent:function(t,e,i){if(this._touchEnabled){if(this._direction!==ccui.ScrollView.DIR_NONE){var n=i.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0,this._touchBeganPosition.x=n.x,this._touchBeganPosition.y=n.y,this._handlePressLogic(i);break;case ccui.Widget.TOUCH_MOVED:t=cc.pLength(cc.pSub(e.getTouchBeganPosition(),n)),this._touchMovePosition.x=n.x,this._touchMovePosition.y=n.y,t>this._childFocusCancelOffset&&(e.setHighlighted(!1),this._handleMoveLogic(i));break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=n.x,this._touchEndPosition.y=n.y,this._handleReleaseLogic(i),e.isSwallowTouches()&&(this._isInterceptTouch=!1)}}}else ccui.Layout.prototype.interceptTouchEvent.call(this,t,e,i)},_processScrollEvent:function(t,e){var i=0;switch(t){case ccui.ScrollView.MOVEDIR_TOP:i=e?ccui.ScrollView.EVENT_BOUNCE_TOP:ccui.ScrollView.EVENT_SCROLL_TO_TOP;break;case ccui.ScrollView.MOVEDIR_BOTTOM:i=e?ccui.ScrollView.EVENT_BOUNCE_BOTTOM:ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM;break;case ccui.ScrollView.MOVEDIR_LEFT:i=e?ccui.ScrollView.EVENT_BOUNCE_LEFT:ccui.ScrollView.EVENT_SCROLL_TO_LEFT;break;case ccui.ScrollView.MOVEDIR_RIGHT:i=e?ccui.ScrollView.EVENT_BOUNCE_RIGHT:ccui.ScrollView.EVENT_SCROLL_TO_RIGHT}this._dispatchEvent(i)},_processScrollingEvent:function(){this._dispatchEvent(ccui.ScrollView.EVENT_SCROLLING)},_dispatchEvent:function(t){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,t):this._scrollViewEventSelector(this,t)),this._ccEventCallback&&this._ccEventCallback(this,t)},addEventListenerScrollView:function(t,e){this._scrollViewEventSelector=t,this._scrollViewEventListener=e},addEventListener:function(t){this._ccEventCallback=t},setDirection:function(t){this._direction=t,this._scrollBarEnabled&&(this._removeScrollBar(),this._initScrollBar())},getDirection:function(){return this._direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},setScrollBarEnabled:function(t){this._scrollBarEnabled!==t&&(this._scrollBarEnabled&&this._removeScrollBar(),(this._scrollBarEnabled=t)&&this._initScrollBar())},isScrollBarEnabled:function(){return this._scrollBarEnabled},setScrollBarPositionFromCorner:function(t){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t)},setScrollBarPositionFromCornerForVertical:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForVertical:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.getPositionFromCorner()},setScrollBarPositionFromCornerForHorizontal:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForHorizontal:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.getPositionFromCorner()},setScrollBarWidth:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setWidth(t),this._horizontalScrollBar&&this._horizontalScrollBar.setWidth(t)},getScrollBarWidth:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.getWidth():this._horizontalScrollBar?this._horizontalScrollBar.getWidth():0},setScrollBarColor:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setColor(t),this._horizontalScrollBar&&this._horizontalScrollBar.setColor(t)},getScrollBarColor:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.getColor(),this._horizontalScrollBar&&this._horizontalScrollBar.getColor(),cc.color.WHITE},setScrollBarOpacity:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.opacity=t),this._horizontalScrollBar&&(this._horizontalScrollBar.opacity=t)},getScrollBarOpacity:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.opacity:this._horizontalScrollBar?this._horizontalScrollBar.opacity:-1},setScrollBarAutoHideEnabled:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideEnabled=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideEnabled=t)},isScrollBarAutoHideEnabled:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideEnabled:!!this._horizontalScrollBar&&this._horizontalScrollBar.autoHideEnabled},setScrollBarAutoHideTime:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideTime=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideTime=t)},getScrollBarAutoHideTime:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideTime:this._horizontalScrollBar?this._horizontalScrollBar.autoHideTime:0},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(t){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,t),this.setInnerContainerSize(t.getInnerContainerSize()),this.setInnerContainerPosition(t.getInnerContainerPosition()),this.setDirection(t._direction),this._topBoundary=t._topBoundary,this._bottomBoundary=t._bottomBoundary,this._leftBoundary=t._leftBoundary,this._rightBoundary=t._rightBoundary,this._bePressed=t._bePressed,this._childFocusCancelOffset=t._childFocusCancelOffset,this._touchMoveDisplacements=t._touchMoveDisplacements,this._touchMoveTimeDeltas=t._touchMoveTimeDeltas,this._touchMovePreviousTimestamp=t._touchMovePreviousTimestamp,this._autoScrolling=t._autoScrolling,this._autoScrollAttenuate=t._autoScrollAttenuate,this._autoScrollStartPosition=t._autoScrollStartPosition,this._autoScrollTargetDelta=t._autoScrollTargetDelta,this._autoScrollTotalTime=t._autoScrollTotalTime,this._autoScrollAccumulatedTime=t._autoScrollAccumulatedTime,this._autoScrollCurrentlyOutOfBoundary=t._autoScrollCurrentlyOutOfBoundary,this._autoScrollBraking=t._autoScrollBraking,this._autoScrollBrakingStartPosition=t._autoScrollBrakingStartPosition,this.setBounceEnabled(t.bounceEnabled),this.setInertiaScrollEnabled(t.inertiaScrollEnabled),this._scrollViewEventListener=t._scrollViewEventListener,this._scrollViewEventSelector=t._scrollViewEventSelector,this._ccEventCallback=t._ccEventCallback,this.setScrollBarEnabled(t.isScrollBarEnabled()),this.isScrollBarEnabled()&&(this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t.getScrollBarPositionFromCornerForVertical()),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t.getScrollBarPositionFromCornerForHorizontal()),this.setScrollBarWidth(t.getScrollBarWidth()),this.setScrollBarColor(t.getScrollBarColor()),this.setScrollBarAutoHideEnabled(t.isScrollBarAutoHideEnabled()),this.setScrollBarAutoHideTime(t.getScrollBarAutoHideTime())))},_initScrollBar:function(){this._direction===ccui.ScrollView.DIR_HORIZONTAL||this._verticalScrollBar||(this._verticalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_VERTICAL),this.addProtectedChild(this._verticalScrollBar,2)),this._direction===ccui.ScrollView.DIR_VERTICAL||this._horizontalScrollBar||(this._horizontalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_HORIZONTAL),this.addProtectedChild(this._horizontalScrollBar,2))},_removeScrollBar:function(){this._verticalScrollBar&&(this.removeProtectedChild(this._verticalScrollBar),this._verticalScrollBar=null),this._horizontalScrollBar&&(this.removeProtectedChild(this._horizontalScrollBar),this._horizontalScrollBar=null)},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,i){this._innerContainer.addNode(t,e,i)}}),_p=ccui.ScrollView.prototype,cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth),cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight),cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),cc.defineGetterSetter(_p,"touchTotalTimeThreshold",_p.getTouchTotalTimeThreshold,_p.setTouchTotalTimeThreshold),_p=null,ccui.ScrollView.create=function(){return new ccui.ScrollView},ccui.ScrollView.DIR_NONE=0,ccui.ScrollView.DIR_VERTICAL=1,ccui.ScrollView.DIR_HORIZONTAL=2,ccui.ScrollView.DIR_BOTH=3,ccui.ScrollView.EVENT_SCROLL_TO_TOP=0,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1,ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3,ccui.ScrollView.EVENT_SCROLLING=4,ccui.ScrollView.EVENT_BOUNCE_TOP=5,ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6,ccui.ScrollView.EVENT_BOUNCE_LEFT=7,ccui.ScrollView.EVENT_BOUNCE_RIGHT=8,ccui.ScrollView.EVENT_CONTAINER_MOVED=9,ccui.ScrollView.EVENT_AUTOSCROLL_ENDED=10,ccui.ScrollView.MOVEDIR_TOP=0,ccui.ScrollView.MOVEDIR_BOTTOM=1,ccui.ScrollView.MOVEDIR_LEFT=2,ccui.ScrollView.MOVEDIR_RIGHT=3,ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,_ccListViewEventCallback:null,_magneticAllowedOutOfBoundary:!0,_magneticType:0,_className:"ListView",ctor:function(){this._items=[],ccui.ScrollView.prototype.ctor.call(this),this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL,this.setTouchEnabled(!0),this.setDirection(ccui.ScrollView.DIR_VERTICAL)},setItemModel:function(t){t?this._model=t:cc.log("Can't set a null to item model!")},_handleReleaseLogic:function(t){ccui.ScrollView.prototype._handleReleaseLogic.call(this,t),this._autoScrolling||this._startMagneticScroll()},_onItemListChanged:function(){this._outOfBoundaryAmountDirty=!0},_updateInnerContainerSize:function(){var t,e,i=this._items;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:var n=((e=i.length)-1)*this._itemsMargin;for(t=0;t<e;t++)n+=i[t].getContentSize().height;this.setInnerContainerSize(cc.size(this._contentSize.width,n));break;case ccui.ScrollView.DIR_HORIZONTAL:for(n=((e=i.length)-1)*this._itemsMargin,t=0;t<e;t++)n+=i[t].getContentSize().width;this.setInnerContainerSize(cc.size(n,this._contentSize.height))}},_remedyLayoutParameter:function(t){cc.assert(null!=t,"ListView Item can't be nil!");var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR),i=!0;e||(e=new ccui.LinearLayoutParameter,i=!1);var n=this.getIndex(t);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(e,n);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(e,n)}i||t.setLayoutParameter(e)},_remedyVerticalLayoutParameter:function(t,e){switch(cc.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_LEFT:t.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:t.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL)}0===e?t.setMargin(ccui.MarginZero()):t.setMargin(new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(t,e){switch(cc.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_TOP:t.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:t.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL)}0===e?t.setMargin(ccui.MarginZero()):t.setMargin(new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(null!=this._model){var t=this._model.clone();this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0}},insertDefaultItem:function(t){if(null!=this._model){var e=this._model.clone();this._items.splice(t,0,e),ccui.ScrollView.prototype.addChild.call(this,e),this._remedyLayoutParameter(e),this._refreshViewDirty=!0}},pushBackCustomItem:function(t){this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0},addChild:function(t,e,i){t&&(e=e||t.getLocalZOrder(),i=i||t.getName(),ccui.ScrollView.prototype.addChild.call(this,t,e,i),t instanceof ccui.Widget&&(this._items.push(t),this._onItemListChanged()))},removeChild:function(t,e){if(t){var i=this._items.indexOf(t);-1<i&&this._items.splice(i,1),this._onItemListChanged(),ccui.ScrollView.prototype.removeChild.call(this,t,e)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,t),this._items=[],this._onItemListChanged()},insertCustomItem:function(t,e){this._items.splice(e,0,t),this._onItemListChanged(),ccui.ScrollView.prototype.addChild.call(this,t),this._remedyLayoutParameter(t),this._refreshViewDirty=!0},removeItem:function(t){null!=(t=this.getItem(t))&&(this.removeChild(t,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(t){return 0>t||t>=this._items.length?null:this._items[t]},getItems:function(){return this._items},getIndex:function(t){return null==t?-1:this._items.indexOf(t)},setGravity:function(t){this._gravity!==t&&(this._gravity=t,this._refreshViewDirty=!0)},setMagneticType:function(t){this._magneticType=t,this._onItemListChanged(),this._startMagneticScroll()},getMagneticType:function(){return this._magneticType},setMagneticAllowedOutOfBoundary:function(t){this._magneticAllowedOutOfBoundary=t},getMagneticAllowedOutOfBoundary:function(){return this._magneticAllowedOutOfBoundary},setItemsMargin:function(t){this._itemsMargin!==t&&(this._itemsMargin=t,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(t){switch(t){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:default:return}ccui.ScrollView.prototype.setDirection.call(this,t)},_getHowMuchOutOfBoundary:function(t){if(void 0===t&&(t=cc.p(0,0)),!this._magneticAllowedOutOfBoundary||0===this._items.length)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,t);if(this._magneticType===ccui.ListView.MAGNETIC_NONE||this._magneticType===ccui.ListView.MAGNETIC_BOTH_END)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,t);if(0===t.x&&0===t.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=this._leftBoundary,i=this._rightBoundary,n=this._topBoundary,r=this._bottomBoundary,o=this._items.length-1,c=this.getContentSize(),s=cc.p(0,0),a=cc.p(0,0);switch(this._magneticType){case ccui.ListView.MAGNETIC_CENTER:s.x=(c.width-this._items[0].width)/2,s.y=(c.height-this._items[0].height)/2,a.x=(c.width-this._items[o].width)/2,a.y=(c.height-this._items[o].height)/2;break;case ccui.ListView.MAGNETIC_LEFT:case ccui.ListView.MAGNETIC_TOP:a.x=c.width-this._items[o].width,a.y=c.height-this._items[o].height;break;case ccui.ListView.MAGNETIC_RIGHT:case ccui.ListView.MAGNETIC_BOTTOM:s.x=c.width-this._items[0].width,s.y=c.height-this._items[0].height}return e+=s.x,i-=a.x,n-=s.y,r+=a.y,o=cc.p(0,0),this._innerContainer.getLeftBoundary()+t.x>e?o.x=e-(this._innerContainer.getLeftBoundary()+t.x):this._innerContainer.getRightBoundary()+t.x<i&&(o.x=i-(this._innerContainer.getRightBoundary()+t.x)),this._innerContainer.getTopBoundary()+t.y<n?o.y=n-(this._innerContainer.getTopBoundary()+t.y):this._innerContainer.getBottomBoundary()+t.y>r&&(o.y=r-(this._innerContainer.getBottomBoundary()+t.y)),0===t.x&&0===t.y&&(this._outOfBoundaryAmount=o,this._outOfBoundaryAmountDirty=!1),o},_calculateItemPositionWithAnchor:function(t,e){var i=cc.p(t.getLeftBoundary(),t.getBottomBoundary());return t=t.getContentSize(),cc.p(i.x+t.width*e.x,i.y+t.height*e.y)},_findClosestItem:function(t,e,i,n,r,o,c){if(cc.assert(0<=n&&o<e.length&&n<=o,""),n===o)return e[n];if(1==o-n)return r<=c?e[n]:e[o];var s=Math.floor((n+o)/2),a=this._calculateItemPositionWithAnchor(e[s],i);return a=cc.pLength(cc.pSub(t,a)),r<=c?this._findClosestItem(t,e,i,n,r,s,a):this._findClosestItem(t,e,i,s,a,o,c)},getClosestItemToPosition:function(t,e){if(0===this._items.length)return null;var i=this._calculateItemPositionWithAnchor(this._items[0],e),n=(i=cc.pLength(cc.pSub(t,i)),this._items.length-1),r=this._calculateItemPositionWithAnchor(this._items[n],e);return r=cc.pLength(cc.pSub(t,r)),this._findClosestItem(t,this._items,e,0,i,n,r)},getClosestItemToPositionInCurrentView:function(t,e){var i=this.getContentSize(),n=cc.pMult(this._innerContainer.getPosition(),-1);return n.x+=i.width*t.x,n.y+=i.height*t.y,this.getClosestItemToPosition(n,e)},getCenterItemInCurrentView:function(){return this.getClosestItemToPositionInCurrentView(cc.p(.5,.5),cc.p(.5,.5))},getLeftmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(0,.5),cc.p(.5,.5)):null},getRightmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(1,.5),cc.p(.5,.5)):null},getTopmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(.5,1),cc.p(.5,.5)):null},getBottommostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(.5,0),cc.p(.5,.5)):null},_calculateItemDestination:function(t,e,i){var n=this.getContentSize(),r=cc.p(0,0);return r.x+=n.width*t.x,r.y+=n.height*t.y,t=this._calculateItemPositionWithAnchor(e,i),cc.pMult(cc.pSub(t,r),-1)},jumpToBottom:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottom.call(this)},jumpToTop:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTop.call(this)},jumpToLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToLeft.call(this)},jumpToRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToRight.call(this)},jumpToTopLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopLeft.call(this)},jumpToTopRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopRight.call(this)},jumpToBottomLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomLeft.call(this)},jumpToBottomRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomRight.call(this)},jumpToPercentVertical:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentVertical.call(this,t)},jumpToPercentHorizontal:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentHorizontal.call(this,t)},jumpToPercentBothDirection:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentBothDirection.call(this,t)},jumpToItem:function(t,e,i){(t=this.getItem(t))&&(this.doLayout(),e=this._calculateItemDestination(e,t,i),this.bounceEnabled||(i=cc.pSub(e,this._innerContainer.getPosition()),i=this._getHowMuchOutOfBoundary(i),e.x+=i.x,e.y+=i.y),this._jumpToDestination(e))},scrollToItem:function(t,e,i,n){void 0===n&&(n=1),(t=this.getItem(t))&&(e=this._calculateItemDestination(e,t,i),this._startAutoScrollToDestination(e,n,!0))},requestRefreshView:function(){this._refreshViewDirty=!0},refreshView:function(){this.forceDoLayout()},doLayout:function(){this._doLayout()},requestDoLayout:function(){this._refreshViewDirty=!0},_doLayout:function(){if(this._refreshViewDirty){for(var t=this._items,e=0;e<t.length;e++){var i=t[e];i.setLocalZOrder(e),this._remedyLayoutParameter(i)}this._updateInnerContainerSize(),this._innerContainer.forceDoLayout(),this._refreshViewDirty=!1}},addEventListenerListView:function(t,e){this._listViewEventListener=e,this._listViewEventSelector=t},addEventListener:function(t){this._ccListViewEventCallback=t},_selectedItemEvent:function(t){t=t===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END,this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,t):this._listViewEventSelector(this,t)),this._ccListViewEventCallback&&this._ccListViewEventCallback(this,t)},interceptTouchEvent:function(t,e,i){if(ccui.ScrollView.prototype.interceptTouchEvent.call(this,t,e,i),this._touchEnabled&&t!==ccui.Widget.TOUCH_MOVED){for(i=e;i;){if(i&&i.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(i);break}i=i.getParent()}e.isHighlighted()&&this._selectedItemEvent(t)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this),this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(t){t=t.getItems();for(var e=0;e<t.length;e++)this.pushBackCustomItem(t[e].clone())},_copySpecialProperties:function(t){t instanceof ccui.ListView&&(ccui.ScrollView.prototype._copySpecialProperties.call(this,t),this.setItemModel(t._model),this.setItemsMargin(t._itemsMargin),this.setGravity(t._gravity),this._listViewEventListener=t._listViewEventListener,this._listViewEventSelector=t._listViewEventSelector)},_startAttenuatingAutoScroll:function(t,e){if(0!==this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE&&(t=this._flattenVectorByDirection(t),0===(i=this._getHowMuchOutOfBoundary(t)).x&&0===i.y)){(i=this._magneticType)===ccui.ListView.MAGNETIC_BOTH_END&&(this._direction===ccui.ScrollView.DIR_HORIZONTAL?i=0<t.x?ccui.ListView.MAGNETIC_LEFT:ccui.ListView.MAGNETIC_RIGHT:this._direction===ccui.ScrollView.DIR_VERTICAL&&(i=0<t.y?ccui.ListView.MAGNETIC_BOTTOM:ccui.ListView.MAGNETIC_TOP));var i,n=this._getAnchorPointByMagneticType(i);(i=cc.pMult(this._innerContainer.getPosition(),-1)).x+=this.width*n.x,i.y+=this.height*n.y,t=this.getClosestItemToPosition(cc.pSub(i,t),n),t=this._calculateItemPositionWithAnchor(t,n),t=cc.pSub(i,t)}ccui.ScrollView.prototype._startAttenuatingAutoScroll.call(this,t,e)},_getAnchorPointByMagneticType:function(t){switch(t){case ccui.ListView.MAGNETIC_BOTH_END:return cc.p(0,1);case ccui.ListView.MAGNETIC_CENTER:return cc.p(.5,.5);case ccui.ListView.MAGNETIC_LEFT:return cc.p(0,.5);case ccui.ListView.MAGNETIC_RIGHT:return cc.p(1,.5);case ccui.ListView.MAGNETIC_TOP:return cc.p(.5,1);case ccui.ListView.MAGNETIC_BOTTOM:return cc.p(.5,0)}return cc.p(0,0)},_startMagneticScroll:function(){if(0!==this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){var t=this._getAnchorPointByMagneticType(this._magneticType),e=cc.pMult(this._innerContainer.getPosition(),-1);e.x+=this.width*t.x,e.y+=this.height*t.y,e=this.getClosestItemToPosition(e,t),this.scrollToItem(this.getIndex(e),t,t)}}}),ccui.ListView.create=function(){return new ccui.ListView},ccui.ListView.EVENT_SELECTED_ITEM=0,ccui.ListView.ON_SELECTED_ITEM_START=0,ccui.ListView.ON_SELECTED_ITEM_END=1,ccui.ListView.GRAVITY_LEFT=0,ccui.ListView.GRAVITY_RIGHT=1,ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2,ccui.ListView.GRAVITY_TOP=3,ccui.ListView.GRAVITY_BOTTOM=4,ccui.ListView.GRAVITY_CENTER_VERTICAL=5,ccui.ListView.MAGNETIC_NONE=0,ccui.ListView.MAGNETIC_CENTER=1,ccui.ListView.MAGNETIC_BOTH_END=2,ccui.ListView.MAGNETIC_LEFT=3,ccui.ListView.MAGNETIC_RIGHT=4,ccui.ListView.MAGNETIC_TOP=5,ccui.ListView.MAGNETIC_BOTTOM=6,ccui.PageView=ccui.ListView.extend({_curPageIdx:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_indicator:null,_indicatorPositionAsAnchorPoint:null,ctor:function(){ccui.ListView.prototype.ctor.call(this),this._childFocusCancelOffset=5,this._indicatorPositionAsAnchorPoint=cc.p(.5,.1),this._pageViewEventSelector=this._pageViewEventListener=null,this.setDirection(ccui.ScrollView.DIR_HORIZONTAL),this.setMagneticType(ccui.ListView.MAGNETIC_CENTER),this.setScrollBarEnabled(!1)},addWidgetToPage:function(t,e,i){this.insertCustomItem(t,e)},addPage:function(t){this.pushBackCustomItem(t)},insertPage:function(t,e){this.insertCustomItem(t,e)},removePage:function(t){this.removeItem(this.getIndex(t))},removePageAtIndex:function(t){this.removeItem(t)},removeAllPages:function(){this.removeAllItems()},scrollToItem:function(t){ccui.ListView.prototype.scrollToItem.call(this,t,cc.p(.5,.5),cc.p(.5,.5))},scrollToPage:function(t){this.scrollToItem(t)},_doLayout:function(){if(this._refreshViewDirty){if(ccui.ListView.prototype._doLayout.call(this),this._indicator){var t=this.getIndex(this.getCenterItemInCurrentView());this._indicator.indicate(t)}this._refreshViewDirty=!1}},setDirection:function(t){ccui.ListView.prototype.setDirection.call(this,t),t===ccui.ScrollView.DIR_HORIZONTAL?this._indicatorPositionAsAnchorPoint=cc.p(.5,.1):t===ccui.ScrollView.DIR_VERTICAL&&(this._indicatorPositionAsAnchorPoint=cc.p(.1,.5)),this._indicator&&(this._indicator.setDirection(t),this._refreshIndicatorPosition())},setCustomScrollThreshold:function(t){},getCustomScrollThreshold:function(){return 0},setUsingCustomScrollThreshold:function(t){},isUsingCustomScrollThreshold:function(){return!1},_moveInnerContainer:function(t,e){ccui.ListView.prototype._moveInnerContainer.call(this,t,e),this._curPageIdx=this.getIndex(this.getCenterItemInCurrentView()),this._indicator&&this._indicator.indicate(this._curPageIdx)},_onItemListChanged:function(){ccui.ListView.prototype._onItemListChanged.call(this),this._indicator&&this._indicator.reset(this._items.length)},_onSizeChanged:function(){ccui.ListView.prototype._onSizeChanged.call(this),this._refreshIndicatorPosition()},_remedyLayoutParameter:function(t){t.setContentSize(this.getContentSize()),ccui.ListView.prototype._remedyLayoutParameter.call(this,t)},_refreshIndicatorPosition:function(){if(this._indicator){var t=this.getContentSize();this._indicator.setPosition(cc.p(t.width*this._indicatorPositionAsAnchorPoint.x,t.height*this._indicatorPositionAsAnchorPoint.y))}},_handleReleaseLogic:function(t){if(ccui.ScrollView.prototype._handleReleaseLogic.call(this,t),!(0>=this._items.length))if(t=this._flattenVectorByDirection(this._calculateTouchMoveVelocity()),500>cc.pLength(t))this._startMagneticScroll();else{var e=this.getItem(this._curPageIdx);e=this._calculateItemDestination(cc.p(.5,.5),e,cc.p(.5,.5)),e=cc.pSub(e,this.getInnerContainerPosition()),e=this._flattenVectorByDirection(e),0<t.x*e.x||0<t.y*e.y?this._startMagneticScroll():(0>t.x||0<t.y?++this._curPageIdx:--this._curPageIdx,this._curPageIdx=Math.min(this._curPageIdx,this._items.length),this._curPageIdx=Math.max(this._curPageIdx,0),this.scrollToItem(this._curPageIdx))}},_getAutoScrollStopEpsilon:function(){return.001},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING):this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING)),this._ccEventCallback&&this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(t,e){this._pageViewEventSelector=t,this._pageViewEventListener=e},addEventListener:function(t){this._ccEventCallback=function(e,i){i==ccui.ScrollView.EVENT_AUTOSCROLL_ENDED&&t(this,i)}},setCurrentPageIndex:function(t){this.jumpToItem(t,cc.p(.5,.5),cc.p(.5,.5))},setCurPageIndex:function(t){this.setCurrentPageIndex(t)},getCurrentPageIndex:function(){return this._curPageIdx},getCurPageIndex:function(){var t=this.getCenterItemInCurrentView();return this.getIndex(t)},getPages:function(){return this.getItems()},getPage:function(t){return this.getItem(t)},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(t){t=t.getPages();for(var e=0;e<t.length;e++)this.addPage(t[e].clone())},_copySpecialProperties:function(t){ccui.ListView.prototype._copySpecialProperties.call(this,t),this._ccEventCallback=t._ccEventCallback,this._pageViewEventListener=t._pageViewEventListener,this._pageViewEventSelector=t._pageViewEventSelector,this._customScrollThreshold=t._customScrollThreshold},setIndicatorEnabled:function(t){t!=(null!==this._indicator)&&(t?(this._indicator=new ccui.PageViewIndicator,this._indicator.setDirection(this.getDirection()),this.addProtectedChild(this._indicator,1e4),this.setIndicatorSelectedIndexColor(cc.color(100,100,255)),this._refreshIndicatorPosition()):(this.removeProtectedChild(this._indicator),this._indicator=null))},getIndicatorEnabled:function(){return null!==this._indicator},setIndicatorPositionAsAnchorPoint:function(t){this._indicatorPositionAsAnchorPoint=t,this._refreshIndicatorPosition()},getIndicatorPositionAsAnchorPoint:function(){return this._indicatorPositionAsAnchorPoint},setIndicatorPosition:function(t){if(this._indicator){var e=this.getContentSize();this._indicatorPositionAsAnchorPoint.x=t.x/e.width,this._indicatorPositionAsAnchorPoint.y=t.y/e.height,this._indicator.setPosition(t)}},getIndicatorPosition:function(){return cc.assert(null!==this._indicator,""),this._indicator.getPosition()},setIndicatorSpaceBetweenIndexNodes:function(t){this._indicator&&this._indicator.setSpaceBetweenIndexNodes(t)},getIndicatorSpaceBetweenIndexNodes:function(){return cc.assert(null!==this._indicator,""),this._indicator.getSpaceBetweenIndexNodes()},setIndicatorSelectedIndexColor:function(t){this._indicator&&this._indicator.setSelectedIndexColor(t)},getIndicatorSelectedIndexColor:function(){return cc.assert(null!==this._indicator,""),this._indicator.getSelectedIndexColor()},setIndicatorIndexNodesColor:function(t){this._indicator&&this._indicator.setIndexNodesColor(t)},getIndicatorIndexNodesColor:function(){return cc.assert(null!==this._indicator,""),this._indicator.getIndexNodesColor()},setIndicatorIndexNodesScale:function(t){this._indicator&&(this._indicator.setIndexNodesScale(t),this._indicator.indicate(this._curPageIdx))},getIndicatorIndexNodesScale:function(){return cc.assert(null!==this._indicator,""),this._indicator.getIndexNodesScale()},setIndicatorIndexNodesTexture:function(t,e){this._indicator&&(this._indicator.setIndexNodesTexture(t,e),this._indicator.indicate(this._curPageIdx))}}),ccui.PageView.create=function(){return new ccui.PageView},ccui.PageView.EVENT_TURNING=0,ccui.PageView.TOUCH_DIR_LEFT=0,ccui.PageView.TOUCH_DIR_RIGHT=1,ccui.PageView.DIRECTION_LEFT=0,ccui.PageView.DIRECTION_RIGHT=1,ccui.PageViewIndicator=ccui.ProtectedNode.extend({_direction:null,_indexNodes:null,_currentIndexNode:null,_spaceBetweenIndexNodes:0,_indexNodesScale:1,_indexNodesColor:null,_useDefaultTexture:!0,_indexNodesTextureFile:"",_indexNodesTexType:ccui.Widget.LOCAL_TEXTURE,_className:"PageViewIndicator",ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._direction=ccui.ScrollView.DIR_HORIZONTAL,this._indexNodes=[],this._spaceBetweenIndexNodes=ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT,this._indexNodesColor=cc.color.WHITE,this._currentIndexNode=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY),this._currentIndexNode.setVisible(!1),this.addProtectedChild(this._currentIndexNode,1)},setDirection:function(t){this._direction=t,this._rearrange()},reset:function(t){for(;this._indexNodes.length<t;)this._increaseNumberOfPages();for(;this._indexNodes.length>t;)this._decreaseNumberOfPages();this._rearrange(),this._currentIndexNode.setVisible(0<this._indexNodes.length)},indicate:function(t){0>t||t>=this._indexNodes.length||this._currentIndexNode.setPosition(this._indexNodes[t].getPosition())},_rearrange:function(){if(0!==this._indexNodes.length)for(var t=this._direction===ccui.ScrollView.DIR_HORIZONTAL,e=this._indexNodes[0].getContentSize(),i=t?e.width:e.height,n=-(i*(n=this._indexNodes.length)+this._spaceBetweenIndexNodes*(n-1))/2+i/2,r=0;r<this._indexNodes.length;++r){var o;o=t?cc.p(n,e.height/2):cc.p(e.width/2,-n),this._indexNodes[r].setPosition(o),n+=i+this._spaceBetweenIndexNodes}},setSpaceBetweenIndexNodes:function(t){this._spaceBetweenIndexNodes!==t&&(this._spaceBetweenIndexNodes=t,this._rearrange())},getSpaceBetweenIndexNodes:function(){return this._spaceBetweenIndexNodes},setSelectedIndexColor:function(t){this._currentIndexNode.setColor(t)},getSelectedIndexColor:function(){return this._currentIndexNode.getColor()},setIndexNodesColor:function(t){this._indexNodesColor=t;for(var e=0;e<this._indexNodes.length;++e)this._indexNodes[e].setColor(t)},getIndexNodesColor:function(){var t=this._indexNodesColor;return cc.color(t.r,t.g,t.b,t.a)},setIndexNodesScale:function(t){if(this._indexNodesScale!==t){for(this._indexNodesScale=t,this._currentIndexNode.setScale(t),t=0;t<this._indexNodes.length;++t)this._indexNodes[t].setScale(this,_indexNodesScale);this._rearrange()}},getIndexNodesScale:function(){return this._indexNodesScale},setIndexNodesTexture:function(t,e){switch(void 0===e&&(e=ccui.Widget.LOCAL_TEXTURE),this._useDefaultTexture=!1,this._indexNodesTextureFile=t,this._indexNodesTexType=e,e){case ccui.Widget.LOCAL_TEXTURE:for(this._currentIndexNode.setTexture(t),e=0;e<this._indexNodes.length;++e)this._indexNodes[e].setTexture(t);break;case ccui.Widget.PLIST_TEXTURE:for(this._currentIndexNode.setSpriteFrame(t),e=0;e<this._indexNodes.length;++e)this._indexNodes[e].setSpriteFrame(t)}this._rearrange()},_increaseNumberOfPages:function(){var t;if(this._useDefaultTexture)t=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY);else switch(t=new cc.Sprite,this._indexNodesTexType){case ccui.Widget.LOCAL_TEXTURE:t.initWithFile(this._indexNodesTextureFile);break;case ccui.Widget.PLIST_TEXTURE:t.initWithSpriteFrameName(this._indexNodesTextureFile)}t.setColor(this._indexNodesColor),t.setScale(this._indexNodesScale),this.addProtectedChild(t),this._indexNodes.push(t)},_decreaseNumberOfPages:function(){0!==this._indexNodes.length&&(this.removeProtectedChild(this._indexNodes[0]),this._indexNodes.splice(0,1))},clear:function(){for(var t=0;t<this._indexNodes.length;++t)this.removeProtectedChild(this._indexNodes[t]);this._indexNodes.length=0,this._currentIndexNode.setVisible(!1)}}),_p=ccui.PageViewIndicator.prototype,cc.defineGetterSetter(_p,"spaceBetweenIndexNodes",_p.getSpaceBetweenIndexNodes,_p.setSpaceBetweenIndexNodes),ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT=23,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY="/__circle_image",ccui.PageViewIndicator.CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAA8ElEQVRIx62VyRGCQBBF+6gWRCEmYDIQkhiBCgHhSclC8YqWzOV5oVzKAYZp3r1/9fpbxAIBMTsKrjx5cqVgR0wgLhCRUWOjJiPqD56xoaGPhpRZV/iSEy6crHmw5oIrF9b/lVeMofrJgjlnxlIy/wik+JB+mme8BExbBhm+5CJC2LE2LtSEQoyGWDioBA5CoRIohJtK4CYDxzNEM4GAugR1E9VjVC+SZpXvhCJCrjomESLvc17pDGX7bWmlh6UtpjPVCWy9zaJ0TD7qfm3pwERMz2trRVZk3K3BD/L34AY+dEDCniMVBkPFkT2J/b2/AIV+dRpFLOYoAAAAAElFTkSuQmCC",function(){if(ccui.ProtectedNode.CanvasRenderCmd){ccui.ScrollView.CanvasRenderCmd=function(t){this._layoutCmdCtor(t),this._dirty=!1};var t=ccui.ScrollView.CanvasRenderCmd.prototype=Object.create(ccui.Layout.CanvasRenderCmd.prototype);t.constructor=ccui.ScrollView.CanvasRenderCmd,t.rendering=function(t){var e,i=cc.renderer._cacheToCanvasCmds[this._node.__instanceId],n=cc.view.getScaleX(),r=cc.view.getScaleY(),o=t||cc._renderContext;for(o.computeRealOffsetY(),this._node.updateChildren(),t=0,e=i.length;t<e;t++){var c=i[t]._node;c instanceof ccui.ScrollView||c&&c._parent&&!1===c._parent._inViewRect||i[t].rendering(o,n,r)}}}}(),function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.ScrollView.WebGLRenderCmd=function(t){this._layoutCmdCtor(t),this._needDraw=!0,this._dirty=!1};var t=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype);t.constructor=ccui.ScrollView.WebGLRenderCmd,t.rendering=function(t){var e,i,n,r=cc.renderer._cacheToBufferCmds[this._node.__instanceId],o=t||cc._renderContext;if(r)for(this._node.updateChildren(),o.bindBuffer(gl.ARRAY_BUFFER,null),t=0,e=r.length;t<e;t++)(i=(n=r[t])._node)&&i._parent&&!1===i._parent._inViewRect||(n.uploadData?cc.renderer._uploadBufferData(n):(0<n._batchingSize&&cc.renderer._batchRendering(),n.rendering(o)),cc.renderer._batchRendering())}}}(),cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=t.constructor.prototype.__pid;if(!e){var i={writable:!0,enumerable:!1,configurable:!0};i.value=ClassManager.getNewID(),Object.defineProperty(t.constructor.prototype,"__pid",i)}this._pool[e]||(this._pool[e]=[]),t.retain&&t.retain(),t.unuse&&t.unuse(),this._pool[e].push(t)},hasObject:function(t){return!(!(t=this._pool[t.prototype.__pid])||0===t.length)},removeObject:function(t){var e=t.constructor.prototype.__pid;if(e&&(e=this._pool[e]))for(var i=0;i<e.length;i++)t===e[i]&&(t.release&&t.release(),e.splice(i,1))},getFromPool:function(t){if(this.hasObject(t)){var e=this._pool[t.prototype.__pid],i=Array.prototype.slice.call(arguments);return i.shift(),(e=e.pop()).reuse&&e.reuse.apply(e,i),cc.sys.isNative&&e.release&&this._autoRelease(e),e}},drainAllPools:function(){for(var t in this._pool)for(var e=0;e<this._pool[t].length;e++){var i=this._pool[t][e];i.release&&i.release()}this._pool={}}};